# ═══════════════════════════════════════════════════════════════════════════════
# SAHOOL v16.0.0 Platform Environment Configuration
# Complete unified environment for 39 services + infrastructure
# Copy this file to .env and fill in your values
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# Core Application Settings
# ─────────────────────────────────────────────────────────────────────────────
# Environment type: development, staging, production
ENVIRONMENT=development

# Logging level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# Node.js environment for frontend services
NODE_ENV=production

# ─────────────────────────────────────────────────────────────────────────────
# Database Configuration (REQUIRED) - TLS ENFORCED
# تكوين قاعدة البيانات (مطلوب) - TLS إلزامي
# ─────────────────────────────────────────────────────────────────────────────
# PostgreSQL credentials
POSTGRES_USER=sahool
POSTGRES_PASSWORD=change_this_secure_password_in_production
POSTGRES_DB=sahool
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_CONTAINER=sahool-postgres

# TLS/SSL Configuration (REQUIRED for production)
# Generate certificates: cd config/certs && ./generate-internal-tls.sh
POSTGRES_SSL_MODE=require
POSTGRES_SSL_CERT=/certs/client.crt
POSTGRES_SSL_KEY=/certs/client.key
POSTGRES_SSL_ROOT_CERT=/certs/ca.crt
PGSSLMODE=require

# Default DATABASE_URL for services (uses PgBouncer for connection pooling)
DATABASE_URL=postgresql://sahool:change_this_secure_password_in_production@pgbouncer:6432/sahool?sslmode=require&pgbouncer=true&connection_limit=8&pool_timeout=20&connect_timeout=10&statement_timeout=30000

# Direct PostgreSQL connection (for migrations only - bypasses PgBouncer)
DATABASE_URL_DIRECT=postgresql://sahool:change_this_secure_password_in_production@postgres:5432/sahool?sslmode=require&connect_timeout=10&keepalives=1&keepalives_idle=30&keepalives_interval=10&keepalives_count=5

# Service-Specific Connection URLs (Optimized per service workload)
# High Traffic Services (10 connections): user-service, chat-service, marketplace-service
DATABASE_URL_HIGH_TRAFFIC=postgresql://sahool:change_this_secure_password_in_production@pgbouncer:6432/sahool?sslmode=require&pgbouncer=true&connection_limit=10&pool_timeout=20&connect_timeout=10&statement_timeout=30000

# Medium Traffic Services (8 connections): research-core, inventory-service, field-management-service
DATABASE_URL_MEDIUM_TRAFFIC=postgresql://sahool:change_this_secure_password_in_production@pgbouncer:6432/sahool?sslmode=require&pgbouncer=true&connection_limit=8&pool_timeout=20&connect_timeout=10&statement_timeout=30000

# Low Traffic Services (6 connections): weather-service, iot-service
DATABASE_URL_LOW_TRAFFIC=postgresql://sahool:change_this_secure_password_in_production@pgbouncer:6432/sahool?sslmode=require&pgbouncer=true&connection_limit=6&pool_timeout=20&connect_timeout=10&statement_timeout=30000

# Legacy URLs (for backward compatibility)
DATABASE_URL_POOLED=postgresql://sahool:change_this_secure_password_in_production@pgbouncer:6432/sahool?sslmode=require&pgbouncer=true&connection_limit=8&pool_timeout=20
PRISMA_DATABASE_URL=postgresql://sahool:change_this_secure_password_in_production@pgbouncer:6432/sahool?sslmode=require&pgbouncer=true&connection_limit=8&pool_timeout=20
SQLALCHEMY_DATABASE_URL=postgresql+asyncpg://sahool:change_this_secure_password_in_production@pgbouncer:6432/sahool?ssl=require

# ─────────────────────────────────────────────────────────────────────────────
# Database Connection Pooling & Performance
# تكوين تجميع الاتصالات بقاعدة البيانات والأداء
# ─────────────────────────────────────────────────────────────────────────────
# Prisma Connection Pooling
PRISMA_POOL_TIMEOUT=20
PRISMA_CONNECT_TIMEOUT=10
PRISMA_QUERY_TIMEOUT=30000
PRISMA_STATEMENT_TIMEOUT=30000
PRISMA_IDLE_TIMEOUT=600
PRISMA_CONNECTION_LIFETIME=3600

# TCP Keepalive Settings (prevents connection drops through firewalls)
PG_TCP_KEEPALIVE=1
PG_KEEPALIVES_IDLE=30
PG_KEEPALIVES_INTERVAL=10
PG_KEEPALIVES_COUNT=5

# SQLAlchemy Connection Pooling (Python Services)
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_POOL_PRE_PING=true
DB_ECHO=false

# Database Retry Configuration
DB_MAX_RETRIES=3
DB_RETRY_DELAY_SECONDS=1
DB_RETRY_BACKOFF_FACTOR=2.0
DB_RETRY_MAX_DELAY_SECONDS=30

# ─────────────────────────────────────────────────────────────────────────────
# Redis Configuration (REQUIRED) - Enhanced Security
# تكوين Redis (مطلوب) - أمان محسّن
# ─────────────────────────────────────────────────────────────────────────────
# SECURITY: Generate strong password with: openssl rand -base64 32
# Used for:
# - Session storage and caching (DB 0)
# - Kong API Gateway rate limiting (DB 1)
# - All 18+ microservices require authentication
#
# Security features enabled:
# - Password authentication (requirepass)
# - Dangerous commands renamed (FLUSHDB, CONFIG, etc.)
# - AOF + RDB persistence
# - Memory limits (512MB) with LRU eviction
# - Protected mode + connection limits
#
# Documentation: /infrastructure/redis/REDIS_SECURITY.md
REDIS_PASSWORD=change_this_secure_redis_password
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_MAXMEMORY=512mb
REDIS_CONTAINER=sahool-redis

# Redis ACL User Passwords (Optional - Enable for enhanced security)
# REDIS_APP_PASSWORD=change_this_app_user_password_32_chars_minimum
# REDIS_ADMIN_PASSWORD=change_this_admin_user_password_32_chars_minimum
# REDIS_KONG_PASSWORD=change_this_kong_user_password_32_chars_minimum
# REDIS_READONLY_PASSWORD=change_this_readonly_user_password_32_chars_minimum

# TLS Configuration (REQUIRED for production)
REDIS_SSL_ENABLED=true
REDIS_TLS_PORT=6380
REDIS_SSL_CERT=/certs/redis-client.crt
REDIS_SSL_KEY=/certs/redis-client.key
REDIS_SSL_CA=/certs/ca.crt

# Connection URL with TLS (use rediss:// protocol)
REDIS_URL=rediss://:change_this_secure_redis_password@redis:6380/0?ssl_cert_reqs=required&ssl_ca_certs=/certs/ca.crt
# Insecure URL (development only - DO NOT use in production)
# REDIS_URL=redis://:change_this_secure_redis_password@redis:6379/0

# ─────────────────────────────────────────────────────────────────────────────
# Message Queue Configuration (NATS with Authentication)
# تكوين قائمة الرسائل (NATS مع المصادقة)
# ─────────────────────────────────────────────────────────────────────────────
# NATS Authentication Credentials (REQUIRED)
# Generate secure passwords with: openssl rand -base64 32
NATS_USER=sahool_app
NATS_PASSWORD=change_this_secure_nats_password_32_chars_min
NATS_ADMIN_USER=nats_admin
NATS_ADMIN_PASSWORD=change_this_secure_nats_admin_password_32_chars
NATS_MONITOR_USER=nats_monitor
NATS_MONITOR_PASSWORD=change_this_secure_nats_monitor_password_32_chars
NATS_SYSTEM_USER=nats_system
NATS_SYSTEM_PASSWORD=change_this_secure_nats_system_password

# NATS Cluster Authentication (for multi-node deployments)
NATS_CLUSTER_USER=nats_cluster
NATS_CLUSTER_PASSWORD=change_this_secure_nats_cluster_password_32_chars

# TLS Configuration (REQUIRED for production)
NATS_TLS_ENABLED=true
NATS_TLS_PORT=4223
NATS_TLS_CERT=/certs/nats-client.crt
NATS_TLS_KEY=/certs/nats-client.key
NATS_TLS_CA=/certs/ca.crt

# NATS Connection URL with TLS (use tls:// protocol)
NATS_URL=tls://${NATS_USER}:${NATS_PASSWORD}@nats:4223?tls_ca_file=/certs/ca.crt&tls_verify=true
# Insecure URL (development only - DO NOT use in production)
# NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222

# NATS Subject patterns (for service subscriptions)
NATS_SUBJECT=sahool.notifications.*

# NATS JetStream encryption key
NATS_JETSTREAM_KEY=change_this_generate_32_byte_jetstream_key

# NATS Prometheus Exporter Configuration
NATS_EXPORTER_LISTEN_ADDRESS=0.0.0.0:7777
NATS_EXPORTER_LISTEN_PATH=/metrics

# ─────────────────────────────────────────────────────────────────────────────
# JWT Configuration (REQUIRED)
# تكوين JWT (مطلوب)
# ─────────────────────────────────────────────────────────────────────────────
# Primary JWT secret key (minimum 32 characters)
JWT_SECRET_KEY=change_this_jwt_secret_key_at_least_32_characters_long
JWT_ALGORITHM=HS256

# Token expiration settings (OWASP recommendations)
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# JWT claims configuration
JWT_AUDIENCE=sahool-api
JWT_ISSUER=sahool-platform

# Alias for service compatibility
JWT_SECRET=${JWT_SECRET_KEY}
JWT_EXPIRES_IN=7d

# Token Revocation (for user-service)
TOKEN_REVOCATION_ENABLED=true

# ─────────────────────────────────────────────────────────────────────────────
# Kong API Gateway Configuration
# تكوين بوابة Kong API
# ─────────────────────────────────────────────────────────────────────────────
# Tier-specific JWT Secrets (minimum 32 characters each)
# Generate with: openssl rand -base64 32
STARTER_JWT_SECRET=change_this_starter_jwt_secret_min_32_chars
PROFESSIONAL_JWT_SECRET=change_this_professional_jwt_secret_min_32_chars
ENTERPRISE_JWT_SECRET=change_this_enterprise_jwt_secret_min_32_chars
RESEARCH_JWT_SECRET=change_this_research_jwt_secret_min_32_chars
ADMIN_JWT_SECRET=change_this_admin_jwt_secret_min_32_chars
SERVICE_JWT_SECRET=change_this_service_jwt_secret_min_32_chars
TRIAL_JWT_SECRET=change_this_trial_jwt_secret_min_32_chars

# CORS Configuration (comma-separated list of allowed origins)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080,https://sahool.com,https://app.sahool.com,https://admin.sahool.app,https://api.sahool.app

# Rate Limiting Redis Configuration
KONG_RATE_LIMIT_REDIS_HOST=redis
KONG_RATE_LIMIT_REDIS_PORT=6379
KONG_RATE_LIMIT_REDIS_DB=1

# Admin API Security (bind to localhost only)
KONG_ADMIN_LISTEN=127.0.0.1:8001

# ─────────────────────────────────────────────────────────────────────────────
# Security & Authentication Settings
# إعدادات الأمان والمصادقة
# ─────────────────────────────────────────────────────────────────────────────
# Application secret key for session signing
APP_SECRET_KEY=change_this_app_secret_key_at_least_32_characters
SIGNATURE_SECRET_KEY=

# Authentication settings
SAHOOL_AUTH_ENABLED=true

# MFA Configuration (enabled by default for admin users)
MFA_ENABLED=true
MFA_ENFORCEMENT_LEVEL=required_for_admin
TOTP_ISSUER=SAHOOL

# Login protection
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=30

# WebSocket authentication
WS_REQUIRE_AUTH=true

# ─────────────────────────────────────────────────────────────────────────────
# Rate Limiting Configuration
# تكوين تحديد المعدل
# ─────────────────────────────────────────────────────────────────────────────
# Enable/disable rate limiting globally
RATE_LIMIT_ENABLED=true

# Free Tier Rate Limits
RATE_LIMIT_FREE_RPM=30
RATE_LIMIT_FREE_RPH=500
RATE_LIMIT_FREE_BURST=5

# Standard Tier Rate Limits
RATE_LIMIT_STANDARD_RPM=60
RATE_LIMIT_STANDARD_RPH=2000
RATE_LIMIT_STANDARD_BURST=10

# Premium Tier Rate Limits
RATE_LIMIT_PREMIUM_RPM=120
RATE_LIMIT_PREMIUM_RPH=5000
RATE_LIMIT_PREMIUM_BURST=20

# Internal Services Rate Limits
RATE_LIMIT_INTERNAL_RPM=1000
RATE_LIMIT_INTERNAL_RPH=50000
RATE_LIMIT_INTERNAL_BURST=100

# General Rate Limiting (for auth middleware)
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW_SECONDS=60

# ─────────────────────────────────────────────────────────────────────────────
# Frontend Configuration (Web & Admin Apps)
# تكوين الواجهات الأمامية
# ─────────────────────────────────────────────────────────────────────────────
# API Gateway URL (Kong on port 8000)
NEXT_PUBLIC_API_URL=http://localhost:8000

# WebSocket Gateway URL (ws-gateway on port 8081)
NEXT_PUBLIC_WS_URL=ws://localhost:8081

# For production:
# NEXT_PUBLIC_API_URL=https://api.sahool.app
# NEXT_PUBLIC_WS_URL=wss://ws.sahool.app

# ─────────────────────────────────────────────────────────────────────────────
# Service Discovery & URLs
# عناوين URL للخدمات
# ─────────────────────────────────────────────────────────────────────────────
BASE_URL=http://localhost:8000
SAHOOL_API_URL=http://kong:8000
KONG_URL=http://kong:8000

# Primary Services (Current - Use These)
FIELD_MANAGEMENT_URL=http://field-management-service:3000
WEATHER_SERVICE_URL=http://weather-service:8092
VEGETATION_ANALYSIS_URL=http://vegetation-analysis-service:8090
ADVISORY_SERVICE_URL=http://advisory-service:8093
CROP_INTELLIGENCE_URL=http://crop-intelligence-service:8095
YIELD_PREDICTION_URL=http://yield-prediction-service:8098
NOTIFICATION_SERVICE_URL=http://notification-service:8110
IOT_GATEWAY_URL=http://iot-gateway:8106
TASK_SERVICE_URL=http://task-service:8103
ASTRONOMICAL_SERVICE_URL=http://astronomical-calendar:8111
ALERT_SERVICE_URL=http://alert-service:8113
FIELD_INTELLIGENCE_URL=http://field-intelligence:8120
CHAT_SERVICE_URL=http://chat-service:8114
USER_SERVICE_URL=http://user-service:3025
MARKETPLACE_SERVICE_URL=http://marketplace-service:3010

# Legacy Service URLs (Deprecated - For backward compatibility, will be removed in v17.0.0)
FIELDOPS_URL=http://field-management-service:3000
WEATHER_URL=http://weather-service:8092
SATELLITE_URL=http://vegetation-analysis-service:8090
SATELLITE_SERVICE_URL=http://vegetation-analysis-service:8090
FERTILIZER_URL=http://advisory-service:8093
IRRIGATION_URL=http://irrigation-smart:8094
INDICATORS_URL=http://indicators-service:8091
CROP_HEALTH_URL=http://crop-intelligence-service:8095
AGRO_ADVISOR_URL=http://advisory-service:8093
NDVI_URL=http://vegetation-analysis-service:8090
NDVI_SERVICE_URL=http://vegetation-analysis-service:8090

# ─────────────────────────────────────────────────────────────────────────────
# MinIO Configuration - S3-Compatible Object Storage
# تكوين MinIO - تخزين كائنات متوافق مع S3
# ─────────────────────────────────────────────────────────────────────────────
# SECURITY HARDENED: TLS enabled, SSE encryption, audit logging
# CRITICAL: Replace ALL default values with strong, unique credentials
# Generate secure credentials: openssl rand -base64 32

# Root Credentials (REQUIRED - minimum 16 characters)
MINIO_ROOT_USER=change_this_minio_admin_username
MINIO_ROOT_PASSWORD=change_this_minio_secure_password

# Alternative environment variable names (for compatibility)
MINIO_ACCESS_KEY=change_this_minio_admin_username
MINIO_SECRET_KEY=change_this_minio_secure_password

# Endpoint Configuration
MINIO_ENDPOINT=https://minio:9000
MINIO_ALIAS=primary
MINIO_SERVER_URL=https://minio:9000
MINIO_DOMAIN=minio.sahool.local

# Server-Side Encryption (SSE) Configuration
# Master encryption key (generate with: openssl rand -base64 32)
MINIO_ENCRYPTION_MASTER_KEY=change_this_generate_32_byte_key_with_openssl
MINIO_KMS_SECRET_KEY=sahool-minio-key:${MINIO_ENCRYPTION_MASTER_KEY}

# Security Configuration
MINIO_BROWSER=off
MINIO_PROMETHEUS_AUTH_TYPE=jwt
MINIO_AUDIT_WEBHOOK_ENABLE=on

# API Configuration
MINIO_API_REQUESTS_MAX=1000
MINIO_API_REQUESTS_DEADLINE=10s
MINIO_REGION=us-east-1

# Bucket Configuration
MINIO_BUCKETS=uploads,documents,images,backups,milvus-bucket
MINIO_BACKUP_BUCKETS=sahool-backups,sahool-backups-archive,postgres-backups,redis-backups,minio-backups

# Milvus service account credentials (generated after running setup-minio-security.sh)
MILVUS_MINIO_ACCESS_KEY=<will-be-generated>
MILVUS_MINIO_SECRET_KEY=<will-be-generated>

# ─────────────────────────────────────────────────────────────────────────────
# MQTT Configuration (REQUIRED for IoT services)
# تكوين MQTT (مطلوب لخدمات إنترنت الأشياء)
# ─────────────────────────────────────────────────────────────────────────────
# SECURITY: MQTT broker requires authentication (allow_anonymous=false)
# ACL-based topic permissions are enforced for fine-grained access control
# Generate secure password with: openssl rand -base64 24
MQTT_BROKER=mqtt
MQTT_PORT=1883
MQTT_USER=sahool_iot
MQTT_PASSWORD=change_this_secure_mqtt_password
MQTT_TOPIC=sahool/sensors/#

# ─────────────────────────────────────────────────────────────────────────────
# Etcd Configuration (REQUIRED for Milvus metadata storage)
# تكوين Etcd (مطلوب لتخزين بيانات Milvus)
# ─────────────────────────────────────────────────────────────────────────────
ETCD_ROOT_USERNAME=root
ETCD_ROOT_PASSWORD=change_this_secure_etcd_password
ETCD_CONTAINER=sahool-etcd
ETCD_ENDPOINTS=127.0.0.1:2379

# ETCD Client configuration (for etcdctl)
ETCDCTL_API=3
ETCDCTL_ENDPOINTS=etcd:2379
ETCDCTL_USER=root
ETCDCTL_PASSWORD=change_this_secure_etcd_password

# ETCD Storage configuration
ETCD_SNAPSHOT_COUNT=10000
ETCD_AUTO_COMPACTION_MODE=revision
ETCD_AUTO_COMPACTION_RETENTION=1000
ETCD_QUOTA_BACKEND_BYTES=4294967296

# ETCD TLS configuration (if enabled)
ETCD_TLS_ENABLED=false
ETCD_CACERT=
ETCD_CERT=
ETCD_KEY=
ETCD_USER=root

# ─────────────────────────────────────────────────────────────────────────────
# AI/ML Services Configuration
# تكوين خدمات الذكاء الاصطناعي
# ─────────────────────────────────────────────────────────────────────────────
# Multi-Provider LLM Configuration (AI Advisor)
PRIMARY_LLM_PROVIDER=anthropic

# Anthropic Claude AI (Primary - Recommended)
ANTHROPIC_API_KEY=
CLAUDE_MODEL=claude-3-5-sonnet-20241022

# OpenAI GPT (Optional Fallback)
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o

# Google Gemini (Optional)
GOOGLE_API_KEY=
GEMINI_MODEL=gemini-1.5-pro

# Qdrant Vector Database (for RAG/semantic search)
QDRANT_HOST=qdrant
QDRANT_PORT=6333
QDRANT_GRPC_PORT=6334
QDRANT_API_KEY=
QDRANT_CONTAINER=sahool-qdrant
QDRANT__LOG_LEVEL=INFO
QDRANT__SERVICE__API_KEY=
QDRANT__SERVICE__GRPC_PORT=6334
EMBEDDING_MODEL=paraphrase-multilingual-MiniLM-L12-v2

# AI Model Configuration
AI_MODEL_ENDPOINT=http://localhost:8080/predict
MODEL_PATH=/models
USE_LOCAL_MODEL=false
CONFIDENCE_THRESHOLD=0.8
EXPERT_REVIEW_THRESHOLD=0.6
SIGNIFICANT_CHANGE_PERCENT=10

# ─────────────────────────────────────────────────────────────────────────────
# Ollama Local LLM Configuration (Optional - for GPU deployments)
# تكوين Ollama للنماذج اللغوية المحلية (اختياري - لعمليات GPU)
# ─────────────────────────────────────────────────────────────────────────────
# Enable Ollama with 'docker compose --profile gpu up'
OLLAMA_HOST=0.0.0.0
OLLAMA_URL=http://ollama:11434
OLLAMA_MODEL=llama3.2
OLLAMA_ORIGINS=*
OLLAMA_KEEP_ALIVE=24h
OLLAMA_NUM_PARALLEL=24
OLLAMA_MAX_LOADED_MODELS=2

# GPU Configuration
OLLAMA_NUM_GPU=1
CUDA_VISIBLE_DEVICES=0
OLLAMA_GPU_LAYERS=999

# ─────────────────────────────────────────────────────────────────────────────
# Weather API Providers (Multi-Provider Support)
# موفرو واجهة برمجة تطبيقات الطقس
# ─────────────────────────────────────────────────────────────────────────────
USE_MULTI_PROVIDER=true
USE_MOCK_WEATHER=false

# OpenWeatherMap (Optional)
OPENWEATHERMAP_API_KEY=

# WeatherAPI (Optional)
WEATHERAPI_KEY=

# Yemen Meteorological Service (Regional provider)
YEMEN_MET_ENABLED=false
YEMEN_MET_API_KEY=

# Weather Service Cache Configuration
WEATHER_CACHE_ENABLED=true
WEATHER_CACHE_TTL_MINUTES=30
WEATHER_CACHE_CURRENT_TTL=1800
WEATHER_CACHE_FORECAST_TTL=3600
WEATHER_ALERTS_ENABLED=true
WEATHER_AG_INDICES_ENABLED=true

# Agricultural Weather Thresholds (Crop-specific)
GDD_BASE_TEMP=10
CHILL_HOURS_THRESHOLD=7.2
FROST_CRITICAL_TEMP=0
HEAT_WAVE_CRITICAL_TEMP=35
HEAVY_RAIN_CRITICAL_MM=50

# ─────────────────────────────────────────────────────────────────────────────
# Satellite Imagery Providers (Multi-Provider Support)
# موفرو صور الأقمار الصناعية
# ─────────────────────────────────────────────────────────────────────────────
# Sentinel Hub (ESA Copernicus - Free tier: 30,000 units/month)
# Register at: https://www.sentinel-hub.com/
SENTINEL_HUB_CLIENT_ID=
SENTINEL_HUB_CLIENT_SECRET=

# NASA Earthdata (Free - MODIS/VIIRS data)
# Register at: https://urs.earthdata.nasa.gov/
NASA_EARTHDATA_USERNAME=
NASA_EARTHDATA_PASSWORD=

# Planet Labs (Paid - High-resolution imagery)
PLANET_API_KEY=
PLANET_CLIENT_ID=

# ─────────────────────────────────────────────────────────────────────────────
# Payment Gateway Configuration
# تكوين بوابة الدفع
# ─────────────────────────────────────────────────────────────────────────────
# Stripe (International payments)
STRIPE_API_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PUBLISHABLE_KEY=

# Tharwatt (MENA region - Yemen)
THARWATT_BASE_URL=https://developers-test.tharwatt.com:5253
THARWATT_API_KEY=
THARWATT_MERCHANT_ID=
THARWATT_WEBHOOK_SECRET=

# Currency Configuration
DEFAULT_CURRENCY=YER
YER_EXCHANGE_RATE=250.0

# ─────────────────────────────────────────────────────────────────────────────
# Email & SMS Notifications
# إشعارات البريد الإلكتروني والرسائل القصيرة
# ─────────────────────────────────────────────────────────────────────────────
# SMTP Configuration (Email Notifications)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=noreply@sahool.com
SMTP_FROM_NAME=SAHOOL Platform
SMTP_FROM=backups@sahool.com

# SendGrid Email Configuration (Alternative to SMTP)
SENDGRID_API_KEY=
SENDGRID_FROM_EMAIL=notifications@sahool.app
SENDGRID_FROM_NAME=SAHOOL Agriculture Platform

# Firebase Configuration (Optional - for mobile push notifications)
FIREBASE_PROJECT_ID=
FIREBASE_CREDENTIALS=
FCM_SERVER_KEY=
FIREBASE_CREDENTIALS_PATH=/path/to/firebase-credentials.json
FIREBASE_CREDENTIALS_JSON=

# SMS Configuration
SMS_PROVIDER=twilio
SMS_API_KEY=
SMS_API_SECRET=
SMS_FROM_NUMBER=

# Twilio (SMS)
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=
TWILIO_FROM_NUMBER=

# ─────────────────────────────────────────────────────────────────────────────
# File Upload & Storage Configuration
# تكوين تحميل الملفات والتخزين
# ─────────────────────────────────────────────────────────────────────────────
UPLOAD_DIR=/uploads
AVATAR_UPLOAD_PATH=/uploads/avatars
CDN_URL=https://cdn.sahool.com
MAX_FILE_SIZE=10485760

# Google Maps
GOOGLE_MAPS_API_KEY=

# ─────────────────────────────────────────────────────────────────────────────
# Observability & Monitoring
# المراقبة والرصد
# ─────────────────────────────────────────────────────────────────────────────
# Grafana Admin Credentials (REQUIRED for observability stack)
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=change_this_secure_grafana_password
GRAFANA_ROOT_URL=http://localhost:3002

# Prometheus Configuration
PROMETHEUS_METRICS_ENABLED=true
PROMETHEUS_MULTIPROC_DIR=/tmp/prometheus_multiproc
METRICS_FILE=/backups/metrics/backup_metrics.prom
METRICS_REFRESH_INTERVAL=300

# OpenTelemetry Configuration (Optional - for distributed tracing)
OTEL_EXPORTER_OTLP_ENDPOINT=
OTEL_EXPORTER_OTLP_PROTOCOL=grpc
OTEL_SERVICE_NAME=
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1

# Health Check Configuration
HEALTH_CHECK_INTERVAL_SECONDS=30
HEALTH_CHECK_TIMEOUT_SECONDS=5

# ─────────────────────────────────────────────────────────────────────────────
# Secrets Management Configuration
# تكوين إدارة الأسرار
# ─────────────────────────────────────────────────────────────────────────────
# Choose your secrets backend:
# - environment: Use environment variables (default, good for development)
# - vault: HashiCorp Vault (recommended for production)
# - aws_secrets_manager: AWS Secrets Manager (for AWS deployments)
# - azure_key_vault: Azure Key Vault (for Azure deployments)
SECRET_BACKEND=environment

# HashiCorp Vault Configuration (Required when SECRET_BACKEND=vault)
VAULT_ADDR=http://localhost:8200
VAULT_TOKEN=
VAULT_ROLE_ID=
VAULT_SECRET_ID=
VAULT_NAMESPACE=
VAULT_MOUNT_POINT=secret
VAULT_PATH_PREFIX=sahool
VAULT_BACKUP_INTEGRATION=false
VAULT_BACKUP_KEY_PATH=secret/backups/encryption-key

# AWS Secrets Manager Configuration (Required when SECRET_BACKEND=aws_secrets_manager)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_SECRETS_PREFIX=sahool/

# Azure Key Vault Configuration (Required when SECRET_BACKEND=azure_key_vault)
AZURE_KEY_VAULT_URL=
AZURE_TENANT_ID=
AZURE_CLIENT_ID=
AZURE_CLIENT_SECRET=

# Local Secrets Encryption (Optional)
# Generate key with: python -c "import base64, os; print(base64.urlsafe_b64encode(os.urandom(32)).decode())"
ENCRYPTION_KEY=
ENCRYPTION_KEY_FILE=
ENCRYPTED_SECRETS_FILE=/var/secrets/sahool.enc

# ─────────────────────────────────────────────────────────────────────────────
# Caching Configuration
# تكوين التخزين المؤقت
# ─────────────────────────────────────────────────────────────────────────────
CACHE_ENABLED=true
CACHE_TTL_SECONDS=300
CACHE_MAX_SIZE=10000

# Cache keys TTL (seconds)
CACHE_TTL_USER_DATA=600
CACHE_TTL_FIELD_DATA=300
CACHE_TTL_WEATHER_DATA=1800
CACHE_TTL_SATELLITE_DATA=3600

# ─────────────────────────────────────────────────────────────────────────────
# API Pagination & Limits
# ترقيم الصفحات وحدود API
# ─────────────────────────────────────────────────────────────────────────────
DEFAULT_PAGE_SIZE=50
MAX_PAGE_SIZE=1000
ENABLE_STREAMING_RESPONSES=true

# Application Limits & Retry Configuration
MAX_NOTIFICATIONS_PER_HOUR=100
MAX_RETRIES=3
RETRY_DELAY_SECONDS=5
MAINTENANCE_CHECK_INTERVAL=3600
PLAN_LIMITS={"free":{"fields":10},"pro":{"fields":100},"enterprise":{"fields":-1}}
TRIAL_DAYS=14

# ─────────────────────────────────────────────────────────────────────────────
# Service Configuration
# تكوين الخدمات
# ─────────────────────────────────────────────────────────────────────────────
SERVICE_NAME=sahool-platform
SERVICE_LAYER=kernel
DEFAULT_TENANT=default

# Port Configuration (for reference - overridden in docker-compose)
PORT=8000
SERVICE_PORT=8000

# ─────────────────────────────────────────────────────────────────────────────
# Development & Debug Configuration
# تكوين التطوير والتصحيح
# ─────────────────────────────────────────────────────────────────────────────
# WARNING: Set these to false in production environments
DEBUG=false
RELOAD=false
SQL_ECHO=false
ALLOW_DEV_DEFAULTS=false
SEED_DEMO_DATA=false
CREATE_DB_SCHEMA=false
INCLUDE_STACK_TRACE=false
LOG_REQUEST_BODY=false

# ─────────────────────────────────────────────────────────────────────────────
# MCP Server Configuration (Model Context Protocol)
# تكوين خادم MCP (بروتوكول سياق النموذج)
# ─────────────────────────────────────────────────────────────────────────────
# MCP Server exposes SAHOOL capabilities to AI assistants (Claude, ChatGPT, etc.)
MCP_SERVER_HOST=0.0.0.0
MCP_SERVER_PORT=8200

# ─────────────────────────────────────────────────────────────────────────────
# Demo Mode Configuration
# تكوين وضع العرض التوضيحي
# ─────────────────────────────────────────────────────────────────────────────
# Demo data service simulates API data flow for testing and demonstrations
DEMO_MODE=continuous
DEMO_INTERVAL_SECONDS=30
DEMO_TENANT_ID=a0000000-0000-0000-0000-000000000001
DEMO_USER_ID=b0000000-0000-0000-0000-000000000001
DEMO_BATCH_COUNT=100

# ═══════════════════════════════════════════════════════════════════════════════
# BACKUP & DISASTER RECOVERY CONFIGURATION
# تكوين النسخ الاحتياطي والتعافي من الكوارث
# ═══════════════════════════════════════════════════════════════════════════════
# Documentation: /scripts/backup/README.md
# Quick Start: /scripts/backup/QUICK_START.md
# Disaster Recovery: /scripts/backup/disaster-recovery.md

# ─────────────────────────────────────────────────────────────────────────────
# General Backup Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Base directory for all backups (absolute path)
BACKUP_DIR=/backups

# Backup compression method: gzip, zstd, none
BACKUP_COMPRESSION=gzip

# ─────────────────────────────────────────────────────────────────────────────
# Backup Encryption Configuration (CRITICAL for production)
# تشفير النسخ الاحتياطية
# ─────────────────────────────────────────────────────────────────────────────
# SECURITY NOTICE:
# - Enable encryption for ALL production backups
# - Store encryption key securely (use HashiCorp Vault in production)
# - Test decryption regularly to ensure key is accessible
# - Backup encryption key to secure offline location
# Generate strong key: openssl rand -base64 32
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_ENCRYPTION_ALGORITHM=aes-256-cbc
BACKUP_ENCRYPTION_KEY=change_this_generate_backup_encryption_key_now

# ─────────────────────────────────────────────────────────────────────────────
# PostgreSQL PITR (Point-in-Time Recovery) Configuration
# تكوين الاستعادة إلى نقطة زمنية لـ PostgreSQL
# ─────────────────────────────────────────────────────────────────────────────
# Enable for production to support recovery to any point in time
WAL_ARCHIVE_ENABLED=true
WAL_ARCHIVE_MODE=always
WAL_LEVEL=replica
MAX_WAL_SENDERS=3
WAL_RETENTION_DAYS=7
BASE_BACKUP_RETENTION_DAYS=30

# ─────────────────────────────────────────────────────────────────────────────
# Redis Backup Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Enable RDB snapshots
BACKUP_RDB=true

# Enable AOF backups (weekly/monthly)
BACKUP_AOF=true

# ─────────────────────────────────────────────────────────────────────────────
# S3/MinIO Backup Storage Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Enable S3/MinIO backup storage (RECOMMENDED for production)
S3_BACKUP_ENABLED=true
S3_ENDPOINT=http://minio:9000
S3_BUCKET=sahool-backups
S3_ACCESS_KEY=${MINIO_ROOT_USER}
S3_SECRET_KEY=${MINIO_ROOT_PASSWORD}

# ─────────────────────────────────────────────────────────────────────────────
# AWS S3 Off-Site Backup Configuration (CRITICAL for DR)
# تكوين النسخ الاحتياطية خارج الموقع في AWS S3
# ─────────────────────────────────────────────────────────────────────────────
# PRODUCTION REQUIREMENT: Enable off-site backups for disaster recovery
AWS_S3_BACKUP_ENABLED=false
AWS_S3_BACKUP_BUCKET=sahool-backups-offsite
AWS_S3_REGION=eu-central-1
AWS_S3_STORAGE_CLASS=STANDARD_IA

# ─────────────────────────────────────────────────────────────────────────────
# Backup Retention Policies (GFS - Grandfather-Father-Son)
# سياسات الاحتفاظ بالنسخ
# ─────────────────────────────────────────────────────────────────────────────
RETENTION_DAILY=7
RETENTION_WEEKLY=28
RETENTION_MONTHLY=365
RETENTION_MANUAL=90

# ─────────────────────────────────────────────────────────────────────────────
# Backup Scheduling Configuration
# جدولة النسخ الاحتياطي
# ─────────────────────────────────────────────────────────────────────────────
# Daily backup time (cron format: minute hour)
BACKUP_DAILY_TIME=0 2

# Weekly backup day and time (0=Sunday)
BACKUP_WEEKLY_DAY=0
BACKUP_WEEKLY_TIME=0 3

# Monthly backup day and time
BACKUP_MONTHLY_DAY=1
BACKUP_MONTHLY_TIME=0 4

# Backup verification schedule (cron format)
BACKUP_VERIFICATION_TIME=0 6 * * 0

# ─────────────────────────────────────────────────────────────────────────────
# Backup Monitoring & Alerting
# مراقبة وتنبيهات النسخ الاحتياطي
# ─────────────────────────────────────────────────────────────────────────────
MAX_BACKUP_AGE_HOURS=26
MIN_BACKUP_SIZE_MB=1

# Slack Notifications
SLACK_NOTIFICATIONS_ENABLED=false
SLACK_WEBHOOK_URL=

# Email Notifications (uses SMTP settings above)
EMAIL_NOTIFICATIONS_ENABLED=false
BACKUP_EMAIL_TO=admin@sahool.com

# ─────────────────────────────────────────────────────────────────────────────
# Backup Verification & Testing
# التحقق واختبار النسخ الاحتياطية
# ─────────────────────────────────────────────────────────────────────────────
BACKUP_VERIFICATION_ENABLED=true
BACKUP_RESTORE_TEST_ENABLED=true
TEST_DB_PREFIX=test_restore_

# ─────────────────────────────────────────────────────────────────────────────
# Disaster Recovery Configuration
# تكوين التعافي من الكوارث
# ─────────────────────────────────────────────────────────────────────────────
# RTO (Recovery Time Objective) - Target in hours
RTO_TARGET_HOURS=6

# RPO (Recovery Point Objective) - Maximum acceptable data loss in hours
RPO_TARGET_HOURS=24

# DR drill schedule (cron format: 0 0 1 */3 * = quarterly)
DR_DRILL_SCHEDULE=0 0 1 */3 *

# DR contact email
DR_CONTACT_EMAIL=dr-team@sahool.com

# ═══════════════════════════════════════════════════════════════════════════════
# END OF CONFIGURATION
# نهاية التكوين
# ═══════════════════════════════════════════════════════════════════════════════
