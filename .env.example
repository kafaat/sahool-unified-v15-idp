# ═══════════════════════════════════════════════════════════════════════════════
# SAHOOL Platform Environment Configuration
# Copy this file to .env and fill in your values
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# Core Application Settings (UNIFIED)
# ─────────────────────────────────────────────────────────────────────────────
# Use ENVIRONMENT as the single source of truth for environment name
ENVIRONMENT=development
LOG_LEVEL=INFO
SERVICE_LAYER=kernel
DEFAULT_TENANT=default
APP_SECRET_KEY=your_app_secret_key_at_least_32_characters_long_change_me

# ─────────────────────────────────────────────────────────────────────────────
# Database Configuration (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────
POSTGRES_USER=sahool
POSTGRES_PASSWORD=your_secure_password_here
POSTGRES_DB=sahool
DATABASE_URL=postgresql://sahool:your_secure_password_here@localhost:5432/sahool

# ─────────────────────────────────────────────────────────────────────────────
# Redis Configuration (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────
REDIS_PASSWORD=your_secure_redis_password_here
REDIS_URL=redis://:your_secure_redis_password_here@localhost:6379

# ─────────────────────────────────────────────────────────────────────────────
# Message Queue Configuration
# ─────────────────────────────────────────────────────────────────────────────
NATS_URL=nats://localhost:4222

# ─────────────────────────────────────────────────────────────────────────────
# JWT Configuration (UNIFIED - REQUIRED for auth services)
# ─────────────────────────────────────────────────────────────────────────────
# Use JWT_SECRET_KEY as the single source of truth
JWT_SECRET_KEY=your_jwt_secret_key_at_least_32_characters_long
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30
JWT_AUDIENCE=sahool-api
JWT_ISSUER=sahool-platform
# Optional: RSA keys for RS256 algorithm
JWT_PRIVATE_KEY_PATH=
JWT_PUBLIC_KEY_PATH=

# ─────────────────────────────────────────────────────────────────────────────
# Kong API Gateway JWT Secrets (REQUIRED for API authentication)
# ─────────────────────────────────────────────────────────────────────────────
# These secrets are used by Kong to verify JWT tokens from different clients
# SECURITY: Generate strong random strings (min 32 characters) for production
KONG_JWT_WEB_SECRET=your_kong_jwt_web_secret_32_chars_min
KONG_JWT_MOBILE_SECRET=your_kong_jwt_mobile_secret_32_chars_min
KONG_JWT_INTERNAL_SECRET=your_kong_jwt_internal_secret_32_chars_min

# ─────────────────────────────────────────────────────────────────────────────
# Security & Authentication Settings
# ─────────────────────────────────────────────────────────────────────────────
SAHOOL_AUTH_ENABLED=true
MFA_ENABLED=false
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=30
TOTP_ISSUER=SAHOOL

# ─────────────────────────────────────────────────────────────────────────────
# Secrets Management Configuration
# ─────────────────────────────────────────────────────────────────────────────
# SECRET_BACKEND options: environment (default), vault, aws_secrets_manager, azure_key_vault
SECRET_BACKEND=environment

# HashiCorp Vault Configuration (Optional - for secrets management)
VAULT_ADDR=http://localhost:8200
VAULT_TOKEN=
VAULT_ROLE_ID=
VAULT_SECRET_ID=
VAULT_NAMESPACE=
VAULT_MOUNT_POINT=secret
VAULT_PATH_PREFIX=sahool

# ─────────────────────────────────────────────────────────────────────────────
# CORS Configuration (UNIFIED)
# ─────────────────────────────────────────────────────────────────────────────
# Use CORS_ALLOWED_ORIGINS as the single source of truth
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080

# ─────────────────────────────────────────────────────────────────────────────
# Service Ports Configuration
# ─────────────────────────────────────────────────────────────────────────────
PORT=8000
SERVICE_PORT=8000
AUTH_SERVICE_PORT=8001
USER_SERVICE_PORT=8002
TENANT_SERVICE_PORT=8003
NOTIFICATION_SERVICE_PORT=8004
GEO_SERVICE_PORT=8005
MARKET_SERVICE_PORT=8006
EQUIPMENT_SERVICE_PORT=8007
CROP_LIFECYCLE_PORT=8008
SOIL_SERVICE_PORT=8009
ALERTS_PORT=8010
TASKS_PORT=8011
NDVI_PORT=8012
ADVISOR_CORE_PORT=8013
SCHEMA_REGISTRY_PORT=8014
PROCESS_MANAGER_PORT=8015

# ─────────────────────────────────────────────────────────────────────────────
# External Service URLs
# ─────────────────────────────────────────────────────────────────────────────
BASE_URL=http://localhost:8000
FIELDOPS_URL=http://localhost:8000
WEATHER_URL=http://localhost:8000/weather
SATELLITE_URL=http://localhost:8000/satellite
FERTILIZER_URL=http://localhost:8000/fertilizer
IRRIGATION_URL=http://localhost:8000/irrigation
INDICATORS_URL=http://localhost:8000/indicators

# ─────────────────────────────────────────────────────────────────────────────
# External API Keys (Optional - for enhanced features)
# ─────────────────────────────────────────────────────────────────────────────
# Weather API Providers (Multi-Provider Support)
# Open-Meteo is FREE and used by default - no API key required
# Add these keys to enable additional providers for redundancy
OPENWEATHERMAP_API_KEY=your_openweathermap_api_key
WEATHERAPI_KEY=your_weatherapi_key
USE_MULTI_PROVIDER=true

# Satellite Imagery Providers (Multi-Provider Support)
# Copernicus STAC is FREE and used by default - no credentials required
# Add these to enable additional providers:

# Sentinel Hub (ESA Copernicus - Free tier: 30,000 units/month)
# Register at: https://www.sentinel-hub.com/
SENTINEL_HUB_CLIENT_ID=your_sentinel_hub_client_id
SENTINEL_HUB_CLIENT_SECRET=your_sentinel_hub_client_secret

# NASA Earthdata (Free - MODIS/VIIRS data)
# Register at: https://urs.earthdata.nasa.gov/
NASA_EARTHDATA_USERNAME=your_nasa_earthdata_username
NASA_EARTHDATA_PASSWORD=your_nasa_earthdata_password

# Planet Labs (Paid - High-resolution imagery)
PLANET_API_KEY=your_planet_api_key

# Maps
GOOGLE_MAPS_API_KEY=your_google_maps_api_key

# ─────────────────────────────────────────────────────────────────────────────
# AI/ML Configuration
# ─────────────────────────────────────────────────────────────────────────────
AI_MODEL_ENDPOINT=http://localhost:8080/predict
MODEL_PATH=/models
USE_LOCAL_MODEL=false
USE_MOCK_WEATHER=false
CONFIDENCE_THRESHOLD=0.8
EXPERT_REVIEW_THRESHOLD=0.6
SIGNIFICANT_CHANGE_PERCENT=10

# ─────────────────────────────────────────────────────────────────────────────
# MQTT Configuration (IoT Integration) - REQUIRED for IoT Gateway
# ─────────────────────────────────────────────────────────────────────────────
MQTT_BROKER=mqtt
MQTT_PORT=1883
MQTT_USER=sahool_iot
MQTT_PASSWORD=your_secure_mqtt_password_here
MQTT_TOPIC=sahool/sensors/#

# ─────────────────────────────────────────────────────────────────────────────
# Firebase Configuration (Optional - for mobile push notifications)
# ─────────────────────────────────────────────────────────────────────────────
FIREBASE_PROJECT_ID=
FIREBASE_CREDENTIALS=
FCM_SERVER_KEY=your_fcm_server_key

# ─────────────────────────────────────────────────────────────────────────────
# SMTP Configuration (Email Notifications)
# ─────────────────────────────────────────────────────────────────────────────
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=noreply@sahool.com
SMTP_FROM_NAME=SAHOOL Platform

# ─────────────────────────────────────────────────────────────────────────────
# SMS Configuration (Optional)
# ─────────────────────────────────────────────────────────────────────────────
SMS_PROVIDER=twilio
SMS_API_KEY=
SMS_API_SECRET=
SMS_FROM_NUMBER=

# Twilio (SMS)
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=your_twilio_phone_number

# ─────────────────────────────────────────────────────────────────────────────
# File Upload & Storage Configuration
# ─────────────────────────────────────────────────────────────────────────────
UPLOAD_DIR=/uploads
AVATAR_UPLOAD_PATH=/uploads/avatars
CDN_BASE_URL=https://cdn.sahool.com

# ─────────────────────────────────────────────────────────────────────────────
# Observability & Monitoring
# ─────────────────────────────────────────────────────────────────────────────
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
SERVICE_NAME=sahool-platform

# Grafana Admin Credentials (REQUIRED for observability stack)
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=your_secure_grafana_password_here
GRAFANA_ROOT_URL=http://localhost:3002

# ─────────────────────────────────────────────────────────────────────────────
# Application Limits & Retry Configuration
# ─────────────────────────────────────────────────────────────────────────────
MAX_NOTIFICATIONS_PER_HOUR=100
MAX_RETRIES=3
RETRY_DELAY_SECONDS=5
MAINTENANCE_CHECK_INTERVAL=3600
PLAN_LIMITS={"free":{"fields":10},"pro":{"fields":100},"enterprise":{"fields":-1}}
TRIAL_DAYS=14

# ─────────────────────────────────────────────────────────────────────────────
# WebSocket Configuration
# ─────────────────────────────────────────────────────────────────────────────
WS_REQUIRE_AUTH=true

# ─────────────────────────────────────────────────────────────────────────────
# Observability & Monitoring Configuration
# ─────────────────────────────────────────────────────────────────────────────
# OpenTelemetry Configuration (Optional - for distributed tracing)
OTEL_EXPORTER_OTLP_ENDPOINT=
OTEL_EXPORTER_OTLP_PROTOCOL=grpc
OTEL_SERVICE_NAME=
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1

# Prometheus Configuration
PROMETHEUS_METRICS_ENABLED=true
PROMETHEUS_MULTIPROC_DIR=/tmp/prometheus_multiproc

# Health Check Configuration
HEALTH_CHECK_INTERVAL_SECONDS=30
HEALTH_CHECK_TIMEOUT_SECONDS=5

# ─────────────────────────────────────────────────────────────────────────────
# Rate Limiting Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Rate limiting tiers (requests per minute / requests per hour / burst limit)
RATE_LIMIT_FREE_RPM=30
RATE_LIMIT_FREE_RPH=500
RATE_LIMIT_FREE_BURST=5

RATE_LIMIT_STANDARD_RPM=60
RATE_LIMIT_STANDARD_RPH=2000
RATE_LIMIT_STANDARD_BURST=10

RATE_LIMIT_PREMIUM_RPM=120
RATE_LIMIT_PREMIUM_RPH=5000
RATE_LIMIT_PREMIUM_BURST=20

RATE_LIMIT_INTERNAL_RPM=1000
RATE_LIMIT_INTERNAL_RPH=50000
RATE_LIMIT_INTERNAL_BURST=100

# ─────────────────────────────────────────────────────────────────────────────
# Database Connection Pooling & Performance
# ─────────────────────────────────────────────────────────────────────────────
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_ECHO=false

# Database retry configuration
DB_MAX_RETRIES=3
DB_RETRY_DELAY_SECONDS=1
DB_RETRY_BACKOFF_FACTOR=2.0

# ─────────────────────────────────────────────────────────────────────────────
# Caching Configuration
# ─────────────────────────────────────────────────────────────────────────────
CACHE_ENABLED=true
CACHE_TTL_SECONDS=300
CACHE_MAX_SIZE=10000

# Cache keys TTL (seconds)
CACHE_TTL_USER_DATA=600
CACHE_TTL_FIELD_DATA=300
CACHE_TTL_WEATHER_DATA=1800
CACHE_TTL_SATELLITE_DATA=3600

# ─────────────────────────────────────────────────────────────────────────────
# API Pagination Defaults
# ─────────────────────────────────────────────────────────────────────────────
DEFAULT_PAGE_SIZE=50
MAX_PAGE_SIZE=1000
ENABLE_STREAMING_RESPONSES=true

# ─────────────────────────────────────────────────────────────────────────────
# Payment Gateway Configuration - بوابات الدفع
# ─────────────────────────────────────────────────────────────────────────────
# Stripe (International payments)
STRIPE_API_KEY=sk_test_your_stripe_api_key
STRIPE_WEBHOOK_SECRET=whsec_your_stripe_webhook_secret
STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key

# Tharwatt (MENA region - Yemen)
THARWATT_BASE_URL=https://developers-test.tharwatt.com:5253
THARWATT_API_KEY=your_tharwatt_api_key
THARWATT_MERCHANT_ID=your_tharwatt_merchant_id
THARWATT_WEBHOOK_SECRET=your_tharwatt_webhook_secret

# ─────────────────────────────────────────────────────────────────────────────
# AI/ML Services Configuration - خدمات الذكاء الاصطناعي
# ─────────────────────────────────────────────────────────────────────────────
# Multi-Provider LLM Configuration (AI Advisor)
# Primary provider: anthropic, openai, or google
PRIMARY_LLM_PROVIDER=anthropic

# Anthropic Claude AI (Primary - Recommended)
ANTHROPIC_API_KEY=your_anthropic_api_key

# OpenAI GPT (Optional Fallback)
OPENAI_API_KEY=your_openai_api_key

# Google Gemini (Optional)
GOOGLE_API_KEY=your_google_gemini_api_key

# Qdrant Vector Database (for RAG/semantic search)
QDRANT_HOST=qdrant
QDRANT_PORT=6333
QDRANT_API_KEY=
