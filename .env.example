# ═══════════════════════════════════════════════════════════════════════════════
# SAHOOL v16.0.0 Platform Environment Configuration
# Complete unified environment for 39 services + infrastructure
# Copy this file to .env and fill in your values
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# Core Application Settings
# ─────────────────────────────────────────────────────────────────────────────
ENVIRONMENT=development
LOG_LEVEL=INFO
NODE_ENV=production

# ─────────────────────────────────────────────────────────────────────────────
# Database Configuration (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────
POSTGRES_USER=sahool
POSTGRES_PASSWORD=change_this_secure_password_in_production
POSTGRES_DB=sahool
DATABASE_URL=postgresql://sahool:change_this_secure_password_in_production@postgres:5432/sahool

# ─────────────────────────────────────────────────────────────────────────────
# Redis Configuration (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────
REDIS_PASSWORD=change_this_secure_redis_password
REDIS_URL=redis://:change_this_secure_redis_password@redis:6379/0

# ─────────────────────────────────────────────────────────────────────────────
# Message Queue Configuration
# ─────────────────────────────────────────────────────────────────────────────
NATS_URL=nats://nats:4222

# ─────────────────────────────────────────────────────────────────────────────
# JWT Configuration (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────
JWT_SECRET_KEY=change_this_jwt_secret_key_at_least_32_characters_long
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30
JWT_AUDIENCE=sahool-api
JWT_ISSUER=sahool-platform
# Optional: RSA keys for RS256 algorithm
JWT_PRIVATE_KEY_PATH=
JWT_PUBLIC_KEY_PATH=

# ─────────────────────────────────────────────────────────────────────────────
# CORS Configuration
# ─────────────────────────────────────────────────────────────────────────────
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080,https://sahool.com,https://app.sahool.com

# ─────────────────────────────────────────────────────────────────────────────
# MQTT Configuration (REQUIRED for IoT services)
# ─────────────────────────────────────────────────────────────────────────────
MQTT_BROKER=mqtt
MQTT_PORT=1883
MQTT_USER=sahool_iot
MQTT_PASSWORD=change_this_secure_mqtt_password
MQTT_TOPIC=sahool/sensors/#

# ─────────────────────────────────────────────────────────────────────────────
# Weather API Providers (Multi-Provider Support)
# ─────────────────────────────────────────────────────────────────────────────
USE_MULTI_PROVIDER=true
USE_MOCK_WEATHER=false
# OpenWeatherMap (Optional)
OPENWEATHERMAP_API_KEY=
OPENWEATHER_API_KEY=
# WeatherAPI (Optional)
WEATHERAPI_KEY=

# ─────────────────────────────────────────────────────────────────────────────
# Satellite Imagery Providers (Multi-Provider Support)
# ─────────────────────────────────────────────────────────────────────────────
# Sentinel Hub (ESA Copernicus - Free tier: 30,000 units/month)
# Register at: https://www.sentinel-hub.com/
SENTINEL_HUB_CLIENT_ID=
SENTINEL_HUB_CLIENT_SECRET=

# NASA Earthdata (Free - MODIS/VIIRS data)
# Register at: https://urs.earthdata.nasa.gov/
NASA_EARTHDATA_USERNAME=
NASA_EARTHDATA_PASSWORD=

# Planet Labs (Paid - High-resolution imagery)
PLANET_API_KEY=
PLANET_CLIENT_ID=

# ─────────────────────────────────────────────────────────────────────────────
# Payment Gateway Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Stripe (International payments)
STRIPE_API_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PUBLISHABLE_KEY=

# Tharwatt (MENA region - Yemen)
THARWATT_BASE_URL=https://developers-test.tharwatt.com:5253
THARWATT_API_KEY=
THARWATT_MERCHANT_ID=
THARWATT_WEBHOOK_SECRET=

# ─────────────────────────────────────────────────────────────────────────────
# AI/ML Services Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Multi-Provider LLM Configuration (AI Advisor)
PRIMARY_LLM_PROVIDER=anthropic

# Anthropic Claude AI (Primary - Recommended)
ANTHROPIC_API_KEY=
CLAUDE_MODEL=claude-3-5-sonnet-20241022

# OpenAI GPT (Optional Fallback)
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o

# Google Gemini (Optional)
GOOGLE_API_KEY=
GEMINI_MODEL=gemini-1.5-pro

# Qdrant Vector Database (for RAG/semantic search)
QDRANT_HOST=qdrant
QDRANT_PORT=6333
QDRANT_API_KEY=
EMBEDDING_MODEL=paraphrase-multilingual-MiniLM-L12-v2

# AI Model Configuration
AI_MODEL_ENDPOINT=http://localhost:8080/predict
MODEL_PATH=/models
USE_LOCAL_MODEL=false
CONFIDENCE_THRESHOLD=0.8
EXPERT_REVIEW_THRESHOLD=0.6
SIGNIFICANT_CHANGE_PERCENT=10

# ─────────────────────────────────────────────────────────────────────────────
# SMTP Configuration (Email Notifications)
# ─────────────────────────────────────────────────────────────────────────────
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=noreply@sahool.com
SMTP_FROM_NAME=SAHOOL Platform

# ─────────────────────────────────────────────────────────────────────────────
# Firebase Configuration (for mobile push notifications)
# ─────────────────────────────────────────────────────────────────────────────
# Firebase Admin SDK Configuration
# Option 1: Path to service account JSON file
FIREBASE_CREDENTIALS_PATH=./apps/services/notification-service/firebase-admin-sdk.json

# Option 2: Service account JSON as environment variable (use this in production/cloud)
FIREBASE_CREDENTIALS_JSON=

# Firebase Project Details
FIREBASE_PROJECT_ID=sahool-platform-yemen
FIREBASE_DATABASE_URL=
FIREBASE_STORAGE_BUCKET=

# Legacy FCM Server Key (deprecated, use Admin SDK instead)
FCM_SERVER_KEY=

# Notification Service Configuration
NOTIFICATION_BATCH_SIZE=500
NOTIFICATION_RATE_LIMIT_PER_MINUTE=100
NOTIFICATION_QUIET_HOURS_START=22:00
NOTIFICATION_QUIET_HOURS_END=06:00
NOTIFICATION_RETRY_MAX_ATTEMPTS=3
NOTIFICATION_RETRY_DELAY_SECONDS=2

# ─────────────────────────────────────────────────────────────────────────────
# SMS Configuration (Optional)
# ─────────────────────────────────────────────────────────────────────────────
SMS_PROVIDER=twilio
SMS_API_KEY=
SMS_API_SECRET=
SMS_FROM_NUMBER=

# Twilio (SMS)
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=

# ─────────────────────────────────────────────────────────────────────────────
# File Upload & Storage Configuration
# ─────────────────────────────────────────────────────────────────────────────
UPLOAD_DIR=/uploads
AVATAR_UPLOAD_PATH=/uploads/avatars
CDN_BASE_URL=https://cdn.sahool.com

# Google Maps
GOOGLE_MAPS_API_KEY=

# ─────────────────────────────────────────────────────────────────────────────
# Observability & Monitoring
# ─────────────────────────────────────────────────────────────────────────────
# Grafana Admin Credentials (REQUIRED for observability stack)
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=change_this_secure_grafana_password
GRAFANA_ROOT_URL=http://localhost:3002
GRAFANA_DOMAIN=localhost
GF_LOG_LEVEL=info

# ─────────────────────────────────────────────────────────────────────────────
# OpenTelemetry Distributed Tracing Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Enable/Disable OpenTelemetry
OTEL_ENABLED=true

# Service Identification
OTEL_SERVICE_NAME=sahool-service
SERVICE_NAME=sahool-service
SERVICE_VERSION=1.0.0

# OTLP Exporter Configuration
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
OTEL_EXPORTER_OTLP_PROTOCOL=grpc
OTEL_EXPORTER_OTLP_INSECURE=true

# Trace Sampling Configuration
# parentbased_traceidratio: Sample based on trace ID with parent-based sampling
# Options: always_on, always_off, traceidratio, parentbased_always_on, parentbased_always_off, parentbased_traceidratio
OTEL_TRACES_SAMPLER=parentbased_traceidratio
# Sampling ratio: 0.0 to 1.0 (0.1 = 10% of traces)
OTEL_TRACES_SAMPLER_ARG=0.1

# Console Export (for debugging)
OTEL_CONSOLE_EXPORT=false

# Excluded URLs (health checks, metrics endpoints)
OTEL_EXCLUDED_URLS=/health,/ready,/metrics,/healthz

# ─────────────────────────────────────────────────────────────────────────────
# Jaeger Tracing Backend Configuration
# ─────────────────────────────────────────────────────────────────────────────
JAEGER_ENDPOINT=http://jaeger:14250
JAEGER_UI_URL=http://localhost:16686
JAEGER_LOG_LEVEL=info

# ─────────────────────────────────────────────────────────────────────────────
# Prometheus Metrics Configuration
# ─────────────────────────────────────────────────────────────────────────────
PROMETHEUS_METRICS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_MULTIPROC_DIR=/tmp/prometheus_multiproc

# ─────────────────────────────────────────────────────────────────────────────
# Structured Logging Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Log format: json or text
LOG_FORMAT=json
# Include trace context in logs (trace_id, span_id)
LOG_INCLUDE_TRACE=true

# Health Check Configuration
HEALTH_CHECK_INTERVAL_SECONDS=30
HEALTH_CHECK_TIMEOUT_SECONDS=5

# ─────────────────────────────────────────────────────────────────────────────
# Service Discovery & URLs
# ─────────────────────────────────────────────────────────────────────────────
BASE_URL=http://localhost:8000
FIELDOPS_URL=http://field_ops:8080
WEATHER_URL=http://weather_core:8108
WEATHER_SERVICE_URL=http://weather_advanced:8092
SATELLITE_URL=http://satellite_service:8090
SATELLITE_SERVICE_URL=http://satellite_service:8090
FERTILIZER_URL=http://fertilizer_advisor:8093
IRRIGATION_URL=http://irrigation_smart:8094
INDICATORS_URL=http://indicators_service:8091
CROP_HEALTH_URL=http://crop_health_ai:8095
AGRO_ADVISOR_URL=http://agro_advisor:8105
NDVI_URL=http://ndvi_engine:8107
IOT_GATEWAY_URL=http://iot_gateway:8106
NOTIFICATION_SERVICE_URL=http://notification_service:8110

# ─────────────────────────────────────────────────────────────────────────────
# Security & Authentication Settings
# ─────────────────────────────────────────────────────────────────────────────
APP_SECRET_KEY=change_this_app_secret_key_at_least_32_characters
SIGNATURE_SECRET_KEY=
SAHOOL_AUTH_ENABLED=true
MFA_ENABLED=false
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=30
TOTP_ISSUER=SAHOOL
WS_REQUIRE_AUTH=true

# ─────────────────────────────────────────────────────────────────────────────
# Secrets Management Configuration
# ─────────────────────────────────────────────────────────────────────────────
# SECRET_BACKEND options: environment (default), vault, aws_secrets_manager, azure_key_vault
SECRET_BACKEND=environment

# HashiCorp Vault Configuration (Optional)
VAULT_ADDR=http://localhost:8200
VAULT_TOKEN=
VAULT_ROLE_ID=
VAULT_SECRET_ID=
VAULT_NAMESPACE=
VAULT_MOUNT_POINT=secret
VAULT_PATH_PREFIX=sahool

# ─────────────────────────────────────────────────────────────────────────────
# Rate Limiting Configuration
# ─────────────────────────────────────────────────────────────────────────────
RATE_LIMIT_FREE_RPM=30
RATE_LIMIT_FREE_RPH=500
RATE_LIMIT_FREE_BURST=5

RATE_LIMIT_STANDARD_RPM=60
RATE_LIMIT_STANDARD_RPH=2000
RATE_LIMIT_STANDARD_BURST=10

RATE_LIMIT_PREMIUM_RPM=120
RATE_LIMIT_PREMIUM_RPH=5000
RATE_LIMIT_PREMIUM_BURST=20

RATE_LIMIT_INTERNAL_RPM=1000
RATE_LIMIT_INTERNAL_RPH=50000
RATE_LIMIT_INTERNAL_BURST=100

# ─────────────────────────────────────────────────────────────────────────────
# Database Connection Pooling & Performance
# ─────────────────────────────────────────────────────────────────────────────
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_ECHO=false

# Database retry configuration
DB_MAX_RETRIES=3
DB_RETRY_DELAY_SECONDS=1
DB_RETRY_BACKOFF_FACTOR=2.0

# ─────────────────────────────────────────────────────────────────────────────
# Caching Configuration
# ─────────────────────────────────────────────────────────────────────────────
CACHE_ENABLED=true
CACHE_TTL_SECONDS=300
CACHE_MAX_SIZE=10000

# Cache keys TTL (seconds)
CACHE_TTL_USER_DATA=600
CACHE_TTL_FIELD_DATA=300
CACHE_TTL_WEATHER_DATA=1800
CACHE_TTL_SATELLITE_DATA=3600

# ─────────────────────────────────────────────────────────────────────────────
# API Pagination Defaults
# ─────────────────────────────────────────────────────────────────────────────
DEFAULT_PAGE_SIZE=50
MAX_PAGE_SIZE=1000
ENABLE_STREAMING_RESPONSES=true

# ─────────────────────────────────────────────────────────────────────────────
# Application Limits & Retry Configuration
# ─────────────────────────────────────────────────────────────────────────────
MAX_NOTIFICATIONS_PER_HOUR=100
MAX_RETRIES=3
RETRY_DELAY_SECONDS=5
MAINTENANCE_CHECK_INTERVAL=3600
PLAN_LIMITS={"free":{"fields":10},"pro":{"fields":100},"enterprise":{"fields":-1}}
TRIAL_DAYS=14

# ─────────────────────────────────────────────────────────────────────────────
# Service-Specific Configuration
# ─────────────────────────────────────────────────────────────────────────────
SERVICE_NAME=sahool-platform
SERVICE_LAYER=kernel
DEFAULT_TENANT=default

# Port Configuration (for reference - overridden in docker-compose)
PORT=8000
SERVICE_PORT=8000
