# ═══════════════════════════════════════════════════════════════════════════════
# SAHOOL v16.0.0 Platform Environment Configuration
# Complete unified environment for 39 services + infrastructure
# Copy this file to .env and fill in your values
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# Core Application Settings
# ─────────────────────────────────────────────────────────────────────────────
ENVIRONMENT=development
LOG_LEVEL=INFO
NODE_ENV=production

# ─────────────────────────────────────────────────────────────────────────────
# Database Configuration (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────
POSTGRES_USER=sahool
POSTGRES_PASSWORD=change_this_secure_password_in_production
POSTGRES_DB=sahool
DATABASE_URL=postgresql://sahool:change_this_secure_password_in_production@postgres:5432/sahool

# ─────────────────────────────────────────────────────────────────────────────
# Redis Configuration (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────
REDIS_PASSWORD=change_this_secure_redis_password
REDIS_URL=redis://:change_this_secure_redis_password@redis:6379/0

# ─────────────────────────────────────────────────────────────────────────────
# Message Queue Configuration
# ─────────────────────────────────────────────────────────────────────────────
NATS_URL=nats://nats:4222

# ─────────────────────────────────────────────────────────────────────────────
# JWT Configuration (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────
JWT_SECRET_KEY=change_this_jwt_secret_key_at_least_32_characters_long
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30
JWT_AUDIENCE=sahool-api
JWT_ISSUER=sahool-platform
# Optional: RSA keys for RS256 algorithm
JWT_PRIVATE_KEY_PATH=
JWT_PUBLIC_KEY_PATH=

# ─────────────────────────────────────────────────────────────────────────────
# Kong API Gateway JWT Secrets (REQUIRED for API authentication)
# ─────────────────────────────────────────────────────────────────────────────
# These secrets are used by Kong to verify JWT tokens from different clients
# SECURITY: Generate strong random strings (min 32 characters) for production
KONG_JWT_WEB_SECRET=your_kong_jwt_web_secret_32_chars_min
KONG_JWT_MOBILE_SECRET=your_kong_jwt_mobile_secret_32_chars_min
KONG_JWT_INTERNAL_SECRET=your_kong_jwt_internal_secret_32_chars_min

# ─────────────────────────────────────────────────────────────────────────────
# CORS Configuration
# ─────────────────────────────────────────────────────────────────────────────
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080,https://sahool.com,https://app.sahool.com

# ─────────────────────────────────────────────────────────────────────────────
# MQTT Configuration (REQUIRED for IoT services)
# ─────────────────────────────────────────────────────────────────────────────
MQTT_BROKER=mqtt
MQTT_PORT=1883
MQTT_USER=sahool_iot
MQTT_PASSWORD=change_this_secure_mqtt_password
MQTT_TOPIC=sahool/sensors/#

# ─────────────────────────────────────────────────────────────────────────────
# Weather API Providers (Multi-Provider Support)
# ─────────────────────────────────────────────────────────────────────────────
USE_MULTI_PROVIDER=true
USE_MOCK_WEATHER=false
# OpenWeatherMap (Optional)
OPENWEATHERMAP_API_KEY=
OPENWEATHER_API_KEY=
# WeatherAPI (Optional)
WEATHERAPI_KEY=

# ─────────────────────────────────────────────────────────────────────────────
# Satellite Imagery Providers (Multi-Provider Support)
# ─────────────────────────────────────────────────────────────────────────────
# Sentinel Hub (ESA Copernicus - Free tier: 30,000 units/month)
# Register at: https://www.sentinel-hub.com/
SENTINEL_HUB_CLIENT_ID=
SENTINEL_HUB_CLIENT_SECRET=

# NASA Earthdata (Free - MODIS/VIIRS data)
# Register at: https://urs.earthdata.nasa.gov/
NASA_EARTHDATA_USERNAME=
NASA_EARTHDATA_PASSWORD=

# Planet Labs (Paid - High-resolution imagery)
PLANET_API_KEY=
PLANET_CLIENT_ID=

# ─────────────────────────────────────────────────────────────────────────────
# Payment Gateway Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Stripe (International payments)
STRIPE_API_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PUBLISHABLE_KEY=

# Tharwatt (MENA region - Yemen)
THARWATT_BASE_URL=https://developers-test.tharwatt.com:5253
THARWATT_API_KEY=
THARWATT_MERCHANT_ID=
THARWATT_WEBHOOK_SECRET=

# ─────────────────────────────────────────────────────────────────────────────
# AI/ML Services Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Multi-Provider LLM Configuration (AI Advisor)
PRIMARY_LLM_PROVIDER=anthropic

# Anthropic Claude AI (Primary - Recommended)
ANTHROPIC_API_KEY=
CLAUDE_MODEL=claude-3-5-sonnet-20241022

# OpenAI GPT (Optional Fallback)
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o

# Google Gemini (Optional)
GOOGLE_API_KEY=
GEMINI_MODEL=gemini-1.5-pro

# Qdrant Vector Database (for RAG/semantic search)
QDRANT_HOST=qdrant
QDRANT_PORT=6333
QDRANT_API_KEY=
EMBEDDING_MODEL=paraphrase-multilingual-MiniLM-L12-v2

# AI Model Configuration
AI_MODEL_ENDPOINT=http://localhost:8080/predict
MODEL_PATH=/models
USE_LOCAL_MODEL=false
CONFIDENCE_THRESHOLD=0.8
EXPERT_REVIEW_THRESHOLD=0.6
SIGNIFICANT_CHANGE_PERCENT=10

# ─────────────────────────────────────────────────────────────────────────────
# SMTP Configuration (Email Notifications)
# ─────────────────────────────────────────────────────────────────────────────
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=noreply@sahool.com
SMTP_FROM_NAME=SAHOOL Platform

# ─────────────────────────────────────────────────────────────────────────────
# Firebase Configuration (Optional - for mobile push notifications)
# ─────────────────────────────────────────────────────────────────────────────
FIREBASE_PROJECT_ID=
FIREBASE_CREDENTIALS=
FCM_SERVER_KEY=

# ─────────────────────────────────────────────────────────────────────────────
# SMS Configuration (Optional)
# ─────────────────────────────────────────────────────────────────────────────
SMS_PROVIDER=twilio
SMS_API_KEY=
SMS_API_SECRET=
SMS_FROM_NUMBER=

# Twilio (SMS)
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=

# ─────────────────────────────────────────────────────────────────────────────
# File Upload & Storage Configuration
# ─────────────────────────────────────────────────────────────────────────────
UPLOAD_DIR=/uploads
AVATAR_UPLOAD_PATH=/uploads/avatars
CDN_BASE_URL=https://cdn.sahool.com

# Google Maps
GOOGLE_MAPS_API_KEY=

# ─────────────────────────────────────────────────────────────────────────────
# Observability & Monitoring
# ─────────────────────────────────────────────────────────────────────────────
# Grafana Admin Credentials (REQUIRED for observability stack)
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=change_this_secure_grafana_password
GRAFANA_ROOT_URL=http://localhost:3002

# OpenTelemetry Configuration (Optional - for distributed tracing)
OTEL_EXPORTER_OTLP_ENDPOINT=
OTEL_EXPORTER_OTLP_PROTOCOL=grpc
OTEL_SERVICE_NAME=
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1

# Prometheus Configuration
PROMETHEUS_METRICS_ENABLED=true
PROMETHEUS_MULTIPROC_DIR=/tmp/prometheus_multiproc

# Health Check Configuration
HEALTH_CHECK_INTERVAL_SECONDS=30
HEALTH_CHECK_TIMEOUT_SECONDS=5

# ─────────────────────────────────────────────────────────────────────────────
# Service Discovery & URLs
# ─────────────────────────────────────────────────────────────────────────────
BASE_URL=http://localhost:8000
FIELDOPS_URL=http://field_ops:8080
WEATHER_URL=http://weather_core:8108
WEATHER_SERVICE_URL=http://weather_advanced:8092
SATELLITE_URL=http://satellite_service:8090
SATELLITE_SERVICE_URL=http://satellite_service:8090
FERTILIZER_URL=http://fertilizer_advisor:8093
IRRIGATION_URL=http://irrigation_smart:8094
INDICATORS_URL=http://indicators_service:8091
CROP_HEALTH_URL=http://crop_health_ai:8095
AGRO_ADVISOR_URL=http://agro_advisor:8105
NDVI_URL=http://ndvi_engine:8107
IOT_GATEWAY_URL=http://iot_gateway:8106
NOTIFICATION_SERVICE_URL=http://notification_service:8110

# ─────────────────────────────────────────────────────────────────────────────
# Security & Authentication Settings
# ─────────────────────────────────────────────────────────────────────────────
APP_SECRET_KEY=change_this_app_secret_key_at_least_32_characters
SIGNATURE_SECRET_KEY=
SAHOOL_AUTH_ENABLED=true
MFA_ENABLED=false
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=30
TOTP_ISSUER=SAHOOL
WS_REQUIRE_AUTH=true

# ─────────────────────────────────────────────────────────────────────────────
# Secrets Management Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Choose your secrets backend:
# - environment: Use environment variables (default, good for development)
# - vault: HashiCorp Vault (recommended for production)
# - aws_secrets_manager: AWS Secrets Manager (for AWS deployments)
# - azure_key_vault: Azure Key Vault (for Azure deployments)
SECRET_BACKEND=environment

# ─────────────────────────────────────────────────────────────────────────────
# HashiCorp Vault Configuration (Optional)
# ─────────────────────────────────────────────────────────────────────────────
# Required when SECRET_BACKEND=vault
# Vault server address
VAULT_ADDR=http://localhost:8200

# Authentication method 1: Token-based (simpler for dev)
VAULT_TOKEN=

# Authentication method 2: AppRole (recommended for production)
VAULT_ROLE_ID=
VAULT_SECRET_ID=

# Optional: Vault namespace (for Vault Enterprise)
VAULT_NAMESPACE=

# KV secrets engine mount point (default: secret)
VAULT_MOUNT_POINT=secret

# Path prefix for SAHOOL secrets in Vault (e.g., sahool/prod, sahool/dev)
VAULT_PATH_PREFIX=sahool

# ─────────────────────────────────────────────────────────────────────────────
# AWS Secrets Manager Configuration (Optional)
# ─────────────────────────────────────────────────────────────────────────────
# Required when SECRET_BACKEND=aws_secrets_manager
# AWS region for Secrets Manager
AWS_REGION=us-east-1

# AWS credentials (optional if using IAM role)
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# Prefix for SAHOOL secrets in AWS (e.g., sahool/prod/, sahool/dev/)
AWS_SECRETS_PREFIX=sahool/

# ─────────────────────────────────────────────────────────────────────────────
# Azure Key Vault Configuration (Optional)
# ─────────────────────────────────────────────────────────────────────────────
# Required when SECRET_BACKEND=azure_key_vault
# Azure Key Vault URL (e.g., https://sahool-vault.vault.azure.net/)
AZURE_KEY_VAULT_URL=

# Azure authentication is handled via DefaultAzureCredential
# Set these for specific authentication methods:
AZURE_TENANT_ID=
AZURE_CLIENT_ID=
AZURE_CLIENT_SECRET=

# ─────────────────────────────────────────────────────────────────────────────
# Local Secrets Encryption (Optional)
# ─────────────────────────────────────────────────────────────────────────────
# Encryption key for local secrets storage (AES-128)
# Generate with: python -c "import base64, os; print(base64.urlsafe_b64encode(os.urandom(32)).decode())"
ENCRYPTION_KEY=

# Path to encryption key file (alternative to ENCRYPTION_KEY env var)
ENCRYPTION_KEY_FILE=

# Path to encrypted secrets file (for local development)
ENCRYPTED_SECRETS_FILE=/var/secrets/sahool.enc

# ─────────────────────────────────────────────────────────────────────────────
# Rate Limiting Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Enable/disable rate limiting globally
RATE_LIMIT_ENABLED=true

# Free Tier Rate Limits
RATE_LIMIT_FREE_RPM=30
RATE_LIMIT_FREE_RPH=500
RATE_LIMIT_FREE_BURST=5

# Standard Tier Rate Limits
RATE_LIMIT_STANDARD_RPM=60
RATE_LIMIT_STANDARD_RPH=2000
RATE_LIMIT_STANDARD_BURST=10

# Premium Tier Rate Limits
RATE_LIMIT_PREMIUM_RPM=120
RATE_LIMIT_PREMIUM_RPH=5000
RATE_LIMIT_PREMIUM_BURST=20

# Internal Services Rate Limits
RATE_LIMIT_INTERNAL_RPM=1000
RATE_LIMIT_INTERNAL_RPH=50000
RATE_LIMIT_INTERNAL_BURST=100

# General Rate Limiting (for auth middleware)
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW_SECONDS=60

# ─────────────────────────────────────────────────────────────────────────────
# Database Connection Pooling & Performance
# ─────────────────────────────────────────────────────────────────────────────
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_ECHO=false

# Database retry configuration
DB_MAX_RETRIES=3
DB_RETRY_DELAY_SECONDS=1
DB_RETRY_BACKOFF_FACTOR=2.0

# ─────────────────────────────────────────────────────────────────────────────
# Caching Configuration
# ─────────────────────────────────────────────────────────────────────────────
CACHE_ENABLED=true
CACHE_TTL_SECONDS=300
CACHE_MAX_SIZE=10000

# Cache keys TTL (seconds)
CACHE_TTL_USER_DATA=600
CACHE_TTL_FIELD_DATA=300
CACHE_TTL_WEATHER_DATA=1800
CACHE_TTL_SATELLITE_DATA=3600

# ─────────────────────────────────────────────────────────────────────────────
# API Pagination Defaults
# ─────────────────────────────────────────────────────────────────────────────
DEFAULT_PAGE_SIZE=50
MAX_PAGE_SIZE=1000
ENABLE_STREAMING_RESPONSES=true

# ─────────────────────────────────────────────────────────────────────────────
# Application Limits & Retry Configuration
# ─────────────────────────────────────────────────────────────────────────────
MAX_NOTIFICATIONS_PER_HOUR=100
MAX_RETRIES=3
RETRY_DELAY_SECONDS=5
MAINTENANCE_CHECK_INTERVAL=3600
PLAN_LIMITS={"free":{"fields":10},"pro":{"fields":100},"enterprise":{"fields":-1}}
TRIAL_DAYS=14

# ─────────────────────────────────────────────────────────────────────────────
# Port Configuration Reference
# ─────────────────────────────────────────────────────────────────────────────
# NOTE: Actual port bindings are defined in docker-compose.yml
# All services are bound to 127.0.0.1 (localhost) except Kong proxy (8000)
# See docs/PORT_MAPPING.md for complete port reference

# Infrastructure Ports (Internal Only - 127.0.0.1)
POSTGRES_PORT=5432
REDIS_PORT=6379
NATS_PORT=4222
MQTT_PORT=1883
QDRANT_PORT=6333

# API Gateway Ports
KONG_PROXY_PORT=8000          # PUBLIC - Main API entry point
KONG_ADMIN_PORT=8001          # Internal - Admin interface

# Node.js Services (Internal Only - 127.0.0.1)
FIELD_MANAGEMENT_PORT=3000    # Unified field operations
MARKETPLACE_PORT=3010         # Marketplace & FinTech
RESEARCH_CORE_PORT=3015       # Research management
DISASTER_ASSESSMENT_PORT=3020 # Disaster assessment
CHAT_SERVICE_PORT=8114        # Real-time chat
IOT_SERVICE_PORT=8117         # IoT device management

# Python Services (Internal Only - 127.0.0.1)
WS_GATEWAY_PORT=8081          # WebSocket gateway
BILLING_CORE_PORT=8089        # Billing service
VEGETATION_ANALYSIS_PORT=8090 # Satellite & vegetation (consolidated)
INDICATORS_PORT=8091          # Agricultural indicators
WEATHER_SERVICE_PORT=8092     # Weather service (consolidated)
ADVISORY_SERVICE_PORT=8093    # Agricultural advisory (consolidated)
IRRIGATION_SMART_PORT=8094    # Smart irrigation
CROP_INTELLIGENCE_PORT=8095   # Crop analysis & AI (consolidated)
VIRTUAL_SENSORS_PORT=8096     # Virtual sensors
FIELD_CHAT_PORT=8099          # Field chat
EQUIPMENT_SERVICE_PORT=8101   # Equipment management
TASK_SERVICE_PORT=8103        # Task management
PROVIDER_CONFIG_PORT=8104     # Provider configuration
IOT_GATEWAY_PORT=8106         # IoT gateway
NOTIFICATION_PORT=8110        # Notifications
ASTRONOMICAL_CALENDAR_PORT=8111 # Calendar service
AI_ADVISOR_PORT=8112          # AI advisor
ALERT_SERVICE_PORT=8113       # Alert service
INVENTORY_PORT=8116           # Inventory management
YIELD_PREDICTION_PORT=8098    # Yield prediction (consolidated)
MCP_SERVER_PORT=8200          # MCP integration

# Deprecated Services (Backwards Compatibility - Will be removed)
# These services are being migrated to consolidated services
FIELD_OPS_PORT=8080           # ⚠️ Migrating to FIELD_MANAGEMENT_PORT (3000)
AGRO_ADVISOR_PORT=8105        # ⚠️ Migrated to ADVISORY_SERVICE_PORT (8093)
NDVI_ENGINE_PORT=8107         # ⚠️ Migrated to VEGETATION_ANALYSIS_PORT (8090)
WEATHER_CORE_PORT=8108        # ⚠️ Migrated to WEATHER_SERVICE_PORT (8092)
FIELD_SERVICE_PORT=8115       # ⚠️ Migrated to FIELD_MANAGEMENT_PORT (3000)
NDVI_PROCESSOR_PORT=8118      # ⚠️ Migrated to VEGETATION_ANALYSIS_PORT (8090)
CROP_HEALTH_PORT=8100         # ⚠️ Migrated to CROP_INTELLIGENCE_PORT (8095)
COMMUNITY_CHAT_PORT=8097      # ⚠️ Migrating to CHAT_SERVICE_PORT (8114)
LAI_ESTIMATION_PORT=3022      # ⚠️ Migrated to VEGETATION_ANALYSIS_PORT (8090)
CROP_GROWTH_MODEL_PORT=3023   # ⚠️ Migrated to CROP_INTELLIGENCE_PORT (8095)
YIELD_PREDICTION_OLD_PORT=3021 # ⚠️ Migrated to YIELD_PREDICTION_PORT (8098)

# ─────────────────────────────────────────────────────────────────────────────
# Service-Specific Configuration
# ─────────────────────────────────────────────────────────────────────────────
SERVICE_NAME=sahool-platform
SERVICE_LAYER=kernel
DEFAULT_TENANT=default

# Default Service Port (used when PORT env var is not set)
PORT=8000
SERVICE_PORT=8000
