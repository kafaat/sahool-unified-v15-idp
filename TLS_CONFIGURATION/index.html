
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Complete developer guide for the SAHOOL Agricultural Platform">
      
      
        <meta name="author" content="KAFAAT Team">
      
      
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>SAHOOL Platform - TLS/SSL Configuration Guide - SAHOOL Developer Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="light-green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sahool-platform-tlsssl-configuration-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="SAHOOL Developer Documentation" class="md-header__button md-logo" aria-label="SAHOOL Developer Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SAHOOL Developer Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SAHOOL Platform - TLS/SSL Configuration Guide
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../index.md" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting-started/installation.md" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../services/overview.md" class="md-tabs__link">
          
  
  
  Services

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../api/authentication/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../development/setup.md" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../contributing/guidelines.md" class="md-tabs__link">
          
  
  
  Contributing

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SAHOOL Developer Documentation" class="md-nav__button md-logo" aria-label="SAHOOL Developer Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    SAHOOL Developer Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/installation.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/quickstart.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/architecture.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/overview.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/starter.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Starter Package
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/professional.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Professional Package
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/enterprise.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Enterprise Package
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/field-ops.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/weather/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weather
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/satellite.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Satellite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/setup.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/testing.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/deployment.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Contributing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/guidelines.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guidelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/code-style.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Style
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="sahool-platform-tlsssl-configuration-guide">SAHOOL Platform - TLS/SSL Configuration Guide<a class="headerlink" href="#sahool-platform-tlsssl-configuration-guide" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The SAHOOL platform uses TLS/SSL encryption to secure all internal service communication. This guide provides comprehensive information about the TLS setup, configuration, and management.</p>
<h2 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h2>
<h3 id="tls-implementation">TLS Implementation<a class="headerlink" href="#tls-implementation" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                     </span><span class="nx">SAHOOL</span><span class="w"> </span><span class="nx">Internal</span><span class="w"> </span><span class="nx">CA</span><span class="w">                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">                    </span><span class="p">(</span><span class="k">Self</span><span class="o">-</span><span class="nx">Signed</span><span class="w"> </span><span class="nx">Root</span><span class="w"> </span><span class="nx">CA</span><span class="p">)</span><span class="w">                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">                   </span><span class="nx">Valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nx">years</span><span class="w">                             </span><span class="err">│</span>
<span class="err">└────────────┬────────────────────────────────────────────────────┘</span>
<span class="w">             </span><span class="err">│</span>
<span class="w">             </span><span class="err">├───</span><span class="w"> </span><span class="nx">Signs</span><span class="w"> </span><span class="err">──→</span><span class="w"> </span><span class="nx">PostgreSQL</span><span class="w"> </span><span class="nx">Certificate</span><span class="w"> </span><span class="p">(</span><span class="mi">825</span><span class="w"> </span><span class="nx">days</span><span class="p">)</span>
<span class="w">             </span><span class="err">├───</span><span class="w"> </span><span class="nx">Signs</span><span class="w"> </span><span class="err">──→</span><span class="w"> </span><span class="nx">PgBouncer</span><span class="w"> </span><span class="nx">Certificate</span><span class="w"> </span><span class="p">(</span><span class="mi">825</span><span class="w"> </span><span class="nx">days</span><span class="p">)</span>
<span class="w">             </span><span class="err">├───</span><span class="w"> </span><span class="nx">Signs</span><span class="w"> </span><span class="err">──→</span><span class="w"> </span><span class="nx">Redis</span><span class="w"> </span><span class="nx">Certificate</span><span class="w"> </span><span class="p">(</span><span class="mi">825</span><span class="w"> </span><span class="nx">days</span><span class="p">)</span>
<span class="w">             </span><span class="err">├───</span><span class="w"> </span><span class="nx">Signs</span><span class="w"> </span><span class="err">──→</span><span class="w"> </span><span class="nx">NATS</span><span class="w"> </span><span class="nx">Certificate</span><span class="w"> </span><span class="p">(</span><span class="mi">825</span><span class="w"> </span><span class="nx">days</span><span class="p">)</span>
<span class="w">             </span><span class="err">└───</span><span class="w"> </span><span class="nx">Signs</span><span class="w"> </span><span class="err">──→</span><span class="w"> </span><span class="nx">Kong</span><span class="w"> </span><span class="nx">Certificate</span><span class="w"> </span><span class="p">(</span><span class="mi">825</span><span class="w"> </span><span class="nx">days</span><span class="p">)</span>
</code></pre></div>

<h3 id="service-communication">Service Communication<a class="headerlink" href="#service-communication" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>┌──────────────┐                    ┌──────────────┐
│   Services   │ ─── TLS 1.2+ ────→ │  PostgreSQL  │
│  (Node.js/   │                    │   (Port 5432)│
│   Python)    │ ←── Encrypted ──── │   SSL ON     │
└──────────────┘                    └──────────────┘
       │
       │ TLS 1.2+
       ↓
┌──────────────┐                    ┌──────────────┐
│   PgBouncer  │ ─── TLS 1.2+ ────→ │  PostgreSQL  │
│  (Port 6432) │                    │              │
└──────────────┘                    └──────────────┘

┌──────────────┐                    ┌──────────────┐
│   Services   │ ─── TLS 1.2+ ────→ │    Redis     │
│              │                    │  (TLS Port   │
│              │ ←── Encrypted ──── │   6379)      │
└──────────────┘                    └──────────────┘

┌──────────────┐                    ┌──────────────┐
│   Services   │ ─── TLS 1.2+ ────→ │    NATS      │
│              │                    │  (Port 4222) │
│              │ ←── Encrypted ──── │   TLS ON     │
└──────────────┘                    └──────────────┘

┌──────────────┐                    ┌──────────────┐
│   Clients    │ ─── HTTPS ───────→ │    Kong      │
│              │                    │ (Port 8443)  │
│              │ ←── Encrypted ──── │   SSL ON     │
└──────────────┘                    └──────────────┘
</code></pre></div>

<h2 id="certificate-infrastructure">Certificate Infrastructure<a class="headerlink" href="#certificate-infrastructure" title="Permanent link">&para;</a></h2>
<h3 id="certificate-authority-ca">Certificate Authority (CA)<a class="headerlink" href="#certificate-authority-ca" title="Permanent link">&para;</a></h3>
<p><strong>Location</strong>: <code>/home/user/sahool-unified-v15-idp/config/certs/ca/</code></p>
<ul>
<li><strong>Certificate</strong>: <code>ca.crt</code> (Public, can be distributed)</li>
<li><strong>Private Key</strong>: <code>ca.key</code> (SECRET - never commit or share)</li>
<li><strong>Validity</strong>: 10 years</li>
<li><strong>Key Size</strong>: 4096 bits RSA</li>
<li><strong>Signature</strong>: SHA-256</li>
</ul>
<p><strong>Subject DN</strong>:</p>
<div class="codehilite"><pre><span></span><code>C=YE, ST=Sana&#39;a, L=Sana&#39;a, O=SAHOOL, OU=Platform Security, CN=SAHOOL Internal CA
</code></pre></div>

<h3 id="service-certificates">Service Certificates<a class="headerlink" href="#service-certificates" title="Permanent link">&para;</a></h3>
<p>Each service has its own certificate with Subject Alternative Names (SANs):</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Location</th>
<th>SANs</th>
</tr>
</thead>
<tbody>
<tr>
<td>PostgreSQL</td>
<td><code>/config/certs/postgres/</code></td>
<td>postgres, postgres.sahool.local, sahool-postgres, localhost</td>
</tr>
<tr>
<td>PgBouncer</td>
<td><code>/config/certs/pgbouncer/</code></td>
<td>pgbouncer, pgbouncer.sahool.local, sahool-pgbouncer, localhost</td>
</tr>
<tr>
<td>Redis</td>
<td><code>/config/certs/redis/</code></td>
<td>redis, redis.sahool.local, sahool-redis, localhost</td>
</tr>
<tr>
<td>NATS</td>
<td><code>/config/certs/nats/</code></td>
<td>nats, nats.sahool.local, sahool-nats, localhost</td>
</tr>
<tr>
<td>Kong</td>
<td><code>/config/certs/kong/</code></td>
<td>kong, kong.sahool.local, sahool-kong, localhost</td>
</tr>
</tbody>
</table>
<p><strong>Certificate Properties</strong>:
- <strong>Validity</strong>: 825 days (~2.25 years, Apple's maximum)
- <strong>Key Size</strong>: 2048 bits RSA
- <strong>Signature</strong>: SHA-256
- <strong>Key Usage</strong>: Digital Signature, Key Encipherment
- <strong>Extended Key Usage</strong>: Server Authentication, Client Authentication</p>
<h2 id="service-configuration">Service Configuration<a class="headerlink" href="#service-configuration" title="Permanent link">&para;</a></h2>
<h3 id="postgresql">PostgreSQL<a class="headerlink" href="#postgresql" title="Permanent link">&para;</a></h3>
<p><strong>Configuration File</strong>: Configured via command-line arguments in <code>docker-compose.tls.yml</code></p>
<p><strong>TLS Settings</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">ssl</span><span class="o">=</span>on
<span class="nv">ssl_cert_file</span><span class="o">=</span>/var/lib/postgresql/certs/server.crt
<span class="nv">ssl_key_file</span><span class="o">=</span>/var/lib/postgresql/certs/server.key
<span class="nv">ssl_ca_file</span><span class="o">=</span>/var/lib/postgresql/certs/ca.crt
<span class="nv">ssl_min_protocol_version</span><span class="o">=</span>TLSv1.2
<span class="nv">ssl_prefer_server_ciphers</span><span class="o">=</span>on
</code></pre></div>

<p><strong>Client Connection</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Connection string with TLS</span>
postgresql://user:pass@postgres:5432/db?sslmode<span class="o">=</span>prefer

<span class="c1"># Environment variables</span>
<span class="nv">PGSSLMODE</span><span class="o">=</span>prefer
<span class="nv">PGSSLROOTCERT</span><span class="o">=</span>/path/to/ca.crt
</code></pre></div>

<p><strong>SSL Modes</strong>:
- <code>disable</code>: No SSL (not recommended)
- <code>allow</code>: Try non-SSL first, then SSL
- <code>prefer</code>: Try SSL first, then non-SSL (default with TLS enabled)
- <code>require</code>: Require SSL (don't verify certificate)
- <code>verify-ca</code>: Require SSL and verify server certificate
- <code>verify-full</code>: Require SSL and verify hostname</p>
<h3 id="pgbouncer">PgBouncer<a class="headerlink" href="#pgbouncer" title="Permanent link">&para;</a></h3>
<p><strong>Configuration File</strong>: <code>/home/user/sahool-unified-v15-idp/infrastructure/core/pgbouncer/pgbouncer.ini</code></p>
<p><strong>TLS Settings</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Server-side TLS (to PostgreSQL)</span>
<span class="na">server_tls_sslmode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">prefer</span>
<span class="na">server_tls_ca_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/etc/pgbouncer/certs/ca.crt</span>

<span class="c1"># Client-side TLS (from applications)</span>
<span class="na">client_tls_sslmode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">prefer</span>
<span class="na">client_tls_cert_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/etc/pgbouncer/certs/server.crt</span>
<span class="na">client_tls_key_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/etc/pgbouncer/certs/server.key</span>
</code></pre></div>

<h3 id="redis">Redis<a class="headerlink" href="#redis" title="Permanent link">&para;</a></h3>
<p><strong>Configuration</strong>: Command-line arguments in <code>docker-compose.tls.yml</code></p>
<p><strong>TLS Settings</strong>:</p>
<div class="codehilite"><pre><span></span><code>--tls-port<span class="w"> </span><span class="m">6379</span>
--port<span class="w"> </span><span class="m">0</span><span class="w">                              </span><span class="c1"># Disable non-TLS port</span>
--tls-cert-file<span class="w"> </span>/etc/redis/certs/server.crt
--tls-key-file<span class="w"> </span>/etc/redis/certs/server.key
--tls-ca-cert-file<span class="w"> </span>/etc/redis/certs/ca.crt
--tls-auth-clients<span class="w"> </span>optional<span class="w">           </span><span class="c1"># Allow both TLS and non-TLS clients initially</span>
--tls-protocols<span class="w"> </span><span class="s2">&quot;TLSv1.2 TLSv1.3&quot;</span>
--tls-prefer-server-ciphers<span class="w"> </span>yes
--tls-session-caching<span class="w"> </span>yes
</code></pre></div>

<p><strong>Client Connection</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Connection string with TLS</span>
rediss://:password@redis:6379/0

<span class="c1"># Python example</span>
redis.Redis<span class="o">(</span><span class="nv">host</span><span class="o">=</span><span class="s1">&#39;redis&#39;</span>,<span class="w"> </span><span class="nv">port</span><span class="o">=</span><span class="m">6379</span>,<span class="w"> </span><span class="nv">password</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span>,<span class="w"> </span><span class="nv">ssl</span><span class="o">=</span>True,<span class="w"> </span><span class="nv">ssl_ca_certs</span><span class="o">=</span><span class="s1">&#39;/path/to/ca.crt&#39;</span><span class="o">)</span>
</code></pre></div>

<h3 id="nats">NATS<a class="headerlink" href="#nats" title="Permanent link">&para;</a></h3>
<p><strong>Configuration File</strong>: <code>/home/user/sahool-unified-v15-idp/config/nats/nats.conf</code></p>
<p><strong>TLS Settings</strong>:</p>
<div class="codehilite"><pre><span></span><code>tls {
    cert_file: &quot;/etc/nats/certs/server.crt&quot;
    key_file: &quot;/etc/nats/certs/server.key&quot;
    ca_file: &quot;/etc/nats/certs/ca.crt&quot;
    verify: true
    timeout: 2
}
</code></pre></div>

<p><strong>Client Connection</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Connection string with TLS</span>
nats://user:pass@nats:4222?tls<span class="o">=</span>true<span class="p">&amp;</span><span class="nv">tls_ca</span><span class="o">=</span>/path/to/ca.crt
</code></pre></div>

<h3 id="kong">Kong<a class="headerlink" href="#kong" title="Permanent link">&para;</a></h3>
<p><strong>Configuration</strong>: Environment variables in <code>docker-compose.tls.yml</code></p>
<p><strong>TLS Settings</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">KONG_PROXY_LISTEN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0.0.0.0:8000,</span><span class="nv"> </span><span class="s">0.0.0.0:8443</span><span class="nv"> </span><span class="s">ssl&quot;</span>
<span class="nt">KONG_SSL_CERT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kong/certs/server.crt</span>
<span class="nt">KONG_SSL_CERT_KEY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/kong/certs/server.key</span>
</code></pre></div>

<p><strong>Access</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># HTTPS access</span>
curl<span class="w"> </span>https://kong:8443/api/v1/health

<span class="c1"># Admin API (localhost only, no TLS required)</span>
curl<span class="w"> </span>http://localhost:8001/status
</code></pre></div>

<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<h3 id="standard-deployment-no-tls">Standard Deployment (No TLS)<a class="headerlink" href="#standard-deployment-no-tls" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>

<h3 id="tls-enabled-deployment">TLS-Enabled Deployment<a class="headerlink" href="#tls-enabled-deployment" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Method 1: Command line</span>
docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.tls.yml<span class="w"> </span>up<span class="w"> </span>-d

<span class="c1"># Method 2: Environment variable (add to .env)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;COMPOSE_FILE=docker-compose.yml:docker-compose.tls.yml&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.env
docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>

<h3 id="certificate-generation-before-first-run">Certificate Generation Before First Run<a class="headerlink" href="#certificate-generation-before-first-run" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Navigate to certs directory</span>
<span class="nb">cd</span><span class="w"> </span>/home/user/sahool-unified-v15-idp/config/certs

<span class="c1"># Generate all certificates</span>
./generate-internal-tls.sh

<span class="c1"># Verify certificates</span>
./generate-internal-tls.sh<span class="w"> </span>--verify
</code></pre></div>

<h2 id="application-integration">Application Integration<a class="headerlink" href="#application-integration" title="Permanent link">&para;</a></h2>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">&para;</a></h3>
<p>Add to your service <code>.env</code> or docker-compose environment:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># PostgreSQL</span>
<span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql://user:pass@postgres:5432/db?sslmode<span class="o">=</span>prefer
<span class="nv">PGSSLMODE</span><span class="o">=</span>prefer
<span class="nv">PGSSLROOTCERT</span><span class="o">=</span>/app/certs/ca.crt

<span class="c1"># Redis</span>
<span class="nv">REDIS_URL</span><span class="o">=</span>rediss://:password@redis:6379/0
<span class="nv">REDIS_TLS_ENABLED</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">REDIS_TLS_CA_CERTS</span><span class="o">=</span>/app/certs/ca.crt

<span class="c1"># NATS</span>
<span class="nv">NATS_URL</span><span class="o">=</span>nats://user:pass@nats:4222?tls<span class="o">=</span><span class="nb">true</span>
<span class="nv">NATS_TLS_ENABLED</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">NATS_TLS_CA</span><span class="o">=</span>/app/certs/ca.crt
</code></pre></div>

<h3 id="code-examples">Code Examples<a class="headerlink" href="#code-examples" title="Permanent link">&para;</a></h3>
<h4 id="python-postgresql-with-asyncpg">Python - PostgreSQL with asyncpg<a class="headerlink" href="#python-postgresql-with-asyncpg" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncpg</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>

<span class="c1"># Create SSL context</span>
<span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span><span class="n">cafile</span><span class="o">=</span><span class="s1">&#39;/app/certs/ca.crt&#39;</span><span class="p">)</span>

<span class="c1"># Connect with TLS</span>
<span class="n">conn</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncpg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">5432</span><span class="p">,</span>
    <span class="n">user</span><span class="o">=</span><span class="s1">&#39;sahool&#39;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
    <span class="n">database</span><span class="o">=</span><span class="s1">&#39;sahool&#39;</span><span class="p">,</span>
    <span class="n">ssl</span><span class="o">=</span><span class="n">ssl_context</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="python-redis-with-redis-py">Python - Redis with redis-py<a class="headerlink" href="#python-redis-with-redis-py" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">redis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>

<span class="c1"># Create SSL context</span>
<span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span><span class="n">cafile</span><span class="o">=</span><span class="s1">&#39;/app/certs/ca.crt&#39;</span><span class="p">)</span>

<span class="c1"># Connect with TLS</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;redis&#39;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
    <span class="n">ssl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">ssl_cert_reqs</span><span class="o">=</span><span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span><span class="p">,</span>
    <span class="n">ssl_ca_certs</span><span class="o">=</span><span class="s1">&#39;/app/certs/ca.crt&#39;</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="nodejs-postgresql-with-pg">Node.js - PostgreSQL with pg<a class="headerlink" href="#nodejs-postgresql-with-pg" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Pool</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pg&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Pool</span><span class="p">({</span>
<span class="w">  </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="mf">5432</span><span class="p">,</span>
<span class="w">  </span><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;sahool&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;sahool&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ssl</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">rejectUnauthorized</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">ca</span><span class="o">:</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;/app/certs/ca.crt&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>

<h4 id="nodejs-redis-with-ioredis">Node.js - Redis with ioredis<a class="headerlink" href="#nodejs-redis-with-ioredis" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">Redis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ioredis&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">redis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Redis</span><span class="p">({</span>
<span class="w">  </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;redis&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="mf">6379</span><span class="p">,</span>
<span class="w">  </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">tls</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ca</span><span class="o">:</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;/app/certs/ca.crt&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="monitoring-maintenance">Monitoring &amp; Maintenance<a class="headerlink" href="#monitoring-maintenance" title="Permanent link">&para;</a></h2>
<h3 id="certificate-expiration-monitoring">Certificate Expiration Monitoring<a class="headerlink" href="#certificate-expiration-monitoring" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check all certificate expiration dates</span>
<span class="nb">cd</span><span class="w"> </span>/home/user/sahool-unified-v15-idp/config/certs

<span class="k">for</span><span class="w"> </span>service<span class="w"> </span><span class="k">in</span><span class="w"> </span>postgres<span class="w"> </span>pgbouncer<span class="w"> </span>redis<span class="w"> </span>nats<span class="w"> </span>kong<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== </span><span class="nv">$service</span><span class="s2"> ===&quot;</span>
<span class="w">  </span>openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$service</span><span class="s2">/server.crt&quot;</span><span class="w"> </span>-noout<span class="w"> </span>-dates
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="k">done</span>
</code></pre></div>

<h3 id="automated-monitoring-script">Automated Monitoring Script<a class="headerlink" href="#automated-monitoring-script" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># monitor-certs.sh</span>

<span class="nv">WARN_DAYS</span><span class="o">=</span><span class="m">30</span>
<span class="nv">CERT_DIR</span><span class="o">=</span><span class="s2">&quot;/home/user/sahool-unified-v15-idp/config/certs&quot;</span>

<span class="k">for</span><span class="w"> </span>cert<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$CERT_DIR</span>/*/server.crt<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nv">service</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="k">$(</span>dirname<span class="w"> </span><span class="nv">$cert</span><span class="k">))</span>
<span class="w">  </span><span class="nv">expiry</span><span class="o">=</span><span class="k">$(</span>openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cert</span><span class="s2">&quot;</span><span class="w"> </span>-noout<span class="w"> </span>-enddate<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="o">=</span><span class="w"> </span>-f2<span class="k">)</span>
<span class="w">  </span><span class="nv">expiry_epoch</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$expiry</span><span class="s2">&quot;</span><span class="w"> </span>+%s<span class="k">)</span>
<span class="w">  </span><span class="nv">now_epoch</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
<span class="w">  </span><span class="nv">days_left</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="o">(</span><span class="nv">$expiry_epoch</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">$now_epoch</span><span class="o">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">86400</span><span class="w"> </span><span class="k">))</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$days_left</span><span class="w"> </span>-lt<span class="w"> </span><span class="nv">$WARN_DAYS</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;⚠️  WARNING: </span><span class="nv">$service</span><span class="s2"> certificate expires in </span><span class="nv">$days_left</span><span class="s2"> days!&quot;</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;✓ </span><span class="nv">$service</span><span class="s2"> certificate valid for </span><span class="nv">$days_left</span><span class="s2"> more days&quot;</span>
<span class="w">  </span><span class="k">fi</span>
<span class="k">done</span>
</code></pre></div>

<h3 id="health-check-endpoints">Health Check Endpoints<a class="headerlink" href="#health-check-endpoints" title="Permanent link">&para;</a></h3>
<p>Monitor TLS connectivity:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># PostgreSQL</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>sahool<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SHOW ssl;&quot;</span>

<span class="c1"># Redis</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>redis<span class="w"> </span>redis-cli<span class="w"> </span>INFO<span class="w"> </span>server<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ssl

<span class="c1"># NATS</span>
curl<span class="w"> </span>http://localhost:8222/varz<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.tls&#39;</span>

<span class="c1"># Kong</span>
curl<span class="w"> </span>-k<span class="w"> </span>https://localhost:8443/
</code></pre></div>

<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="common-issues">Common Issues<a class="headerlink" href="#common-issues" title="Permanent link">&para;</a></h3>
<h4 id="1-certificate-verification-failed">1. Certificate Verification Failed<a class="headerlink" href="#1-certificate-verification-failed" title="Permanent link">&para;</a></h4>
<p><strong>Error</strong>: <code>SSL error: certificate verify failed</code></p>
<p><strong>Causes</strong>:
- CA certificate not provided to client
- Certificate expired
- Hostname mismatch</p>
<p><strong>Solutions</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify certificate is valid</span>
openssl<span class="w"> </span>verify<span class="w"> </span>-CAfile<span class="w"> </span>config/certs/ca/ca.crt<span class="w"> </span>config/certs/postgres/server.crt

<span class="c1"># Check expiration</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>config/certs/postgres/server.crt<span class="w"> </span>-noout<span class="w"> </span>-dates

<span class="c1"># Regenerate if needed</span>
<span class="nb">cd</span><span class="w"> </span>config/certs<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./generate-internal-tls.sh<span class="w"> </span>--force
</code></pre></div>

<h4 id="2-connection-refused">2. Connection Refused<a class="headerlink" href="#2-connection-refused" title="Permanent link">&para;</a></h4>
<p><strong>Error</strong>: <code>Connection refused</code> or <code>Connection reset by peer</code></p>
<p><strong>Causes</strong>:
- Service not configured for TLS
- Wrong port
- Firewall blocking TLS port</p>
<p><strong>Solutions</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check service logs</span>
docker-compose<span class="w"> </span>logs<span class="w"> </span>postgres<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>ssl
docker-compose<span class="w"> </span>logs<span class="w"> </span>redis<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>tls

<span class="c1"># Verify TLS is enabled</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>sahool<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SHOW ssl;&quot;</span>

<span class="c1"># Test connection</span>
openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>localhost:5432<span class="w"> </span>-starttls<span class="w"> </span>postgres
</code></pre></div>

<h4 id="3-permission-denied-reading-certificate">3. Permission Denied Reading Certificate<a class="headerlink" href="#3-permission-denied-reading-certificate" title="Permanent link">&para;</a></h4>
<p><strong>Error</strong>: <code>Permission denied</code> when accessing certificate files</p>
<p><strong>Solution</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Fix permissions</span>
<span class="nb">cd</span><span class="w"> </span>/home/user/sahool-unified-v15-idp/config/certs
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>*/server.key
chmod<span class="w"> </span><span class="m">644</span><span class="w"> </span>*/server.crt<span class="w"> </span>ca/ca.crt
</code></pre></div>

<h4 id="4-wrong-ssl-mode">4. Wrong SSL Mode<a class="headerlink" href="#4-wrong-ssl-mode" title="Permanent link">&para;</a></h4>
<p><strong>Error</strong>: <code>sslmode value "require" is not valid</code></p>
<p><strong>Solution</strong>: Use correct sslmode values:
- PostgreSQL: <code>disable</code>, <code>allow</code>, <code>prefer</code>, <code>require</code>, <code>verify-ca</code>, <code>verify-full</code>
- Update connection string or environment variable</p>
<h2 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h2>
<h3 id="development-environment">Development Environment<a class="headerlink" href="#development-environment" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ Use <code>sslmode=prefer</code> to allow gradual migration</li>
<li>✅ Self-signed certificates are acceptable</li>
<li>✅ Keep certificates in version control (except <code>.key</code> files)</li>
</ul>
<h3 id="production-environment">Production Environment<a class="headerlink" href="#production-environment" title="Permanent link">&para;</a></h3>
<ul>
<li>⚠️ Use <code>sslmode=require</code> or <code>sslmode=verify-full</code></li>
<li>⚠️ Consider using CA-signed certificates</li>
<li>⚠️ Store certificates in secrets management (Vault, AWS Secrets Manager)</li>
<li>⚠️ Enable certificate pinning for critical services</li>
<li>⚠️ Implement automated certificate rotation</li>
<li>⚠️ Monitor certificate expiration</li>
</ul>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Never commit private keys</strong> (<code>.key</code> files) to version control</li>
<li><strong>Rotate certificates regularly</strong> (before expiration)</li>
<li><strong>Use strong ciphers</strong> (TLS 1.2+, disable weak ciphers)</li>
<li><strong>Monitor TLS connections</strong> (failed handshakes, expired certs)</li>
<li><strong>Implement certificate pinning</strong> for critical clients</li>
<li><strong>Use separate certificates per environment</strong> (dev/staging/prod)</li>
<li><strong>Keep CA private key extremely secure</strong></li>
<li><strong>Audit certificate access and usage</strong></li>
</ol>
<h2 id="migration-path">Migration Path<a class="headerlink" href="#migration-path" title="Permanent link">&para;</a></h2>
<h3 id="phase-1-enable-tls-optional-mode">Phase 1: Enable TLS (Optional Mode)<a class="headerlink" href="#phase-1-enable-tls-optional-mode" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Services support both TLS and non-TLS</span>
<span class="c1"># PostgreSQL: sslmode=prefer</span>
<span class="c1"># Redis: tls-auth-clients optional</span>
</code></pre></div>

<h3 id="phase-2-update-applications">Phase 2: Update Applications<a class="headerlink" href="#phase-2-update-applications" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Update all services to use TLS connections</span>
<span class="c1"># Test thoroughly</span>
</code></pre></div>

<h3 id="phase-3-enforce-tls-required-mode">Phase 3: Enforce TLS (Required Mode)<a class="headerlink" href="#phase-3-enforce-tls-required-mode" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># PostgreSQL: sslmode=require</span>
<span class="c1"># Redis: tls-auth-clients yes</span>
<span class="c1"># NATS: verify=true</span>
</code></pre></div>

<h3 id="phase-4-enable-mutual-tls-mtls">Phase 4: Enable Mutual TLS (mTLS)<a class="headerlink" href="#phase-4-enable-mutual-tls-mtls" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Require client certificates</span>
<span class="c1"># PostgreSQL: sslmode=verify-full, clientcert=verify-full</span>
<span class="c1"># Redis: tls-auth-clients yes</span>
<span class="c1"># NATS: verify_and_map=true</span>
</code></pre></div>

<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.postgresql.org/docs/current/ssl-tcp.html">PostgreSQL SSL Documentation</a></li>
<li><a href="https://redis.io/docs/management/security/encryption/">Redis TLS Documentation</a></li>
<li><a href="https://docs.nats.io/running-a-nats-service/configuration/securing_nats/tls">NATS TLS Documentation</a></li>
<li><a href="https://docs.konghq.com/gateway/latest/production/networking/cp-dp-proxy/">Kong SSL Configuration</a></li>
<li><a href="https://www.openssl.org/docs/">OpenSSL Documentation</a></li>
</ul>
<h2 id="support">Support<a class="headerlink" href="#support" title="Permanent link">&para;</a></h2>
<p>For issues or questions about TLS configuration:</p>
<ol>
<li>Check service logs: <code>docker-compose logs &lt;service&gt;</code></li>
<li>Verify certificates: <code>./config/certs/generate-internal-tls.sh --verify</code></li>
<li>Review this documentation</li>
<li>Check <code>/home/user/sahool-unified-v15-idp/config/certs/README.md</code></li>
</ol>
<hr />
<p><strong>Document Version</strong>: 1.0
<strong>Last Updated</strong>: 2026-01-06
<strong>Maintained By</strong>: SAHOOL Platform Team</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>