# Astronomical Task Widget - ููุฏุฌุช ุงูููุงู ุงูููููุฉ

## ูุธุฑุฉ ุนุงูุฉ

ููุฏุฌุช ูุชูุงูู ูุนุฑุถ ุฃูุถู ุงูุฃูุงู ููุฃูุดุทุฉ ุงูุฒุฑุงุนูุฉ ุจูุงุกู ุนูู ุงูุชูููู ุงููููู ุงููููู ุงูุชูููุฏูุ ูุน ุฅููุงููุฉ ุฅูุดุงุก ููุงู ูุจุงุดุฑุฉ ูู ุงูุฃูุงู ุงูููุชุฑุญุฉ.

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. ุงุฎุชูุงุฑ ุงููุดุงุท
- ุฒุฑุงุนุฉ ๐ฑ
- ุฑู ๐ง
- ุญุตุงุฏ ๐พ
- ุชุณููุฏ ๐ฟ

### 2. ุฃููุงุท ุงูุนุฑุถ
- **ุนุฑุถ ุงูุชูููู**: ุดุจูุฉ ุชูููููุฉ ุดูุฑูุฉ ูุน ุชุฑููุฒ ูููู ุญุณุจ ุงูุฏุฑุฌุฉ
- **ุนุฑุถ ุงููุงุฆูุฉ**: ูุงุฆูุฉ ูุฑุชุจุฉ ุจุฃูุถู ุงูุฃูุงู ูุน ุงูุชูุงุตูู ุงููุงููุฉ

### 3. ุชูุงุตูู ุงูููู
ุนูุฏ ุงุฎุชูุงุฑ ููู ูุนููุ ูุชู ุนุฑุถ:
- ุงูุชุงุฑูุฎ ุงููููุงุฏู ูุงููุฌุฑู
- ุทูุฑ ุงูููุฑ ุงูุญุงูู
- ุงูููุฒูุฉ ุงูููุฑูุฉ
- ุฏุฑุฌุฉ ุงูููุงุกูุฉ ูููุดุงุท (0-100)
- ุงูุณุจุจ ุงููููู ููุชูุตูุฉ

### 4. ุฅูุดุงุก ุงูููุงู
- ุฒุฑ ูุจุงุดุฑ ูุฅูุดุงุก ูููุฉ ูู ุงูููู ุงููุญุฏุฏ
- ุชูุงูู ูุงูู ูุน ุดุงุดุฉ ุฅูุดุงุก ุงูููุงู ุงูููุฌูุฏุฉ
- ุชุนุจุฆุฉ ุชููุงุฆูุฉ ููุชุงุฑูุฎ ูุงููุดุงุท

### 5. ุงูุชุฎุฒูู ุงููุคูุช (Offline Support)
- ุญูุธ ุชููุงุฆู ููุจูุงูุงุช ุงูููููุฉ
- ุงูุนูู ุจุฏูู ุงุชุตุงู ุจุงูุฅูุชุฑูุช
- ุตูุงุญูุฉ ุงูุจูุงูุงุช: 7 ุฃูุงู
- ุงุณุชุฎุฏุงู SharedPreferences ููุชุฎุฒูู

### 6. ุงูุชุฑููุฒ ุงููููู
- **ุฃุฎุถุฑ ุฏุงูู** (90-100): ููุชุงุฒ - ุฃูุถู ุงูุฃูุงู
- **ุฃุฎุถุฑ** (80-89): ุฌูุฏ ุฌุฏุงู
- **ุฃุฎุถุฑ ูุงุชุญ** (70-79): ุฌูุฏ
- **ุฃุตูุฑ ูุฎุถุฑ** (60-69): ููุจูู
- **ุจุฑุชูุงูู** (ุฃูู ูู 60): ูุชูุณุท

## ุงูุงุณุชุฎุฏุงู

### ุทุฑููุฉ 1: ุนุฑุถ ูู Bottom Sheet (ููุตู ุจูุง)

```dart
import 'package:flutter/material.dart';
import 'astronomical_task_widget.dart';

void showAstronomicalTaskSheet(BuildContext context, {String? fieldId, String? fieldName}) {
  showModalBottomSheet(
    context: context,
    isScrollControlled: true,
    backgroundColor: Colors.transparent,
    builder: (context) => DraggableScrollableSheet(
      initialChildSize: 0.9,
      minChildSize: 0.5,
      maxChildSize: 0.95,
      builder: (context, scrollController) => AstronomicalTaskWidget(
        fieldId: fieldId,
        fieldName: fieldName,
      ),
    ),
  );
}

// ุงูุงุณุชุฎุฏุงู
ElevatedButton(
  onPressed: () => showAstronomicalTaskSheet(
    context,
    fieldId: 'field_123',
    fieldName: 'ุญูู ุงูููุญ ุงูุดูุงูู',
  ),
  child: Text('ุงูุชูููู ุงููููู'),
)
```

### ุทุฑููุฉ 2: ูุดุงุดุฉ ูุงููุฉ

```dart
import 'package:flutter/material.dart';
import 'astronomical_task_widget.dart';

class AstronomicalTaskScreen extends StatelessWidget {
  final String? fieldId;
  final String? fieldName;

  const AstronomicalTaskScreen({
    super.key,
    this.fieldId,
    this.fieldName,
  });

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: AstronomicalTaskWidget(
        fieldId: fieldId,
        fieldName: fieldName,
      ),
    );
  }
}
```

### ุทุฑููุฉ 3: ูุชุจููุจ ูู ุดุงุดุฉ ููุฌูุฏุฉ

```dart
TabBarView(
  children: [
    // ุชุจููุจุงุช ุฃุฎุฑู...
    AstronomicalTaskWidget(
      fieldId: fieldId,
      fieldName: fieldName,
    ),
  ],
)
```

## ุงููุนุงููุงุช (Parameters)

| ุงููุนุงูู | ุงูููุน | ูุทููุจ | ุงููุตู |
|---------|------|-------|-------|
| `fieldId` | String? | ูุง | ูุนุฑู ุงูุญูู ุงูุฐู ุณูุชู ุฅูุดุงุก ุงููููุฉ ูู |
| `fieldName` | String? | ูุง | ุงุณู ุงูุญูู (ููุนุฑุถ) |

## ุงููุฒูุฏุงุช (Providers)

### astronomicalTaskActivityProvider
```dart
final astronomicalTaskActivityProvider = StateProvider<String>((ref) => 'ุฒุฑุงุนุฉ');
```
ูุฏูุฑ ุงููุดุงุท ุงููุญุฏุฏ ุญุงููุงู.

### selectedAstroDayProvider
```dart
final selectedAstroDayProvider = StateProvider<BestDay?>((ref) => null);
```
ูุฏูุฑ ุงูููู ุงููุญุฏุฏ ูู ุงูุชูููู.

### astroViewModeProvider
```dart
final astroViewModeProvider = StateProvider<AstroViewMode>((ref) => AstroViewMode.calendar);
```
ูุฏูุฑ ููุท ุงูุนุฑุถ (ุชูููู ุฃู ูุงุฆูุฉ).

### astronomicalCacheProvider
```dart
final astronomicalCacheProvider = FutureProvider.family<BestDaysResult?, String>((ref, activity) async {...});
```
ูุฏูุฑ ุฌูุจ ุงูุจูุงูุงุช ูุงูุชุฎุฒูู ุงููุคูุช.

## ุงูุจููุฉ ุงูุชูููุฉ

### ูููุฐุฌ ุงูุจูุงูุงุช

```dart
class BestDay {
  final String date;           // ุงูุชุงุฑูุฎ ุงููููุงุฏู (yyyy-MM-dd)
  final String hijriDate;      // ุงูุชุงุฑูุฎ ุงููุฌุฑู
  final String moonPhase;      // ุทูุฑ ุงูููุฑ
  final String lunarMansion;   // ุงูููุฒูุฉ ุงูููุฑูุฉ
  final int score;             // ุงูุฏุฑุฌุฉ (0-100)
  final String reason;         // ุณุจุจ ุงูุชูุตูุฉ
}

class BestDaysResult {
  final String activity;       // ุงููุดุงุท ุงููุทููุจ
  final int searchPeriodDays;  // ุนุฏุฏ ุงูุฃูุงู ุงููุจุญูุซ ูููุง
  final List<BestDay> bestDays; // ูุงุฆูุฉ ุฃูุถู ุงูุฃูุงู
  final int totalFound;        // ุฅุฌูุงูู ุงูุฃูุงู ุงูููุงุณุจุฉ
}
```

### ููููุงุช ุงูููุฏุฌุช

1. **_CalendarGrid**: ุดุจูุฉ ุงูุชูููู ุงูุดูุฑูุฉ
2. **_DayDetailsCard**: ุจุทุงูุฉ ุชูุงุตูู ุงูููู ุงููุญุฏุฏ
3. **_DayListTile**: ุนูุตุฑ ูู ุนุฑุถ ุงููุงุฆูุฉ
4. **_buildActivitySelector**: ูุญุฏุฏ ุงููุดุงุท
5. **_buildCreateTaskButton**: ุฒุฑ ุฅูุดุงุก ุงููููุฉ

## ุงูุชุฏูู ุงูุจุฑูุฌู

```mermaid
graph TD
    A[ูุชุญ ุงูููุฏุฌุช] --> B[ุงุฎุชูุงุฑ ุงููุดุงุท]
    B --> C[ุฌูุจ ุงูุจูุงูุงุช ูู API]
    C --> D{ูุฌุญ ุงูุฌูุจุ}
    D -->|ูุนู| E[ุญูุธ ูู ุงูุชุฎุฒูู ุงููุคูุช]
    D -->|ูุง| F[ูุฑุงุกุฉ ูู ุงูุชุฎุฒูู ุงููุคูุช]
    E --> G[ุนุฑุถ ุงูุชูููู/ุงููุงุฆูุฉ]
    F --> G
    G --> H[ุงุฎุชูุงุฑ ููู]
    H --> I[ุนุฑุถ ุงูุชูุงุตูู]
    I --> J[ุฅูุดุงุก ูููุฉ]
    J --> K[ุงูุงูุชูุงู ูุดุงุดุฉ ุฅูุดุงุก ุงูููุงู]
```

## ุงูุชุฎุฒูู ุงููุคูุช

### ุขููุฉ ุงูุนูู

1. **ุงูุฌูุจ ุงูุฃูู**: ูุญุงููุฉ ุงูุฌูุจ ูู ุงูุฎุงุฏู
2. **ุงูุญูุธ**: ุญูุธ ุงูุจูุงูุงุช ูุน ุทุงุจุน ุฒููู
3. **ุงููุดู**: ูุฑุงุกุฉ ุงูุจูุงูุงุช ุงููุฎุฒูุฉ
4. **ุงูุชุญูู**: ูุญุต ุตูุงุญูุฉ ุงูุจูุงูุงุช (7 ุฃูุงู)

### ูููู ุงูุจูุงูุงุช ุงููุฎุฒูุฉ

```json
{
  "result": {
    "activity": "ุฒุฑุงุนุฉ",
    "searchPeriodDays": 30,
    "bestDays": [...],
    "totalFound": 15
  },
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

### ููุชุงุญ ุงูุชุฎุฒูู
```dart
'astronomical_data_{activity}'
// ูุซุงู: 'astronomical_data_ุฒุฑุงุนุฉ'
```

## ุงูุชูุงูู ูุน ุดุงุดุฉ ุฅูุดุงุก ุงูููุงู

ุนูุฏ ุงูููุฑ ุนูู "ุฅูุดุงุก ูููุฉ":

1. ุชุญููู ุงูุชุงุฑูุฎ ุงููุญุฏุฏ
2. ุงูุงูุชูุงู ุฅูู `CreateTaskScreen`
3. ุชูุฑูุฑ `fieldId` ู `fieldName`
4. ุงููุณุชุฎุฏู ูููู ุจูุงูุงุช ุงููููุฉ
5. ุงูุนูุฏุฉ ุจูุชูุฌุฉ ุงููุฌุงุญ
6. ุนุฑุถ ุฑุณุงูุฉ ุงูุชุฃููุฏ

```dart
final result = await Navigator.push<bool>(
  context,
  MaterialPageRoute(
    builder: (context) => CreateTaskScreen(
      fieldId: fieldId,
      fieldName: fieldName,
    ),
  ),
);

if (result == true) {
  // ูุฌุญ ุงูุฅูุดุงุก
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text('ุชู ุฅูุดุงุก ุงููููุฉ ุจูุฌุงุญ')),
  );
}
```

## ุงูุชุฎุตูุต

### ุชุบููุฑ ุงูุฃููุงู

```dart
// ูู _getScoreColor
Color _getScoreColor(int score) {
  if (score >= 90) return Colors.green.shade700;  // ููุชุงุฒ
  if (score >= 80) return Colors.green;           // ุฌูุฏ ุฌุฏุงู
  if (score >= 70) return Colors.lightGreen;      // ุฌูุฏ
  if (score >= 60) return Colors.lime.shade600;   // ููุจูู
  return Colors.orange;                           // ูุชูุณุท
}
```

### ุชุบููุฑ ูุฏุฉ ุงูุชุฎุฒูู ุงููุคูุช

```dart
// ูู _loadFromCache
if (DateTime.now().difference(timestamp).inDays > 7) {  // 7 ุฃูุงู
  return null;
}
```

### ุชุบููุฑ ุนุฏุฏ ุงูุฃูุงู ุงููุจุญูุซ ูููุง

```dart
final cacheAsync = ref.watch(
  astronomicalCacheProvider(selectedActivity),
  // ูุชุบููุฑ ุนุฏุฏ ุงูุฃูุงูุ ุนุฏูู ูู BestDaysParams
);

// ูู ุงููุฒูุฏ:
BestDaysParams(activity: selectedActivity, days: 30)  // 30 ูููุงู
```

## ุงูุฃูุซูุฉ

ุฑุงุฌุน ููู `astronomical_task_widget_example.dart` ููุฃูุซูุฉ ุงููุงููุฉ:

1. ุนุฑุถ ูู Bottom Sheet
2. ุฏูุฌ ูู ุดุงุดุฉ ุงูููุงู
3. ุฏูุฌ ูุชุจููุจ
4. ุนุฑุถ ูุดุงุดุฉ ูููุตูุฉ
5. ุงุณุชุฎุฏุงู ูุน ูุงุฆูุฉ ุงูุญููู
6. ุฏูุฌ ูู ุดุงุดุฉ ุฅูุดุงุก ุงููููุฉ

## ุงููุชุทูุจุงุช

### Dependencies

```yaml
dependencies:
  flutter_riverpod: ^2.4.0
  intl: ^0.19.0
  shared_preferences: ^2.3.3
```

### ุงูุญุฏ ุงูุฃุฏูู ูู Flutter SDK

```yaml
environment:
  sdk: ">=3.0.0 <4.0.0"
```

## ุงูุงุนุชุจุงุฑุงุช ุงูุฃูููุฉ

- ุงูุจูุงูุงุช ุงูููููุฉ ุบูุฑ ุญุณุงุณุฉุ ูููู ุชุฎุฒูููุง ุจุฏูู ุชุดููุฑ
- ุงุณุชุฎุฏุงู SharedPreferences ููุชุฎุฒูู ุงูุจุณูุท
- ุนุฏู ุชุฎุฒูู ูุนูููุงุช ุงููุณุชุฎุฏู ุงูุญุณุงุณุฉ

## ุงูุฃุฏุงุก

### ุงูุชุญุณููุงุช ุงููุทุจูุฉ

1. **Lazy Loading**: ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุงูุทูุจ ููุท
2. **Caching**: ุชูููู ุงูุทูุจุงุช ููุฎุงุฏู
3. **AutoDispose**: ุชูุธูู ุงููุฒูุฏุงุช ุชููุงุฆูุงู
4. **Efficient Rebuilds**: ุงุณุชุฎุฏุงู Consumer ููุชุญุฏูุซุงุช ุงูุงูุชูุงุฆูุฉ

### ุงูุฐุงูุฑุฉ

- ุญุฌู ุงูุจูุงูุงุช ุงููุฎุฒูุฉ: ~10-20 KB ููู ูุดุงุท
- ุฅุฌูุงูู ุงูุฐุงูุฑุฉ: ~50-80 KB ูุฌููุน ุงูุฃูุดุทุฉ

## ุงูุฅุตูุงุญุงุช ุงูุดุงุฆุนุฉ

### ุงูุจูุงูุงุช ูุง ุชุธูุฑ

```dart
// ุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช
// ุงูุณุญ ุงูุชุฎุฒูู ุงููุคูุช
final prefs = await SharedPreferences.getInstance();
await prefs.remove('astronomical_data_ุฒุฑุงุนุฉ');
```

### ุฎุทุฃ ูู ุงูุชุงุฑูุฎ

```dart
// ุชุญูู ูู ุตูุบุฉ ุงูุชุงุฑูุฎ
DateFormat('yyyy-MM-dd').parse(day.date)
```

### ูุง ูุชู ุฅูุดุงุก ุงููููุฉ

```dart
// ุชุญูู ูู fieldId
// ุชุญูู ูู ุงูุชููู
Navigator.push<bool>(...)
```

## ุงููุณุงููุฉ

ุนูุฏ ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ:

1. ุงุชุจุน ููุท ุงูุจุฑูุฌุฉ ุงูุญุงูู
2. ุฃุถู ุชุนูููุงุช ุจุงููุบุฉ ุงูุนุฑุจูุฉ
3. ุญุงูุธ ุนูู ุงูุชูุงูู ูุน ุงูุชุฎุฒูู ุงููุคูุช
4. ุงุฎุชุจุฑ ูู ูุถุน ุนุฏู ุงูุงุชุตุงู

## ุงูุชุฑุฎูุต

ุฌุฒุก ูู ูุธุงู SAHOOL ุงูุฒุฑุงุนู ุงููุชูุงูู.

---

## ููุงุญุธุงุช ุฅุถุงููุฉ

### ุงูุชูููู ุงููููู ุงููููู

ูุนุชูุฏ ุงูููุฏุฌุช ุนูู:
- **28 ููุฒูุฉ ููุฑูุฉ**: ูู ููุฒูุฉ ููุง ุฎุตุงุฆุต ุฒุฑุงุนูุฉ ูุฎุชููุฉ
- **ุฃุทูุงุฑ ุงูููุฑ**: ุชุฃุซูุฑ ุงูููุฑ ุนูู ููู ุงููุจุงุชุงุช
- **ุงูุชุงุฑูุฎ ุงููุฌุฑู**: ุงูุชูููู ุงูุชูููุฏู ุงููุณุชุฎุฏู ูู ุงูููู
- **ุงูุฃูุซุงู ุงูุดุนุจูุฉ**: ุญููุฉ ุงูุฃุฌุฏุงุฏ ูู ุงูุฒุฑุงุนุฉ

### ุงูุฃูุดุทุฉ ุงููุฏุนููุฉ

1. **ุฒุฑุงุนุฉ**: ุฒุฑุงุนุฉ ุงูุจุฐูุฑ ูุงูุดุชูุงุช
2. **ุฑู**: ุณูู ุงููุญุงุตูู
3. **ุญุตุงุฏ**: ุฌูู ุงููุญุตูู
4. **ุชุณููุฏ**: ุฅุถุงูุฉ ุงูุฃุณูุฏุฉ ููุชุฑุจุฉ

ูู ูุดุงุท ูู ูุนุงููุฑ ููููุฉ ุฎุงุตุฉ ุจู.
