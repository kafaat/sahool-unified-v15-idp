# SAHOOL Change Detection System

# Ù†Ø¸Ø§Ù… ÙƒØ´Ù Ø§Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© - Ø³Ù‡ÙˆÙ„

## Overview | Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

The Change Detection System analyzes satellite time series data to automatically identify significant changes in agricultural fields, helping farmers respond quickly to crop stress, damage, or optimal growth conditions.

ÙŠØ­Ù„Ù„ Ù†Ø¸Ø§Ù… ÙƒØ´Ù Ø§Ù„ØªØºÙŠØ±Ø§Øª Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù…Ù…Ø§ ÙŠØ³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¨Ø³Ø±Ø¹Ø© Ù„Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø£Ø¶Ø±Ø§Ø± Ø£Ùˆ Ø¸Ø±ÙˆÙ Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ù…Ø«Ù„Ù‰.

## Features | Ø§Ù„Ù…ÙŠØ²Ø§Øª

### 1. Change Types Detected | Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ©

- **Vegetation Growth** (Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ù†Ø¨Ø§ØªÙŠ): Healthy crop development
- **Vegetation Decline** (Ø§Ù„ØªØ¯Ù‡ÙˆØ± Ø§Ù„Ù†Ø¨Ø§ØªÙŠ): Reduced crop vigor
- **Water Stress** (Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ù…Ø§Ø¦ÙŠ): Insufficient irrigation detected
- **Drought Stress** (Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ø¬ÙØ§Ù): Severe water deficiency
- **Flooding** (Ø§Ù„ÙÙŠØ¶Ø§Ù†): Excess water accumulation
- **Harvest Detection** (ÙƒØ´Ù Ø§Ù„Ø­ØµØ§Ø¯): Automatic harvest event detection
- **Planting Detection** (ÙƒØ´Ù Ø§Ù„Ø²Ø±Ø§Ø¹Ø©): New crop planting identification
- **Crop Damage** (ØªÙ„Ù Ø§Ù„Ù…Ø­ØµÙˆÙ„): Pest, disease, or weather damage
- **Land Clearing** (ØªØ¬Ø±ÙŠÙ Ø§Ù„Ø£Ø±Ø¶): Field preparation or deforestation

### 2. Severity Levels | Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø®Ø·ÙˆØ±Ø©

- **Low** (Ù…Ù†Ø®ÙØ¶): Minor changes, monitor only
- **Medium** (Ù…ØªÙˆØ³Ø·): Moderate changes, consider action
- **High** (Ù…Ø±ØªÙØ¹): Significant changes, action recommended
- **Critical** (Ø­Ø±Ø¬): Severe changes, immediate action required

### 3. Analysis Capabilities | Ù‚Ø¯Ø±Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„

- Time series anomaly detection (ÙƒØ´Ù Ø§Ù„Ø´Ø°ÙˆØ° ÙÙŠ Ø§Ù„Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø²Ù…Ù†ÙŠØ©)
- Trend analysis (ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª)
- Seasonal pattern recognition (Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ©)
- Crop-specific thresholds (Ø¹ØªØ¨Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø­ØµÙˆÙ„)
- Bilingual recommendations (ØªÙˆØµÙŠØ§Øª Ø«Ù†Ø§Ø¦ÙŠØ© Ø§Ù„Ù„ØºØ©)

## API Endpoints | Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ©

### 1. Comprehensive Change Detection

**Endpoint**: `GET /v1/changes/{field_id}`

Analyzes a time period to detect all significant changes.

**Parameters**:

- `field_id` (required): Field identifier
- `lat` (required): Field latitude (-90 to 90)
- `lon` (required): Field longitude (-180 to 180)
- `start_date` (required): Start date (YYYY-MM-DD)
- `end_date` (required): End date (YYYY-MM-DD)
- `crop_type` (optional): Crop type (wheat, sorghum, coffee, qat, etc.)

**Example Request**:

```bash
curl "http://localhost:8090/v1/changes/field_123?lat=15.5&lon=44.2&start_date=2024-01-01&end_date=2024-03-31&crop_type=wheat"
```

**Example Response**:

```json
{
  "field_id": "field_123",
  "analysis_period": {
    "start_date": "2024-01-01",
    "end_date": "2024-03-31"
  },
  "events": [
    {
      "field_id": "field_123",
      "change_type": "water_stress",
      "severity": "high",
      "detected_date": "2024-02-15",
      "location": {
        "lat": 15.5,
        "lon": 44.2,
        "affected_area_ha": 1.0
      },
      "ndvi_before": 0.75,
      "ndvi_after": 0.52,
      "ndvi_change": -0.23,
      "change_percent": -30.7,
      "confidence": 0.89,
      "description_ar": "Ø¥Ø¬Ù‡Ø§Ø¯ Ù…Ø§Ø¦ÙŠ Ù…ÙƒØªØ´Ù - Ø§Ù†Ø®ÙØ§Ø¶ NDVI Ø¨Ù†Ø³Ø¨Ø© 30.7Ùª",
      "description_en": "Water stress detected - NDVI decreased by 30.7%",
      "recommended_action_ar": "Ø²Ø¯ ÙƒÙ…ÙŠØ© Ø§Ù„Ø±ÙŠ Ø¨Ù†Ø³Ø¨Ø© 20-30Ùª - Ø¥Ø¬Ù‡Ø§Ø¯ Ù…Ø§Ø¦ÙŠ ÙˆØ§Ø¶Ø­",
      "recommended_action_en": "Increase irrigation by 20-30% - clear water stress",
      "additional_metrics": {
        "ndwi": 0.05,
        "z_score": 2.35
      }
    }
  ],
  "overall_trend": "declining",
  "ndvi_trend": -0.0023,
  "anomaly_count": 3,
  "severity_summary": {
    "low": 1,
    "medium": 0,
    "high": 2,
    "critical": 0
  },
  "change_type_summary": {
    "water_stress": 2,
    "vegetation_decrease": 1
  },
  "summary_ar": "ØªÙ… Ø§ÙƒØªØ´Ø§Ù 3 ØªØºÙŠÙŠØ± Ø®Ù„Ø§Ù„ 90 ÙŠÙˆÙ…. Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ø§Ù…: ØªØ¯Ù‡ÙˆØ±. 2 Ø­Ø¯Ø« Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø®Ø·ÙˆØ±Ø©.",
  "summary_en": "Detected 3 changes over 90 days. Overall trend: declining. 2 high-severity event(s).",
  "recommendations_ar": [
    "Ø²Ø¯ ÙƒÙ…ÙŠØ© Ø§Ù„Ø±ÙŠ Ø¨Ù†Ø³Ø¨Ø© 20-30Ùª - Ø¥Ø¬Ù‡Ø§Ø¯ Ù…Ø§Ø¦ÙŠ ÙˆØ§Ø¶Ø­",
    "ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø­Ù‚Ù„ Ù„ØªØ­Ø¯ÙŠØ¯ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªØ¯Ù‡ÙˆØ±",
    "Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©"
  ],
  "recommendations_en": [
    "Increase irrigation by 20-30% - clear water stress",
    "Comprehensive field inspection to identify causes of decline",
    "Continuous monitoring using satellite imagery"
  ]
}
```

### 2. Compare Two Dates

**Endpoint**: `GET /v1/changes/{field_id}/compare`

Compares two specific dates for before/after analysis.

**Parameters**:

- `field_id` (required): Field identifier
- `lat` (required): Field latitude
- `lon` (required): Field longitude
- `date1` (required): First date (YYYY-MM-DD)
- `date2` (required): Second date (YYYY-MM-DD)

**Example Request**:

```bash
curl "http://localhost:8090/v1/changes/field_123/compare?lat=15.5&lon=44.2&date1=2024-01-01&date2=2024-02-01"
```

**Example Response**:

```json
{
  "field_id": "field_123",
  "change_type": "harvest",
  "severity": "high",
  "detected_date": "2024-02-01",
  "location": {
    "lat": 15.5,
    "lon": 44.2,
    "affected_area_ha": 1.0
  },
  "ndvi_before": 0.78,
  "ndvi_after": 0.25,
  "ndvi_change": -0.53,
  "change_percent": -67.9,
  "confidence": 0.95,
  "description_ar": "Ø­ØµØ§Ø¯ Ù…ÙƒØªØ´Ù - Ø§Ù†Ø®ÙØ§Ø¶ Ø³Ø±ÙŠØ¹ ÙÙŠ NDVI Ù…Ù† 67.9Ùª",
  "description_en": "Harvest detected - rapid NDVI drop of 67.9%",
  "recommended_action_ar": "Ø­ØµØ§Ø¯ ØªÙ… Ø¨Ù†Ø¬Ø§Ø­ - Ø®Ø·Ø· Ù„Ù„Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©",
  "recommended_action_en": "Harvest completed successfully - plan for next planting"
}
```

### 3. Detect Anomalies

**Endpoint**: `GET /v1/changes/{field_id}/anomalies`

Identifies unusual NDVI values that deviate from expected patterns.

**Parameters**:

- `field_id` (required): Field identifier
- `lat` (required): Field latitude
- `lon` (required): Field longitude
- `days` (optional): Analysis period in days (default: 90, max: 365)
- `crop_type` (optional): Crop type for expected pattern

**Example Request**:

```bash
curl "http://localhost:8090/v1/changes/field_123/anomalies?lat=15.5&lon=44.2&days=90&crop_type=wheat"
```

**Example Response**:

```json
{
  "field_id": "field_123",
  "analysis_period": {
    "start_date": "2024-09-26",
    "end_date": "2024-12-25"
  },
  "anomaly_count": 2,
  "anomalies": [
    {
      "date": "2024-11-15",
      "ndvi": 0.35,
      "expected": 0.68,
      "deviation": -0.33,
      "z_score": 2.45,
      "severity": "moderate",
      "ndwi": 0.12,
      "ndmi": 0.1
    }
  ],
  "crop_type": "wheat",
  "expected_pattern_used": true
}
```

## Algorithm Details | ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©

### Change Detection Process

1. **Data Collection**: Fetch NDVI time series from satellite observations
2. **Quality Filtering**: Remove cloudy observations (>30% cloud cover)
3. **Seasonal Pattern Calculation**: Compute expected NDVI based on crop type
4. **Anomaly Detection**: Identify deviations using Z-score analysis
5. **Change Classification**: Categorize anomalies by type (harvest, stress, etc.)
6. **Severity Assessment**: Determine urgency based on magnitude and speed
7. **Trend Analysis**: Calculate overall field health trajectory
8. **Recommendation Generation**: Provide actionable advice in Arabic & English

### Detection Thresholds

```python
THRESHOLDS = {
    "significant_change": 0.10,      # 10% NDVI change
    "major_change": 0.20,            # 20% NDVI change
    "critical_change": 0.30,         # 30% NDVI change
    "rapid_change_days": 14,         # Change within 2 weeks
}

ANOMALY_THRESHOLDS = {
    "mild": 1.5,                     # 1.5 standard deviations
    "moderate": 2.0,                 # 2.0 standard deviations
    "severe": 2.5,                   # 2.5 standard deviations
}
```

### Classification Logic

**Harvest Detection**:

- NDVI before > 0.5 (healthy crop)
- NDVI after < 0.3 (bare soil)
- Change > -0.3
- Within 30 days

**Planting Detection**:

- NDVI before < 0.25 (bare soil)
- NDVI after > 0.35 (vegetation)
- Change > +0.2
- Within 45 days

**Water Stress**:

- NDVI decline
- NDWI decline (simultaneous)
- Moderate change rate

**Flooding**:

- NDVI decline
- NDWI increase (water accumulation)
- Rapid change

## Crop-Specific Patterns | Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„

### Wheat (Ø§Ù„Ù‚Ù…Ø­)

- Planting: November
- Peak NDVI: ~0.75
- Harvest: May

### Sorghum (Ø§Ù„Ø°Ø±Ø© Ø§Ù„Ø±ÙÙŠØ¹Ø©)

- Planting: June
- Peak NDVI: ~0.80
- Harvest: October

### Coffee (Ø§Ù„Ø¨Ù†)

- Perennial crop
- Peak NDVI: ~0.85
- Base NDVI: ~0.65

### Qat (Ø§Ù„Ù‚Ø§Øª)

- Perennial crop
- Peak NDVI: ~0.80
- Base NDVI: ~0.60

## Use Cases | Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### 1. Early Warning System

Monitor fields continuously and receive alerts when stress is detected early, allowing preventive action.

### 2. Harvest Planning

Automatically detect when crops are harvested and plan next planting cycle.

### 3. Irrigation Management

Identify water stress events and optimize irrigation schedules.

### 4. Insurance Claims

Document crop damage events with satellite evidence for insurance verification.

### 5. Yield Prediction

Use change patterns to improve yield forecasting accuracy.

### 6. Farm Management

Track multiple fields and prioritize attention based on severity.

## Integration Examples | Ø£Ù…Ø«Ù„Ø© Ø§Ù„ØªÙƒØ§Ù…Ù„

### Python Client

```python
import requests
from datetime import date, timedelta

# Detect changes over last 90 days
today = date.today()
start = today - timedelta(days=90)

response = requests.get(
    "http://localhost:8090/v1/changes/my_field",
    params={
        "lat": 15.5,
        "lon": 44.2,
        "start_date": start.isoformat(),
        "end_date": today.isoformat(),
        "crop_type": "wheat"
    }
)

report = response.json()
print(f"Detected {len(report['events'])} changes")
print(f"Overall trend: {report['overall_trend']}")

# Print critical events
for event in report['events']:
    if event['severity'] == 'critical':
        print(f"âš ï¸ {event['description_en']}")
        print(f"   {event['recommended_action_en']}")
```

### JavaScript/Node.js Client

```javascript
const axios = require("axios");

async function detectChanges(fieldId, lat, lon, startDate, endDate) {
  try {
    const response = await axios.get(
      `http://localhost:8090/v1/changes/${fieldId}`,
      {
        params: {
          lat,
          lon,
          start_date: startDate,
          end_date: endDate,
          crop_type: "wheat",
        },
      },
    );

    const report = response.data;
    console.log(`Trend: ${report.overall_trend}`);
    console.log(`Events: ${report.events.length}`);

    // Display recommendations
    report.recommendations_en.forEach((rec) => {
      console.log(`ðŸ“‹ ${rec}`);
    });

    return report;
  } catch (error) {
    console.error("Change detection failed:", error.message);
  }
}
```

### Mobile App Integration

```kotlin
// Android Kotlin example
suspend fun detectChanges(
    fieldId: String,
    lat: Double,
    lon: Double,
    startDate: String,
    endDate: String
): ChangeReport = withContext(Dispatchers.IO) {
    val response = apiService.detectChanges(
        fieldId = fieldId,
        lat = lat,
        lon = lon,
        startDate = startDate,
        endDate = endDate,
        cropType = "wheat"
    )

    // Show notification for critical events
    response.events
        .filter { it.severity == "critical" }
        .forEach { event ->
            showNotification(
                title = "ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø±Ø¬ - Critical Alert",
                message = event.description_ar
            )
        }

    response
}
```

## Performance Considerations | Ø§Ø¹ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡

- **Response Time**: Typically 1-3 seconds for 90-day analysis
- **Data Points**: Processes up to 50 observations efficiently
- **Concurrent Requests**: Supports multiple fields simultaneously
- **Caching**: Results cached for 1 hour by default

## Limitations | Ø§Ù„Ù‚ÙŠÙˆØ¯

1. **Cloud Cover**: Requires at least 3 clear observations for reliable analysis
2. **Temporal Resolution**: Sentinel-2 revisit time is 5-10 days
3. **Spatial Resolution**: 10-20m depending on satellite band
4. **Crop Knowledge**: Better results when crop type is specified

## Future Enhancements | Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©

- [ ] SAR integration for all-weather monitoring
- [ ] Machine learning for improved classification
- [ ] Multi-field batch analysis
- [ ] Real-time alert subscriptions via NATS
- [ ] Export to GeoJSON/Shapefile
- [ ] Historical baseline comparison
- [ ] Mobile push notifications

## Support | Ø§Ù„Ø¯Ø¹Ù…

For questions or issues, contact the SAHOOL development team:

- Email: support@sahool.ye
- Documentation: https://docs.sahool.ye
- GitHub: https://github.com/sahool/satellite-service

---

**Version**: 1.0.0
**Last Updated**: December 2024
**License**: Proprietary - SAHOOL Agriculture Platform
