# InteractiveFieldMap Component

## Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©

A comprehensive, feature-rich interactive map component for displaying agricultural fields with support for multiple data layers and user interactions.

Ù…ÙƒÙˆÙ† Ø®Ø±ÙŠØ·Ø© ØªÙØ§Ø¹Ù„ÙŠ Ø´Ø§Ù…Ù„ ÙˆØºÙ†ÙŠ Ø¨Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© Ù…Ø¹ Ø¯Ø¹Ù… Ø·Ø¨Ù‚Ø§Øª Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© ÙˆØ§Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©.

---

## Features / Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

### âœ… Core Features / Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©

- **Field Boundary Display** / **Ø¹Ø±Ø¶ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø­Ù‚ÙˆÙ„**: Display field polygons with customizable styling
- **NDVI Layer Overlay** / **Ø·Ø¨Ù‚Ø© NDVI**: Color-coded NDVI visualization with automatic color mapping
- **Health Zones** / **Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØµØ­Ø©**: Circular zones showing field health status
- **Task Markers** / **Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù…**: Interactive markers for field tasks with priority-based colors
- **Weather Overlay** / **Ø·Ø¨Ù‚Ø© Ø§Ù„Ø·Ù‚Ø³**: Real-time weather information display
- **Layer Controls** / **Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª**: Toggle individual layers on/off
- **Zoom Controls** / **Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙƒØ¨ÙŠØ±**: Standard map zoom functionality
- **Interactive Popups** / **Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©**: Detailed information on click
- **Event Handlers** / **Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«**: Callbacks for user interactions
- **RTL Support** / **Ø¯Ø¹Ù… RTL**: Full Arabic language support

### ğŸ¨ Styling / Ø§Ù„ØªÙ†Ø³ÙŠÙ‚

- Built with **Tailwind CSS** / Ù…Ø¨Ù†ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Tailwind CSS
- Responsive design / ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨
- Custom markers and icons / Ø¹Ù„Ø§Ù…Ø§Øª ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…Ø®ØµØµØ©
- Smooth transitions and animations / Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª ÙˆØ±Ø³ÙˆÙ… Ù…ØªØ­Ø±ÙƒØ© Ø³Ù„Ø³Ø©

### ğŸ”§ Technical / ØªÙ‚Ù†ÙŠ

- **TypeScript** with full type safety / TypeScript Ù…Ø¹ Ø£Ù…Ø§Ù† ÙƒØ§Ù…Ù„ Ù„Ù„Ø£Ù†ÙˆØ§Ø¹
- **React Leaflet 4.2.1** integration / ØªÙƒØ§Ù…Ù„ Ù…Ø¹ React Leaflet
- **Functional Component** with hooks / Ù…ÙƒÙˆÙ† ÙˆØ¸ÙŠÙÙŠ Ù…Ø¹ Ø§Ù„Ø®Ø·Ø§ÙØ§Øª
- Optimized with `useMemo` and `useCallback` / Ù…Ø­Ø³Ù‘Ù† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… useMemo Ùˆ useCallback
- Clean code architecture / Ù…Ø¹Ù…Ø§Ø±ÙŠØ© ÙƒÙˆØ¯ Ù†Ø¸ÙŠÙØ©

---

## Installation / Ø§Ù„ØªØ«Ø¨ÙŠØª

The component is already part of the fields feature module. Dependencies are:

Ø§Ù„Ù…ÙƒÙˆÙ† Ø¬Ø²Ø¡ Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ù† ÙˆØ­Ø¯Ø© Ù…ÙŠØ²Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„. Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ù‡ÙŠ:

```json
{
  "leaflet": "1.9.4",
  "react-leaflet": "4.2.1",
  "@types/leaflet": "1.9.21",
  "lucide-react": "0.468.0"
}
```

---

## Usage / Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### Basic Usage / Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ

```tsx
import { InteractiveFieldMap } from "@/features/fields/components";

function MyComponent() {
  const field = {
    id: "field-1",
    name: "My Field",
    nameAr: "Ø­Ù‚Ù„ÙŠ",
    area: 5.0,
    polygon: {
      type: "Polygon",
      coordinates: [
        [
          [44.2, 15.3],
          [44.21, 15.3],
          [44.21, 15.31],
          [44.2, 15.31],
          [44.2, 15.3],
        ],
      ],
    },
    ndviValue: 0.65,
    healthScore: 85,
    status: "active",
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  };

  return (
    <InteractiveFieldMap
      field={field}
      height="600px"
      onFieldClick={(field) => console.log("Clicked:", field)}
    />
  );
}
```

### Advanced Usage with All Features / Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

```tsx
import { InteractiveFieldMap } from "@/features/fields/components";
import type { HealthZone, MapTask } from "@/features/fields/components";

function AdvancedMap() {
  const fields = [
    /* array of fields */
  ];
  const tasks: MapTask[] = [
    /* array of tasks with location */
  ];
  const healthZones: HealthZone[] = [
    /* array of health zones */
  ];
  const weather = {
    /* weather data */
  };

  return (
    <InteractiveFieldMap
      fields={fields}
      tasks={tasks}
      healthZones={healthZones}
      weather={weather}
      height="800px"
      zoom={15}
      center={[15.5527, 48.5164]}
      enableLayerControl={true}
      onFieldClick={(field) => handleFieldClick(field)}
      onTaskClick={(task) => handleTaskClick(task)}
      onHealthZoneClick={(zone) => handleZoneClick(zone)}
      onMapClick={(lat, lng) => console.log("Map clicked at:", lat, lng)}
    />
  );
}
```

---

## Props / Ø§Ù„Ø®ØµØ§Ø¦Øµ

### InteractiveFieldMapProps

| Prop                 | Type                                 | Required | Default         | Description                                |
| -------------------- | ------------------------------------ | -------- | --------------- | ------------------------------------------ |
| `fields`             | `Field[]`                            | No       | `[]`            | Array of fields to display                 |
| `field`              | `Field`                              | No       | -               | Single field (alternative to fields array) |
| `tasks`              | `MapTask[]`                          | No       | `[]`            | Tasks with location data                   |
| `healthZones`        | `HealthZone[]`                       | No       | `[]`            | Health zones to visualize                  |
| `weather`            | `WeatherData`                        | No       | -               | Weather data for overlay                   |
| `height`             | `string`                             | No       | `'600px'`       | Map container height                       |
| `center`             | `LatLngTuple`                        | No       | Auto-calculated | Initial map center [lat, lng]              |
| `zoom`               | `number`                             | No       | `13`            | Initial zoom level                         |
| `enableLayerControl` | `boolean`                            | No       | `true`          | Show layer control panel                   |
| `onFieldClick`       | `(field: Field) => void`             | No       | -               | Callback when field is clicked             |
| `onTaskClick`        | `(task: MapTask) => void`            | No       | -               | Callback when task is clicked              |
| `onHealthZoneClick`  | `(zone: HealthZone) => void`         | No       | -               | Callback when zone is clicked              |
| `onMapClick`         | `(lat: number, lng: number) => void` | No       | -               | Callback when map is clicked               |
| `className`          | `string`                             | No       | `''`            | Additional CSS classes                     |

---

## Type Definitions / ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ø£Ù†ÙˆØ§Ø¹

### HealthZone

```typescript
interface HealthZone {
  id: string;
  fieldId: string;
  center: GeoPoint; // Center coordinates / Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
  radius: number; // Radius in meters / Ù†ØµÙ Ø§Ù„Ù‚Ø·Ø± Ø¨Ø§Ù„Ø£Ù…ØªØ§Ø±
  healthScore: number; // 0-100
  ndviValue?: number; // Optional NDVI value
  status: "healthy" | "moderate" | "stressed" | "critical";
  color: string; // Hex color code
}
```

### MapTask

```typescript
interface MapTask extends Task {
  location?: GeoPoint; // Task location on map / Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
}
```

### LayerConfig

```typescript
interface LayerConfig {
  fields: boolean; // Show field boundaries
  ndvi: boolean; // Show NDVI coloring
  healthZones: boolean; // Show health zones
  tasks: boolean; // Show task markers
  weather: boolean; // Show weather overlay
}
```

---

## Features in Detail / ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

### 1. Field Boundaries / Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø­Ù‚ÙˆÙ„

Fields are displayed as polygons on the map. The color is determined by:

- NDVI value (if NDVI layer is active)
- Default blue color (if NDVI is inactive)

ØªÙØ¹Ø±Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙƒÙ…Ø¶Ù„Ø¹Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©. ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø¨ÙˆØ§Ø³Ø·Ø©:

- Ù‚ÙŠÙ…Ø© NDVI (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø·Ø¨Ù‚Ø© NDVI Ù†Ø´Ø·Ø©)
- Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¥Ø°Ø§ ÙƒØ§Ù† NDVI ØºÙŠØ± Ù†Ø´Ø·)

**Click Behavior**: Clicking a field shows a popup with details and triggers `onFieldClick` callback.

### 2. NDVI Layer / Ø·Ø¨Ù‚Ø© NDVI

NDVI (Normalized Difference Vegetation Index) values are color-coded:

Ù‚ÙŠÙ… NDVI (Ù…Ø¤Ø´Ø± Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ù†Ø¨Ø§ØªØ§Øª) Ù…Ø±Ù…Ø²Ø© Ø¨Ø§Ù„Ø£Ù„ÙˆØ§Ù†:

- **> 0.6**: ğŸŸ¢ Healthy Green / Ø£Ø®Ø¶Ø± ØµØ­ÙŠ
- **0.4 - 0.6**: ğŸŸ¢ Light Green / Ø£Ø®Ø¶Ø± ÙØ§ØªØ­
- **0.2 - 0.4**: ğŸŸ¡ Yellow / Ø£ØµÙØ±
- **0.0 - 0.2**: ğŸŸ  Orange / Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
- **< 0.0**: ğŸ”´ Red / Ø£Ø­Ù…Ø±

A legend is automatically displayed at the bottom-left when NDVI layer is active.

### 3. Health Zones / Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØµØ­Ø©

Circular zones representing areas with specific health characteristics:

- Radius in meters
- Color-coded by health score or custom color
- Clickable with popup details

Ù…Ù†Ø§Ø·Ù‚ Ø¯Ø§Ø¦Ø±ÙŠØ© ØªÙ…Ø«Ù„ Ù…Ù†Ø§Ø·Ù‚ Ø°Ø§Øª Ø®ØµØ§Ø¦Øµ ØµØ­ÙŠØ© Ù…Ø­Ø¯Ø¯Ø©:

- Ù†ØµÙ Ø§Ù„Ù‚Ø·Ø± Ø¨Ø§Ù„Ø£Ù…ØªØ§Ø±
- Ù…Ø±Ù…Ø²Ø© Ø¨Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø­Ø³Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„ØµØ­Ø© Ø£Ùˆ Ù„ÙˆÙ† Ù…Ø®ØµØµ
- Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø± Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ù…Ù†Ø¨Ø«Ù‚Ø©

### 4. Task Markers / Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù…

Tasks are displayed as circular markers with:

- **Color** based on priority and status
- **Icon**: âœ“ for completed, ! for others
- **Priority colors**:
  - Urgent: ğŸ”´ Red
  - High: ğŸŸ  Orange
  - Medium: ğŸŸ¡ Yellow
  - Low: ğŸ”µ Blue

### 5. Weather Overlay / Ø·Ø¨Ù‚Ø© Ø§Ù„Ø·Ù‚Ø³

Displays current weather conditions in a panel:

- Temperature / Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©
- Humidity / Ø§Ù„Ø±Ø·ÙˆØ¨Ø©
- Wind speed / Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­
- Condition description / ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø©

### 6. Layer Control / Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª

Interactive panel to toggle each layer:

- Click the layers icon (top-left)
- Check/uncheck individual layers
- Changes apply immediately

Ù„ÙˆØ­Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ù„ØªØ¨Ø¯ÙŠÙ„ ÙƒÙ„ Ø·Ø¨Ù‚Ø©:

- Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø·Ø¨Ù‚Ø§Øª (Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±)
- Ø­Ø¯Ø¯/Ø£Ù„ØºÙ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©
- ØªÙØ·Ø¨Ù‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙˆØ±Ø§Ù‹

---

## Color Schemes / Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†

### NDVI Colors

```typescript
const getNDVIColor = (ndvi: number): string => {
  if (ndvi >= 0.6) return "#00ff00"; // Healthy
  if (ndvi >= 0.4) return "#90ee90"; // Good
  if (ndvi >= 0.2) return "#ffff00"; // Moderate
  if (ndvi >= 0.0) return "#ffa500"; // Poor
  return "#ff0000"; // Critical
};
```

### Health Score Colors

```typescript
const getHealthColor = (score: number): string => {
  if (score >= 80) return "#22c55e"; // Green
  if (score >= 60) return "#eab308"; // Yellow
  if (score >= 40) return "#f97316"; // Orange
  return "#ef4444"; // Red
};
```

### Task Priority Colors

```typescript
const getTaskColor = (priority: Priority, status: TaskStatus): string => {
  if (status === "completed") return "#22c55e";
  if (status === "cancelled") return "#6b7280";

  switch (priority) {
    case "urgent":
      return "#dc2626";
    case "high":
      return "#f97316";
    case "medium":
      return "#eab308";
    case "low":
      return "#3b82f6";
  }
};
```

---

## Event Handlers / Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«

### onFieldClick

```typescript
onFieldClick={(field: Field) => {
  // Handle field selection
  setSelectedField(field);
  // Show field details
  showFieldDetails(field.id);
  // Navigate to field page
  router.push(`/fields/${field.id}`);
}}
```

### onTaskClick

```typescript
onTaskClick={(task: MapTask) => {
  // Open task modal
  openTaskModal(task);
  // Update task status
  updateTaskStatus(task.id);
}}
```

### onHealthZoneClick

```typescript
onHealthZoneClick={(zone: HealthZone) => {
  // Show zone analysis
  showZoneAnalysis(zone);
  // Trigger zone actions
  handleZoneAction(zone.status);
}}
```

### onMapClick

```typescript
onMapClick={(lat: number, lng: number) => {
  // Create new task at location
  createTaskAtLocation(lat, lng);
  // Add measurement point
  addMeasurementPoint({ lat, lng });
}}
```

---

## Best Practices / Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª

### 1. Performance / Ø§Ù„Ø£Ø¯Ø§Ø¡

```typescript
// âœ… DO: Memoize data
const processedFields = useMemo(() => fields.map(processField), [fields]);

// âŒ DON'T: Process data on every render
const processedFields = fields.map(processField);
```

### 2. Event Handlers / Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«

```typescript
// âœ… DO: Use useCallback for handlers
const handleFieldClick = useCallback((field: Field) => {
  console.log(field);
}, []);

// âŒ DON'T: Define inline functions
onFieldClick={(field) => console.log(field)}
```

### 3. Data Validation / Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

```typescript
// âœ… DO: Validate polygon data
const validFields = fields.filter(f =>
  f.polygon &&
  f.polygon.coordinates.length > 0
);

// Then use in map
<InteractiveFieldMap fields={validFields} />
```

---

## Accessibility / Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„

- Semantic HTML structure
- ARIA labels for controls
- Keyboard navigation support
- Screen reader friendly
- RTL support for Arabic

---

## Browser Support / Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­Ø§Øª

- Chrome/Edge: âœ… Full support
- Firefox: âœ… Full support
- Safari: âœ… Full support
- Mobile browsers: âœ… Responsive

---

## Troubleshooting / Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

### Map doesn't appear

```typescript
// Ensure container has height
<div style={{ height: '600px' }}>
  <InteractiveFieldMap ... />
</div>
```

### Markers not showing

```typescript
// Ensure tasks have location property
const tasks = tasks.map((task) => ({
  ...task,
  location: {
    type: "Point",
    coordinates: [lng, lat], // Note: [lng, lat] order
  },
}));
```

### NDVI colors not updating

```typescript
// Ensure ndviValue is set on fields
const fields = fields.map((f) => ({
  ...f,
  ndviValue: calculateNDVI(f),
}));
```

---

## Related Components / Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©

- `FieldMap` - Simple field map (legacy)
- `NdviTileLayer` - NDVI tile layer component
- `WeatherOverlay` - Weather overlay component
- `HealthZonesLayer` - Health zones layer component

---

## License / Ø§Ù„ØªØ±Ø®ÙŠØµ

Part of the SAHOOL Agricultural Platform
Â© 2024 SAHOOL. All rights reserved.

---

## Support / Ø§Ù„Ø¯Ø¹Ù…

For questions or issues, contact the development team or refer to the main project documentation.

Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ø£Ùˆ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ØŒ Ø§ØªØµÙ„ Ø¨ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø£Ùˆ Ø±Ø§Ø¬Ø¹ ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.
