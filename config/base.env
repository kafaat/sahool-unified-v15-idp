# ═══════════════════════════════════════════════════════════════════════════════
# SAHOOL Platform - Base Environment Configuration
# This file contains all configuration variables with their defaults
# Environment-specific files override these values
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# Core Application
# ─────────────────────────────────────────────────────────────────────────────
ENVIRONMENT=development
LOG_LEVEL=INFO
SERVICE_LAYER=kernel
DEFAULT_TENANT=default

# ─────────────────────────────────────────────────────────────────────────────
# Database (PostgreSQL + PostGIS) - TLS ENFORCED
# ─────────────────────────────────────────────────────────────────────────────
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=sahool
POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-MUST_SET_IN_PRODUCTION}
POSTGRES_DB=sahool

# TLS Configuration
# sslmode options: disable, allow, prefer, require, verify-ca, verify-full
# Production MUST use 'require' or higher
POSTGRES_SSL_MODE=require
POSTGRES_SSL_CERT=/certs/client.crt
POSTGRES_SSL_KEY=/certs/client.key
POSTGRES_SSL_ROOT_CERT=/certs/ca.crt

# Connection URLs with TLS
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?sslmode=${POSTGRES_SSL_MODE:-require}&connect_timeout=10&statement_timeout=30000
DATABASE_URL_DIRECT=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?sslmode=${POSTGRES_SSL_MODE:-require}&connect_timeout=10
DATABASE_URL_POOLED=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB}?sslmode=${POSTGRES_SSL_MODE:-require}&pgbouncer=true

# ─────────────────────────────────────────────────────────────────────────────
# Redis - TLS ENFORCED
# ─────────────────────────────────────────────────────────────────────────────
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_TLS_PORT=6380
REDIS_PASSWORD=${REDIS_PASSWORD:-MUST_SET_IN_PRODUCTION}

# TLS Configuration
REDIS_SSL_ENABLED=true
REDIS_SSL_CERT=/certs/redis-client.crt
REDIS_SSL_KEY=/certs/redis-client.key
REDIS_SSL_CA=/certs/ca.crt

# Connection URLs (use rediss:// for TLS)
REDIS_URL=rediss://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_TLS_PORT}/0?ssl_cert_reqs=required&ssl_ca_certs=${REDIS_SSL_CA:-/certs/ca.crt}
REDIS_URL_INSECURE=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/0

# ─────────────────────────────────────────────────────────────────────────────
# NATS (Message Queue with Authentication) - TLS ENFORCED & HARDENED
# Security Score: 9.5/10 - Rate limiting, encryption at rest, system account
# ─────────────────────────────────────────────────────────────────────────────
NATS_HOST=nats
NATS_PORT=4222
NATS_TLS_PORT=4223
NATS_USER=sahool_app
NATS_PASSWORD=${NATS_PASSWORD:-MUST_SET_IN_PRODUCTION}
NATS_ADMIN_USER=nats_admin
NATS_ADMIN_PASSWORD=${NATS_ADMIN_PASSWORD:-MUST_SET_IN_PRODUCTION}

# SECURITY ENHANCEMENT: Additional accounts for hardened configuration
NATS_MONITOR_USER=nats_monitor
NATS_MONITOR_PASSWORD=${NATS_MONITOR_PASSWORD:-MUST_SET_IN_PRODUCTION}
NATS_CLUSTER_USER=nats_cluster
NATS_CLUSTER_PASSWORD=${NATS_CLUSTER_PASSWORD:-MUST_SET_IN_PRODUCTION}
NATS_SYSTEM_USER=nats_system
NATS_SYSTEM_PASSWORD=${NATS_SYSTEM_PASSWORD:-MUST_SET_IN_PRODUCTION}

# SECURITY ENHANCEMENT: JetStream encryption key (AES-256)
# Generate with: openssl rand -base64 32
NATS_JETSTREAM_KEY=${NATS_JETSTREAM_KEY:-MUST_SET_IN_PRODUCTION}

# TLS Configuration
NATS_TLS_ENABLED=true
NATS_TLS_CERT=/certs/nats-client.crt
NATS_TLS_KEY=/certs/nats-client.key
NATS_TLS_CA=/certs/ca.crt

# Connection URLs (use tls:// for TLS)
NATS_URL=tls://${NATS_USER}:${NATS_PASSWORD}@${NATS_HOST}:${NATS_TLS_PORT}?tls_ca_file=${NATS_TLS_CA:-/certs/ca.crt}&tls_verify=true
NATS_URL_INSECURE=nats://${NATS_USER}:${NATS_PASSWORD}@${NATS_HOST}:${NATS_PORT}

# ─────────────────────────────────────────────────────────────────────────────
# MQTT (IoT)
# ─────────────────────────────────────────────────────────────────────────────
MQTT_HOST=mqtt
MQTT_PORT=1883
MQTT_WS_PORT=9001

# ─────────────────────────────────────────────────────────────────────────────
# JWT Authentication
# ─────────────────────────────────────────────────────────────────────────────
JWT_SECRET_KEY=${JWT_SECRET_KEY:-MUST_SET_IN_PRODUCTION_MIN_32_CHARS}
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30
JWT_AUDIENCE=sahool-api
JWT_ISSUER=sahool-platform

# ─────────────────────────────────────────────────────────────────────────────
# Security
# ─────────────────────────────────────────────────────────────────────────────
APP_SECRET_KEY=${APP_SECRET_KEY:-MUST_SET_IN_PRODUCTION_MIN_32_CHARS}
SAHOOL_AUTH_ENABLED=true
MFA_ENABLED=false
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=30

# ─────────────────────────────────────────────────────────────────────────────
# CORS
# ─────────────────────────────────────────────────────────────────────────────
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:3002

# ─────────────────────────────────────────────────────────────────────────────
# Service Ports
# ─────────────────────────────────────────────────────────────────────────────
API_GATEWAY_PORT=8000
FIELD_CORE_PORT=3000
WEB_APP_PORT=3001
ADMIN_APP_PORT=3002
AUTH_SERVICE_PORT=8001
USER_SERVICE_PORT=8002
TENANT_SERVICE_PORT=8003
GEO_SERVICE_PORT=8005

# ─────────────────────────────────────────────────────────────────────────────
# External Services (Optional)
# ─────────────────────────────────────────────────────────────────────────────
SENTRY_DSN=
GOOGLE_CLOUD_PROJECT=
AWS_REGION=
