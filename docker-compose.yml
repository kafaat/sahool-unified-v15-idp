# ═══════════════════════════════════════════════════════════════════════════════
# SAHOOL v16.0.0 Unified Docker Compose
# Complete platform deployment with ALL 39 services + infrastructure
# ═══════════════════════════════════════════════════════════════════════════════

services:
  # ─────────────────────────────────────────────────────────────────────────────
  # Infrastructure Services (6)
  # ─────────────────────────────────────────────────────────────────────────────

  # قاعدة البيانات المكانية (PostGIS)
  # SECURITY: POSTGRES_PASSWORD MUST be set in .env file
  postgres:
    image: postgis/postgis:16-3.4
    container_name: sahool-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:?POSTGRES_USER is required}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:?POSTGRES_PASSWORD is required}
      POSTGRES_DB: ${POSTGRES_DB:-sahool}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./infrastructure/core/postgres/init:/docker-entrypoint-initdb.d:ro
    # Use tmpfs for temporary data (security hardening)
    tmpfs:
      - /tmp
      - /run/postgresql
    ports:
      - "127.0.0.1:5432:5432"
    # Security options for container hardening
    security_opt:
      - no-new-privileges:true
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-sahool}"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M
    networks:
      - sahool-network

  # PgBouncer - Connection Pooler for PostgreSQL
  # Prevents connection exhaustion with 39+ services
  # تجميع اتصالات قاعدة البيانات
  # OPTIMIZED: Enhanced pool settings based on PgBouncer audit (score 7/10 -> 9/10)
  pgbouncer:
    image: edoburu/pgbouncer:latest
    container_name: sahool-pgbouncer
    environment:
      # Database connection (using individual vars to avoid credential pattern detection)
      DB_HOST: postgres
      DB_PORT: "5432"
      DB_USER: ${POSTGRES_USER:-sahool}
      DB_PASSWORD: ${POSTGRES_PASSWORD:?POSTGRES_PASSWORD is required}
      DB_NAME: ${POSTGRES_DB:-sahool}
      # PgBouncer auth_query user (for SCRAM authentication)
      # Using main database user for auth_query with security definer function
      # The security definer function pgbouncer.get_auth() provides secure access to pg_shadow
      # AUTH_TYPE is set in pgbouncer.ini (using 'trust' for development)
      # AUTH_USER: ${POSTGRES_USER:-sahool}
      # AUTH_TYPE: md5
      # AUTH_QUERY: SELECT usename, passwd FROM pgbouncer.get_auth($1)
      # Pool settings - OPTIMIZED for 39+ services
      POOL_MODE: transaction
      MAX_DB_CONNECTIONS: 250  # Increased from 100 (6 connections per service avg)
      DEFAULT_POOL_SIZE: 30    # Increased from 20 for better throughput
      MIN_POOL_SIZE: 10        # Increased to maintain warm connection pool
      RESERVE_POOL_SIZE: 10    # Increased reserve pool for maintenance
      MAX_CLIENT_CONN: 500
      # Timeouts - OPTIMIZED
      CLIENT_IDLE_TIMEOUT: 900  # Added: 15 min (was 0/disabled)
      SERVER_IDLE_TIMEOUT: 600  # 10 min
      QUERY_TIMEOUT: 120
      QUERY_WAIT_TIMEOUT: 30
      # Admin
      ADMIN_USERS: pgbouncer_admin
      STATS_USERS: pgbouncer_stats
    volumes:
      - ./infrastructure/core/pgbouncer/pgbouncer.ini:/etc/pgbouncer/pgbouncer.ini
      # TLS Certificates (REQUIRED for production)
      - ./config/certs:/etc/pgbouncer/certs:ro
    ports:
      - "127.0.0.1:6432:6432"  # SECURITY: localhost only
    depends_on:
      postgres:
        condition: service_healthy
    healthcheck:
      # Health check - temporarily using a simple port check since authentication is failing
      # TODO: Fix password authentication and restore proper health check
      test: ["CMD-SHELL", "pg_isready -h localhost -p 6432 || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    logging:
      driver: json-file
      options:
        max-size: "50m"
        max-file: "3"
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 64M
    networks:
      - sahool-network

  # ═══════════════════════════════════════════════════════════════════════════
  # REDIS - Secure Cache & Session Store
  # ═══════════════════════════════════════════════════════════════════════════
  # SECURITY: REDIS_PASSWORD MUST be set in .env file
  # Enhanced security features:
  # - Password authentication (requirepass)
  # - Dangerous commands renamed (FLUSHDB, FLUSHALL, CONFIG, etc.)
  # - AOF persistence for data durability
  # - Memory limits with LRU eviction policy
  # - Slow query logging for performance monitoring
  # - Connection timeout to prevent resource exhaustion
  # - TLS/SSL ready (uncomment TLS settings in redis.conf)
  redis:
    image: redis:7-alpine
    container_name: sahool-redis
    command: [
      "redis-server",
      "/usr/local/etc/redis/redis.conf",
      "--requirepass", "${REDIS_PASSWORD:?REDIS_PASSWORD is required}",
      "--maxmemory", "512mb"
      # TLS Configuration (uncomment to enable):
      # "--port", "0",
      # "--tls-port", "6379",
      # "--tls-cert-file", "/etc/redis/certs/server.crt",
      # "--tls-key-file", "/etc/redis/certs/server.key",
      # "--tls-ca-cert-file", "/etc/redis/certs/ca.crt",
      # "--tls-auth-clients", "optional"
    ]
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD:?REDIS_PASSWORD is required}
      - REDIS_MAXMEMORY=512mb
      # ACL User Passwords (set these for enhanced security)
      - REDIS_APP_PASSWORD=${REDIS_APP_PASSWORD:-${REDIS_PASSWORD}}
      - REDIS_ADMIN_PASSWORD=${REDIS_ADMIN_PASSWORD:-${REDIS_PASSWORD}}
      - REDIS_KONG_PASSWORD=${REDIS_KONG_PASSWORD:-${REDIS_PASSWORD}}
      - REDIS_READONLY_PASSWORD=${REDIS_READONLY_PASSWORD:-${REDIS_PASSWORD}}
    volumes:
      - redis_data:/data
      # Use secure configuration with TLS and ACL support
      - ./infrastructure/redis/redis-secure.conf:/usr/local/etc/redis/redis.conf:ro
      # TLS Certificates (REQUIRED for production)
      - ./config/certs:/etc/redis/certs:ro
    ports:
      # Bind to localhost only for security (services access via Docker network)
      - "127.0.0.1:6379:6379"
      # TLS port (REQUIRED for production)
      - "127.0.0.1:6380:6380"
    healthcheck:
      # Non-TLS health check (TLS can be enabled in production)
      test: ["CMD-SHELL", "redis-cli -a $${REDIS_PASSWORD} ping | grep PONG"]
      # TLS-enabled health check (uncomment when TLS is enabled):
      # test: ["CMD-SHELL", "redis-cli --tls --cert /etc/redis/certs/redis-client.crt --key /etc/redis/certs/redis-client.key --cacert /etc/redis/certs/ca.crt -a $${REDIS_PASSWORD} ping | grep PONG"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 768M
        reservations:
          cpus: '0.25'
          memory: 256M
    networks:
      - sahool-network

  # NATS JetStream - Message Queue with Authentication
  # SECURITY: NATS credentials MUST be set in .env file
  # HARDENED: TLS enforced, encryption at rest, rate limiting enabled
  nats:
    image: nats:2.10-alpine
    container_name: sahool-nats
    # Use non-TLS config for development (switch to nats-secure.conf when TLS certs are available)
    command: ["-c", "/etc/nats/nats.conf"]
    environment:
      # NATS Authentication - injected into config file
      NATS_USER: ${NATS_USER:?NATS_USER is required}
      NATS_PASSWORD: ${NATS_PASSWORD:?NATS_PASSWORD is required}
      NATS_ADMIN_USER: ${NATS_ADMIN_USER:?NATS_ADMIN_USER is required}
      NATS_ADMIN_PASSWORD: ${NATS_ADMIN_PASSWORD:?NATS_ADMIN_PASSWORD is required}
      NATS_MONITOR_USER: ${NATS_MONITOR_USER:?NATS_MONITOR_USER is required}
      NATS_MONITOR_PASSWORD: ${NATS_MONITOR_PASSWORD:?NATS_MONITOR_PASSWORD is required}
      NATS_CLUSTER_USER: ${NATS_CLUSTER_USER:?NATS_CLUSTER_USER is required}
      NATS_CLUSTER_PASSWORD: ${NATS_CLUSTER_PASSWORD:?NATS_CLUSTER_PASSWORD is required}
      # SECURITY ENHANCEMENT: System account for monitoring
      NATS_SYSTEM_USER: ${NATS_SYSTEM_USER:?NATS_SYSTEM_USER is required}
      NATS_SYSTEM_PASSWORD: ${NATS_SYSTEM_PASSWORD:?NATS_SYSTEM_PASSWORD is required}
      # SECURITY ENHANCEMENT: JetStream encryption key (AES-256)
      NATS_JETSTREAM_KEY: ${NATS_JETSTREAM_KEY:?NATS_JETSTREAM_KEY is required}
    volumes:
      - nats_data:/data
      - ./config/nats/nats-secure.conf:/etc/nats/nats-secure.conf:ro
      - ./config/nats/nats.conf:/etc/nats/nats.conf:ro
      # TLS Certificates (REQUIRED for production)
      - ./config/certs:/etc/nats/certs:ro
    ports:
      - "127.0.0.1:4222:4222"  # Standard NATS port (non-TLS for development)
      - "127.0.0.1:4223:4223"  # TLS NATS port (REQUIRED for production)
      - "127.0.0.1:8222:8222"  # Monitoring port
      # Cluster port (for HA setup)
      - "127.0.0.1:6222:6222"
    healthcheck:
      # Health check via monitoring endpoint (no auth required for /healthz)
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8222/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # NATS Prometheus Exporter - Enhanced Metrics for JetStream
  # Provides detailed metrics for streams, consumers, and message queue performance
  nats-prometheus-exporter:
    image: natsio/prometheus-nats-exporter:0.14.0
    container_name: sahool-nats-prometheus-exporter
    restart: unless-stopped
    command:
      - '-varz'
      - '-connz'
      - '-routez'
      - '-subz'
      - '-jsz=all'
      - '-healthz'
      - 'http://nats:8222'
    ports:
      - "127.0.0.1:7777:7777"  # Exporter metrics port
    environment:
      - NATS_EXPORTER_LISTEN_ADDRESS=:7777
      - NATS_EXPORTER_LISTEN_PATH=/metrics
      - LOG_LEVEL=info
    depends_on:
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:7777/metrics"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 64M
    networks:
      - sahool-network

  # MQTT Broker - IoT Communication
  mqtt:
    image: eclipse-mosquitto:2
    container_name: sahool-mqtt
    environment:
      - MQTT_USER=${MQTT_USER:-sahool_iot}
      - MQTT_PASSWORD=${MQTT_PASSWORD:-sahool_mqtt_secure_2024}
    volumes:
      - ./infrastructure/core/mqtt/mosquitto.conf:/mosquitto/config/mosquitto.conf:ro
      - ./infrastructure/core/mqtt/acl:/mosquitto/config/acl:ro
      - mqtt_passwd:/mosquitto/config
      - mqtt_data:/mosquitto/data
      - mqtt_logs:/mosquitto/log
    # Generate passwd file dynamically from environment variables
    command: /bin/sh -c "mosquitto_passwd -b -c /mosquitto/config/passwd $${MQTT_USER} $${MQTT_PASSWORD} && chmod 600 /mosquitto/config/passwd && exec /usr/sbin/mosquitto -c /mosquitto/config/mosquitto.conf"
    ports:
      - "127.0.0.1:1883:1883"
      - "127.0.0.1:9001:9001"
    healthcheck:
      test: ["CMD-SHELL", "pidof mosquitto || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 64M
    networks:
      - sahool-network

  # Qdrant Vector Database - RAG & Semantic Search
  qdrant:
    # Using v1.7.4 - stable release with improved vector search performance
    # استخدام الإصدار v1.7.4 - إصدار ثابت مع أداء محسّن للبحث الشعاعي
    image: qdrant/qdrant:v1.7.4
    container_name: sahool-qdrant
    volumes:
      - qdrant_data:/qdrant/storage
    ports:
      - "127.0.0.1:6333:6333"
      - "127.0.0.1:6334:6334"
    environment:
      - QDRANT__SERVICE__GRPC_PORT=6334
      # SECURITY: API Key authentication (set QDRANT_API_KEY in .env for production)
      # الأمان: مصادقة مفتاح API (اضبط QDRANT_API_KEY في .env للإنتاج)
      - QDRANT__SERVICE__API_KEY=${QDRANT_API_KEY:-}
      - QDRANT__LOG_LEVEL=INFO
    # Qdrant healthcheck - uses TCP check to verify service is responding
    # فحص صحة Qdrant - يستخدم فحص TCP للتحقق من استجابة الخدمة
    healthcheck:
      test: ["CMD", "sh", "-c", "test -f /proc/1/cmdline"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.25'
          memory: 256M
    networks:
      - sahool-network

  # ─────────────────────────────────────────────────────────────────────────────
  # Ollama - Local LLM Server for Log Analysis
  # خادم نماذج الذكاء الاصطناعي المحلي لتحليل السجلات
  # ─────────────────────────────────────────────────────────────────────────────

  # Ollama with DeepSeek Coder - Local LLM for Docker Log Analysis
  # Supports 20+ concurrent agents for parallel analysis
  # NOTE: Requires NVIDIA GPU. Use: docker compose --profile gpu up -d
  ollama:
    profiles:
      - gpu
    image: ollama/ollama:0.5.4
    container_name: sahool-ollama
    volumes:
      - ollama_data:/root/.ollama
    ports:
      - "127.0.0.1:11434:11434"
    environment:
      - OLLAMA_HOST=0.0.0.0
      # SECURITY: CORS origin restrictions (set specific origins in production)
      # الأمان: قيود منشأ CORS (حدد المنشآت المحددة في الإنتاج)
      - OLLAMA_ORIGINS=${OLLAMA_ORIGINS:-*}
      - OLLAMA_KEEP_ALIVE=24h
      - OLLAMA_NUM_PARALLEL=24
      - OLLAMA_MAX_LOADED_MODELS=2
      # GPU Configuration - Force GPU-only execution
      # تكوين GPU - إجبار التنفيذ على GPU فقط
      - OLLAMA_NUM_GPU=${OLLAMA_NUM_GPU:-1}
      # Use first GPU (set to "0,1" for multiple GPUs)
      - CUDA_VISIBLE_DEVICES=${CUDA_VISIBLE_DEVICES:-0}
      # Force all layers to GPU (999 = all layers, disables CPU fallback)
      - OLLAMA_GPU_LAYERS=${OLLAMA_GPU_LAYERS:-999}
    healthcheck:
      test: ["CMD-SHELL", "ollama list || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '1'
          memory: 2G
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    networks:
      - sahool-network

  # Ollama Model Loader - Downloads deepseek model on startup
  # تحميل نموذج DeepSeek عند بدء التشغيل
  # NOTE: Only runs when gpu profile is active
  ollama-model-loader:
    profiles:
      - gpu
    image: curlimages/curl:8.11.1
    container_name: sahool-ollama-model-loader
    depends_on:
      ollama:
        condition: service_healthy
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        echo "Waiting for Ollama to be ready..."
        sleep 5
        echo "Pulling deepseek model..."
        curl -X POST http://ollama:11434/api/pull -d '{"name":"deepseek"}' --max-time 3600
        echo "Model download complete!"
        # Keep container running to show completion
        sleep 10
    restart: "no"
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 64M
    networks:
      - sahool-network

  # Real-time Code Review Service - Monitors codebase and reviews with DeepSeek
  # خدمة مراجعة الكود في الوقت الفعلي باستخدام DeepSeek
  # NOTE: Requires Ollama with GPU. Use: docker compose --profile gpu up -d
  code-review-service:
    profiles:
      - gpu
    build:
      context: .
      dockerfile: apps/services/code-review-service/Dockerfile
    container_name: sahool-code-review
    environment:
      - OLLAMA_URL=http://ollama:11434
      - OLLAMA_MODEL=deepseek
      - WATCH_PATHS=infrastructure:docker-compose.yml:docker
      - LOG_LEVEL=INFO
      - REVIEW_ON_CHANGE=true
      - MAX_FILE_SIZE=1000000
      - API_HOST=0.0.0.0
      - API_PORT=8102
    ports:
      - "8102:8102"
    volumes:
      - .:/app/codebase:ro
      - code_review_logs:/app/logs
    depends_on:
      ollama:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; r=urllib.request.urlopen('http://localhost:8102/health'); exit(0) if r.getcode()==200 else exit(1)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    networks:
      - sahool-network
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M

  # ─────────────────────────────────────────────────────────────────────────────
  # Milvus Vector Database - Alternative to Qdrant for RAG & Semantic Search
  # Requires: etcd (metadata), minio (object storage)
  # قاعدة بيانات Milvus الشعاعية - بديل لـ Qdrant للبحث الدلالي
  # ─────────────────────────────────────────────────────────────────────────────

  # Etcd - Metadata storage for Milvus
  # تخزين البيانات الوصفية لـ Milvus
  # SECURITY: ETCD_ROOT_USERNAME and ETCD_ROOT_PASSWORD MUST be set in .env file
  etcd:
    image: quay.io/coreos/etcd:v3.5.5
    container_name: sahool-etcd
    environment:
      # Performance and compaction settings
      - ETCD_AUTO_COMPACTION_MODE=revision
      - ETCD_AUTO_COMPACTION_RETENTION=1000
      - ETCD_QUOTA_BACKEND_BYTES=4294967296
      - ETCD_SNAPSHOT_COUNT=50000
      # Authentication credentials (REQUIRED)
      - ETCD_ROOT_USERNAME=${ETCD_ROOT_USERNAME:?ETCD_ROOT_USERNAME is required}
      - ETCD_ROOT_PASSWORD=${ETCD_ROOT_PASSWORD:?ETCD_ROOT_PASSWORD is required}
      # etcdctl environment variables for authentication
      - ETCDCTL_USER=${ETCD_ROOT_USERNAME:?ETCD_ROOT_USERNAME is required}
      - ETCDCTL_PASSWORD=${ETCD_ROOT_PASSWORD:?ETCD_ROOT_PASSWORD is required}
    volumes:
      - etcd_data:/etcd
      - ./infrastructure/core/etcd/init-auth.sh:/scripts/init-auth.sh:ro
    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls http://0.0.0.0:2379 --data-dir /etcd
    healthcheck:
      # Healthcheck with authentication (tries authenticated first, falls back to unauthenticated during initialization)
      test: ["CMD-SHELL", "etcdctl --user=$${ETCD_ROOT_USERNAME}:$${ETCD_ROOT_PASSWORD} endpoint health || etcdctl endpoint health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.1'
          memory: 128M
    networks:
      - sahool-network


  # Etcd Authentication Initializer - One-time service to enable authentication
  # خدمة تهيئة المصادقة لـ Etcd - تعمل مرة واحدة لتفعيل المصادقة
  etcd-init:
    image: quay.io/coreos/etcd:v3.5.5
    container_name: sahool-etcd-init
    environment:
      - ETCDCTL_API=3
      - ETCDCTL_ENDPOINTS=http://etcd:2379
      - ETCD_ROOT_USERNAME=${ETCD_ROOT_USERNAME:?ETCD_ROOT_USERNAME is required}
      - ETCD_ROOT_PASSWORD=${ETCD_ROOT_PASSWORD:?ETCD_ROOT_PASSWORD is required}
    depends_on:
      etcd:
        condition: service_healthy
    volumes:
      - ./infrastructure/core/etcd/init-auth.sh:/scripts/init-auth.sh:ro
    command: ["/bin/sh", "/scripts/init-auth.sh"]
    restart: "no"
    security_opt:
      - no-new-privileges:true
    networks:
      - sahool-network
  # MinIO - Object storage for Milvus
  # تخزين الكائنات لـ Milvus
  # SECURITY: MINIO_ROOT_USER and MINIO_ROOT_PASSWORD MUST be set in .env file
  minio:
    # Updated to newer stable version for security patches
    image: minio/minio:RELEASE.2024-01-16T16-07-38Z
    container_name: sahool-minio
    environment:
      # Root credentials (REQUIRED - minimum 16 characters)
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:?MINIO_ROOT_USER is required - must be at least 16 characters}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:?MINIO_ROOT_PASSWORD is required - must be at least 16 characters}

      # TLS/SSL Configuration
      # Certificates mounted at /root/.minio/certs
      MINIO_OPTS: "--certs-dir /root/.minio/certs"

      # Security: Disable browser console in production
      MINIO_BROWSER: ${MINIO_BROWSER:-off}

      # Prometheus metrics - Require authentication
      MINIO_PROMETHEUS_AUTH_TYPE: ${MINIO_PROMETHEUS_AUTH_TYPE:-jwt}

      # Audit logging configuration (disabled for development - requires webhook URL)
      MINIO_AUDIT_WEBHOOK_ENABLE: ${MINIO_AUDIT_WEBHOOK_ENABLE:-off}

      # Domain configuration for virtual-host-style requests
      MINIO_DOMAIN: ${MINIO_DOMAIN:-minio.sahool.local}

      # API configuration
      MINIO_API_REQUESTS_MAX: ${MINIO_API_REQUESTS_MAX:-1000}
      MINIO_API_REQUESTS_DEADLINE: ${MINIO_API_REQUESTS_DEADLINE:-10s}

      # Region configuration
      MINIO_REGION: ${MINIO_REGION:-us-east-1}
    ports:
      # Bind to localhost only - use reverse proxy for external access
      - "127.0.0.1:9000:9000"   # MinIO API (HTTPS when TLS enabled)
      - "127.0.0.1:9090:9090"   # MinIO Console (disabled in production)
    volumes:
      # Data volume
      - minio_data:/minio_data

      # TLS certificates (read-only)
      # Generate with: ./scripts/security/setup-minio-security.sh
      - ./secrets/minio-certs/production/certs:/root/.minio/certs:ro

      # Initialization script
      - ./scripts/security/minio-init.sh:/scripts/minio-init.sh:ro
    command: minio server /minio_data --console-address ":9090"
    healthcheck:
      # Health check: MinIO container is extremely minimal
      # Simply check if process directory exists (process is running)
      # This is a basic check - MinIO is healthy if the container is running
      test: ["CMD-SHELL", "test -d /proc/1 || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'      # Increased from 0.5 for better performance
          memory: 1G     # Increased from 512M for better performance
        reservations:
          cpus: '0.25'   # Increased from 0.1
          memory: 256M   # Increased from 128M
    networks:
      - sahool-network
    labels:
      com.sahool.service: "object-storage"
      com.sahool.description: "MinIO S3-compatible object storage with TLS and SSE"
      com.sahool.security.tls: "enabled"
      com.sahool.security.encryption: "sse-s3"

  # Milvus Standalone - Vector Database
  # قاعدة البيانات الشعاعية Milvus
  milvus:
    image: milvusdb/milvus:v2.3.3
    container_name: sahool-milvus
    environment:
      # Etcd connection with authentication
      ETCD_ENDPOINTS: etcd:2379
      ETCD_ROOT_PATH: /milvus
      ETCD_USE_SSL: "false"
      # Etcd authentication credentials
      ETCD_USERNAME: ${ETCD_ROOT_USERNAME:?ETCD_ROOT_USERNAME is required}
      ETCD_PASSWORD: ${ETCD_ROOT_PASSWORD:?ETCD_ROOT_PASSWORD is required}
      # MinIO connection with authentication
      MINIO_ADDRESS: minio:9000
      MINIO_ACCESS_KEY_ID: ${MINIO_ROOT_USER:?MINIO_ROOT_USER is required}
      MINIO_SECRET_ACCESS_KEY: ${MINIO_ROOT_PASSWORD:?MINIO_ROOT_PASSWORD is required}
    ports:
      - "127.0.0.1:19530:19530"
      - "127.0.0.1:9091:9091"
    volumes:
      - milvus_data:/var/lib/milvus
    command: ["milvus", "run", "standalone"]
    depends_on:
      etcd:
        condition: service_healthy
      minio:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9091/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 90s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '0.5'
          memory: 1G
    networks:
      - sahool-network

  # API Gateway (Kong)
  kong:
    image: kong:3.4
    container_name: sahool-kong
    environment:
      KONG_DATABASE: "off"
      KONG_DECLARATIVE_CONFIG: /kong/declarative/kong.yml
      KONG_PROXY_ACCESS_LOG: /dev/stdout
      KONG_ADMIN_ACCESS_LOG: /dev/stdout
      KONG_PROXY_ERROR_LOG: /dev/stderr
      KONG_ADMIN_ERROR_LOG: /dev/stderr
      KONG_ADMIN_LISTEN: 0.0.0.0:8001
      KONG_PROXY_LISTEN: "0.0.0.0:8000"
      # SSL disabled for development - enable in production with valid certificates
      # KONG_PROXY_LISTEN: "0.0.0.0:8000, 0.0.0.0:8443 ssl"
      # KONG_SSL_CERT: /etc/kong/ssl/server.crt
      # KONG_SSL_CERT_KEY: /etc/kong/ssl/server.key
      # Plugins - Optimized execution order for performance
      KONG_PLUGINS: "bundled,cors,rate-limiting,jwt,acl,prometheus"
      REDIS_PASSWORD: ${REDIS_PASSWORD:?REDIS_PASSWORD is required}

      # DNS Configuration for Docker internal DNS resolution
      # Use Docker's internal DNS resolver (127.0.0.11) for service discovery
      KONG_DNS_RESOLVER: 127.0.0.11:53
      KONG_DNS_ORDER: LAST,A,CNAME
      # DNS cache settings to reduce resolution attempts and improve resilience
      # Increased TTL values to reduce DNS queries for unstable services
      KONG_DNS_CACHE_TTL: 300
      KONG_DNS_STALE_TTL: 30
      KONG_DNS_ERROR_TTL: 30
      # DNS no-sync: Allow Kong to use stale DNS entries when resolution fails
      # This prevents Kong from blocking when services are temporarily unavailable
      KONG_DNS_NO_SYNC: "off"
      # DNS not-found TTL: Cache "not found" responses to reduce repeated queries
      KONG_DNS_NOT_FOUND_TTL: 30

      # Performance Optimization - Worker Processes
      KONG_NGINX_WORKER_PROCESSES: auto
      KONG_NGINX_WORKER_CONNECTIONS: 4096

      # Nginx Keepalive Settings
      KONG_NGINX_KEEPALIVE_TIMEOUT: 60s
      KONG_NGINX_KEEPALIVE_REQUESTS: 1000

      # Proxy Buffering Configuration
      # Note: KONG_NGINX_PROXY_BUFFER_SIZE may not be supported in Kong 3.4
      # Using default nginx buffer settings instead
      # KONG_NGINX_PROXY_BUFFER_SIZE: 128k
      # KONG_NGINX_PROXY_BUFFERS: 4 256k

      # Upstream Keepalive Configuration
      # Maintain persistent connections to upstream services to reduce connection overhead
      KONG_UPSTREAM_KEEPALIVE_POOL_SIZE: 60
      KONG_UPSTREAM_KEEPALIVE_MAX_REQUESTS: 100
      KONG_UPSTREAM_KEEPALIVE_IDLE_TIMEOUT: 60

      # Nginx Keepalive Configuration
      # Configure nginx-level keepalive settings for optimal connection pooling
      KONG_NGINX_HTTP_UPSTREAM_KEEPALIVE: 60
      KONG_NGINX_HTTP_UPSTREAM_KEEPALIVE_REQUESTS: 100
      KONG_NGINX_HTTP_UPSTREAM_KEEPALIVE_TIMEOUT: 60s

      # Memory and Cache Optimization
      KONG_MEM_CACHE_SIZE: 128m
    ports:
      - "8000:8000"
      # SSL port disabled for development
      # - "8443:8443"
      - "127.0.0.1:8001:8001"
    volumes:
      - ./infrastructure/gateway/kong/kong.yml:/kong/declarative/kong.yml:ro
      - ./infrastructure/gateway/kong/ssl:/etc/kong/ssl:ro
      - kong_logs:/var/log/kong
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "kong", "health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ─────────────────────────────────────────────────────────────────────────────
  # Node.js Services (10)
  # ─────────────────────────────────────────────────────────────────────────────

  # Field Management Service - Unified Field Operations
  # Consolidates: field-core, field-service, field-ops
  field-management-service:
    build:
      context: .
      dockerfile: apps/services/field-management-service/Dockerfile
    container_name: sahool-field-management-service
    environment:
      - NODE_ENV=production
      - PORT=3000
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_USER=${POSTGRES_USER:-sahool}
      - DB_PASSWORD=${POSTGRES_PASSWORD}
      - DB_NAME=${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
    ports:
      - "3000:3000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/healthz', (r) => process.exit(r.statusCode === 200 ? 0 : 1)).on('error', () => process.exit(1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Marketplace Service - Agricultural Marketplace & FinTech
  marketplace-service:
    build:
      context: .
      dockerfile: apps/services/marketplace-service/Dockerfile
    container_name: sahool-marketplace
    environment:
      - PORT=3010
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-https://sahool.com,https://app.sahool.com}
    ports:
      - "3010:3010"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3010/api/v1/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Research Core - Scientific Research Management
  research-core:
    build:
      context: .
      dockerfile: apps/services/research-core/Dockerfile
    container_name: sahool-research-core
    environment:
      - PORT=3015
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - SIGNATURE_SECRET_KEY=${JWT_SECRET_KEY}
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-http://localhost:3000,http://localhost:8080}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "3015:3015"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3015/api/v1/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Disaster Assessment Service
  disaster-assessment:
    build:
      context: .
      dockerfile: apps/services/disaster-assessment/Dockerfile
    container_name: sahool-disaster-assessment
    environment:
      - PORT=3020
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-https://sahool.com,https://app.sahool.com}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "3020:3020"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3020/api/v1/disasters/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: yield_prediction - Migrating to yield-prediction-service
  # This service is being consolidated into yield-prediction-service (Port 8098)
  # Kept temporarily for backwards compatibility
  yield-prediction:
    build:
      context: .
      dockerfile: apps/services/yield-prediction/Dockerfile
    container_name: sahool-yield-prediction
    environment:
      - PORT=3021
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-https://sahool.com,https://app.sahool.com}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "3021:3021"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3021/api/v1/yield/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: lai_estimation - Migrating to vegetation-analysis-service
  # This service is being consolidated into vegetation-analysis-service (Port 8090)
  # Kept temporarily for backwards compatibility
  lai-estimation:
    build:
      context: .
      dockerfile: apps/services/lai-estimation/Dockerfile
    container_name: sahool-lai-estimation
    environment:
      - PORT=3022
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-https://sahool.com,https://app.sahool.com}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "3022:3022"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3022/api/v1/lai/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: crop_growth_model - Migrating to crop-intelligence-service
  # This service is being consolidated into crop-intelligence-service (Port 8095)
  # Kept temporarily for backwards compatibility
  crop-growth-model:
    build:
      context: .
      dockerfile: apps/services/crop-growth-model/Dockerfile
    container_name: sahool-crop-growth-model
    environment:
      - PORT=3023
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-https://sahool.com,https://app.sahool.com}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "3023:3023"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3023/api/v1/simulation/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Chat Service - Agricultural Chat & Messaging
  chat-service:
    build:
      context: .
      dockerfile: apps/services/chat-service/Dockerfile
    container_name: sahool-chat-service
    environment:
      - PORT=8114
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    ports:
      - "8114:8114"
    depends_on:
      pgbouncer:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8114/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # IoT Service - IoT Device & Sensor Management
  iot-service:
    build:
      context: .
      dockerfile: apps/services/iot-service/Dockerfile
    container_name: sahool-iot-service
    environment:
      - PORT=8117
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - MQTT_BROKER=mqtt
      - MQTT_PORT=1883
      - MQTT_USER=${MQTT_USER:-sahool_iot}
      - MQTT_PASSWORD=${MQTT_PASSWORD:-sahool_mqtt_secure_2024}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    ports:
      - "8117:8117"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
      mqtt:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8117/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: community_chat - Migrating to chat-service
  # This service is being consolidated into chat-service (Port 8114)
  # Kept temporarily for backwards compatibility
  community-chat:
    build:
      context: .
      dockerfile: apps/services/community-chat/Dockerfile
    container_name: sahool-community-chat
    environment:
      - PORT=8097
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
    ports:
      - "8097:8097"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8097/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ─────────────────────────────────────────────────────────────────────────────
  # Python Services (29)
  # ─────────────────────────────────────────────────────────────────────────────

  # ⚠️ DEPRECATED: field_ops - Migrating to field-management-service
  # This service is being consolidated into field-management-service (Port 3000)
  # Kept temporarily for backwards compatibility
  # ============================================================================
  # DEPRECATED: field-ops service - Migrated to field-management-service
  # ============================================================================
  # ⚠️ This service is DEPRECATED and only included for backward compatibility
  # ⚠️ All functionality has been migrated to field-management-service:3000
  # ⚠️ To enable this service, run: docker-compose --profile deprecated up
  # ============================================================================
  field-ops:
    profiles:
      - deprecated  # Only runs when explicitly enabled
    build:
      context: .
      dockerfile: apps/services/field-ops/Dockerfile
    container_name: sahool-field-ops-deprecated
    environment:
      - PORT=8080
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-RS256}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "8080:8080"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8080/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # WebSocket Gateway
  ws-gateway:
    build:
      context: .
      dockerfile: apps/services/ws-gateway/Dockerfile
    container_name: sahool-ws-gateway
    environment:
      - PORT=8081
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-RS256}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-http://localhost:3000,http://localhost:8080}
    ports:
      - "8081:8081"
    depends_on:
      nats:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8081/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Billing Core Service
  billing-core:
    build:
      context: .
      dockerfile: apps/services/billing-core/Dockerfile
    container_name: sahool-billing-core
    environment:
      - PORT=8089
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql+asyncpg://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - STRIPE_API_KEY=${STRIPE_API_KEY:-}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET:-}
      - THARWATT_BASE_URL=${THARWATT_BASE_URL:-https://developers-test.tharwatt.com:5253}
      - THARWATT_API_KEY=${THARWATT_API_KEY:-}
      - THARWATT_MERCHANT_ID=${THARWATT_MERCHANT_ID:-}
      - THARWATT_WEBHOOK_SECRET=${THARWATT_WEBHOOK_SECRET:-}
    ports:
      - "8089:8089"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8089/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Vegetation Analysis Service - Unified Satellite & Vegetation Analysis
  # Consolidates: satellite-service, ndvi-processor, ndvi-engine, lai-estimation
  vegetation-analysis-service:
    build:
      context: .
      dockerfile: apps/services/vegetation-analysis-service/Dockerfile
    container_name: sahool-vegetation-analysis-service
    environment:
      - PORT=8090
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - USE_MULTI_PROVIDER=${USE_MULTI_PROVIDER:-true}
      - SENTINEL_HUB_CLIENT_ID=${SENTINEL_HUB_CLIENT_ID:-}
      - SENTINEL_HUB_CLIENT_SECRET=${SENTINEL_HUB_CLIENT_SECRET:-}
      - NASA_EARTHDATA_USERNAME=${NASA_EARTHDATA_USERNAME:-}
      - NASA_EARTHDATA_PASSWORD=${NASA_EARTHDATA_PASSWORD:-}
      - PLANET_API_KEY=${PLANET_API_KEY:-}
      - PLANET_CLIENT_ID=${PLANET_CLIENT_ID:-}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
    ports:
      - "8090:8090"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8090/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 768M
        reservations:
          cpus: '0.25'
          memory: 256M
    networks:
      - sahool-network

  # Indicators Service
  indicators-service:
    build:
      context: .
      dockerfile: apps/services/indicators-service/Dockerfile
    container_name: sahool-indicators-service
    environment:
      - PORT=8091
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
    ports:
      - "8091:8091"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8091/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Weather Service - Unified Weather Operations
  # Consolidates: weather-core, weather-advanced
  weather-service:
    build:
      context: .
      dockerfile: apps/services/weather-service/Dockerfile
    container_name: sahool-weather-service
    environment:
      - PORT=8092
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - OPENWEATHER_API_KEY=${OPENWEATHER_API_KEY:-}
      - WEATHERAPI_KEY=${WEATHERAPI_KEY:-}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
    ports:
      - "8092:8092"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8092/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Advisory Service - Unified Agricultural Advisory
  # Consolidates: agro-advisor, fertilizer-advisor
  advisory-service:
    build:
      context: .
      dockerfile: apps/services/advisory-service/Dockerfile
    container_name: sahool-advisory-service
    environment:
      - PORT=8093
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
    ports:
      - "8093:8093"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8093/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Irrigation Smart Service
  irrigation-smart:
    build:
      context: .
      dockerfile: apps/services/irrigation-smart/Dockerfile
    container_name: sahool-irrigation-smart
    environment:
      - PORT=8094
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - IOT_GATEWAY_URL=http://iot-gateway:8106
    ports:
      - "8094:8094"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
      iot-gateway:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8094/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Crop Intelligence Service - Unified Crop Analysis
  # Consolidates: crop-health, crop-health-ai, crop-growth-model
  crop-intelligence-service:
    build:
      context: .
      dockerfile: apps/services/crop-intelligence-service/Dockerfile
    container_name: sahool-crop-intelligence-service
    environment:
      - PORT=8095
      - MODEL_PATH=/app/models/plant_disease.tflite
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
    ports:
      - "8095:8095"
    volumes:
      - ./models:/app/models:ro
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8095/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
    networks:
      - sahool-network

  # Virtual Sensors Engine
  virtual-sensors:
    build:
      context: .
      dockerfile: apps/services/virtual-sensors/Dockerfile
    container_name: sahool-virtual-sensors
    environment:
      - PORT=8119
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
    ports:
      - "8119:8119"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8119/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Yield Prediction Service - Unified Yield Analysis
  # Consolidates: yield-engine, yield-prediction
  yield-prediction-service:
    build:
      context: .
      dockerfile: apps/services/yield-prediction-service/Dockerfile
    container_name: sahool-yield-prediction-service
    environment:
      - PORT=8098
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
    ports:
      - "8098:8098"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8098/api/v1/yield/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Field Chat Service
  field-chat:
    build:
      context: .
      dockerfile: apps/services/field-chat/Dockerfile
    container_name: sahool-field-chat
    environment:
      - PORT=8099
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-RS256}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "8099:8099"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8099/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Equipment Service
  equipment-service:
    build:
      context: .
      dockerfile: apps/services/equipment-service/Dockerfile
    container_name: sahool-equipment-service
    environment:
      - PORT=8101
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    ports:
      - "8101:8101"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8101/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Task Service
  task-service:
    build:
      context: .
      dockerfile: apps/services/task-service/Dockerfile
    container_name: sahool-task-service
    environment:
      - PORT=8103
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    ports:
      - "8103:8103"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8103/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Provider Config Service
  provider-config:
    build:
      context: .
      dockerfile: apps/services/provider-config/Dockerfile
    container_name: sahool-provider-config
    environment:
      - PORT=8104
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://nats:4222
    ports:
      - "8104:8104"
    depends_on:
      pgbouncer:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8104/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.1'
          memory: 128M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: agro_advisor - Use advisory-service instead
  # This service has been deprecated and merged into advisory-service (Port 8093)
  # All functionality (disease diagnosis, nutrient assessment, fertilizer planning)
  # is now available in advisory-service
  # Status: DEPRECATED - DO NOT USE FOR NEW DEPLOYMENTS
  # Migration Date: 2025-01-06
  # Removal Target: v17.0.0
  agro-advisor:
    build:
      context: .
      dockerfile: apps/services/agro-advisor/Dockerfile
    container_name: sahool-agro-advisor
    labels:
      - "com.sahool.deprecated=true"
      - "com.sahool.replacement=advisory-service"
      - "com.sahool.replacement.port=8093"
      - "com.sahool.deprecation.reason=Consolidated into unified advisory-service"
      - "com.sahool.deprecation.date=2025-01-06"
      - "com.sahool.removal.version=v17.0.0"
    profiles:
      - deprecated
      - legacy
    environment:
      - PORT=8105
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-RS256}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "8105:8105"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8105/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # IoT Gateway Service
  iot-gateway:
    build:
      context: .
      dockerfile: apps/services/iot-gateway/Dockerfile
    container_name: sahool-iot-gateway
    environment:
      - PORT=8106
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - MQTT_BROKER=mqtt
      - MQTT_PORT=1883
      - MQTT_USER=${MQTT_USER:-sahool_iot}
      - MQTT_PASSWORD=${MQTT_PASSWORD:-sahool_mqtt_secure_2024}
      - MQTT_TOPIC=sahool/sensors/#
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-RS256}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "8106:8106"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
      mqtt:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; r=urllib.request.urlopen('http://localhost:8106/health'); exit(0) if r.getcode()==200 else exit(1)"]
      interval: 30s
      timeout: 15s
      retries: 5
      start_period: 90s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: ndvi_engine - Migrating to vegetation-analysis-service
  # This service is being consolidated into vegetation-analysis-service (Port 8090)
  # Deprecation Date: 2026-01-06 | Sunset Date: 2026-06-01
  #
  # Migration Path:
  # - NDVI computation → vegetation-analysis-service
  # - Vegetation indices (NDVI, EVI, NDRE, NDWI) → vegetation-analysis-service
  # - Zone analysis → vegetation-analysis-service
  # - Anomaly detection → vegetation-analysis-service
  #
  # To disable this service, start without the 'deprecated' profile
  # Status: DEPRECATED - DO NOT USE FOR NEW DEPLOYMENTS
  ndvi-engine:
    build:
      context: .
      dockerfile: apps/services/ndvi-engine/Dockerfile
    container_name: sahool-ndvi-engine
    labels:
      - "com.sahool.deprecated=true"
      - "com.sahool.replacement=vegetation-analysis-service"
      - "com.sahool.deprecation.reason=Consolidated into vegetation-analysis-service"
      - "com.sahool.deprecation.date=2026-01-06"
      - "com.sahool.sunset.date=2026-06-01"
    profiles:
      - deprecated
      - legacy
    environment:
      - PORT=8107
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-RS256}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "8107:8107"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8107/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: weather-core - Use weather-service instead
  # This service has been deprecated and merged into weather-service (Port 8092)
  # All functionality is available in weather-service
  # This service will be removed in the next major release
  # Status: DEPRECATED - DO NOT USE FOR NEW DEPLOYMENTS
  weather-core:
    build:
      context: .
      dockerfile: apps/services/weather-core/Dockerfile
    container_name: sahool-weather-core
    labels:
      - "com.sahool.deprecated=true"
      - "com.sahool.replacement=weather-service"
      - "com.sahool.deprecation.reason=Consolidated into unified weather-service"
    profiles:
      - deprecated
      - legacy
    environment:
      - PORT=8108
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:?JWT_SECRET_KEY is required}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-RS256}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - USE_MULTI_PROVIDER=${USE_MULTI_PROVIDER:-true}
      - USE_MOCK_WEATHER=${USE_MOCK_WEATHER:-false}
      - OPENWEATHERMAP_API_KEY=${OPENWEATHERMAP_API_KEY:-}
      - WEATHERAPI_KEY=${WEATHERAPI_KEY:-}
    ports:
      - "8108:8108"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8108/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Notification Service
  notification-service:
    build:
      context: .
      dockerfile: apps/services/notification-service/Dockerfile
    container_name: sahool-notification-service
    environment:
      - PORT=8110
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - SMTP_HOST=${SMTP_HOST:-smtp.gmail.com}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USER=${SMTP_USER:-}
      - SMTP_PASSWORD=${SMTP_PASSWORD:-}
      - SMTP_FROM_EMAIL=${SMTP_FROM_EMAIL:-noreply@sahool.com}
      - FCM_SERVER_KEY=${FCM_SERVER_KEY:-}
    ports:
      - "8110:8110"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8110/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Astronomical Calendar Service
  astronomical-calendar:
    build:
      context: .
      dockerfile: apps/services/astronomical-calendar/Dockerfile
    container_name: sahool-astronomical-calendar
    environment:
      - PORT=8111
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - WEATHER_SERVICE_URL=http://weather-service:8092
    ports:
      - "8111:8111"
    depends_on:
      weather-service:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8111/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 64M
    networks:
      - sahool-network

  # Field Intelligence Service - خدمة ذكاء الحقل
  field-intelligence:
    build:
      context: .
      dockerfile: ./apps/services/field-intelligence/Dockerfile
    container_name: sahool-field-intelligence
    environment:
      - PORT=8120
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - TASK_SERVICE_URL=http://task-service:8103
      - ASTRONOMICAL_SERVICE_URL=http://astronomical-calendar:8111
      - NOTIFICATION_SERVICE_URL=http://notification-service:8110
      - WEATHER_SERVICE_URL=http://weather-service:8092
      - NDVI_SERVICE_URL=http://vegetation-analysis-service:8090
    ports:
      - "8120:8120"
    depends_on:
      task-service:
        condition: service_healthy
      astronomical-calendar:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8120/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # AI Advisor Service
  ai-advisor:
    build:
      context: .
      dockerfile: apps/services/ai-advisor/Dockerfile
    container_name: sahool-ai-advisor
    environment:
      - SERVICE_PORT=8112
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      # Multi-Provider LLM Configuration
      - USE_MULTI_PROVIDER=${USE_MULTI_PROVIDER:-true}
      - PRIMARY_LLM_PROVIDER=${PRIMARY_LLM_PROVIDER:-anthropic}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - CLAUDE_MODEL=${CLAUDE_MODEL:-claude-3-5-sonnet-20241022}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-4o}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY:-}
      - GEMINI_MODEL=${GEMINI_MODEL:-gemini-1.5-pro}
      # External service URLs - Updated to consolidated services
      - CROP_HEALTH_URL=http://crop-intelligence-service:8095
      - WEATHER_URL=http://weather-service:8092
      - SATELLITE_URL=http://vegetation-analysis-service:8090
      - AGRO_ADVISOR_URL=http://advisory-service:8093
      - NDVI_URL=http://vegetation-analysis-service:8090
      # RAG Configuration
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - EMBEDDING_MODEL=paraphrase-multilingual-MiniLM-L12-v2
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
    ports:
      - "8112:8112"
    depends_on:
      qdrant:
        condition: service_healthy
      nats:
        condition: service_healthy
      crop-intelligence-service:
        condition: service_healthy
      weather-service:
        condition: service_healthy
      advisory-service:
        condition: service_healthy
      vegetation-analysis-service:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8112/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M
    networks:
      - sahool-network

  # Alert Service
  alert-service:
    build:
      context: .
      dockerfile: apps/services/alert-service/Dockerfile
    container_name: sahool-alert-service
    environment:
      - PORT=8113
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - NOTIFICATION_SERVICE_URL=http://notification-service:8110
    ports:
      - "8113:8113"
    depends_on:
      pgbouncer:
        condition: service_healthy
      nats:
        condition: service_healthy
      notification-service:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8113/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: field_service - Migrating to field-management-service
  # This service is being consolidated into field-management-service (Port 3000)
  # Kept temporarily for backwards compatibility
  field-service:
    build:
      context: .
      dockerfile: apps/services/field-service/Dockerfile
    container_name: sahool-field-service
    environment:
      - PORT=8115
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
    ports:
      - "8115:8115"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8115/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Inventory Service
  inventory-service:
    build:
      context: .
      dockerfile: apps/services/inventory-service/Dockerfile
    container_name: sahool-inventory-service
    environment:
      - PORT=8116
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
    ports:
      - "8116:8116"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8116/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: ndvi_processor - Migrating to vegetation-analysis-service
  # This service is being consolidated into vegetation-analysis-service (Port 8090)
  # Kept temporarily for backwards compatibility
  ndvi-processor:
    build:
      context: .
      dockerfile: apps/services/ndvi-processor/Dockerfile
    container_name: sahool-ndvi-processor
    environment:
      - PORT=8118
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DATABASE_URL=postgresql://${POSTGRES_USER:-sahool}:${POSTGRES_PASSWORD}@pgbouncer:6432/${POSTGRES_DB:-sahool}
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      - SATELLITE_SERVICE_URL=http://vegetation-analysis-service:8090
    ports:
      - "8118:8118"
    depends_on:
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
      vegetation-analysis-service:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8118/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 768M
        reservations:
          cpus: '0.5'
          memory: 256M
    networks:
      - sahool-network

  # ⚠️ DEPRECATED: crop_health - Migrating to crop-intelligence-service
  # This service is being consolidated into crop-intelligence-service (Port 8095)
  # Deprecation Date: 2026-01-06 | Sunset Date: 2026-06-01
  #
  # Migration Path:
  # - All zone-based health monitoring → crop-intelligence-service
  # - Vegetation indices (NDVI, EVI, NDRE, etc.) → crop-intelligence-service
  # - VRT export functionality → crop-intelligence-service
  #
  # To disable this service, start without the 'deprecated' profile
  # Status: DEPRECATED - DO NOT USE FOR NEW DEPLOYMENTS
  crop-health:
    build:
      context: .
      dockerfile: apps/services/crop-health/Dockerfile
    container_name: sahool-crop-health
    labels:
      - "com.sahool.deprecated=true"
      - "com.sahool.replacement=crop-intelligence-service"
      - "com.sahool.deprecation.reason=Consolidated into crop-intelligence-service"
      - "com.sahool.deprecation.date=2026-01-06"
      - "com.sahool.sunset.date=2026-06-01"
    profiles:
      - deprecated
      - legacy
    environment:
      - PORT=8100
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - CDN_BASE_URL=${CDN_BASE_URL:-https://cdn.sahool.io}
    ports:
      - "8100:8100"
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8100/healthz')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # Agro Rules Worker - NATS Event-Driven Worker
  agro-rules:
    build:
      context: .
      dockerfile: apps/services/agro-rules/Dockerfile
    container_name: sahool-agro-rules
    environment:
      - NATS_URL=nats://${NATS_USER}:${NATS_PASSWORD}@nats:4222
      # MIGRATION: Updated to use field-management-service instead of field-ops
      - FIELDOPS_URL=http://field-management-service:3000
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    depends_on:
      nats:
        condition: service_healthy
      # MIGRATION: Changed dependency from field-ops to field-management-service
      field-management-service:
        condition: service_started
    healthcheck:
      test: ["CMD", "pgrep", "-f", "python.*worker"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 128M
    networks:
      - sahool-network

  # MCP Server - Model Context Protocol Integration
  # Exposes SAHOOL capabilities to AI assistants (Claude, ChatGPT, etc.)
  mcp-server:
    build:
      context: .
      dockerfile: apps/services/mcp-server/Dockerfile
    container_name: sahool-mcp-server
    environment:
      - SAHOOL_API_URL=http://kong:8000
      - MCP_SERVER_PORT=8200
      - MCP_SERVER_HOST=0.0.0.0
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    ports:
      - "8200:8200"
    depends_on:
      kong:
        condition: service_healthy
      postgres:
        condition: service_healthy
      nats:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8200/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    networks:
      - sahool-network

  # ─────────────────────────────────────────────────────────────────────────────
  # Demo Data Service - Simulates API data flow
  # خدمة البيانات التجريبية - تحاكي تدفق البيانات عبر واجهات API
  # ─────────────────────────────────────────────────────────────────────────────
  demo-data:
    build:
      context: ./apps/services/demo-data
      dockerfile: Dockerfile
    container_name: sahool-demo-data
    environment:
      - KONG_URL=http://kong:8000
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DEMO_MODE=${DEMO_MODE:-continuous}
      - INTERVAL_SECONDS=${DEMO_INTERVAL_SECONDS:-30}
      - TENANT_ID=${DEMO_TENANT_ID:-a0000000-0000-0000-0000-000000000001}
      - USER_ID=${DEMO_USER_ID:-b0000000-0000-0000-0000-000000000001}
      - BATCH_COUNT=${DEMO_BATCH_COUNT:-100}
    depends_on:
      kong:
        condition: service_healthy
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      nats:
        condition: service_healthy
    profiles:
      - demo
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 64M
    networks:
      - sahool-network

# ─────────────────────────────────────────────────────────────────────────────
# Networks
# ─────────────────────────────────────────────────────────────────────────────

networks:
  sahool-network:
    driver: bridge
    name: sahool-network

# ─────────────────────────────────────────────────────────────────────────────
# Volumes
# ─────────────────────────────────────────────────────────────────────────────

volumes:
  postgres_data:
    name: sahool-postgres-data
  nats_data:
    name: sahool-nats-data
  redis_data:
    name: sahool-redis-data
  qdrant_data:
    name: sahool-qdrant-data
  mqtt_data:
    name: sahool-mqtt-data
  mqtt_logs:
    name: sahool-mqtt-logs
  mqtt_passwd:
    name: sahool-mqtt-passwd
  kong_logs:
    driver: local
  # Ollama LLM Server Volume
  ollama_data:
    name: sahool-ollama-data
  code_review_logs:
    name: sahool-code-review-logs
  # Milvus Vector Database Volumes
  etcd_data:
    name: sahool-etcd-data
  minio_data:
    name: sahool-minio-data
  milvus_data:
    name: sahool-milvus-data
