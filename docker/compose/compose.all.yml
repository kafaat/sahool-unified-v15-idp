version: '3.8'
services:
  crop-growth-model:
    build:
      context: ../../apps/services/crop-growth-model
      dockerfile: Dockerfile
    ports:
    - 3023:3023
    environment:
    - PORT=3023
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3023/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
  yield-prediction:
    build:
      context: ../../apps/services/yield-prediction
      dockerfile: Dockerfile
    ports:
    - 3021:3021
    environment:
    - PORT=3021
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3021/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
    depends_on:
    - crop-growth-model
    - weather-advanced
    - lai-estimation
  yield-engine:
    build:
      context: ../../apps/services/yield-engine
      dockerfile: Dockerfile
    ports:
    - 8098:8098
    environment:
    - PORT=8098
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8098/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
    depends_on:
    - crop-growth-model
    - weather-advanced
  fertilizer-advisor:
    build:
      context: ../../apps/services/fertilizer-advisor
      dockerfile: Dockerfile
    ports:
    - 9093:9093
    environment:
    - PORT=9093
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:9093/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - crop-growth-model
    - satellite-service
  irrigation-smart:
    build:
      context: ../../apps/services/irrigation-smart
      dockerfile: Dockerfile
    ports:
    - 8094:8094
    environment:
    - PORT=8094
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8094/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - weather-advanced
    - virtual-sensors
  advisory-service:
    build:
      context: ../../apps/services/advisory-service
      dockerfile: Dockerfile
    ports:
    - 8093:8093
    environment:
    - PORT=8093
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8093/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - postgres
    - redis
    - nats
  agro-advisor:
    build:
      context: ../../apps/services/agro-advisor
      dockerfile: Dockerfile
    ports:
    - 8105:8105
    environment:
    - PORT=8105
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8105/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - postgres
    - redis
    - nats
  disaster-assessment:
    build:
      context: ../../apps/services/disaster-assessment
      dockerfile: Dockerfile
    ports:
    - 3020:3020
    environment:
    - PORT=3020
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3020/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '300'
          memory: 256Mi
    depends_on:
    - weather-advanced
    - satellite-service
  lai-estimation:
    build:
      context: ../../apps/services/lai-estimation
      dockerfile: Dockerfile
    ports:
    - 3022:3022
    environment:
    - PORT=3022
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3022/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - satellite-service
  indicators-service:
    build:
      context: ../../apps/services/indicators-service
      dockerfile: Dockerfile
    ports:
    - 8091:8091
    environment:
    - PORT=8091
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8091/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - satellite-service
  crop-health-ai:
    build:
      context: ../../apps/services/crop-health-ai
      dockerfile: Dockerfile
    ports:
    - 9095:9095
    environment:
    - PORT=9095
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:9095/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '800'
          memory: 1Gi
    depends_on:
    - satellite-service
  agro-rules:
    build:
      context: ../../apps/services/agro-rules
      dockerfile: Dockerfile
    ports:
    - 8151:8151
    environment:
    - PORT=8151
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8151/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '200'
          memory: 256Mi
    depends_on:
    - nats
  crop-intelligence-service:
    build:
      context: ../../apps/services/crop-intelligence-service
      dockerfile: Dockerfile
    ports:
    - 8095:8095
    environment:
    - PORT=8095
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8095/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
    depends_on:
    - satellite-service
  ndvi-processor:
    build:
      context: ../../apps/services/ndvi-processor
      dockerfile: Dockerfile
    ports:
    - 8118:8118
    environment:
    - PORT=8118
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8118/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
    depends_on:
    - satellite-service
  field-intelligence:
    build:
      context: ../../apps/services/field-intelligence
      dockerfile: Dockerfile
    ports:
    - 8120:8120
    environment:
    - PORT=8120
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8120/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - indicators-service
  vegetation-analysis-service:
    build:
      context: ../../apps/services/vegetation-analysis-service
      dockerfile: Dockerfile
    ports:
    - 8090:8090
    environment:
    - PORT=8090
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8090/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
    depends_on:
    - postgres
    - redis
    - nats
  skills-service:
    build:
      context: ../../apps/services/skills-service
      dockerfile: Dockerfile
    ports:
    - 8121:8121
    environment:
    - PORT=8121
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8121/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 512Mi
    depends_on:
    - postgres
    - redis
    - nats
  marketplace-service:
    build:
      context: ../../apps/services/marketplace-service
      dockerfile: Dockerfile
    ports:
    - 3010:3010
    environment:
    - PORT=3010
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3010/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
  community-chat:
    build:
      context: ../../apps/services/community-chat
      dockerfile: Dockerfile
    ports:
    - 8097:8097
    environment:
    - PORT=8097
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8097/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '300'
          memory: 256Mi
  research-core:
    build:
      context: ../../apps/services/research-core
      dockerfile: Dockerfile
    ports:
    - 3015:3015
    environment:
    - PORT=3015
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3015/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
  billing-core:
    build:
      context: ../../apps/services/billing-core
      dockerfile: Dockerfile
    ports:
    - 8089:8089
    environment:
    - PORT=8089
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8089/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '300'
          memory: 256Mi
  notification-service:
    build:
      context: ../../apps/services/notification-service
      dockerfile: Dockerfile
    ports:
    - 8110:8110
    environment:
    - PORT=8110
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8110/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '200'
          memory: 256Mi
  mcp-server:
    build:
      context: ../../apps/services/mcp-server
      dockerfile: Dockerfile
    ports:
    - 8200:8200
    environment:
    - PORT=8200
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8200/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '200'
          memory: 256Mi
    depends_on:
    - kong
  equipment-service:
    build:
      context: ../../apps/services/equipment-service
      dockerfile: Dockerfile
    ports:
    - 8101:8101
    environment:
    - PORT=8101
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8101/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '200'
          memory: 256Mi
  task-service:
    build:
      context: ../../apps/services/task-service
      dockerfile: Dockerfile
    ports:
    - 8103:8103
    environment:
    - PORT=8103
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8103/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '200'
          memory: 256Mi
  ws-gateway:
    build:
      context: ../../apps/services/ws-gateway
      dockerfile: Dockerfile
    ports:
    - 8081:8081
    environment:
    - PORT=8081
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8081/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '300'
          memory: 256Mi
    depends_on:
    - nats
  field-management-service:
    build:
      context: ../../apps/services/field-management-service
      dockerfile: Dockerfile
    ports:
    - 3000:3000
    environment:
    - PORT=3000
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3000/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
    depends_on:
    - postgres
    - redis
    - nats
  user-service:
    build:
      context: ../../apps/services/user-service
      dockerfile: Dockerfile
    ports:
    - 3025:3025
    environment:
    - PORT=3025
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3025/api/v1/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - postgres
    - redis
  alert-service:
    build:
      context: ../../apps/services/alert-service
      dockerfile: Dockerfile
    ports:
    - 8113:8113
    environment:
    - PORT=8113
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8113/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '300'
          memory: 256Mi
    depends_on:
    - postgres
    - redis
    - nats
  inventory-service:
    build:
      context: ../../apps/services/inventory-service
      dockerfile: Dockerfile
    ports:
    - 8116:8116
    environment:
    - PORT=8116
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8116/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '200'
          memory: 256Mi
    depends_on:
    - postgres
    - redis
  field-chat:
    build:
      context: ../../apps/services/field-chat
      dockerfile: Dockerfile
    ports:
    - 8099:8099
    environment:
    - PORT=8099
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8099/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '300'
          memory: 256Mi
    depends_on:
    - postgres
    - redis
    - nats
  provider-config:
    build:
      context: ../../apps/services/provider-config
      dockerfile: Dockerfile
    ports:
    - 8104:8104
    environment:
    - PORT=8104
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8104/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '200'
          memory: 256Mi
    depends_on:
    - postgres
    - redis
  iot-service:
    build:
      context: ../../apps/services/iot-service
      dockerfile: Dockerfile
    ports:
    - 8117:8117
    environment:
    - PORT=8117
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8117/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 512Mi
  satellite-service:
    build:
      context: ../../apps/services/satellite-service
      dockerfile: Dockerfile
    ports:
    - 9190:9190
    environment:
    - PORT=9190
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:9190/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '600'
          memory: 768Mi
  weather-advanced:
    build:
      context: ../../apps/services/weather-advanced
      dockerfile: Dockerfile
    ports:
    - 9092:9092
    environment:
    - PORT=9092
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:9092/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '300'
          memory: 256Mi
  virtual-sensors:
    build:
      context: ../../apps/services/virtual-sensors
      dockerfile: Dockerfile
    ports:
    - 8119:8119
    environment:
    - PORT=8119
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8119/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - weather-advanced
    - satellite-service
  weather-service:
    build:
      context: ../../apps/services/weather-service
      dockerfile: Dockerfile
    ports:
    - 8092:8092
    environment:
    - PORT=8092
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8092/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '300'
          memory: 256Mi
    depends_on:
    - postgres
    - redis
    - nats
  astronomical-calendar:
    build:
      context: ../../apps/services/astronomical-calendar
      dockerfile: Dockerfile
    ports:
    - 8111:8111
    environment:
    - PORT=8111
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8111/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '200'
          memory: 256Mi
    depends_on:
    - postgres
    - redis
  iot-gateway:
    build:
      context: ../../apps/services/iot-gateway
      dockerfile: Dockerfile
    ports:
    - 8106:8106
    environment:
    - PORT=8106
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8106/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '300'
          memory: 256Mi
    depends_on:
    - postgres
    - redis
    - nats
    - mqtt
networks:
  sahool-network:
    driver: bridge
