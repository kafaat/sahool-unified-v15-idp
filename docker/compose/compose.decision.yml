version: '3.8'
services:
  crop-growth-model:
    build:
      context: ../../apps/services/crop-growth-model
      dockerfile: Dockerfile
    ports:
    - 3023:3023
    environment:
    - PORT=3023
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3023/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
  yield-prediction:
    build:
      context: ../../apps/services/yield-prediction
      dockerfile: Dockerfile
    ports:
    - 3021:3021
    environment:
    - PORT=3021
    - NODE_ENV=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:3021/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
    depends_on:
    - crop-growth-model
    - weather-advanced
    - lai-estimation
  yield-engine:
    build:
      context: ../../apps/services/yield-engine
      dockerfile: Dockerfile
    ports:
    - 8098:8098
    environment:
    - PORT=8098
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8098/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '500'
          memory: 512Mi
    depends_on:
    - crop-growth-model
    - weather-advanced
  fertilizer-advisor:
    build:
      context: ../../apps/services/fertilizer-advisor
      dockerfile: Dockerfile
    ports:
    - 9093:9093
    environment:
    - PORT=9093
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:9093/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - crop-growth-model
    - satellite-service
  irrigation-smart:
    build:
      context: ../../apps/services/irrigation-smart
      dockerfile: Dockerfile
    ports:
    - 8094:8094
    environment:
    - PORT=8094
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8094/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - weather-advanced
    - virtual-sensors
  advisory-service:
    build:
      context: ../../apps/services/advisory-service
      dockerfile: Dockerfile
    ports:
    - 8093:8093
    environment:
    - PORT=8093
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8093/health
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - postgres
    - redis
    - nats
  agro-advisor:
    build:
      context: ../../apps/services/agro-advisor
      dockerfile: Dockerfile
    ports:
    - 8105:8105
    environment:
    - PORT=8105
    - ENVIRONMENT=production
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:8105/healthz
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '400'
          memory: 384Mi
    depends_on:
    - postgres
    - redis
    - nats
networks:
  sahool-network:
    driver: bridge
