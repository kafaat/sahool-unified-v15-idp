# ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูููุตุฉ ุณููู
# SAHOOL Platform Backup Strategy

**ุงููุณุฎุฉ:** 1.0.0
**ุขุฎุฑ ุชุญุฏูุซ:** 2025-12-27
**ุงููุณุคูู:** ูุฑูู ุงูุจููุฉ ุงูุชุญุชูุฉ ูููุตุฉ ุณููู

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช | Table of Contents

1. [ูุธุฑุฉ ุนุงูุฉ](#ูุธุฑุฉ-ุนุงูุฉ)
2. [ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูู PostgreSQL](#ุงุณุชุฑุงุชูุฌูุฉ-ุงููุณุฎ-ุงูุงุญุชูุงุทู-ูู-postgresql)
3. [ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูู Redis](#ุงุณุชุฑุงุชูุฌูุฉ-ุงููุณุฎ-ุงูุงุญุชูุงุทู-ูู-redis)
4. [ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูู MinIO/S3](#ุงุณุชุฑุงุชูุฌูุฉ-ุงููุณุฎ-ุงูุงุญุชูุงุทู-ูู-minio-s3)
5. [ุฌุฏูู ุงููุณุฎ ุงูุงุญุชูุงุทู](#ุฌุฏูู-ุงููุณุฎ-ุงูุงุญุชูุงุทู)
6. [ุฅุฌุฑุงุกุงุช ุงูุงุณุชุนุงุฏุฉ](#ุฅุฌุฑุงุกุงุช-ุงูุงุณุชุนุงุฏุฉ)
7. [ุงููุฑุงูุจุฉ ูุงูุฅุดุนุงุฑุงุช](#ุงููุฑุงูุจุฉ-ูุงูุฅุดุนุงุฑุงุช)
8. [ุงูุฃูุงู ูุฃูุถู ุงูููุงุฑุณุงุช](#ุงูุฃูุงู-ูุฃูุถู-ุงูููุงุฑุณุงุช)

---

## ูุธุฑุฉ ุนุงูุฉ

### ุงูุฃูุฏุงู ุงูุฑุฆูุณูุฉ

ุชูุฏู ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูููุตุฉ ุณููู ุฅูู:

- **ุญูุงูุฉ ุงูุจูุงูุงุช**: ุถูุงู ุนุฏู ููุฏุงู ุงูุจูุงูุงุช ุงูุญุฑุฌุฉ
- **ุงูุชุนุงูู ุงูุณุฑูุน**: ุชูููู ููุช ุงูุชุนุทู (RTO < 4 ุณุงุนุงุช)
- **ููุทุฉ ุงุณุชุนุงุฏุฉ ุฏูููุฉ**: ุงูุญุฏ ุงูุฃุฏูู ูููุฏุงู ุงูุจูุงูุงุช (RPO < 1 ุณุงุนุฉ)
- **ุงูุงูุชุซุงู**: ุงูุงูุชุฒุงู ุจูุชุทูุจุงุช ุญูุงูุฉ ุงูุจูุงูุงุช
- **ุงูุงุฎุชุจุงุฑ ุงูููุชุธู**: ุงูุชุญูู ูู ุตุญุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ุดูุฑููุง

### ุงูููููุงุช ุงููุดูููุฉ ูู ุงููุณุฎ ุงูุงุญุชูุงุทู

| ุงููููู | ุงูููุน | ุงูุฃููููุฉ | ุงูุชูุฑุงุฑ |
|--------|------|----------|----------|
| PostgreSQL (PostGIS) | ูุงุนุฏุฉ ุจูุงูุงุช | ุญุฑุฌ | ููููุ ุฃุณุจูุนูุ ุดูุฑู |
| Redis | ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช | ุนุงูู | ูููู |
| MinIO/S3 | ุชุฎุฒูู ุงููููุงุช | ุญุฑุฌ | ูููู |
| NATS JetStream | ูุงุฆูุฉ ุงูุฑุณุงุฆู | ูุชูุณุท | ูููู |
| ูููุงุช ุงูุฅุนุฏุงุฏุงุช | ุชูููู | ุนุงูู | ุนูุฏ ูู ุชุบููุฑ |

### ูุนุงููุฑ ุงูุฃุฏุงุก

- **RTO (Recovery Time Objective)**: 4 ุณุงุนุงุช
- **RPO (Recovery Point Objective)**: 1 ุณุงุนุฉ
- **ูุณุจุฉ ูุฌุงุญ ุงููุณุฎ ุงูุงุญุชูุงุทู**: > 99.9%
- **ููุช ุงูุชุญูู**: < 30 ุฏูููุฉ

---

## ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูู PostgreSQL

### 1. ุทุฑู ุงููุณุฎ ุงูุงุญุชูุงุทู

#### ุฃ. ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูููุทูู (Logical Backup)

**ุงูุฃุฏุงุฉ**: `pg_dump` / `pg_dumpall`

**ุงููุฒุงูุง**:
- ุณูููุฉ ุงูุงุณุชุนุงุฏุฉ ุงูุฌุฒุฆูุฉ
- ููู ุงูุจูุงูุงุช ุจูู ุฅุตุฏุงุฑุงุช PostgreSQL ูุฎุชููุฉ
- ูุงุจููุฉ ูููุฑุงุกุฉ ูุงูุชุนุฏูู (SQL format)

**ุงูุงุณุชุฎุฏุงู**:
```bash
# ูุณุฎ ุงุญุชูุงุทู ูุงูู ุจุตูุบุฉ ูุฎุตุตุฉ (ููุตู ุจู)
pg_dump -h postgres -U sahool -F c -f sahool_backup.dump sahool

# ูุณุฎ ุงุญุชูุงุทู ุจุตูุบุฉ SQL ูุตูุฉ
pg_dump -h postgres -U sahool -f sahool_backup.sql sahool

# ูุณุฎ ุงุญุชูุงุทู ูุฌููุน ููุงุนุฏ ุงูุจูุงูุงุช
pg_dumpall -h postgres -U sahool -f all_databases.sql
```

**ุงูุฌุฏูู ุงูุฒููู**:
- ูููู: ุงูุณุงุนุฉ 2:00 ุตุจุงุญูุง
- ุฃุณุจูุนู: ุงูุฃุญุฏ 3:00 ุตุจุงุญูุง
- ุดูุฑู: ุฃูู ููู ูู ุงูุดูุฑ 4:00 ุตุจุงุญูุง

#### ุจ. ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูููุฒูุงุฆู (Physical Backup)

**ุงูุฃุฏุงุฉ**: `pg_basebackup`

**ุงููุฒุงูุง**:
- ุงุณุชุนุงุฏุฉ ุฃุณุฑุน
- ูุณุฎ ุงุญุชูุงุทู ุนูู ูุณุชูู ุงููููุงุช
- ุฏุนู Point-in-Time Recovery (PITR)

**ุงูุงุณุชุฎุฏุงู**:
```bash
# ูุณุฎ ุงุญุชูุงุทู ุฃุณุงุณู
pg_basebackup -h postgres -U sahool -D /backups/base -F tar -z -P

# ูุณุฎ ุงุญุชูุงุทู ูุน WAL
pg_basebackup -h postgres -U sahool -D /backups/base -X stream -P
```

**ุงูุฌุฏูู ุงูุฒููู**:
- ุฃุณุจูุนู: ุงูุณุจุช 1:00 ุตุจุงุญูุง

### 2. ุชูููู PostgreSQL ูููุณุฎ ุงูุงุญุชูุงุทู

```sql
-- ุชูุนูู WAL archiving
ALTER SYSTEM SET wal_level = 'replica';
ALTER SYSTEM SET archive_mode = 'on';
ALTER SYSTEM SET archive_command = 'cp %p /var/lib/postgresql/wal_archive/%f';
ALTER SYSTEM SET max_wal_senders = 3;

-- ุฅุนุงุฏุฉ ุชุญููู ุงูุฅุนุฏุงุฏุงุช
SELECT pg_reload_conf();
```

### 3. ุงูุถุบุท ูุงูุชุดููุฑ

```bash
# ุถุบุท ูุน gzip
pg_dump -h postgres -U sahool sahool | gzip > backup.sql.gz

# ุชุดููุฑ ูุน OpenSSL
pg_dump -h postgres -U sahool sahool | \
  openssl enc -aes-256-cbc -salt -pbkdf2 -out backup.sql.enc

# ุถุบุท ูุชุดููุฑ ูุนูุง
pg_dump -h postgres -U sahool sahool | \
  gzip | \
  openssl enc -aes-256-cbc -salt -pbkdf2 -out backup.sql.gz.enc
```

### 4. ุณูุงุณุฉ ุงูุงุญุชูุงุธ

| ููุน ุงููุณุฎุฉ | ูุฏุฉ ุงูุงุญุชูุงุธ | ุนุฏุฏ ุงููุณุฎ |
|------------|--------------|-----------|
| ูููู | 7 ุฃูุงู | 7 ูุณุฎ |
| ุฃุณุจูุนู | 4 ุฃุณุงุจูุน | 4 ูุณุฎ |
| ุดูุฑู | 12 ุดูุฑ | 12 ูุณุฎุฉ |
| ุณููู | 5 ุณููุงุช | 5 ูุณุฎ |

### 5. ุงูุชุญูู ูู ุตุญุฉ ุงููุณุฎุฉ

```bash
# ุงูุชุญูู ูู ุงููุณุฎุฉ ุงููุถุบูุทุฉ
pg_restore --list backup.dump | head -20

# ุงุฎุชุจุงุฑ ุงูุงุณุชุนุงุฏุฉ ูู ูุงุนุฏุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
pg_restore -h postgres -U sahool -d sahool_test backup.dump --verbose
```

---

## ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูู Redis

### 1. ุทุฑู ุงููุณุฎ ุงูุงุญุชูุงุทู

#### ุฃ. RDB (Redis Database Backup)

**ุขููุฉ ุงูุนูู**: ููุทุฉ (snapshot) ุซูุงุฆูุฉ ููุจูุงูุงุช

**ุงูุชูููู ูู redis.conf**:
```conf
# ุญูุธ ุชููุงุฆู
save 900 1      # ุจุนุฏ 900 ุซุงููุฉ ุฅุฐุง ุชุบูุฑ ููุชุงุญ ูุงุญุฏ ุนูู ุงูุฃูู
save 300 10     # ุจุนุฏ 300 ุซุงููุฉ ุฅุฐุง ุชุบูุฑุช 10 ููุงุชูุญ
save 60 10000   # ุจุนุฏ 60 ุซุงููุฉ ุฅุฐุง ุชุบูุฑุช 10000 ููุชุงุญ

# ุงุณู ุงูููู
dbfilename dump.rdb

# ุงููุณุงุฑ
dir /data

# ุงูุถุบุท
rdbcompression yes

# ุงูุชุญูู ูู ุงูุชุฌุฒุฆุฉ
rdbchecksum yes
```

**ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุฏูู**:
```bash
# ุญูุธ ููุฑู (ูุนูู ุงูุนูููุงุช)
redis-cli -a $REDIS_PASSWORD SAVE

# ุญูุธ ูู ุงูุฎูููุฉ (ููุตู ุจู)
redis-cli -a $REDIS_PASSWORD BGSAVE

# ูุณุฎ ุงูููู
docker exec sahool-redis redis-cli -a $REDIS_PASSWORD BGSAVE
sleep 5
docker cp sahool-redis:/data/dump.rdb /backups/redis/dump_$(date +%Y%m%d).rdb
```

#### ุจ. AOF (Append Only File)

**ุงูุชูููู**:
```conf
# ุชูุนูู AOF
appendonly yes
appendfilename "appendonly.aof"

# ุงุณุชุฑุงุชูุฌูุฉ ุงููุฒุงููุฉ
appendfsync everysec  # ุชูุงุฒู ุจูู ุงูุฃุฏุงุก ูุงูุฃูุงู

# ุฅุนุงุฏุฉ ุงููุชุงุจุฉ ุงูุชููุงุฆูุฉ
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
```

**ุงููุณุฎ ุงูุงุญุชูุงุทู**:
```bash
# ุฅุนุงุฏุฉ ูุชุงุจุฉ AOF
redis-cli -a $REDIS_PASSWORD BGREWRITEAOF

# ูุณุฎ ุงูููู
docker cp sahool-redis:/data/appendonly.aof /backups/redis/
```

### 2. ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูููุตู ุจูุง

**ุงูููุฌ ุงููุฎุชูุท**:
- ุงุณุชุฎุฏุงู RDB ูููุณุฎ ุงูุงุญุชูุงุทู ุงููููู (ุณุฑูุนุ ุญุฌู ุฃุตุบุฑ)
- ุงุณุชุฎุฏุงู AOF ููุชุนุงูู ูู ุงููุดู (ุจูุงูุงุช ุฃุญุฏุซุ RPO ุฃูู)

### 3. ุงูุฌุฏูู ุงูุฒููู

```bash
# ูููู: RDB snapshot
0 2 * * * /scripts/backup/backup_redis.sh daily

# ุฃุณุจูุนู: ูุณุฎ ูุงูู ูุน AOF
0 3 * * 0 /scripts/backup/backup_redis.sh weekly
```

### 4. ุณูุงุณุฉ ุงูุงุญุชูุงุธ

| ููุน ุงููุณุฎุฉ | ูุฏุฉ ุงูุงุญุชูุงุธ |
|------------|--------------|
| ูููู (RDB) | 7 ุฃูุงู |
| ุฃุณุจูุนู (RDB+AOF) | 4 ุฃุณุงุจูุน |

### 5. ุงูุชุญูู

```bash
# ูุญุต ููู RDB
redis-check-rdb /backups/redis/dump.rdb

# ูุญุต ููู AOF
redis-check-aof /backups/redis/appendonly.aof

# ูุญุต ุจุงูุงุณุชุนุงุฏุฉ ูู ุจูุฆุฉ ูููุตูุฉ
docker run --rm -v /backups/redis:/data redis:7-alpine \
  redis-server --appendonly no --save ""
```

---

## ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูู MinIO / S3

### 1. ุทุฑู ุงููุณุฎ ุงูุงุญุชูุงุทู

#### ุฃ. ุงููุณุฎ ุงููุชุทุงุจู (Mirror)

**ุงูุฃุฏุงุฉ**: `mc mirror`

```bash
# ูุณุฎ ูุชุทุงุจู ุฅูู ูููุน ุฎุงุฑุฌู
mc mirror --overwrite sahool/uploads s3-backup/sahool-uploads

# ูุณุฎ ูุชุทุงุจู ูุน ุงูุญุฐู
mc mirror --overwrite --remove sahool/uploads s3-backup/sahool-uploads
```

#### ุจ. ุงููุณุฎ ุงููุชุฒุงูุฏ (Incremental)

```bash
# ูุณุฎ ุงููููุงุช ุงูุฌุฏูุฏุฉ ูุงููุญุฏุซุฉ ููุท
mc mirror --newer-than 24h sahool/uploads s3-backup/sahool-uploads-daily
```

#### ุฌ. ููุทุฉ ูุงููุฉ (Snapshot)

```bash
# ูุณุฎ ูุงูู ุจุงูุชุงุฑูุฎ
BACKUP_DATE=$(date +%Y%m%d)
mc mirror sahool/uploads s3-backup/snapshots/${BACKUP_DATE}/uploads
```

### 2. ุงุณุชุฑุงุชูุฌูุฉ ุงูุชุฎุฒูู ูุชุนุฏุฏ ุงูููุงุทู

```bash
# ุฅุนุฏุงุฏ ููุงูุน ูุชุนุฏุฏุฉ
mc alias set primary http://minio-primary:9000 ACCESS_KEY SECRET_KEY
mc alias set backup http://minio-backup:9000 ACCESS_KEY SECRET_KEY
mc alias set aws-s3 https://s3.amazonaws.com ACCESS_KEY SECRET_KEY

# ูุณุฎ ุงุญุชูุงุทู ูุชุนุฏุฏ ุงููุณุชููุงุช
mc mirror primary/uploads backup/uploads              # ูุญูู
mc mirror primary/uploads aws-s3/sahool-backup/uploads  # ุณุญุงุจู
```

### 3. ุฅุตุฏุงุฑุงุช ุงููุงุฆูุงุช (Versioning)

```bash
# ุชูุนูู ุงูุฅุตุฏุงุฑุงุช
mc version enable sahool/uploads

# ุนุฑุถ ุงูุฅุตุฏุงุฑุงุช
mc ls --versions sahool/uploads/file.pdf

# ุงุณุชุนุงุฏุฉ ุฅุตุฏุงุฑ ูุฏูู
mc cp --version-id VERSION_ID sahool/uploads/file.pdf restored-file.pdf
```

### 4. ุณูุงุณุฉ ุฏูุฑุฉ ุงูุญูุงุฉ (Lifecycle)

```bash
# ุฅูุดุงุก ุณูุงุณุฉ ุฏูุฑุฉ ุงูุญูุงุฉ
cat > lifecycle.json <<EOF
{
  "Rules": [
    {
      "ID": "DeleteOldVersions",
      "Status": "Enabled",
      "NoncurrentVersionExpiration": {
        "NoncurrentDays": 90
      }
    },
    {
      "ID": "MoveToGlacier",
      "Status": "Enabled",
      "Transition": {
        "Days": 30,
        "StorageClass": "GLACIER"
      }
    }
  ]
}
EOF

# ุชุทุจูู ุงูุณูุงุณุฉ
mc ilm import sahool/uploads < lifecycle.json
```

### 5. ุงูุฌุฏูู ุงูุฒููู

| ููุน ุงููุณุฎุฉ | ุงูุชูุฑุงุฑ | ุงูููุช | ุงููุฌูุฉ |
|------------|----------|-------|--------|
| ูุชุฒุงูุฏ | ูููู | 1:00 ุตุจุงุญูุง | MinIO ูุญูู |
| ููุทุฉ ูุงููุฉ | ุฃุณุจูุนู | ุงูุฃุญุฏ 2:00 ุตุจุงุญูุง | MinIO ูุญูู + S3 |
| ุฃุฑุดูู | ุดูุฑู | ุฃูู ููู 3:00 ุตุจุงุญูุง | S3 Glacier |

### 6. ุณูุงุณุฉ ุงูุงุญุชูุงุธ

```bash
# ุญุฐู ุงููุณุฎ ุงููุฏููุฉ ุชููุงุฆููุง
mc rm --recursive --force --older-than 30d backup/daily/
mc rm --recursive --force --older-than 90d backup/weekly/
```

### 7. ุงูุชุญูู ูู ุงูุณูุงูุฉ

```bash
# ูุญุต ุชูุงูู ุงููููุงุช
mc admin heal sahool

# ููุงุฑูุฉ ุงูุจูุงูุงุช
mc diff sahool/uploads s3-backup/uploads

# ุงูุชุญูู ูู ุงูุญุฌู
mc du sahool/uploads
mc du s3-backup/uploads
```

---

## ุฌุฏูู ุงููุณุฎ ุงูุงุญุชูุงุทู

### ุฌุฏูู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุงูู

```
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
โ ุงููููู      โ ููุน ุงููุณุฎุฉ  โ ุงูุชูุฑุงุฑ โ ุงูููุช      โ ูุฏุฉ ุงูุงุญุชูุงุธ  โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโค
โ PostgreSQL  โ ูููู         โ ูููู    โ 2:00 ุต     โ 7 ุฃูุงู        โ
โ             โ ุฃุณุจูุนู       โ ุฃุณุจูุนู  โ ุงูุฃุญุฏ 3 ุต  โ 28 ููู        โ
โ             โ ุดูุฑู         โ ุดูุฑู    โ 1st 4 ุต    โ 365 ููู       โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโค
โ Redis       โ ูููู RDB     โ ูููู    โ 2:15 ุต     โ 7 ุฃูุงู        โ
โ             โ ุฃุณุจูุนู ูุงูู โ ุฃุณุจูุนู  โ ุงูุฃุญุฏ 3:15 ุตโ 28 ููู        โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโค
โ MinIO       โ ูุชุฒุงูุฏ       โ ูููู    โ 1:00 ุต     โ 30 ููู        โ
โ             โ ููุทุฉ ูุงููุฉ   โ ุฃุณุจูุนู  โ ุงูุฃุญุฏ 2 ุต  โ 90 ููู        โ
โ             โ ุฃุฑุดูู        โ ุดูุฑู    โ 1st 3 ุต    โ 365 ููู       โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโค
โ NATS        โ ูููู         โ ูููู    โ 2:30 ุต     โ 7 ุฃูุงู        โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโค
โ Configs     โ ุนูุฏ ุงูุชุบููุฑ โ ุญุณุจ ุงูุญุงุฌุฉโ ุชููุงุฆู    โ 90 ููู        โ
โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโ
```

### ููู Crontab

```cron
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# SAHOOL Platform Backup Schedule - ุฌุฏูู ุงููุณุฎ ุงูุงุญุชูุงุทู ูููุตุฉ ุณููู
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

SHELL=/bin/bash
PATH=/usr/local/bin:/usr/bin:/bin
MAILTO=admin@sahool.com

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Daily Backups - ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููููู
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# MinIO - ูู ููู ุงูุณุงุนุฉ 1:00 ุตุจุงุญูุง
0 1 * * * /scripts/backup/backup_minio.sh daily >> /var/log/backup/minio.log 2>&1

# PostgreSQL - ูู ููู ุงูุณุงุนุฉ 2:00 ุตุจุงุญูุง
0 2 * * * /scripts/backup/backup_postgres.sh daily >> /var/log/backup/postgres.log 2>&1

# Redis - ูู ููู ุงูุณุงุนุฉ 2:15 ุตุจุงุญูุง
15 2 * * * /scripts/backup/backup_redis.sh daily >> /var/log/backup/redis.log 2>&1

# NATS - ูู ููู ุงูุณุงุนุฉ 2:30 ุตุจุงุญูุง
30 2 * * * /scripts/backup/backup_nats.sh daily >> /var/log/backup/nats.log 2>&1

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Weekly Backups - ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุฃุณุจูุนู
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# MinIO - ูู ุฃุญุฏ ุงูุณุงุนุฉ 2:00 ุตุจุงุญูุง
0 2 * * 0 /scripts/backup/backup_minio.sh weekly >> /var/log/backup/minio.log 2>&1

# PostgreSQL - ูู ุฃุญุฏ ุงูุณุงุนุฉ 3:00 ุตุจุงุญูุง
0 3 * * 0 /scripts/backup/backup_postgres.sh weekly >> /var/log/backup/postgres.log 2>&1

# Redis - ูู ุฃุญุฏ ุงูุณุงุนุฉ 3:15 ุตุจุงุญูุง
15 3 * * 0 /scripts/backup/backup_redis.sh weekly >> /var/log/backup/redis.log 2>&1

# Backup All - ูู ุฃุญุฏ ุงูุณุงุนุฉ 4:00 ุตุจุงุญูุง (ูุณุฎุฉ ุดุงููุฉ)
0 4 * * 0 /scripts/backup/backup_all.sh weekly >> /var/log/backup/all.log 2>&1

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Monthly Backups - ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุดูุฑู
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# All services - ุฃูู ููู ูู ุงูุดูุฑ ุงูุณุงุนุฉ 3:00 ุตุจุงุญูุง
0 3 1 * * /scripts/backup/backup_all.sh monthly >> /var/log/backup/all.log 2>&1

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Maintenance Tasks - ููุงู ุงูุตูุงูุฉ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Cleanup old backups - ูู ููู ุงูุณุงุนุฉ 5:00 ุตุจุงุญูุง
0 5 * * * /scripts/backup/cleanup.sh >> /var/log/backup/cleanup.log 2>&1

# Verify backups - ูู ููู ุงูุณุงุนุฉ 6:00 ุตุจุงุญูุง
0 6 * * * /scripts/backup/verify-backup.sh >> /var/log/backup/verify.log 2>&1

# Generate backup report - ูู ุงุซููู ุงูุณุงุนุฉ 8:00 ุตุจุงุญูุง
0 8 * * 1 /scripts/backup/generate_report.sh >> /var/log/backup/report.log 2>&1
```

---

## ุฅุฌุฑุงุกุงุช ุงูุงุณุชุนุงุฏุฉ

### 1. ุงุณุชุนุงุฏุฉ PostgreSQL

#### ุฃ. ุงุณุชุนุงุฏุฉ ูุงููุฉ ูู pg_dump

```bash
#!/bin/bash
# ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL

BACKUP_FILE="/backups/postgres/sahool_20250127_020000.dump"

# 1. ุฅููุงู ุงูุฎุฏูุงุช ุงููุนุชูุฏุฉ
docker compose stop api-gateway auth-service

# 2. ุฅุณูุงุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ (ุญุฐุฑ!)
docker exec -it sahool-postgres psql -U sahool -c "DROP DATABASE IF EXISTS sahool;"

# 3. ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ
docker exec -it sahool-postgres psql -U sahool -c "CREATE DATABASE sahool;"

# 4. ุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช
docker exec -i sahool-postgres pg_restore \
  -U sahool \
  -d sahool \
  -v \
  --no-owner \
  --no-privileges \
  < "${BACKUP_FILE}"

# 5. ุฅุนุงุฏุฉ ุจูุงุก ุงูููุงุฑุณ
docker exec -it sahool-postgres psql -U sahool -d sahool -c "REINDEX DATABASE sahool;"

# 6. ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
docker exec -it sahool-postgres psql -U sahool -d sahool -c "ANALYZE;"

# 7. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุงุช
docker compose start api-gateway auth-service

echo "โ ุชูุช ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ"
```

#### ุจ. ุงุณุชุนุงุฏุฉ ุฌุฒุฆูุฉ (ุฌุฏูู ูุงุญุฏ)

```bash
# ุงุณุชุนุงุฏุฉ ุฌุฏูู ูุงุญุฏ
pg_restore -U sahool -d sahool -t users backup.dump

# ุงุณุชุนุงุฏุฉ ูุฎุทุท ูุญุฏุฏ
pg_restore -U sahool -d sahool -n public backup.dump
```

#### ุฌ. Point-in-Time Recovery (PITR)

```bash
# 1. ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุฃุณุงุณูุฉ
tar -xzf base_backup.tar.gz -C /var/lib/postgresql/data

# 2. ุฅูุดุงุก ููู recovery.conf
cat > /var/lib/postgresql/data/recovery.conf <<EOF
restore_command = 'cp /var/lib/postgresql/wal_archive/%f %p'
recovery_target_time = '2025-01-27 14:30:00'
recovery_target_action = 'promote'
EOF

# 3. ุฅุนุงุฏุฉ ุชุดุบูู PostgreSQL
docker compose restart postgres
```

### 2. ุงุณุชุนุงุฏุฉ Redis

#### ุฃ. ุงุณุชุนุงุฏุฉ ูู RDB

```bash
#!/bin/bash
# ุงุณุชุนุงุฏุฉ Redis ูู RDB

BACKUP_FILE="/backups/redis/dump_20250127.rdb"

# 1. ุฅููุงู Redis
docker compose stop redis

# 2. ูุณุฎ ููู RDB
docker cp "${BACKUP_FILE}" sahool-redis:/data/dump.rdb

# 3. ุชุนููู ุงูุตูุงุญูุงุช
docker exec sahool-redis chown redis:redis /data/dump.rdb

# 4. ุฅุนุงุฏุฉ ุชุดุบูู Redis
docker compose start redis

# 5. ุงูุชุญูู
sleep 5
docker exec sahool-redis redis-cli -a $REDIS_PASSWORD DBSIZE

echo "โ ุชูุช ุงุณุชุนุงุฏุฉ Redis ุจูุฌุงุญ"
```

#### ุจ. ุงุณุชุนุงุฏุฉ ูู AOF

```bash
# 1. ุฅููุงู Redis
docker compose stop redis

# 2. ูุณุฎ ููู AOF
docker cp /backups/redis/appendonly.aof sahool-redis:/data/

# 3. ุฅุนุงุฏุฉ ุชุดุบูู ูุน ุชูุนูู AOF
docker compose start redis

# 4. ุฅุนุงุฏุฉ ุจูุงุก RDB ูู AOF
docker exec sahool-redis redis-cli -a $REDIS_PASSWORD BGREWRITEAOF
```

### 3. ุงุณุชุนุงุฏุฉ MinIO

#### ุฃ. ุงุณุชุนุงุฏุฉ ูุงููุฉ

```bash
#!/bin/bash
# ุงุณุชุนุงุฏุฉ MinIO ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ

SOURCE_ALIAS="backup"
TARGET_ALIAS="sahool"
BUCKET="uploads"

# 1. ุญุฐู ุงูุจูุงูุงุช ุงูุญุงููุฉ (ุงุฎุชูุงุฑู)
mc rm --recursive --force ${TARGET_ALIAS}/${BUCKET}/

# 2. ุงุณุชุนุงุฏุฉ ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
mc mirror --overwrite ${SOURCE_ALIAS}/${BUCKET} ${TARGET_ALIAS}/${BUCKET}

# 3. ุงูุชุญูู
mc ls ${TARGET_ALIAS}/${BUCKET}

echo "โ ุชูุช ุงุณุชุนุงุฏุฉ MinIO ุจูุฌุงุญ"
```

#### ุจ. ุงุณุชุนุงุฏุฉ ููู ูุญุฏุฏ

```bash
# ุงุณุชุนุงุฏุฉ ููู ูุงุญุฏ
mc cp backup/uploads/important-file.pdf sahool/uploads/

# ุงุณุชุนุงุฏุฉ ูุฌูุฏ ูุญุฏุฏ
mc mirror backup/uploads/documents/ sahool/uploads/documents/
```

#### ุฌ. ุงุณุชุนุงุฏุฉ ุฅุตุฏุงุฑ ูุฏูู

```bash
# ุนุฑุถ ุงูุฅุตุฏุงุฑุงุช
mc ls --versions sahool/uploads/document.pdf

# ุงุณุชุนุงุฏุฉ ุฅุตุฏุงุฑ ูุญุฏุฏ
VERSION_ID="xxxxx-xxxxx-xxxxx"
mc cp --version-id ${VERSION_ID} \
  sahool/uploads/document.pdf \
  sahool/uploads/document_restored.pdf
```

### 4. ุฎุทุฉ ุงูุชุนุงูู ุงููุงูู ูู ุงูููุงุฑุซ

#### ุงููุฑุญูุฉ 1: ุงูุชูููู (0-15 ุฏูููุฉ)

```bash
# 1. ุชูููู ูุฏู ุงูุถุฑุฑ
/scripts/disaster-recovery/assess.sh

# 2. ุชุญุฏูุฏ ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุตุงูุญุฉ
/scripts/disaster-recovery/find-latest-backup.sh

# 3. ุฅุดุนุงุฑ ุงููุฑูู
/scripts/disaster-recovery/notify-team.sh
```

#### ุงููุฑุญูุฉ 2: ุงูุชุญุถูุฑ (15-30 ุฏูููุฉ)

```bash
# 1. ุฅููุงู ุฌููุน ุงูุฎุฏูุงุช
docker compose down

# 2. ูุณุฎ ุงุญุชูุงุทู ููุญุงูุฉ ุงูุญุงููุฉ (ููุชุญููู)
/scripts/disaster-recovery/backup-current-state.sh

# 3. ุชูุธูู ุงูุจูุฆุฉ
/scripts/disaster-recovery/cleanup.sh
```

#### ุงููุฑุญูุฉ 3: ุงูุงุณุชุนุงุฏุฉ (30 ุฏูููุฉ - 2 ุณุงุนุฉ)

```bash
# 1. ุงุณุชุนุงุฏุฉ PostgreSQL
/scripts/backup/restore_postgres.sh /backups/latest/postgres.dump

# 2. ุงุณุชุนุงุฏุฉ Redis
/scripts/backup/restore_redis.sh /backups/latest/redis.rdb

# 3. ุงุณุชุนุงุฏุฉ MinIO
/scripts/backup/restore_minio.sh /backups/latest/minio

# 4. ุงุณุชุนุงุฏุฉ ุงูุฅุนุฏุงุฏุงุช
/scripts/backup/restore_configs.sh
```

#### ุงููุฑุญูุฉ 4: ุงูุชุญูู (2-3 ุณุงุนุงุช)

```bash
# 1. ุงูุชุญูู ูู ููุงุนุฏ ุงูุจูุงูุงุช
/scripts/disaster-recovery/verify-databases.sh

# 2. ุงูุชุญูู ูู ุงูุฎุฏูุงุช
/scripts/disaster-recovery/verify-services.sh

# 3. ุงุฎุชุจุงุฑ ูุธููู
/scripts/disaster-recovery/functional-tests.sh
```

#### ุงููุฑุญูุฉ 5: ุงูุนูุฏุฉ ููุนูู (3-4 ุณุงุนุงุช)

```bash
# 1. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุงุช ุจุงูุชุฑุชูุจ
docker compose up -d postgres redis nats
sleep 30
docker compose up -d api-gateway
docker compose up -d

# 2. ูุฑุงูุจุฉ ุงูุณุฌูุงุช
/scripts/disaster-recovery/monitor-logs.sh

# 3. ุฅุดุนุงุฑ ุจุงูุนูุฏุฉ ููุนูู
/scripts/disaster-recovery/notify-recovery-complete.sh
```

### 5. ุณููุงุฑูููุงุช ุงูุงุณุชุนุงุฏุฉ ุงูุดุงุฆุนุฉ

#### ุณููุงุฑูู 1: ุญุฐู ุจูุงูุงุช ุนู ุทุฑูู ุงูุฎุทุฃ

```bash
# ุงุณุชุนุงุฏุฉ ูู ุขุฎุฑ ูุณุฎุฉ ููููุฉ (ุนุงุฏุฉ < 24 ุณุงุนุฉ)
LATEST_BACKUP=$(ls -t /backups/daily/postgres/*.dump | head -1)
/scripts/backup/restore_postgres.sh "${LATEST_BACKUP}"
```

#### ุณููุงุฑูู 2: ูุดู ูู ุงูุฃุฌูุฒุฉ

```bash
# ุงุณุชุนุงุฏุฉ ูุงููุฉ ุนูู ุฎุงุฏู ุฌุฏูุฏ
./scripts/disaster-recovery/full-restore.sh \
  --backup-date 20250127 \
  --new-server server2.sahool.com
```

#### ุณููุงุฑูู 3: ูุฌูู ุจุฑูุฌูุงุช ุฎุจูุซุฉ

```bash
# ุงุณุชุนุงุฏุฉ ูู ูุณุฎุฉ ูุจู ุงููุฌูู
./scripts/disaster-recovery/restore-clean-state.sh \
  --date "2025-01-25 10:00:00" \
  --verify-integrity
```

---

## ุงููุฑุงูุจุฉ ูุงูุฅุดุนุงุฑุงุช

### 1. ูุฑุงูุจุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู

#### ุฃ. ููุงููุณ ุงููุฑุงูุจุฉ

```bash
# ุญุฌู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
du -sh /backups/*

# ุนุฏุฏ ุงููุณุฎ ุงููุงุฌุญุฉ/ุงููุงุดูุฉ
grep -c "SUCCESS" /var/log/backup/*.log
grep -c "ERROR" /var/log/backup/*.log

# ููุช ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
stat -c %y /backups/latest/postgres.dump

# ูุนุฏู ูุฌุงุญ ุงููุณุฎ ุงูุงุญุชูุงุทู (ุขุฎุฑ 30 ููู)
./scripts/monitoring/backup-success-rate.sh 30
```

#### ุจ. ููุญุฉ Grafana

```yaml
# ูุซุงู ุนูู ุงุณุชุนูุงู Prometheus
- name: backup_success_rate
  expr: |
    sum(rate(backup_success_total[24h])) /
    sum(rate(backup_attempts_total[24h])) * 100

- name: backup_duration_seconds
  expr: histogram_quantile(0.95, backup_duration_seconds_bucket)

- name: backup_size_bytes
  expr: backup_size_bytes
```

### 2. ูุธุงู ุงูุฅุดุนุงุฑุงุช

#### ุฃ. ุฅุดุนุงุฑุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

```bash
# ูู ุญุงูุฉ ุงููุฌุงุญ
cat > /tmp/backup_success.txt <<EOF
Subject: โ ูุฌุงุญ ุงููุณุฎ ุงูุงุญุชูุงุทู - SAHOOL Platform

ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: daily_20250127_020000
ุงูุชุงุฑูุฎ: 2025-01-27 02:15:00
ุงูุญุงูุฉ: ูุฌุญุช โ

ุงูุชูุงุตูู:
- PostgreSQL: 2.3 GB (ูุฌุญ)
- Redis: 450 MB (ูุฌุญ)
- MinIO: 15.7 GB (ูุฌุญ)

ูุฏุฉ ุงูุชูููุฐ: 18 ุฏูููุฉ
ุงููุฌูุฉ: MinIO + AWS S3
EOF

sendmail -t < /tmp/backup_success.txt

# ูู ุญุงูุฉ ุงููุดู
cat > /tmp/backup_failure.txt <<EOF
Subject: โ๏ธ ูุดู ุงููุณุฎ ุงูุงุญุชูุงุทู - ุชุญุชุงุฌ ุชุฏุฎู ููุฑู

ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: daily_20250127_020000
ุงูุชุงุฑูุฎ: 2025-01-27 02:15:00
ุงูุญุงูุฉ: ูุดูุช โ

ุงูุฎุทุฃ:
PostgreSQL backup failed: Connection timeout

ุงูุฅุฌุฑุงุก ุงููุทููุจ:
1. ุงูุชุญูู ูู ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุฏูููุง
3. ุงูุชุญูู ูู ุงูุณุฌูุงุช

ุงูุณุฌูุงุช: /var/log/backup/postgres_20250127.log
EOF

sendmail -t < /tmp/backup_failure.txt
```

#### ุจ. ุฅุดุนุงุฑุงุช Slack

```bash
#!/bin/bash
# ุฅุฑุณุงู ุฅุดุนุงุฑ ุฅูู Slack

WEBHOOK_URL="${SLACK_WEBHOOK_URL}"
STATUS="$1"  # success or failure
MESSAGE="$2"

if [ "$STATUS" = "success" ]; then
  COLOR="good"
  EMOJI=":white_check_mark:"
else
  COLOR="danger"
  EMOJI=":x:"
fi

curl -X POST "${WEBHOOK_URL}" \
  -H 'Content-Type: application/json' \
  -d @- <<EOF
{
  "attachments": [
    {
      "color": "${COLOR}",
      "title": "${EMOJI} SAHOOL Platform Backup",
      "text": "${MESSAGE}",
      "footer": "Backup System",
      "ts": $(date +%s)
    }
  ]
}
EOF
```

#### ุฌ. ุฅุดุนุงุฑุงุช PagerDuty (ููุญุงูุงุช ุงูุญุฑุฌุฉ)

```bash
#!/bin/bash
# ุฅูุดุงุก ุญุงุฏุซุฉ ูู PagerDuty

curl -X POST https://api.pagerduty.com/incidents \
  -H 'Authorization: Token token=YOUR_API_TOKEN' \
  -H 'Content-Type: application/json' \
  -d @- <<EOF
{
  "incident": {
    "type": "incident",
    "title": "ูุดู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุญุฑุฌ - SAHOOL Platform",
    "service": {
      "id": "SERVICE_ID",
      "type": "service_reference"
    },
    "urgency": "high",
    "body": {
      "type": "incident_body",
      "details": "ูุดูุช ุฌููุน ูุญุงููุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู ูู PostgreSQL"
    }
  }
}
EOF
```

### 3. ุชูุงุฑูุฑ ุฏูุฑูุฉ

```bash
#!/bin/bash
# ุชูุฑูุฑ ุฃุณุจูุนู ูููุณุฎ ุงูุงุญุชูุงุทู

cat > /tmp/weekly_backup_report.txt <<EOF
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุชูุฑูุฑ ุงูุฃุณุจูุนู ูููุณุฎ ุงูุงุญุชูุงุทู - SAHOOL Platform
ุงูุฃุณุจูุน: $(date +%V) ูู $(date +%Y)
ุงูุชุงุฑูุฎ: $(date +%Y-%m-%d)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ ุฅุญุตุงุฆูุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู:
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโโโโโโโ
โ ุงููููู         โ ูุงุฌุญ   โ ูุงุดู    โ ูุนุฏู ุงููุฌุงุญ โ
โโโโโโโโโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโโโโโค
โ PostgreSQL     โ 7/7     โ 0       โ 100%         โ
โ Redis          โ 7/7     โ 0       โ 100%         โ
โ MinIO          โ 7/7     โ 0       โ 100%         โ
โ NATS           โ 7/7     โ 0       โ 100%         โ
โโโโโโโโโโโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโโโโโโ

๐พ ุฃุญุฌุงู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ:
- PostgreSQL: ูุชูุณุท 2.4 GB
- Redis: ูุชูุณุท 460 MB
- MinIO: ูุชูุณุท 16.2 GB
- ุฅุฌูุงูู: 19.06 GB

โฑ๏ธ ุฃููุงุช ุงูุชูููุฐ:
- ุฃุณุฑุน: 12 ุฏูููุฉ (PostgreSQL)
- ุฃุจุทุฃ: 25 ุฏูููุฉ (MinIO)
- ูุชูุณุท: 18 ุฏูููุฉ

๐๏ธ ุงูุชุฎุฒูู:
- ุงููุณุงุญุฉ ุงููุณุชุฎุฏูุฉ: 85.3 GB / 500 GB (17%)
- ุงููุณุฎ ุงููุฏููุฉ ุงููุญุฐููุฉ: 12 ูุณุฎุฉ
- ุงููุณุงุญุฉ ุงููุชููุฑุฉ: 414.7 GB

โ ุงูุฅุฌุฑุงุกุงุช ุงูููุตู ุจูุง:
- ูุง ุชูุฌุฏ ูุดุงูู ุญุงููุฉ
- ุงููุธุงู ูุนูู ุจุดูู ูุซุงูู

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุชููุงุฆููุง ุจูุงุณุทุฉ ูุธุงู ุงููุณุฎ ุงูุงุญุชูุงุทู
EOF

# ุฅุฑุณุงู ุงูุชูุฑูุฑ
sendmail admin@sahool.com < /tmp/weekly_backup_report.txt
```

---

## ุงูุฃูุงู ูุฃูุถู ุงูููุงุฑุณุงุช

### 1. ุชุดููุฑ ุงูุจูุงูุงุช

#### ุฃ. ุชุดููุฑ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ

```bash
#!/bin/bash
# ุชุดููุฑ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจุงุณุชุฎุฏุงู GPG

BACKUP_FILE="sahool_backup.sql"
GPG_KEY="admin@sahool.com"

# ุชุดููุฑ
gpg --encrypt --recipient "${GPG_KEY}" "${BACKUP_FILE}"

# ูู ุงูุชุดููุฑ
gpg --decrypt "${BACKUP_FILE}.gpg" > "${BACKUP_FILE}"
```

#### ุจ. ุชุดููุฑ ุงูููู

```bash
# ููู ุขูู ุนุจุฑ SSH
scp -i ~/.ssh/backup_key backup.sql user@backup-server:/backups/

# ุฑูุน ูุดูุฑ ุฅูู S3
aws s3 cp backup.sql s3://bucket/ \
  --sse AES256 \
  --storage-class GLACIER
```

### 2. ุงูุชุญูู ูู ุงููุตูู

#### ุฃ. ุตูุงุญูุงุช ุงููููุงุช

```bash
# ุชุนููู ุตูุงุญูุงุช ุขููุฉ
chmod 600 /backups/*.dump
chmod 700 /backups/
chown backup:backup /backups/

# ููุน ุงููุตูู ุงูุนุงู
chmod o-rwx /backups/*
```

#### ุจ. ุฅุฏุงุฑุฉ ุงูููุงุชูุญ

```bash
# ุชุฎุฒูู ุงูููุงุชูุญ ูู Vault
vault kv put secret/backup/postgres \
  username=sahool \
  password=secure_password

# ุงุณุชุฑุฌุงุน ุงูููุงุชูุญ
POSTGRES_PASSWORD=$(vault kv get -field=password secret/backup/postgres)
```

### 3. ุงูุชุฏููู ูุงูุชุชุจุน

```bash
# ุชุณุฌูู ุฌููุน ุนูููุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู
cat >> /var/log/backup/audit.log <<EOF
[$(date +%Y-%m-%d\ %H:%M:%S)] BACKUP_START user=${USER} type=daily
[$(date +%Y-%m-%d\ %H:%M:%S)] BACKUP_SUCCESS size=2.3GB duration=15m
[$(date +%Y-%m-%d\ %H:%M:%S)] UPLOAD_S3 destination=s3://sahool-backups
EOF
```

### 4. ุงูุงุฎุชุจุงุฑ ุงูููุชุธู

#### ุฃ. ุงุฎุชุจุงุฑ ุดูุฑู ููุงุณุชุนุงุฏุฉ

```bash
#!/bin/bash
# ุงุฎุชุจุงุฑ ุงูุงุณุชุนุงุฏุฉ ูู ุจูุฆุฉ ูููุตูุฉ

TEST_DATE=$(date +%Y%m%d)
TEST_DB="sahool_test_${TEST_DATE}"

# 1. ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุงุฎุชุจุงุฑ
createdb "${TEST_DB}"

# 2. ุงุณุชุนุงุฏุฉ ูู ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
pg_restore -d "${TEST_DB}" /backups/latest/postgres.dump

# 3. ุงูุชุญูู ูู ุงูุจูุงูุงุช
psql "${TEST_DB}" -c "SELECT COUNT(*) FROM users;"
psql "${TEST_DB}" -c "SELECT COUNT(*) FROM farms;"

# 4. ุชูุธูู
dropdb "${TEST_DB}"

echo "โ ุงุฎุชุจุงุฑ ุงูุงุณุชุนุงุฏุฉ ูุฌุญ"
```

### 5. ุงูุชูุซูู ูุงูุชุฏุฑูุจ

- **ุฏููู ุงูุงุณุชุนุงุฏุฉ**: ุชูุซูู ููุตู ูุฌููุน ุณููุงุฑูููุงุช ุงูุงุณุชุนุงุฏุฉ
- **ุฌูุณุงุช ุชุฏุฑูุจูุฉ**: ุฑุจุน ุณูููุฉ ููุฑูู ุงูุนูููุงุช
- **ุชูุงุฑูู ูุญุงูุงุฉ**: ูุญุงูุงุฉ ููุงุฑุซ ููุชุฏุฑูุจ
- **ูุงุฆูุฉ ุฌูุงุช ุงูุงุชุตุงู**: ูุงุฆูุฉ ูุญุฏุซุฉ ููุทูุงุฑุฆ

### 6. ุงููุฑุงุฌุนุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ

```bash
# ูุฑุงุฌุนุฉ ุฑุจุน ุณูููุฉ
- ูุฑุงุฌุนุฉ ุณูุงุณุฉ ุงูุงุญุชูุงุธ
- ุชูููู ุฃููุงุช ุงูุงุณุชุนุงุฏุฉ
- ุชุญุฏูุซ ุงููุซุงุฆู
- ุงุฎุชุจุงุฑ ุฎุทุฉ ุงูุชุนุงูู ูู ุงูููุงุฑุซ
- ูุฑุงุฌุนุฉ ุณุนุงุช ุงูุชุฎุฒูู
```

---

## ููุญู: ุฃูุงูุฑ ุณุฑูุนุฉ

### ูุณุฎ ุงุญุชูุงุทู ูุฏูู ุณุฑูุน

```bash
# ูุณุฎ ุงุญุชูุงุทู ุดุงูู ูุฌููุน ุงูููููุงุช
/scripts/backup/backup_all.sh manual

# ูุณุฎ ุงุญุชูุงุทู PostgreSQL ููุท
/scripts/backup/backup_postgres.sh manual

# ูุณุฎ ุงุญุชูุงุทู Redis ููุท
/scripts/backup/backup_redis.sh manual

# ูุณุฎ ุงุญุชูุงุทู MinIO ููุท
/scripts/backup/backup_minio.sh manual
```

### ุงูุชุญูู ูู ุญุงูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู

```bash
# ุญุงูุฉ ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
/scripts/backup/status.sh

# ุงูุชุญูู ูู ุตุญุฉ ุงููุณุฎุฉ
/scripts/backup/verify-backup.sh /backups/latest

# ุนุฑุถ ุงูุณุฌูุงุช
tail -f /var/log/backup/*.log
```

### ุงุณุชุนุงุฏุฉ ุณุฑูุนุฉ

```bash
# ุงุณุชุนุงุฏุฉ PostgreSQL ูู ุขุฎุฑ ูุณุฎุฉ
/scripts/backup/restore_postgres.sh --latest

# ุงุณุชุนุงุฏุฉ Redis ูู ุขุฎุฑ ูุณุฎุฉ
/scripts/backup/restore_redis.sh --latest

# ุงุณุชุนุงุฏุฉ ูุงููุฉ
/scripts/disaster-recovery/full-restore.sh --latest
```

---

## ุงูุฏุนู ูุงููุณุงุนุฏุฉ

### ุฌูุงุช ุงูุงุชุตุงู

- **ุงูุฏุนู ุงูููู**: support@sahool.com
- **ุงูุทูุงุฑุฆ**: +966-XX-XXX-XXXX
- **ูุฑูู DevOps**: devops@sahool.com

### ุงูููุงุฑุฏ

- **ุงููุซุงุฆู**: https://docs.sahool.com/backup
- **ุงูุฃุฏูุงุช**: /scripts/backup/
- **ุงูุณุฌูุงุช**: /var/log/backup/
- **ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ**: /backups/

### ุงูุฅุจูุงุบ ุนู ุงููุดุงูู

```bash
# ุฅูุดุงุก ุชุฐูุฑุฉ ุฏุนู ุชููุงุฆููุง
/scripts/support/create-ticket.sh \
  --category backup \
  --priority high \
  --description "ูุดู ุงููุณุฎ ุงูุงุญุชูุงุทู"
```

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-12-27
**ุงูุฅุตุฏุงุฑ**: 1.0.0
**ุงููุณุคูู**: ูุฑูู ุงูุจููุฉ ุงูุชุญุชูุฉ - SAHOOL Platform
