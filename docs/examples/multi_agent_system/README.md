# نظام الوكلاء المتعددين | Multi-Agent System

## الهيكل العام | Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           نظام الوكلاء المتعددين                              │
│                         Multi-Agent System                                  │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────┐
                              │    المستخدم     │
                              │      User       │
                              └────────┬────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                         الوكيل المركزي | Orchestrator                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │  1. استقبال الطلب    2. التحليل والتخطيط    3. توزيع المهام            │ │
│  │  4. مراقبة التنفيذ    5. تجميع النتائج      6. التكامل والرد            │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐           │
│  │  Agent Registry  │  │   Task Queue     │  │  Result Store    │           │
│  │  سجل الوكلاء     │  │  طابور المهام    │  │  مخزن النتائج    │           │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘           │
└──────────────────────────────────────────────────────────────────────────────┘
                                       │
              ┌────────────────────────┼────────────────────────┐
              │                        │                        │
              ▼                        ▼                        ▼
┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐
│   Code Writer Agent  │  │  Code Reviewer Agent │  │   Test Writer Agent  │
│   وكيل كتابة الكود   │  │  وكيل مراجعة الكود   │  │  وكيل كتابة الاختبار │
├──────────────────────┤  ├──────────────────────┤  ├──────────────────────┤
│ • CODE_GENERATION    │  │ • CODE_REVIEW        │  │ • TESTING            │
│ • WRITE_FILES        │  │ • READ_FILES         │  │ • CODE_GENERATION    │
│ • READ_FILES         │  │                      │  │ • WRITE_FILES        │
└──────────────────────┘  └──────────────────────┘  └──────────────────────┘
              │                        │                        │
              └────────────────────────┼────────────────────────┘
                                       │
                                       ▼
                          ┌──────────────────────┐
                          │   النتائج المجمعة    │
                          │  Aggregated Results  │
                          └──────────────────────┘
```

---

## المكونات | Components

### 1. الوكيل المركزي (Orchestrator)

```python
# orchestrator.py
class Orchestrator:
    """
    المسؤوليات:
    - تحليل طلب المستخدم
    - تقسيم العمل إلى مهام
    - توزيع المهام على الوكلاء
    - تجميع وتكامل النتائج
    """
```

**الوظائف الرئيسية:**
| الوظيفة | الوصف |
|---------|-------|
| `analyze_request()` | تحليل طلب المستخدم وتقسيمه |
| `execute_tasks()` | تنفيذ المهام بالتوازي |
| `integrate_results()` | تجميع النتائج |
| `process_request()` | المعالجة الكاملة |

---

### 2. طابور المهام (Task Queue)

```python
# task_queue.py
class TaskQueue:
    """
    الميزات:
    - ترتيب حسب الأولوية
    - دعم التبعيات
    - إعادة المحاولة التلقائية
    """
```

**الأولويات:**
```
CRITICAL (1) → HIGH (2) → NORMAL (3) → LOW (4) → BACKGROUND (5)
```

---

### 3. سجل الوكلاء (Agent Registry)

```python
# agent_registry.py
@AgentRegistry.register(
    name="code-writer",
    capabilities=[AgentCapability.CODE_GENERATION]
)
class CodeWriterAgent:
    pass
```

---

## تدفق العمل | Workflow

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                              تدفق العمل                                       │
└──────────────────────────────────────────────────────────────────────────────┘

  الخطوة 1: الاستقبال          الخطوة 2: التحليل           الخطوة 3: التخطيط
┌─────────────────────┐    ┌─────────────────────┐    ┌─────────────────────┐
│                     │    │                     │    │ Task 1 ──┐          │
│  "أريد إنشاء API   │───▶│  Claude يحلل       │───▶│ Task 2 ──┼──▶ Plan  │
│   للمستخدمين"       │    │  الطلب ويفهمه      │    │ Task 3 ──┘          │
│                     │    │                     │    │                     │
└─────────────────────┘    └─────────────────────┘    └─────────────────────┘
                                                                │
                    ┌───────────────────────────────────────────┘
                    │
                    ▼
  الخطوة 4: التوزيع           الخطوة 5: التنفيذ          الخطوة 6: التجميع
┌─────────────────────┐    ┌─────────────────────┐    ┌─────────────────────┐
│                     │    │ Agent 1: ✅ Done    │    │                     │
│  توزيع على         │───▶│ Agent 2: ⏳ Running │───▶│  تجميع النتائج      │
│  الوكلاء            │    │ Agent 3: ✅ Done    │    │  والتكامل           │
│                     │    │                     │    │                     │
└─────────────────────┘    └─────────────────────┘    └─────────────────────┘
                                                                │
                    ┌───────────────────────────────────────────┘
                    │
                    ▼
  الخطوة 7: الرد النهائي
┌─────────────────────┐
│                     │
│  رد متماسك         │
│  للمستخدم           │
│                     │
└─────────────────────┘
```

---

## أنماط التنفيذ | Execution Patterns

### 1. التنفيذ المتوازي (Parallel)
```
المهام المستقلة تُنفذ في نفس الوقت

Task 1 ─────────────▶ ✅
Task 2 ─────────────▶ ✅    ← في نفس الوقت
Task 3 ─────────────▶ ✅
```

### 2. التنفيذ المتسلسل (Sequential)
```
المهام المعتمدة تُنفذ بالترتيب

Task 1 ─────▶ Task 2 ─────▶ Task 3
```

### 3. التنفيذ المختلط (Mixed)
```
Task 1 ─────────────────────────▶ ✅
Task 2 ─────────────────────────▶ ✅   ← متوازي
                                  │
                                  ▼
                            Task 3 ───▶ ✅  ← يعتمد على 1 و 2
                                  │
                                  ▼
Task 4 ─────────────────────────▶ ✅
Task 5 ─────────────────────────▶ ✅   ← متوازي
```

---

## مثال عملي | Example

```python
import asyncio
from orchestrator import Orchestrator

async def main():
    # إنشاء Orchestrator
    orchestrator = Orchestrator(
        api_key="your-api-key",
        max_parallel_agents=5
    )

    # طلب المستخدم
    request = """
    أريد إنشاء نظام تسجيل دخول كامل:
    1. إنشاء نموذج المستخدم
    2. إنشاء API للتسجيل
    3. كتابة الاختبارات
    4. كتابة التوثيق
    """

    # معالجة الطلب
    response = await orchestrator.process_request(request)
    print(response)

asyncio.run(main())
```

**الناتج المتوقع:**
```
📥 استلام الطلب: أريد إنشاء نظام تسجيل دخول...
🔍 تحليل الطلب...
📋 تم تحديد 4 مهام
🚀 بدء التنفيذ...
  ⚙️ Task 1: إنشاء نموذج المستخدم
  ⚙️ Task 2: إنشاء API للتسجيل
  ⚙️ Task 3: كتابة الاختبارات
  ⚙️ Task 4: كتابة التوثيق
✅ اكتمل 4/4 مهمة
🔄 تجميع النتائج...
✨ اكتمل!
```

---

## الملفات | Files

| الملف | الوصف |
|-------|-------|
| `orchestrator.py` | الوكيل المركزي |
| `task_queue.py` | إدارة المهام |
| `agent_registry.py` | سجل الوكلاء |
| `README.md` | هذا الملف |

---

## التكامل مع Claude Code

هذا النظام مشابه لكيفية عمل Claude Code:

```
Claude Code Orchestrator (أنا)
         │
         ├── Task Tool → SubAgent 1 (general-purpose)
         ├── Task Tool → SubAgent 2 (Explore)
         ├── Task Tool → SubAgent 3 (Plan)
         └── Task Tool → SubAgent 4 (claude-code-guide)
```

**الفرق:**
- Claude Code يستخدم الـ `Task` tool لإطلاق الوكلاء
- كل وكيل يعمل في سياق منفصل
- الوكيل الرئيسي يجمع النتائج ويرد على المستخدم
