# ═══════════════════════════════════════════════════════════════════════════════
# SAHOOL Services Registry - سجل الخدمات المعتمدة
# Single Source of Truth for all microservices
# ═══════════════════════════════════════════════════════════════════════════════

version: "1.0.0"
last_updated: "2025-12-19"

# ─────────────────────────────────────────────────────────────────────────────
# Service Categories
# ─────────────────────────────────────────────────────────────────────────────

categories:
  core:
    description: "Core platform services"
    description_ar: "خدمات المنصة الأساسية"

  crop:
    description: "Crop management and modeling"
    description_ar: "إدارة ونمذجة المحاصيل"

  analytics:
    description: "Data analytics and predictions"
    description_ar: "تحليل البيانات والتنبؤات"

  integration:
    description: "External integrations and IoT"
    description_ar: "التكاملات الخارجية وإنترنت الأشياء"

  community:
    description: "Community and marketplace"
    description_ar: "المجتمع والسوق"

# ─────────────────────────────────────────────────────────────────────────────
# Approved Services (v15.3)
# ─────────────────────────────────────────────────────────────────────────────

services:
  # ═══════════════════════════════════════════════════════════════════════════
  # CROP GROWTH MODEL - نموذج نمو المحاصيل
  # ═══════════════════════════════════════════════════════════════════════════
  crop-growth-model:
    name: "Crop Growth Model"
    name_ar: "نموذج نمو المحاصيل"
    category: crop
    path: "kernel-services-v15.3/crop-growth-model"
    port: 3000
    protocol: http
    health_endpoint: "/health"
    status: active

    modules:
      - id: phenology
        name: "Phenology Tracking"
        name_ar: "تتبع الفينولوجيا"
        endpoint: "/phenology"

      - id: photosynthesis
        name: "Photosynthesis Model"
        name_ar: "نموذج التمثيل الضوئي"
        endpoint: "/photosynthesis"

      - id: biomass
        name: "Biomass Accumulation"
        name_ar: "تراكم الكتلة الحيوية"
        endpoint: "/biomass"

      - id: simulation
        name: "Growth Simulation"
        name_ar: "محاكاة النمو"
        endpoint: "/simulation"

      - id: root-growth
        name: "Root Growth Model"
        name_ar: "نموذج نمو الجذور"
        endpoint: "/root-growth"

      - id: water-balance
        name: "Water Balance (FAO-56)"
        name_ar: "توازن المياه"
        endpoint: "/water-balance"

      - id: satellite-data
        name: "Satellite Data Selector"
        name_ar: "محدد بيانات الأقمار"
        endpoint: "/satellite-data"

      - id: irrigation-decision
        name: "Irrigation Decision Support"
        name_ar: "دعم قرارات الري"
        endpoint: "/irrigation-decision"

      - id: multi-agent-advisor
        name: "Multi-Agent Advisory"
        name_ar: "المستشار متعدد الوكلاء"
        endpoint: "/advisor"

      - id: voice-guidance
        name: "Voice Guidance (Arabic)"
        name_ar: "الإرشاد الصوتي"
        endpoint: "/voice-guidance"

      - id: web-data-collector
        name: "Web Data Collector"
        name_ar: "جامع بيانات الويب"
        endpoint: "/web-data"

      - id: digital-twin-core
        name: "Digital Twin Core"
        name_ar: "التوأم الرقمي"
        endpoint: "/digital-twin"

      - id: rs-world-model
        name: "RS World Model"
        name_ar: "نموذج العالم للاستشعار"
        endpoint: "/rs-world-model"

      - id: planting-strategy
        name: "Planting Strategy Optimizer"
        name_ar: "محسّن استراتيجية الزراعة"
        endpoint: "/planting-strategy"

      - id: gis-integration
        name: "GIS Integration"
        name_ar: "تكامل نظم المعلومات الجغرافية"
        endpoint: "/gis"

    dependencies: []

    environment:
      - NODE_ENV
      - PORT

    resources:
      cpu: "500m"
      memory: "512Mi"
      replicas: 2

  # ═══════════════════════════════════════════════════════════════════════════
  # DISASTER ASSESSMENT - تقييم الكوارث
  # ═══════════════════════════════════════════════════════════════════════════
  disaster-assessment:
    name: "Disaster Assessment"
    name_ar: "تقييم الكوارث"
    category: analytics
    path: "kernel-services-v15.3/disaster-assessment"
    port: 3001
    protocol: http
    health_endpoint: "/health"
    status: active

    modules:
      - id: disaster
        name: "Disaster Detection"
        endpoint: "/disaster"
      - id: alert
        name: "Alert Management"
        endpoint: "/alert"

    database:
      type: postgresql
      name: sahool_disaster

    dependencies:
      - weather-core
      - satellite-data

    resources:
      cpu: "300m"
      memory: "256Mi"
      replicas: 1

  # ═══════════════════════════════════════════════════════════════════════════
  # LAI ESTIMATION - تقدير مؤشر مساحة الأوراق
  # ═══════════════════════════════════════════════════════════════════════════
  lai-estimation:
    name: "LAI Estimation"
    name_ar: "تقدير LAI"
    category: analytics
    path: "kernel-services-v15.3/lai-estimation"
    port: 3002
    protocol: http
    health_endpoint: "/health"
    status: active

    modules:
      - id: lai
        name: "LAI Calculator"
        endpoint: "/lai"
      - id: indices
        name: "Vegetation Indices"
        endpoint: "/indices"

    dependencies:
      - satellite-data

    resources:
      cpu: "400m"
      memory: "384Mi"
      replicas: 1

  # ═══════════════════════════════════════════════════════════════════════════
  # YIELD PREDICTION - تنبؤ الغلة
  # ═══════════════════════════════════════════════════════════════════════════
  yield-prediction:
    name: "Yield Prediction"
    name_ar: "تنبؤ الغلة"
    category: analytics
    path: "kernel-services-v15.3/yield-prediction"
    port: 3003
    protocol: http
    health_endpoint: "/health"
    status: active

    modules:
      - id: yield
        name: "Yield Forecaster"
        endpoint: "/yield"

    dependencies:
      - crop-growth-model
      - weather-core
      - lai-estimation

    resources:
      cpu: "500m"
      memory: "512Mi"
      replicas: 1

  # ═══════════════════════════════════════════════════════════════════════════
  # MARKETPLACE SERVICE - خدمة السوق
  # ═══════════════════════════════════════════════════════════════════════════
  marketplace-service:
    name: "Marketplace Service"
    name_ar: "خدمة السوق"
    category: community
    path: "kernel-services-v15.3/marketplace-service"
    port: 3004
    protocol: http
    health_endpoint: "/health"
    status: active

    modules:
      - id: market
        name: "Market Operations"
        endpoint: "/market"
      - id: fintech
        name: "Financial Services"
        endpoint: "/fintech"

    database:
      type: postgresql
      name: sahool_marketplace

    dependencies: []

    resources:
      cpu: "400m"
      memory: "384Mi"
      replicas: 2

  # ═══════════════════════════════════════════════════════════════════════════
  # COMMUNITY CHAT - دردشة المجتمع
  # ═══════════════════════════════════════════════════════════════════════════
  community-chat:
    name: "Community Chat"
    name_ar: "دردشة المجتمع"
    category: community
    path: "kernel-services-v15.3/community-chat"
    port: 3005
    protocol: http
    health_endpoint: "/health"
    status: active

    database:
      type: postgresql
      name: sahool_chat

    dependencies: []

    resources:
      cpu: "300m"
      memory: "256Mi"
      replicas: 1

  # ═══════════════════════════════════════════════════════════════════════════
  # IOT SERVICE - خدمة إنترنت الأشياء
  # ═══════════════════════════════════════════════════════════════════════════
  iot-service:
    name: "IoT Gateway"
    name_ar: "بوابة إنترنت الأشياء"
    category: integration
    path: "kernel-services-v15.3/iot-service"
    port: 3006
    protocol: http
    health_endpoint: "/health"
    status: active

    database:
      type: timescaledb
      name: sahool_iot

    message_broker:
      type: mqtt
      topics:
        - "sahool/sensors/#"
        - "sahool/devices/#"

    dependencies: []

    resources:
      cpu: "400m"
      memory: "512Mi"
      replicas: 2

  # ═══════════════════════════════════════════════════════════════════════════
  # FIELD OPERATIONS - عمليات الحقول
  # ═══════════════════════════════════════════════════════════════════════════
  field-ops:
    name: "Field Operations"
    name_ar: "عمليات الحقول"
    category: core
    path: "kernel/services/field_core"
    port: 8080
    protocol: http
    health_endpoint: "/healthz"
    status: active

    database:
      type: postgresql
      name: sahool_fields

    dependencies: []

    resources:
      cpu: "500m"
      memory: "512Mi"
      replicas: 2

  # ═══════════════════════════════════════════════════════════════════════════
  # WEATHER CORE - الطقس
  # ═══════════════════════════════════════════════════════════════════════════
  weather-core:
    name: "Weather Service"
    name_ar: "خدمة الطقس"
    category: integration
    path: "kernel/services/weather_core"
    port: 8108
    protocol: http
    health_endpoint: "/health"
    status: active

    database:
      type: postgresql
      name: sahool_weather

    external_apis:
      - openweathermap
      - weatherapi

    dependencies: []

    resources:
      cpu: "300m"
      memory: "256Mi"
      replicas: 1

  # ═══════════════════════════════════════════════════════════════════════════
  # NDVI ENGINE - محرك NDVI
  # ═══════════════════════════════════════════════════════════════════════════
  ndvi-engine:
    name: "NDVI Engine"
    name_ar: "محرك NDVI"
    category: analytics
    path: "kernel/services/ndvi_engine"
    port: 8107
    protocol: http
    health_endpoint: "/health"
    status: active

    dependencies:
      - satellite-data

    resources:
      cpu: "600m"
      memory: "768Mi"
      replicas: 1

  # ═══════════════════════════════════════════════════════════════════════════
  # AGRO ADVISOR - المستشار الزراعي
  # ═══════════════════════════════════════════════════════════════════════════
  agro-advisor:
    name: "Agro Advisor"
    name_ar: "المستشار الزراعي"
    category: core
    path: "advisor"
    port: 8105
    protocol: http
    health_endpoint: "/health"
    status: active

    database:
      type: postgresql
      name: sahool_advisor

    ai_models:
      - crop-recommendations
      - pest-detection
      - irrigation-optimization

    dependencies:
      - crop-growth-model
      - weather-core
      - ndvi-engine

    resources:
      cpu: "800m"
      memory: "1Gi"
      replicas: 2

# ─────────────────────────────────────────────────────────────────────────────
# API Gateway Configuration
# ─────────────────────────────────────────────────────────────────────────────

gateway:
  type: kong
  config_path: "infra/kong/kong.yml"

  global_rate_limit:
    minute: 60
    hour: 2000

  authentication:
    type: jwt
    algorithm: RS256

# ─────────────────────────────────────────────────────────────────────────────
# Infrastructure Dependencies
# ─────────────────────────────────────────────────────────────────────────────

infrastructure:
  databases:
    postgresql:
      version: "15"
      host: "${POSTGRES_HOST:-localhost}"
      port: 5432

    timescaledb:
      version: "2.11"
      host: "${TIMESCALE_HOST:-localhost}"
      port: 5432

    redis:
      version: "7"
      host: "${REDIS_HOST:-localhost}"
      port: 6379

  message_brokers:
    mqtt:
      host: "${MQTT_HOST:-localhost}"
      port: 1883

    rabbitmq:
      host: "${RABBITMQ_HOST:-localhost}"
      port: 5672

  observability:
    prometheus:
      port: 9090
    grafana:
      port: 3000
    loki:
      port: 3100

# ─────────────────────────────────────────────────────────────────────────────
# Deployment Environments
# ─────────────────────────────────────────────────────────────────────────────

environments:
  development:
    replicas: 1
    resources_multiplier: 0.5
    debug: true

  staging:
    replicas: 1
    resources_multiplier: 0.75
    debug: false

  production:
    replicas: 2
    resources_multiplier: 1.0
    debug: false
    autoscaling:
      enabled: true
      min_replicas: 2
      max_replicas: 10
      target_cpu: 70
