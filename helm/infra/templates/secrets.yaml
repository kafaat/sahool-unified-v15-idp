---
# ═══════════════════════════════════════════════════════════════════════════════
# SAHOOL Platform Secrets - Helm Chart
# ═══════════════════════════════════════════════════════════════════════════════
#
# IMPORTANT: This file defines SECRET PLACEHOLDERS ONLY!
#
# For production deployments, you MUST use one of these approaches:
#
# 1. External Secrets Operator (RECOMMENDED)
#    - Automatically syncs secrets from Vault/AWS/Azure to Kubernetes
#    - See: /gitops/secrets/external-secrets-operator.yaml
#    - Installation: helm install external-secrets external-secrets/external-secrets
#
# 2. Sealed Secrets
#    - Encrypt secrets before committing to Git
#    - See: https://github.com/bitnami-labs/sealed-secrets
#
# 3. Manual Secret Creation (NOT RECOMMENDED)
#    - Create secrets manually via kubectl
#    - Secrets are not version controlled
#
# NEVER commit actual secret values to Git!
# ═══════════════════════════════════════════════════════════════════════════════

{{- if not .Values.externalSecrets.enabled }}
---
# PostgreSQL Secret Placeholder
# Only created if External Secrets Operator is disabled
apiVersion: v1
kind: Secret
metadata:
  name: sahool-postgresql-secret
  namespace: {{ include "infra.namespace" . }}
  labels:
    {{- include "infra.postgresql.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
    description: "PostgreSQL credentials - MUST be replaced in production"
type: Opaque
stringData:
  # WARNING: These are DEVELOPMENT PLACEHOLDERS ONLY!
  # Replace these values using:
  #   kubectl create secret generic sahool-postgresql-secret \
  #     --from-literal=postgres-password=$(openssl rand -base64 32) \
  #     --from-literal=password=$(openssl rand -base64 32) \
  #     --dry-run=client -o yaml | kubectl apply -f -
  postgres-password: "REPLACE_WITH_SECURE_PASSWORD_MIN_32_CHARS"
  password: "REPLACE_WITH_SECURE_PASSWORD_MIN_32_CHARS"
  username: "sahool"

---
# Redis Secret Placeholder
# Only created if External Secrets Operator is disabled
apiVersion: v1
kind: Secret
metadata:
  name: sahool-redis-secret
  namespace: {{ include "infra.namespace" . }}
  labels:
    {{- include "infra.redis.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
    description: "Redis credentials - MUST be replaced in production"
type: Opaque
stringData:
  # WARNING: This is a DEVELOPMENT PLACEHOLDER ONLY!
  # Replace this value using:
  #   kubectl create secret generic sahool-redis-secret \
  #     --from-literal=redis-password=$(openssl rand -base64 32) \
  #     --dry-run=client -o yaml | kubectl apply -f -
  redis-password: "REPLACE_WITH_SECURE_PASSWORD_MIN_32_CHARS"

---
# NATS Secret Placeholder
# Only created if External Secrets Operator is disabled
apiVersion: v1
kind: Secret
metadata:
  name: sahool-nats-secret
  namespace: {{ include "infra.namespace" . }}
  annotations:
    helm.sh/resource-policy: keep
    description: "NATS credentials - MUST be replaced in production"
type: Opaque
stringData:
  # WARNING: These are DEVELOPMENT PLACEHOLDERS ONLY!
  nats-user: "sahool_app"
  nats-password: "REPLACE_WITH_SECURE_PASSWORD_MIN_32_CHARS"

---
# JWT Secret Placeholder
# Only created if External Secrets Operator is disabled
apiVersion: v1
kind: Secret
metadata:
  name: sahool-jwt-secret
  namespace: {{ include "infra.namespace" . }}
  annotations:
    helm.sh/resource-policy: keep
    description: "JWT signing keys - MUST be replaced in production"
type: Opaque
stringData:
  # WARNING: This is a DEVELOPMENT PLACEHOLDER ONLY!
  # For production, use RSA keys:
  #   openssl genrsa -out private.pem 4096
  #   openssl rsa -in private.pem -pubout -out public.pem
  secret_key: "REPLACE_WITH_SECURE_JWT_SECRET_MIN_32_CHARS"
  algorithm: "HS256"

{{- else }}
---
# External Secrets are enabled - secrets will be managed by External Secrets Operator
# See /gitops/secrets/external-secrets-operator.yaml for configuration
{{- end }}
