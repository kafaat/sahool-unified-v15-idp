apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "sahool.fullname" . }}-config
  labels:
    {{- include "sahool.labels" . | nindent 4 }}
data:
  SAHOOL_VERSION: {{ .Chart.AppVersion | quote }}
  LOG_LEVEL: {{ .Values.logLevel | default "INFO" | quote }}
  LOG_FORMAT: "json"

  # JWT Configuration
  JWT_ALGORITHM: {{ .Values.security.jwt.algorithm | quote }}
  JWT_ISSUER: {{ .Values.security.jwt.issuer | quote }}
  JWT_AUDIENCE: {{ .Values.security.jwt.audience | quote }}
  JWT_ACCESS_EXPIRE_MINUTES: {{ .Values.security.jwt.accessExpireMinutes | quote }}
  JWT_REFRESH_EXPIRE_DAYS: {{ .Values.security.jwt.refreshExpireDays | quote }}

  # Feature Flags
  ENABLE_SECURITY: {{ .Values.features.enableSecurity | quote }}
  ENABLE_AUDIT_LOGGING: {{ .Values.features.enableAuditLogging | quote }}
  ENABLE_RATE_LIMITING: {{ .Values.features.enableRateLimiting | quote }}
  ENABLE_METRICS: {{ .Values.features.enableMetrics | quote }}
  ENABLE_TRACING: {{ .Values.features.enableTracing | quote }}
  ENABLE_CACHING: {{ .Values.features.enableCaching | quote }}

  # Environment Configuration
  NODE_ENV: {{ .Values.configMap.commonEnv.NODE_ENV | default "production" | quote }}
  TZ: {{ .Values.configMap.commonEnv.TZ | default "Asia/Riyadh" | quote }}

  # Database Configuration
  DATABASE_HOST: {{ include "sahool.fullname" . }}-postgresql
  DATABASE_PORT: "5432"

  # Redis Configuration
  REDIS_HOST: {{ include "sahool.fullname" . }}-redis-master
  REDIS_PORT: "6379"

  # NATS Configuration
  NATS_HOST: {{ include "sahool.fullname" . }}-nats
  NATS_PORT: "4222"
