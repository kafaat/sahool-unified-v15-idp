# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SAHOOL Helm Chart Values - Ù…Ù†ØµØ© Ø³Ù‡ÙˆÙ„ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©
# v15.3.2
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Global Settings
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

global:
  imageRegistry: "ghcr.io/sahool"
  imagePullSecrets: []
  storageClass: "standard"
  environment: "development"  # development, staging, production

# Deployment Package Tier (controls which services are enabled)
# Options: starter, professional, enterprise
packageTier: "starter"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Common Configuration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

nameOverride: ""
fullnameOverride: ""
namespaceOverride: ""

# Default replica count for services
replicaCount: 1

image:
  pullPolicy: IfNotPresent

serviceAccount:
  create: true
  annotations: {}
  name: "sahool-sa"
  automountServiceAccountToken: true

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

# Default resource limits
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

nodeSelector: {}
tolerations: []
affinity: {}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Infrastructure Dependencies
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

infrastructure:
  postgresql:
    enabled: true
    image:
      repository: postgis/postgis
      tag: "16-3.4"
    auth:
      username: sahool
      database: sahool
      existingSecret: "sahool-postgresql-secret"
    primary:
      persistence:
        enabled: true
        size: 20Gi
        storageClass: ""
      resources:
        limits:
          cpu: 2000m
          memory: 4Gi
        requests:
          cpu: 500m
          memory: 1Gi
    # VPA Configuration for PostgreSQL (Stateful Database)
    # CRITICAL: "Off" mode - VPA only provides recommendations, never auto-updates
    # Prevents disruption to database connections and ensures data consistency
    vpa:
      enabled: true
      updateMode: "Off"  # Never auto-update database pods
      controlledValues: "RequestsOnly"  # Only update requests, preserve limits

  redis:
    enabled: true
    image:
      repository: redis
      tag: "7.4-alpine"
    auth:
      enabled: true
      existingSecret: "sahool-redis-secret"
    master:
      persistence:
        enabled: true
        size: 5Gi
      resources:
        limits:
          cpu: 500m
          memory: 1Gi
        requests:
          cpu: 100m
          memory: 256Mi
    # VPA Configuration for Redis (Stateful Cache/Data Store)
    # CRITICAL: "Off" mode - VPA only provides recommendations, never auto-updates
    # Prevents disruption to cache connections and session data
    vpa:
      enabled: true
      updateMode: "Off"  # Never auto-update Redis pods
      controlledValues: "RequestsOnly"  # Only update requests, preserve limits

  nats:
    enabled: true
    image:
      repository: nats
      tag: "2.10.24-alpine"
    jetstream:
      enabled: true
      memStorage:
        enabled: true
        size: 2Gi
      fileStorage:
        enabled: true
        size: 10Gi
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 200m
        memory: 512Mi
    # VPA Configuration for NATS (Stateful Message Broker with JetStream)
    # CRITICAL: "Off" mode - VPA only provides recommendations, never auto-updates
    # Prevents disruption to message streams and persistent message storage
    vpa:
      enabled: true
      updateMode: "Off"  # Never auto-update NATS pods
      controlledValues: "RequestsOnly"  # Only update requests, preserve limits

  kong:
    enabled: true
    image:
      repository: kong
      tag: "3.4"
    database: postgres
    admin:
      # SECURITY: Admin API disabled - access via kubectl exec or port-forward only
      enabled: false
      http:
        enabled: false
        servicePort: 8001
    proxy:
      enabled: true
      http:
        enabled: true
        servicePort: 8000
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 200m
        memory: 512Mi
    # VPA Configuration for Kong (API Gateway with PostgreSQL connection)
    # "Initial" mode - Only applies recommendations when pods are created
    # Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  qdrant:
    enabled: false  # Only for Enterprise
    image:
      repository: qdrant/qdrant
      tag: "v1.10.1"
    persistence:
      enabled: true
      size: 10Gi
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 500m
        memory: 1Gi
    # VPA Configuration for Qdrant (Stateful Vector Database)
    # CRITICAL: "Off" mode - VPA only provides recommendations, never auto-updates
    # Prevents disruption to vector database and AI embeddings
    vpa:
      enabled: true
      updateMode: "Off"  # Never auto-update Qdrant pods
      controlledValues: "RequestsOnly"  # Only update requests, preserve limits

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Application Services - Organized by Package Tier
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

services:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸŒ± STARTER PACKAGE - Basic Services
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  fieldCore:
    enabled: true
    name: field-core
    package: starter
    image:
      repository: field-core
      tag: "15.3.2"
    port: 3001
    targetPort: 3001
    replicaCount: 2
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 512Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 5
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    env:
      - name: NODE_ENV
        value: production
      - name: PORT
        value: "3000"
    # VPA Configuration for Field Core (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  weatherCore:
    enabled: true
    name: weather-core
    package: starter
    image:
      repository: weather-core
      tag: "15.3.2"
    port: 8108
    targetPort: 8108
    replicaCount: 2
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 4
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for Weather Core (Stateless service)
    # "Auto" mode - Safe for stateless services without persistent connections
    vpa:
      enabled: true
      updateMode: "Auto"  # Can safely auto-update stateless pods
      controlledValues: "RequestsAndLimits"

  astronomicalCalendar:
    enabled: true
    name: astronomical-calendar
    package: starter
    image:
      repository: astronomical-calendar
      tag: "15.3.2"
    port: 8111
    targetPort: 8111
    replicaCount: 1
    resources:
      limits:
        cpu: 250m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi
    autoscaling:
      enabled: false
    # VPA Configuration for Astronomical Calendar (Stateless service)
    # "Auto" mode - Safe for stateless services without persistent connections
    vpa:
      enabled: true
      updateMode: "Auto"  # Can safely auto-update stateless pods
      controlledValues: "RequestsAndLimits"

  agroAdvisor:
    enabled: true
    name: agro-advisor
    package: starter
    image:
      repository: agro-advisor
      tag: "15.3.2"
    port: 8105
    targetPort: 8105
    replicaCount: 2
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 4
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for Agro Advisor (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  notificationService:
    enabled: true
    name: notification-service
    package: starter
    image:
      repository: notification-service
      tag: "15.3.2"
    port: 8000
    targetPort: 8000
    replicaCount: 2
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 6
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for Notification Service (Database-connected service)
    # "Initial" mode - Safe for services with persistent database/queue connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  userService:
    enabled: true
    name: user-service
    package: starter
    image:
      repository: user-service
      tag: "16.0.0"
    port: 3000
    targetPort: 3000
    replicaCount: 2
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 6
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    env:
      - name: NODE_ENV
        value: production
      - name: PORT
        value: "3000"
    # VPA Configuration for User Service (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  fieldManagementService:
    enabled: true
    name: field-management-service
    package: starter
    image:
      repository: field-management-service
      tag: "16.0.0"
    port: 3000
    targetPort: 3000
    replicaCount: 2
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 512Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 5
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    env:
      - name: NODE_ENV
        value: production
      - name: PORT
        value: "3000"
    # VPA Configuration for Field Management Service (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸšœ PROFESSIONAL PACKAGE - Additional Services
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  satelliteService:
    enabled: false  # Enable when packageTier >= professional
    name: satellite-service
    package: professional
    image:
      repository: satellite-service
      tag: "15.3.2"
    port: 8125
    targetPort: 8125
    replicaCount: 2
    resources:
      limits:
        cpu: 2000m
        memory: 2Gi
      requests:
        cpu: 500m
        memory: 1Gi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 4
      targetCPUUtilization: 75
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for Satellite Service (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  ndviEngine:
    enabled: false
    name: ndvi-engine
    package: professional
    image:
      repository: ndvi-engine
      tag: "15.3.2"
    port: 8107
    targetPort: 8107
    replicaCount: 2
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 512Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 5
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for NDVI Engine (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  cropHealthAi:
    enabled: false
    name: crop-health-ai
    package: professional
    image:
      repository: crop-health-ai
      tag: "15.3.2"
    port: 8128
    targetPort: 8128
    replicaCount: 2
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 500m
        memory: 2Gi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 4
      targetCPUUtilization: 75
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for Crop Health AI (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  irrigationSmart:
    enabled: false
    name: irrigation-smart
    package: professional
    image:
      repository: irrigation-smart
      tag: "15.3.2"
    port: 8094
    targetPort: 8094
    replicaCount: 1
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    autoscaling:
      enabled: false
    # VPA Configuration for Irrigation Smart (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  virtualSensors:
    enabled: false
    name: virtual-sensors
    package: professional
    image:
      repository: virtual-sensors
      tag: "15.3.2"
    port: 8119
    targetPort: 8119
    replicaCount: 1
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    autoscaling:
      enabled: false
    # VPA Configuration for Virtual Sensors (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  yieldEngine:
    enabled: false
    name: yield-engine
    package: professional
    image:
      repository: yield-engine
      tag: "15.3.2"
    port: 8098
    targetPort: 8098
    replicaCount: 1
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 200m
        memory: 512Mi
    autoscaling:
      enabled: false
    # VPA Configuration for Yield Engine (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  fertilizerAdvisor:
    enabled: false
    name: fertilizer-advisor
    package: professional
    image:
      repository: fertilizer-advisor
      tag: "15.3.2"
    port: 8127
    targetPort: 8127
    replicaCount: 1
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    autoscaling:
      enabled: false
    # VPA Configuration for Fertilizer Advisor (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  inventoryService:
    enabled: false
    name: inventory-service
    package: professional
    image:
      repository: inventory-service
      tag: "15.3.2"
    port: 8116
    targetPort: 8116
    replicaCount: 2
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 200m
        memory: 512Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 4
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for Inventory Service (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ¢ ENTERPRISE PACKAGE - Advanced Services
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  aiAdvisor:
    enabled: false  # Enable when packageTier == enterprise
    name: ai-advisor
    package: enterprise
    image:
      repository: ai-advisor
      tag: "15.3.2"
    port: 8112
    targetPort: 8112
    replicaCount: 2
    resources:
      limits:
        cpu: 4000m
        memory: 8Gi
      requests:
        cpu: 1000m
        memory: 4Gi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 6
      targetCPUUtilization: 75
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for AI Advisor (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  iotGateway:
    enabled: false
    name: iot-gateway
    package: enterprise
    image:
      repository: iot-gateway
      tag: "15.3.2"
    port: 8106
    targetPort: 8106
    replicaCount: 2
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 512Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 8
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for IoT Gateway (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  researchCore:
    enabled: false
    name: research-core
    package: enterprise
    image:
      repository: research-core
      tag: "15.3.2"
    port: 3015
    targetPort: 3015
    replicaCount: 1
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 250m
        memory: 1Gi
    autoscaling:
      enabled: false
    # VPA Configuration for Research Core (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  marketplaceService:
    enabled: false
    name: marketplace-service
    package: enterprise
    image:
      repository: marketplace-service
      tag: "15.3.2"
    port: 3010
    targetPort: 3010
    replicaCount: 2
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 512Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 6
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for Marketplace Service (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  billingCore:
    enabled: false
    name: billing-core
    package: enterprise
    image:
      repository: billing-core
      tag: "15.3.2"
    port: 8089
    targetPort: 8089
    replicaCount: 2
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 512Mi
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 4
      targetCPUUtilization: 70
    pdb:
      enabled: true
      minAvailable: 1
    # VPA Configuration for Billing Core (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  disasterAssessment:
    enabled: false
    name: disaster-assessment
    package: enterprise
    image:
      repository: disaster-assessment
      tag: "15.3.2"
    port: 3020
    targetPort: 3020
    replicaCount: 1
    resources:
      limits:
        cpu: 2000m
        memory: 2Gi
      requests:
        cpu: 500m
        memory: 1Gi
    autoscaling:
      enabled: false
    # VPA Configuration for Disaster Assessment (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  cropGrowthModel:
    enabled: false
    name: crop-growth-model
    package: enterprise
    image:
      repository: crop-growth-model
      tag: "15.3.2"
    port: 3023
    targetPort: 3023
    replicaCount: 1
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 500m
        memory: 2Gi
    autoscaling:
      enabled: false
    # VPA Configuration for Crop Growth Model (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  laiEstimation:
    enabled: false
    name: lai-estimation
    package: enterprise
    image:
      repository: lai-estimation
      tag: "15.3.2"
    port: 3022
    targetPort: 3022
    replicaCount: 1
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 250m
        memory: 1Gi
    autoscaling:
      enabled: false
    # VPA Configuration for LAI Estimation (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # DEPRECATED SERVICES (kept for backward compatibility)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  fieldOps:
    enabled: false  # DEPRECATED: Use fieldCore instead
    name: field-ops
    package: starter
    image:
      repository: field-ops
      tag: "15.3.2"
    port: 8080
    targetPort: 8080
    replicaCount: 1
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    autoscaling:
      enabled: false
    pdb:
      enabled: false
    # VPA Configuration for Field Ops (Database-connected service)
    # "Initial" mode - Safe for services with persistent database connections
    vpa:
      enabled: true
      updateMode: "Initial"  # Only update on pod creation
      controlledValues: "RequestsAndLimits"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ingress Configuration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
  hosts:
    - host: api.sahool.ag
      paths:
        # Starter Package Routes
        - path: /api/v1/fields
          pathType: Prefix
          service: field-core
          port: 3001
        - path: /api/v1/weather
          pathType: Prefix
          service: weather-core
          port: 8108
        - path: /api/v1/calendar
          pathType: Prefix
          service: astronomical-calendar
          port: 8111
        - path: /api/v1/advisory
          pathType: Prefix
          service: agro-advisor
          port: 8105
        - path: /api/v1/notifications
          pathType: Prefix
          service: notification-service
          port: 8000
        - path: /api/v1/users
          pathType: Prefix
          service: user-service
          port: 3000
        - path: /api/v1/field-management
          pathType: Prefix
          service: field-management-service
          port: 3000
        # Professional Package Routes
        - path: /api/v1/satellite
          pathType: Prefix
          service: satellite-service
          port: 8125
        - path: /api/v1/ndvi
          pathType: Prefix
          service: ndvi-engine
          port: 8107
        - path: /api/v1/crop-health
          pathType: Prefix
          service: crop-health-ai
          port: 8128
        - path: /api/v1/inventory
          pathType: Prefix
          service: inventory-service
          port: 8116
        # Enterprise Package Routes
        - path: /api/v1/ai-advisor
          pathType: Prefix
          service: ai-advisor
          port: 8112
        - path: /api/v1/iot
          pathType: Prefix
          service: iot-gateway
          port: 8106
        - path: /api/v1/marketplace
          pathType: Prefix
          service: marketplace-service
          port: 3010
        - path: /api/v1/billing
          pathType: Prefix
          service: billing-core
          port: 8089
  tls:
    - secretName: sahool-tls-prod
      hosts:
        - api.sahool.ag

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Network Policies
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: sahool
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: sahool
      ports:
        - protocol: TCP
          port: 8080
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 5432  # PostgreSQL
        - protocol: TCP
          port: 6379  # Redis
        - protocol: TCP
          port: 4222  # NATS
        - protocol: TCP
          port: 53    # DNS TCP
        - protocol: UDP
          port: 53    # DNS UDP

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Security Configuration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

security:
  jwt:
    algorithm: HS256
    issuer: sahool-platform
    audience: sahool-api
    accessExpireMinutes: 30
    refreshExpireDays: 7
    existingSecret: "sahool-jwt-secret"

  rbac:
    enabled: true
    rules:
      - apiGroups: [""]
        resources: ["pods", "services", "configmaps"]
        verbs: ["get", "list", "watch"]

  podSecurityPolicy:
    enabled: false

  mtls:
    enabled: false

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Monitoring & Observability
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

monitoring:
  enabled: false
  prometheus:
    enabled: false
    scrapeInterval: 30s
    retention: 15d
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 500m
        memory: 2Gi
  grafana:
    enabled: false
    adminPassword: ""  # Set via secret
    persistence:
      enabled: true
      size: 5Gi
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Vertical Pod Autoscaler (VPA)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

vpa:
  enabled: true
  # Update mode: "Off", "Initial", "Recreate", or "Auto"
  # - Off: Only provides recommendations, doesn't update pods
  # - Initial: Only applies recommendations when pods are created
  # - Recreate: Updates running pods by evicting and recreating them
  # - Auto: Same as Recreate, automatically updates running pods
  # SECURITY: Default is "Initial" for safety. Stateful services use "Off"
  updateMode: "Initial"
  # controlledValues: "RequestsAndLimits" or "RequestsOnly"
  # Determines whether VPA updates both requests and limits or only requests
  controlledValues: "RequestsAndLimits"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Configuration Management
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

configMap:
  # Common environment variables for all services
  commonEnv:
    LOG_LEVEL: "info"
    NODE_ENV: "production"
    TZ: "Asia/Riyadh"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Secrets Configuration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

secrets:
  # External secrets to be created manually or via External Secrets Operator
  externalSecrets:
    - sahool-postgresql-secret
    - sahool-redis-secret
    - sahool-jwt-secret
    - sahool-tls-prod
    - sahool-api-keys

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Feature Flags
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

features:
  enableSecurity: true
  enableAuditLogging: true
  enableRateLimiting: true
  enableMetrics: true
  enableTracing: false
  enableCaching: true

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Backup & Disaster Recovery
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

backup:
  enabled: false
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 30  # days
  storageClass: "standard"
  size: 50Gi
