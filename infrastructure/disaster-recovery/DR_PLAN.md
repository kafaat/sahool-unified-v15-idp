# ๐ก๏ธ ุฎุทุฉ ุงูุชุนุงูู ูู ุงูููุงุฑุซ - ููุตุฉ ุณููู
# Disaster Recovery Plan - Sahool Platform

## ๐ ููุฎุต ุชูููุฐู / Executive Summary

ูุฐู ุงูุฎุทุฉ ุชุญุฏุฏ ุฅุฌุฑุงุกุงุช ุงูุชุนุงูู ูู ุงูููุงุฑุซ ูููุตุฉ ุณููู ููุฐูุงุก ุงูุฒุฑุงุนู.

| ุงููููุงุณ | ุงููุฏู |
|---------|-------|
| **RTO** (Recovery Time Objective) | < 4 ุณุงุนุงุช |
| **RPO** (Recovery Point Objective) | < 15 ุฏูููุฉ |
| **ุงูุชูุงูุฑ ุงููุณุชูุฏู** | 99.9% |

---

## ๐๏ธ ุงูุจููุฉ ุงูุชุญุชูุฉ / Architecture

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        Global Load Balancer                      โ
โ                      (AWS Route 53 + CloudFront)                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
          โโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโ
          โ                               โ
          โผ                               โผ
โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ
โ   Primary Region    โ         โ  Secondary Region   โ
โ     (ุงูุฑูุงุถ)        โ         โ      (ุฌุฏุฉ)          โ
โ   me-south-1        โโโโโโโโโโบโ   me-south-1b       โ
โ                     โ Replication                   โ
โ  โโโโโโโโโโโโโโโโโ  โ         โ  โโโโโโโโโโโโโโโโโ  โ
โ  โ EKS Cluster   โ  โ         โ  โ EKS Cluster   โ  โ
โ  โ (Active)      โ  โ         โ  โ (Standby)     โ  โ
โ  โโโโโโโโโโโโโโโโโ  โ         โ  โโโโโโโโโโโโโโโโโ  โ
โ                     โ         โ                     โ
โ  โโโโโโโโโโโโโโโโโ  โ         โ  โโโโโโโโโโโโโโโโโ  โ
โ  โ RDS Primary   โโโโผโโโโโโโโโบโ  โ RDS Replica   โ  โ
โ  โ (PostgreSQL)  โ  โ Async   โ  โ (Read-only)   โ  โ
โ  โโโโโโโโโโโโโโโโโ  โ         โ  โโโโโโโโโโโโโโโโโ  โ
โ                     โ         โ                     โ
โ  โโโโโโโโโโโโโโโโโ  โ         โ  โโโโโโโโโโโโโโโโโ  โ
โ  โ S3 Bucket     โโโโผโโโโโโโโโบโ  โ S3 Bucket     โ  โ
โ  โ (Primary)     โ  โ CRR     โ  โ (Replica)     โ  โ
โ  โโโโโโโโโโโโโโโโโ  โ         โ  โโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐จ ุณููุงุฑูููุงุช ุงูููุงุฑุซ / Disaster Scenarios

### ุงููุณุชูู 1: ูุดู ุฎุฏูุฉ ูุงุญุฏุฉ (Service Failure)
- **ุงูุชุฃุซูุฑ**: ุฎุฏูุฉ ูุงุญุฏุฉ ุบูุฑ ูุชุงุญุฉ
- **RTO**: < 5 ุฏูุงุฆู
- **ุงูุฅุฌุฑุงุก**: ุฅุนุงุฏุฉ ุชุดุบูู ุชููุงุฆู ุนุจุฑ Kubernetes

### ุงููุณุชูู 2: ูุดู ููุทูุฉ ุชูุงูุฑ (AZ Failure)
- **ุงูุชุฃุซูุฑ**: ุฌุฒุก ูู ุงูุจููุฉ ุบูุฑ ูุชุงุญ
- **RTO**: < 15 ุฏูููุฉ
- **ุงูุฅุฌุฑุงุก**: ุชุจุฏูู ุชููุงุฆู ูููุทูุฉ ุฃุฎุฑู

### ุงููุณุชูู 3: ูุดู ุงูููุทูุฉ ุงูุฑุฆูุณูุฉ (Region Failure)
- **ุงูุชุฃุซูุฑ**: ุงูููุทูุฉ ุจุฃููููุง ุบูุฑ ูุชุงุญุฉ
- **RTO**: < 4 ุณุงุนุงุช
- **ุงูุฅุฌุฑุงุก**: ุชูุนูู ุงูููุทูุฉ ุงูุซุงูููุฉ

### ุงููุณุชูู 4: ูุงุฑุซุฉ ูุงููุฉ (Complete Disaster)
- **ุงูุชุฃุซูุฑ**: ููุฏุงู ุงูุจูุงูุงุช ุฃู ุงููุฌูุงุช
- **RTO**: < 24 ุณุงุนุฉ
- **ุงูุฅุฌุฑุงุก**: ุงุณุชุนุงุฏุฉ ูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ

---

## ๐ฆ ุฅุฌุฑุงุกุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู / Backup Procedures

### ูุงุนุฏุฉ ุงูุจูุงูุงุช (PostgreSQL)
```bash
# ูุณุฎ ุงุญุชูุงุทู ูููู ุชููุงุฆู
# Automated daily backup
0 2 * * * /scripts/backup/pg_backup.sh

# ุงุญุชูุงุธ: 30 ููู
# Retention: 30 days
```

### ุตูุฑ ุงูุฃููุงุฑ ุงูุตูุงุนูุฉ (S3)
- **CRR** (Cross-Region Replication) ููุนูู
- ูุณุฎ ุชููุงุฆู ูู ุงูุฑูุงุถ ุฅูู ุฌุฏุฉ
- ุงุญุชูุงุธ: 90 ููู ููุจูุงูุงุช ุงูุฎุงู

### Kubernetes Resources
```bash
# ูุณุฎ ุงุญุชูุงุทู ูููู ุจุงุณุชุฎุฏุงู Velero
velero backup create daily-backup --include-namespaces sahool
```

---

## ๐ ุฅุฌุฑุงุกุงุช ุงูุชุนุงูู / Recovery Procedures

### 1. ูุดู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Failover)

```bash
# ุงูุฎุทูุฉ 1: ุงูุชุญูู ูู ุญุงูุฉ RDS
aws rds describe-db-instances --db-instance-identifier sahool-primary

# ุงูุฎุทูุฉ 2: ุชุฑููุฉ ุงููุณุฎุฉ ุงููุชูุงุซูุฉ
aws rds promote-read-replica --db-instance-identifier sahool-replica-jeddah

# ุงูุฎุทูุฉ 3: ุชุญุฏูุซ ุงุชุตุงู ุงูุชุทุจููุงุช
kubectl set env deployment --all DATABASE_HOST=sahool-replica-jeddah.xxxxx.me-south-1.rds.amazonaws.com
```

### 2. ูุดู ุงูููุทูุฉ (Region Failover)

```bash
#!/bin/bash
# region-failover.sh

echo "๐จ ุจุฏุก ุนูููุฉ ุงูุชุจุฏูู ููููุทูุฉ ุงูุซุงูููุฉ..."

# 1. ุชุญุฏูุซ Route 53
aws route53 change-resource-record-sets \
  --hosted-zone-id $HOSTED_ZONE_ID \
  --change-batch file://failover-dns.json

# 2. ุชุฑููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
aws rds promote-read-replica \
  --db-instance-identifier sahool-replica-jeddah

# 3. ุชูุดูุท EKS ูู ุงูููุทูุฉ ุงูุซุงูููุฉ
kubectl config use-context sahool-jeddah
kubectl scale deployment --all --replicas=2 -n sahool

# 4. ุงูุชุญูู ูู ุงูุตุญุฉ
./scripts/health-check.sh

echo "โ ุชู ุงูุชุจุฏูู ุจูุฌุงุญ"
```

### 3. ุงุณุชุนุงุฏุฉ ูู ุงููุณุฎ ุงูุงุญุชูุงุทู (Restore from Backup)

```bash
#!/bin/bash
# restore-from-backup.sh

# 1. ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
aws rds restore-db-instance-from-db-snapshot \
  --db-instance-identifier sahool-restored \
  --db-snapshot-identifier sahool-daily-$(date +%Y%m%d)

# 2. ุงุณุชุนุงุฏุฉ Kubernetes
velero restore create --from-backup daily-backup

# 3. ุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช ูู S3
aws s3 sync s3://sahool-backup-jeddah s3://sahool-satellite-imagery-riyadh
```

---

## ๐ ุฌูุงุช ุงูุงุชุตุงู / Contact List

| ุงูุฏูุฑ | ุงูุงุณู | ุงููุงุชู | ุงูุจุฑูุฏ |
|-------|-------|--------|--------|
| **ูุฏูุฑ ุงูุทูุงุฑุฆ** | - | - | emergency@sahool.sa |
| **ูุฑูู DevOps** | - | - | devops@sahool.sa |
| **ูุฑูู ุงูุฃูู** | - | - | security@sahool.sa |
| **AWS Support** | - | Premium Support | - |

---

## โ ูุงุฆูุฉ ุงูุชุญูู / Checklist

### ูุจู ุงููุงุฑุซุฉ (Prevention)
- [ ] ุงุฎุชุจุงุฑ ุงููุณุฎ ุงูุงุญุชูุงุทู ุดูุฑูุงู
- [ ] ุงุฎุชุจุงุฑ ุงูุชุจุฏูู ุฑุจุน ุณูููุงู
- [ ] ุชุญุฏูุซ ุฅุฌุฑุงุกุงุช ุงูุชุนุงูู
- [ ] ุชุฏุฑูุจ ุงููุฑูู

### ุฃุซูุงุก ุงููุงุฑุซุฉ (Response)
- [ ] ุชุญุฏูุฏ ููุน ุงููุงุฑุซุฉ
- [ ] ุฅุฎุทุงุฑ ุงููุฑูู ุงููุนูู
- [ ] ุชูููุฐ ุฅุฌุฑุงุกุงุช ุงูุชุนุงูู
- [ ] ูุฑุงูุจุฉ ุงูุชูุฏู

### ุจุนุฏ ุงููุงุฑุซุฉ (Recovery)
- [ ] ุงูุชุญูู ูู ุงุณุชุนุงุฏุฉ ุงูุฎุฏูุงุช
- [ ] ุชุญููู ุงูุณุจุจ ุงูุฌุฐุฑู
- [ ] ุชุญุฏูุซ ุงูุฎุทุฉ
- [ ] ุชูุซูู ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

---

## ๐งช ุฌุฏูู ุงูุงุฎุชุจุงุฑุงุช / Test Schedule

| ุงูุงุฎุชุจุงุฑ | ุงูุชูุฑุงุฑ | ุขุฎุฑ ุงุฎุชุจุงุฑ | ุงููุงุฏู |
|----------|---------|------------|--------|
| ุงุณุชุนุงุฏุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู | ุดูุฑู | - | - |
| ุชุจุฏูู ุงูููุทูุฉ | ุฑุจุน ุณููู | - | - |
| ุชูุฑูู ูุงูู | ุณููู | - | - |

---

## ๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก / KPIs

- **MTTR** (Mean Time to Recovery): < 2 ุณุงุนุฉ
- **MTBF** (Mean Time Between Failures): > 90 ููู
- **ูุฌุงุญ ุงูุงุฎุชุจุงุฑุงุช**: > 95%
- **ุงูุชูุงู ุงููุณุฎ ุงูุงุญุชูุงุทู**: 100%
