# ============================================================================
# NOTE: This file mirrors /infra/kong/kong.yml
# The canonical configuration is in /infra/kong/kong.yml
# Last synced: 2026-01-06 - Added 17 missing service routes
# ============================================================================

_format_version: "3.0"
_transform: true

# ============================================================================
# تكوين Kong API Gateway لمنصة سهول الزراعية
# SAHOOL Platform Kong API Gateway Configuration
# ============================================================================
# يوفر هذا التكوين:
# - إدارة جميع الخدمات الـ 39 المصغرة
# - تحديد المعدل حسب باقة الاشتراك
# - مصادقة JWT
# - التحكم في الوصول ACL
# - فحوصات الصحة
# ============================================================================

# ============================================================================
# الخوادم النهائية - Upstreams
# ============================================================================

upstreams:
  - name: field-management-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: field-management-service:3000
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: weather-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: weather-service:8092
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: vegetation-analysis-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: vegetation-analysis-service:8090
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: ai-advisor-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: ai-advisor:8112
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: crop-intelligence-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: crop-intelligence-service:8095
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: advisory-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: advisory-service:8093
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: iot-gateway-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: iot-gateway:8106
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: iot-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: iot-service:8117
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: virtual-sensors-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: virtual-sensors:8119
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: marketplace-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: marketplace-service:3010
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: billing-core-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: billing-core:8089
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: notification-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: notification-service:8110
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: research-core-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: research-core:3015
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: disaster-assessment-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: disaster-assessment:3020
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: field-intelligence-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: field-intelligence:8120
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: mcp-server-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: mcp-server:8200
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /health
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: code-review-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: code-review-service:8096
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /health
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  # ═══════════════════════════════════════════════════════════════════════════
  # NEW UPSTREAMS - 17 Missing Services
  # ═══════════════════════════════════════════════════════════════════════════

  - name: user-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: user-service:3025
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: agent-registry-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: agent-registry:8150
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: ai-agents-core-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: ai-agents-core:8122
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: globalgap-compliance-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: globalgap-compliance:8153
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: analytics-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: analytics-service:8154
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: reporting-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: reporting-service:8155
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: integration-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: integration-service:8156
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: audit-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: audit-service:8157
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: export-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: export-service:8158
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: import-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: import-service:8159
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: admin-dashboard-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: admin-dashboard:3001
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: monitoring-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: monitoring-service:8160
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: logging-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: logging-service:8161
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: tracing-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: tracing-service:8162
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: cache-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: cache-service:8163
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

  - name: search-service-upstream
    algorithm: round-robin
    slots: 10000
    targets:
      - target: search-service:8164
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /healthz
        healthy:
          interval: 5
          successes: 2
          http_statuses: [200, 201, 204]
        unhealthy:
          interval: 5
          http_failures: 3
          tcp_failures: 3
          timeouts: 3
          http_statuses: [500, 502, 503, 504]
      passive:
        healthy:
          http_statuses: [200, 201, 204]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
          tcp_failures: 3

# ============================================================================
# الخدمات الأساسية - Starter Package Services
# للمزارعين الصغار وملاك الأراضي الجدد
# ============================================================================

services:
  # ============================================================================
  # إدارة الحقول - Field Management
  # ============================================================================
  - name: field-core
    host: field-management-upstream
    tags:
      - starter
      - core
    retries: 3
    connect_timeout: 5000
    write_timeout: 60000
    read_timeout: 60000
    routes:
      - name: field-core-route
        paths:
          - /api/v1/fields
          - /api/v1/field-core
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - PATCH
          - DELETE
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 100
          hour: 5000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: correlation-id
        config:
          header_name: X-Request-ID
          generator: uuid
      - name: request-size-limiting
        config:
          allowed_payload_size: 10

  # ============================================================================
  # خدمة الطقس - Weather Service
  # ============================================================================
  - name: weather-service
    host: weather-service-upstream
    tags:
      - starter
      - weather
    retries: 3
    routes:
      - name: weather-service-route
        paths:
          - /api/v1/weather
        strip_path: false
        methods:
          - GET
          - POST
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 100
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: response-transformer
        config:
          add:
            headers:
              - "X-Service: weather-service"

  # ============================================================================
  # التقويم الفلكي اليمني - Astronomical Calendar
  # ============================================================================
  - name: astronomical-calendar
    url: http://astronomical-calendar:8111
    tags:
      - starter
      - calendar
    routes:
      - name: astronomical-calendar-route
        paths:
          - /api/v1/astronomical
          - /api/v1/calendar
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 100
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة الاستشارات الزراعية - Advisory Service (Unified)
  # Consolidates: agro-advisor (deprecated), fertilizer-advisor (deprecated)
  # المستشار الزراعي - Agricultural Advisory
  # ============================================================================
  - name: advisory-service
    url: http://advisory-service:8093
    tags:
      - starter
      - advisory
    routes:
      - name: advisory-route
        paths:
          - /api/v1/advice
          - /api/v1/advisory
          - /api/v1/agro-advisor  # Legacy path for backwards compatibility
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 100
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة الإشعارات - Notification Service
  # ============================================================================
  - name: notification-service
    url: http://notification-service:8110
    tags:
      - starter
      - notifications
    routes:
      - name: notification-route
        paths:
          - /api/v1/notifications
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 100
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # الخدمات المتوسطة - Professional Package Services
  # للمزارعين المحترفين والتعاونيات
  # ============================================================================

  # ============================================================================
  # خدمة الأقمار الصناعية - Satellite Service
  # ============================================================================
  - name: satellite-service
    host: vegetation-analysis-upstream
    tags:
      - professional
      - satellite
    retries: 3
    connect_timeout: 10000
    write_timeout: 120000
    read_timeout: 120000
    routes:
      - name: satellite-route
        paths:
          - /api/v1/satellite
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          hour: 50000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: request-size-limiting
        config:
          allowed_payload_size: 50

  # ============================================================================
  # محرك NDVI - NDVI Engine
  # ============================================================================
  - name: ndvi-engine
    url: http://ndvi-processor:8118
    tags:
      - professional
      - analytics
    routes:
      - name: ndvi-route
        paths:
          - /api/v1/ndvi
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # الذكاء الاصطناعي لصحة المحاصيل - Crop Health AI
  # ============================================================================
  - name: crop-health-ai
    host: crop-intelligence-upstream
    tags:
      - professional
      - ai
    connect_timeout: 10000
    write_timeout: 120000
    read_timeout: 120000
    routes:
      - name: crop-health-route
        paths:
          - /api/v1/crop-health
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: request-size-limiting
        config:
          allowed_payload_size: 25

  # ============================================================================
  # الري الذكي - Smart Irrigation
  # ============================================================================
  - name: irrigation-smart
    url: http://irrigation-smart:8094
    tags:
      - professional
      - irrigation
    routes:
      - name: irrigation-route
        paths:
          - /api/v1/irrigation
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # المستشعرات الافتراضية - Virtual Sensors (ET0)
  # ============================================================================
  - name: virtual-sensors
    host: virtual-sensors-upstream
    tags:
      - professional
      - sensors
    routes:
      - name: virtual-sensors-route
        paths:
          - /api/v1/sensors/virtual
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # محرك توقع الإنتاجية - Yield Engine
  # ============================================================================
  - name: yield-engine
    url: http://yield-prediction-service:8098
    tags:
      - professional
      - analytics
    routes:
      - name: yield-engine-route
        paths:
          - /api/v1/yield
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # مستشار التسميد - Fertilizer Advisor
  # ============================================================================
  - name: fertilizer-advisor
    host: advisory-service-upstream
    tags:
      - professional
      - advisory
    routes:
      - name: fertilizer-route
        paths:
          - /api/v1/fertilizer
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة المخزون - Inventory Service
  # ============================================================================
  - name: inventory-service
    url: http://inventory-service:8116
    tags:
      - professional
      - inventory
    routes:
      - name: inventory-route
        paths:
          - /api/v1/inventory
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Field Intelligence Service - خدمة ذكاء الحقل
  # ============================================================================
  - name: field-intelligence
    url: http://field-intelligence:8120
    tags:
      - professional
      - intelligence
    routes:
      - name: field-intelligence-route
        paths:
          - /api/v1/field-intelligence
          - /api/v1/intelligence
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # الخدمات المتقدمة - Enterprise Package Services
  # للشركات الزراعية ومراكز البحث
  # ============================================================================

  # ============================================================================
  # المستشار الذكي متعدد الوكلاء - AI Advisor
  # ============================================================================
  - name: ai-advisor
    host: ai-advisor-upstream
    tags:
      - enterprise
      - ai
    connect_timeout: 15000
    write_timeout: 180000
    read_timeout: 180000
    routes:
      - name: ai-advisor-route
        paths:
          - /api/v1/ai-advisor
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 10000
          hour: 500000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: request-size-limiting
        config:
          allowed_payload_size: 50

  # ============================================================================
  # بوابة إنترنت الأشياء - IoT Gateway
  # ============================================================================
  - name: iot-gateway
    host: iot-gateway-upstream
    tags:
      - enterprise
      - iot
    routes:
      - name: iot-gateway-route
        paths:
          - /api/v1/iot
          - /api/v1/agro-rules
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: ip-restriction
        config:
          allow:
            - 10.0.0.0/8
            - 172.16.0.0/12
            - 192.168.0.0/16

  # ============================================================================
  # إدارة الأبحاث - Research Core
  # ============================================================================
  - name: research-core
    url: http://research-core:3015
    tags:
      - enterprise
      - research
    routes:
      - name: research-route
        paths:
          - /api/v1/research
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: ip-restriction
        config:
          allow:
            - 10.0.0.0/8
            - 172.16.0.0/12
            - 192.168.0.0/16

  # ============================================================================
  # السوق الزراعي - Marketplace Service
  # ============================================================================
  - name: marketplace-service
    url: http://marketplace-service:3010
    tags:
      - enterprise
      - marketplace
    routes:
      - name: marketplace-route
        paths:
          - /api/v1/marketplace
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: ip-restriction
        config:
          allow:
            - 10.0.0.0/8
            - 172.16.0.0/12
            - 192.168.0.0/16

  # ============================================================================
  # الفوترة والمدفوعات - Billing Core
  # ============================================================================
  - name: billing-core
    url: http://billing-core:8089
    tags:
      - enterprise
      - billing
    routes:
      - name: billing-route
        paths:
          - /api/v1/billing
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: ip-restriction
        config:
          allow:
            - 10.0.0.0/8
            - 172.16.0.0/12
            - 192.168.0.0/16

  # ============================================================================
  # تقييم الكوارث - Disaster Assessment
  # ============================================================================
  - name: disaster-assessment
    url: http://disaster-assessment:3020
    tags:
      - enterprise
      - disaster
    routes:
      - name: disaster-route
        paths:
          - /api/v1/disaster
          - /api/v1/disasters
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: ip-restriction
        config:
          allow:
            - 10.0.0.0/8
            - 172.16.0.0/12
            - 192.168.0.0/16

  # ============================================================================
  # نماذج نمو المحاصيل - Crop Growth Model (WOFOST)
  # ============================================================================
  - name: crop-growth-model
    url: http://crop-growth-model:3023
    tags:
      - enterprise
      - modeling
    connect_timeout: 15000
    write_timeout: 180000
    read_timeout: 180000
    routes:
      - name: crop-model-route
        paths:
          - /api/v1/crop-model
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # تقدير مؤشر مساحة الورق - LAI Estimation
  # ============================================================================
  - name: lai-estimation
    url: http://lai-estimation:3022
    tags:
      - enterprise
      - analytics
    routes:
      - name: lai-route
        paths:
          - /api/v1/lai
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمات إضافية - Additional Services
  # ============================================================================

  # ============================================================================
  # عمليات الحقول - Field Operations
  # ============================================================================
  - name: field-ops
    url: http://field-management-service:3000
    tags:
      - shared
      - operations
    routes:
      - name: field-ops-route
        paths:
          - /api/v1/field-ops
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # بوابة WebSocket - WebSocket Gateway
  # ============================================================================
  - name: ws-gateway
    url: http://ws-gateway:8081
    tags:
      - shared
      - websocket
    routes:
      - name: ws-gateway-route
        paths:
          - /api/v1/ws
        strip_path: false
        protocols:
          - http
          - https
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 5000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة المؤشرات - Indicators Service
  # ============================================================================
  - name: indicators-service
    url: http://indicators-service:8091
    tags:
      - shared
      - analytics
    routes:
      - name: indicators-route
        paths:
          - /api/v1/indicators
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # الطقس المتقدم - Advanced Weather (Consolidated into weather-service)
  # ============================================================================
  - name: weather-advanced
    url: http://weather-service:8092
    tags:
      - professional
      - weather
    routes:
      - name: weather-advanced-route
        paths:
          - /api/v1/weather/advanced
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # محادثة المجتمع - Community Chat
  # ============================================================================
  - name: community-chat
    url: http://community-chat:8097
    tags:
      - shared
      - social
    routes:
      - name: community-chat-route
        paths:
          - /api/v1/community/chat
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 2000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # محادثة الحقل - Field Chat
  # ============================================================================
  - name: field-chat
    url: http://field-chat:8099
    tags:
      - shared
      - social
    routes:
      - name: field-chat-route
        paths:
          - /api/v1/field/chat
          - /api/v1/field-chat
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 2000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة المعدات - Equipment Service
  # ============================================================================
  - name: equipment-service
    url: http://equipment-service:8101
    tags:
      - professional
      - equipment
    routes:
      - name: equipment-route
        paths:
          - /api/v1/equipment
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة المهام - Task Service
  # ============================================================================
  - name: task-service
    url: http://task-service:8103
    tags:
      - shared
      - tasks
    routes:
      - name: task-route
        paths:
          - /api/v1/tasks
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # تكوين المزودين - Provider Config
  # ============================================================================
  - name: provider-config
    url: http://provider-config:8104
    tags:
      - shared
      - config
    routes:
      - name: provider-config-route
        paths:
          - /api/v1/providers
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 500
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # لوحة التحكم - Admin Dashboard
  # ============================================================================
  # TODO: Admin dashboard service needs to be created
  # خدمة لوحة التحكم تحتاج للإنشاء
  # - name: admin-dashboard
  #   url: http://admin-dashboard:3001
  #   tags:
  #     - admin
  #     - dashboard
  #   routes:
  #     - name: admin-route
  #       paths:
  #         - /api/v1/admin
  #       strip_path: false
  #   plugins:
  #     - name: jwt
  #     - name: acl
  #       config:
  #         allow:
  #           - admin-users
  #     - name: rate-limiting
  #       config:
  #         minute: 5000
  #         policy: redis
  #         redis_host: redis
  #         redis_port: 6379
  #         redis_password: ${REDIS_PASSWORD}
  #         redis_database: 1
  #         redis_timeout: 2000
  #         fault_tolerant: true
  #     - name: ip-restriction
  #       config:
  #         allow:
  #           - 10.0.0.0/8
  #           - 172.16.0.0/12
  #           - 192.168.0.0/16

  # ============================================================================
  # توقع الإنتاجية - Yield Prediction
  # ============================================================================
  - name: yield-prediction
    url: http://yield-prediction:3021
    tags:
      - enterprise
      - analytics
    routes:
      - name: yield-prediction-route
        paths:
          - /api/v1/yield-prediction
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة التنبيهات - Alert Service
  # ============================================================================
  - name: alert-service
    url: http://alert-service:8113
    tags:
      - shared
      - alerts
    routes:
      - name: alert-route
        paths:
          - /api/v1/alerts
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة المحادثة - Chat Service
  # ============================================================================
  - name: chat-service
    url: http://chat-service:8114
    tags:
      - shared
      - chat
    routes:
      - name: chat-service-route
        paths:
          - /api/v1/chat
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 2000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة الحقول - Field Service
  # ============================================================================
  - name: field-service
    url: http://field-management-service:3000
    tags:
      - shared
      - fields
    routes:
      - name: field-service-route
        paths:
          - /api/v1/field-service
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # خدمة IoT - IoT Service
  # ============================================================================
  - name: iot-service
    host: iot-service-upstream
    tags:
      - enterprise
      - iot
    routes:
      - name: iot-service-route
        paths:
          - /api/v1/iot-service
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # معالج NDVI - NDVI Processor
  # ============================================================================
  - name: ndvi-processor
    url: http://ndvi-processor:8118
    tags:
      - professional
      - analytics
    routes:
      - name: ndvi-processor-route
        paths:
          - /api/v1/ndvi-processor
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # MCP Server - Model Context Protocol Integration
  # خادم بروتوكول سياق النموذج - تكامل مع مساعدي الذكاء الاصطناعي
  # ============================================================================
  - name: mcp-server
    host: mcp-server-upstream
    tags:
      - shared
      - integration
      - ai
    routes:
      - name: mcp-server-route
        paths:
          - /api/v1/mcp
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 1000
          hour: 50000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Code Review Service - AI-Powered Code Analysis
  # خدمة مراجعة الكود - تحليل الكود بالذكاء الاصطناعي
  # ============================================================================
  - name: code-review-service
    host: code-review-upstream
    tags:
      - shared
      - development
      - ai
    routes:
      - name: code-review-route
        paths:
          - /api/v1/code-review
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 500
          hour: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ═══════════════════════════════════════════════════════════════════════════
  # NEW SERVICES - 17 Missing Routes Added
  # ═══════════════════════════════════════════════════════════════════════════

  # ============================================================================
  # User Service - Authentication and User Management (CRITICAL)
  # خدمة المستخدمين - المصادقة وإدارة المستخدمين
  # ============================================================================
  - name: user-service
    host: user-service-upstream
    tags:
      - critical
      - auth
      - users
    retries: 3
    connect_timeout: 5000
    write_timeout: 60000
    read_timeout: 60000
    routes:
      - name: user-service-route
        paths:
          - /api/v1/users
          - /api/v1/auth
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - PATCH
          - DELETE
    plugins:
      # SECURITY FIX: JWT authentication is required for user management
      # Note: /api/v1/auth endpoints handle their own authentication internally
      # The user-service validates tokens server-side for auth endpoints
      - name: jwt
        config:
          # Auth endpoints (/api/v1/auth/*) are excluded from JWT check at the service level
          # as they need to be accessible for login/register operations
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
            - admin-users
      - name: rate-limiting
        config:
          minute: 2000
          hour: 100000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: correlation-id
        config:
          header_name: X-Request-ID
          generator: uuid
      - name: request-size-limiting
        config:
          allowed_payload_size: 5

  # ============================================================================
  # Agent Registry - AI Agent Management
  # سجل الوكلاء - إدارة وكلاء الذكاء الاصطناعي
  # ============================================================================
  - name: agent-registry
    host: agent-registry-upstream
    tags:
      - professional
      - ai
      - agents
    routes:
      - name: agent-registry-route
        paths:
          - /api/v1/agents
          - /api/v1/agent-registry
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # AI Agents Core - Multi-Agent Orchestration
  # نواة وكلاء الذكاء الاصطناعي - تنسيق الوكلاء المتعددين
  # ============================================================================
  - name: ai-agents-core
    host: ai-agents-core-upstream
    tags:
      - enterprise
      - ai
      - orchestration
    connect_timeout: 15000
    write_timeout: 180000
    read_timeout: 180000
    routes:
      - name: ai-agents-core-route
        paths:
          - /api/v1/ai-agents
          - /api/v1/orchestration
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 5000
          hour: 250000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: request-size-limiting
        config:
          allowed_payload_size: 50

  # ============================================================================
  # GlobalGAP Compliance - Agricultural Compliance Tracking
  # الامتثال لـ GlobalGAP - تتبع الامتثال الزراعي
  # ============================================================================
  - name: globalgap-compliance
    host: globalgap-compliance-upstream
    tags:
      - professional
      - compliance
      - globalgap
    routes:
      - name: globalgap-route
        paths:
          - /api/v1/compliance
          - /api/v1/globalgap
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Crop Intelligence Service - Direct Access
  # خدمة ذكاء المحاصيل - وصول مباشر
  # ============================================================================
  - name: crop-intelligence-direct
    host: crop-intelligence-upstream
    tags:
      - professional
      - ai
      - crops
    routes:
      - name: crop-intelligence-route
        paths:
          - /api/v1/crop-intelligence
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Vegetation Analysis Service - Direct Access
  # خدمة تحليل الغطاء النباتي - وصول مباشر
  # ============================================================================
  - name: vegetation-analysis-direct
    host: vegetation-analysis-upstream
    tags:
      - professional
      - satellite
      - analysis
    routes:
      - name: vegetation-analysis-route
        paths:
          - /api/v1/vegetation
          - /api/v1/vegetation-analysis
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Field Management Service - Direct Access
  # خدمة إدارة الحقول - وصول مباشر
  # ============================================================================
  - name: field-management-direct
    host: field-management-upstream
    tags:
      - starter
      - fields
      - management
    routes:
      - name: field-management-route
        paths:
          - /api/v1/field-management
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Analytics Service - Platform Analytics
  # خدمة التحليلات - تحليلات المنصة
  # ============================================================================
  - name: analytics-service
    host: analytics-service-upstream
    tags:
      - enterprise
      - analytics
    routes:
      - name: analytics-route
        paths:
          - /api/v1/analytics
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
            - research-users
      - name: rate-limiting
        config:
          minute: 5000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Reporting Service - Report Generation
  # خدمة التقارير - إنشاء التقارير
  # ============================================================================
  - name: reporting-service
    host: reporting-service-upstream
    tags:
      - professional
      - reporting
    routes:
      - name: reporting-route
        paths:
          - /api/v1/reports
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 500
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Integration Service - Third-Party Integrations
  # خدمة التكامل - تكامل الجهات الخارجية
  # ============================================================================
  - name: integration-service
    host: integration-service-upstream
    tags:
      - professional
      - integration
    routes:
      - name: integration-route
        paths:
          - /api/v1/integrations
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 1000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Audit Service - System Audit Logs
  # خدمة التدقيق - سجلات تدقيق النظام
  # ============================================================================
  - name: audit-service
    host: audit-service-upstream
    tags:
      - enterprise
      - audit
      - security
    routes:
      - name: audit-route
        paths:
          - /api/v1/audit
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - admin-users
      - name: rate-limiting
        config:
          minute: 2000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: ip-restriction
        config:
          allow:
            - 10.0.0.0/8
            - 172.16.0.0/12
            - 192.168.0.0/16

  # ============================================================================
  # Export Service - Data Export
  # خدمة التصدير - تصدير البيانات
  # ============================================================================
  - name: export-service
    host: export-service-upstream
    tags:
      - professional
      - export
    routes:
      - name: export-route
        paths:
          - /api/v1/export
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 100
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Import Service - Data Import
  # خدمة الاستيراد - استيراد البيانات
  # ============================================================================
  - name: import-service
    host: import-service-upstream
    tags:
      - professional
      - import
    routes:
      - name: import-route
        paths:
          - /api/v1/import
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 100
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: request-size-limiting
        config:
          allowed_payload_size: 100

  # ============================================================================
  # Admin Dashboard - Administration Interface
  # لوحة تحكم المسؤول - واجهة الإدارة
  # ============================================================================
  - name: admin-dashboard
    host: admin-dashboard-upstream
    tags:
      - admin
      - dashboard
    routes:
      - name: admin-route
        paths:
          - /api/v1/admin
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - admin-users
      - name: rate-limiting
        config:
          minute: 5000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true
      - name: ip-restriction
        config:
          allow:
            - 10.0.0.0/8
            - 172.16.0.0/12
            - 192.168.0.0/16

  # ============================================================================
  # Monitoring Service - System Monitoring
  # خدمة المراقبة - مراقبة النظام
  # ============================================================================
  - name: monitoring-service
    host: monitoring-service-upstream
    tags:
      - observability
      - monitoring
    routes:
      - name: monitoring-route
        paths:
          - /api/v1/monitoring
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - admin-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Logging Service - Centralized Logging
  # خدمة السجلات - السجلات المركزية
  # ============================================================================
  - name: logging-service
    host: logging-service-upstream
    tags:
      - observability
      - logging
    routes:
      - name: logging-route
        paths:
          - /api/v1/logs
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - admin-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Tracing Service - Distributed Tracing
  # خدمة التتبع - التتبع الموزع
  # ============================================================================
  - name: tracing-service
    host: tracing-service-upstream
    tags:
      - observability
      - tracing
    routes:
      - name: tracing-route
        paths:
          - /api/v1/tracing
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - enterprise-users
            - admin-users
      - name: rate-limiting
        config:
          minute: 10000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Cache Service - Distributed Caching
  # خدمة التخزين المؤقت - التخزين المؤقت الموزع
  # ============================================================================
  - name: cache-service
    host: cache-service-upstream
    tags:
      - infrastructure
      - cache
    routes:
      - name: cache-route
        paths:
          - /api/v1/cache
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 50000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # Search Service - Full-Text Search
  # خدمة البحث - البحث عن النصوص الكاملة
  # ============================================================================
  - name: search-service
    host: search-service-upstream
    tags:
      - professional
      - search
    routes:
      - name: search-route
        paths:
          - /api/v1/search
        strip_path: false
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
            - sub
            - aud
            - iss
          key_claim_name: iss
          secret_is_base64: false
      - name: acl
        config:
          allow:
            - starter-users
            - professional-users
            - enterprise-users
      - name: rate-limiting
        config:
          minute: 5000
          policy: redis
          redis_host: redis
          redis_port: 6379
          redis_password: ${REDIS_PASSWORD}
          redis_database: 1
          redis_timeout: 2000
          fault_tolerant: true

  # ============================================================================
  # نقاط فحص الصحة - Health Check Endpoints
  # ============================================================================
  - name: health-check
    url: http://kong:8000
    routes:
      - name: health-route
        paths:
          - /health
          - /ping
        strip_path: false
        methods:
          - GET
    plugins:
      - name: request-termination
        config:
          status_code: 200
          message: "SAHOOL Platform is healthy"

# ============================================================================
# الإضافات العامة - Global Plugins
# ============================================================================

plugins:
  # CORS للسماح بالطلبات من المتصفحات
  - name: cors
    config:
      origins:
        - "https://sahool.app"
        - "https://www.sahool.app"
        - "https://admin.sahool.app"
        - "https://api.sahool.app"
        - "https://staging.sahool.app"
        - "http://localhost:3000"
        - "http://localhost:5173"
        - "http://localhost:8080"
      methods:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
        - OPTIONS
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - Authorization
        - X-Auth-Token
      exposed_headers:
        - X-Request-ID
      credentials: true
      max_age: 3600

  # تسجيل الطلبات
  - name: file-log
    config:
      path: /var/log/kong/access.log
      reopen: true

  # Prometheus للمراقبة
  - name: prometheus

  # Security Headers
  - name: response-transformer
    config:
      add:
        headers:
          - "X-Content-Type-Options: nosniff"
          - "X-Frame-Options: DENY"
          - "X-XSS-Protection: 1; mode=block"
          - "Referrer-Policy: strict-origin-when-cross-origin"
          - "Permissions-Policy: geolocation=(), microphone=(), camera=()"
          - "Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://api.sahool.app wss://api.sahool.app"
          - "Strict-Transport-Security: max-age=31536000; includeSubDomains; preload"

  # معرف الطلب
  - name: correlation-id
    config:
      header_name: X-Request-ID
      generator: uuid
      echo_downstream: true

# ============================================================================
# مستهلكو الخدمة - Service Consumers
# ============================================================================

consumers:
  # المستخدمون الأساسيون - Starter Users
  - username: starter-user-sample
    custom_id: starter-001
    tags:
      - starter
    jwt_secrets:
      - key: starter-jwt-key-hs256
        algorithm: HS256
        secret: ${STARTER_JWT_SECRET}
      # RS256 disabled until valid JWT_PUBLIC_KEY is configured
      # - key: starter-jwt-key-rs256
      #   algorithm: RS256
      #   rsa_public_key: ${JWT_PUBLIC_KEY}

  # المستخدمون المحترفون - Professional Users
  - username: professional-user-sample
    custom_id: professional-001
    tags:
      - professional
    jwt_secrets:
      - key: professional-jwt-key-hs256
        algorithm: HS256
        secret: ${PROFESSIONAL_JWT_SECRET}
      # RS256 disabled until valid JWT_PUBLIC_KEY is configured
      # - key: professional-jwt-key-rs256
      #   algorithm: RS256
      #   rsa_public_key: ${JWT_PUBLIC_KEY}

  # المستخدمون المؤسسيون - Enterprise Users
  - username: enterprise-user-sample
    custom_id: enterprise-001
    tags:
      - enterprise
    jwt_secrets:
      - key: enterprise-jwt-key-hs256
        algorithm: HS256
        secret: ${ENTERPRISE_JWT_SECRET}
      # RS256 disabled until valid JWT_PUBLIC_KEY is configured
      # - key: enterprise-jwt-key-rs256
      #   algorithm: RS256
      #   rsa_public_key: ${JWT_PUBLIC_KEY}

  # المستخدمون البحثيون - Research Users
  - username: research-user-sample
    custom_id: research-001
    tags:
      - research
    jwt_secrets:
      - key: research-jwt-key-hs256
        algorithm: HS256
        secret: ${RESEARCH_JWT_SECRET}
      # RS256 disabled until valid JWT_PUBLIC_KEY is configured
      # - key: research-jwt-key-rs256
      #   algorithm: RS256
      #   rsa_public_key: ${JWT_PUBLIC_KEY}

  # المستخدمون المسؤولون - Admin Users
  - username: admin-user-sample
    custom_id: admin-001
    tags:
      - admin
    jwt_secrets:
      - key: admin-jwt-key-hs256
        algorithm: HS256
        secret: ${ADMIN_JWT_SECRET}
      # RS256 disabled until valid JWT_PUBLIC_KEY is configured
      # - key: admin-jwt-key-rs256
      #   algorithm: RS256
      #   rsa_public_key: ${JWT_PUBLIC_KEY}

# ============================================================================
# مجموعات التحكم في الوصول - ACL Groups
# ============================================================================

acls:
  - consumer: starter-user-sample
    group: starter-users
  - consumer: professional-user-sample
    group: professional-users
  - consumer: enterprise-user-sample
    group: enterprise-users
  - consumer: research-user-sample
    group: research-users
  - consumer: admin-user-sample
    group: admin-users

# ============================================================================
# نهاية التكوين
# End of Configuration
# ============================================================================
