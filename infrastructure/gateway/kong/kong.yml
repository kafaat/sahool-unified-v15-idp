_format_version: "3.0"
_transform: true

# ------------------------------------------------------------------------------
# Kong Declarative Config (DB-less)
# Generated from docker-compose.yml
# Fix applied: service.name + service.host (docker DNS) + service.port (internal)
# Only includes services that actually exist in docker-compose.yml
# ------------------------------------------------------------------------------

# Optional: global plugins (applies to all routes/services)
plugins:
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
        - OPTIONS
      headers:
        - Accept
        - Accept-Version
        - Authorization
        - Content-Length
        - Content-Type
        - Date
        - X-Request-Id
      exposed_headers:
        - X-Request-Id
      credentials: true
      max_age: 3600
      preflight_continue: false

  - name: prometheus
    config: {}

# ------------------------------------------------------------------------------
# Services + Routes
# NOTE:
# - host MUST be the docker-compose service key (not container_name)
# - port is the container listen port (your PORT env var)
# - Only services that exist in docker-compose.yml are included
# ------------------------------------------------------------------------------

services:
  # -----------------------------
  # Node.js services
  # -----------------------------
  - name: field-management-service
    host: field-management-service
    port: 3000
    protocol: http
    routes:
      - name: field-management-service-route
        paths: ["/field"]
        strip_path: true
        protocols: ["http", "https"]

  - name: marketplace-service
    host: marketplace-service
    port: 3010
    protocol: http
    routes:
      - name: marketplace-service-route
        paths: ["/marketplace"]
        strip_path: true
        protocols: ["http", "https"]

  - name: research-core
    host: research-core
    port: 3015
    protocol: http
    routes:
      - name: research-core-route
        paths: ["/research"]
        strip_path: true
        protocols: ["http", "https"]

  - name: disaster-assessment
    host: disaster-assessment
    port: 3020
    protocol: http
    routes:
      - name: disaster-assessment-route
        paths: ["/disaster"]
        strip_path: true
        protocols: ["http", "https"]

  # DEPRECATED (still routable if needed)
  - name: yield-prediction
    host: yield-prediction
    port: 3021
    protocol: http
    routes:
      - name: yield-prediction-route
        paths: ["/yield-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  # DEPRECATED (still routable if needed)
  - name: lai-estimation
    host: lai-estimation
    port: 3022
    protocol: http
    routes:
      - name: lai-estimation-route
        paths: ["/lai-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  # DEPRECATED (still routable if needed)
  - name: crop-growth-model
    host: crop-growth-model
    port: 3023
    protocol: http
    routes:
      - name: crop-growth-model-route
        paths: ["/crop-growth-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  - name: chat-service
    host: chat-service
    port: 8114
    protocol: http
    routes:
      - name: chat-service-route
        paths: ["/chat"]
        strip_path: true
        protocols: ["http", "https"]

  - name: iot-service
    host: iot-service
    port: 8117
    protocol: http
    routes:
      - name: iot-service-route
        paths: ["/iot"]
        strip_path: true
        protocols: ["http", "https"]

  # DEPRECATED (still routable if needed)
  - name: community-chat
    host: community-chat
    port: 8097
    protocol: http
    routes:
      - name: community-chat-route
        paths: ["/community-chat-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  # -----------------------------
  # Python services
  # -----------------------------
  # DEPRECATED profile (only runs if profile enabled)
  - name: field-ops
    host: field-ops
    port: 8080
    protocol: http
    routes:
      - name: field-ops-route
        paths: ["/field-ops-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  - name: ws-gateway
    host: ws-gateway
    port: 8081
    protocol: http
    routes:
      - name: ws-gateway-route
        paths: ["/ws"]
        strip_path: true
        protocols: ["http", "https"]

  - name: billing-core
    host: billing-core
    port: 8089
    protocol: http
    routes:
      - name: billing-core-route
        paths: ["/billing"]
        strip_path: true
        protocols: ["http", "https"]

  - name: vegetation-analysis-service
    host: vegetation-analysis-service
    port: 8090
    protocol: http
    routes:
      - name: vegetation-analysis-service-route
        paths: ["/vegetation"]
        strip_path: true
        protocols: ["http", "https"]

  - name: indicators-service
    host: indicators-service
    port: 8091
    protocol: http
    routes:
      - name: indicators-service-route
        paths: ["/indicators"]
        strip_path: true
        protocols: ["http", "https"]

  - name: weather-service
    host: weather-service
    port: 8092
    protocol: http
    routes:
      - name: weather-service-route
        paths: ["/weather"]
        strip_path: true
        protocols: ["http", "https"]

  - name: advisory-service
    host: advisory-service
    port: 8093
    protocol: http
    routes:
      - name: advisory-service-route
        paths: ["/advisory"]
        strip_path: true
        protocols: ["http", "https"]

  - name: irrigation-smart
    host: irrigation-smart
    port: 8094
    protocol: http
    routes:
      - name: irrigation-smart-route
        paths: ["/irrigation"]
        strip_path: true
        protocols: ["http", "https"]

  - name: crop-intelligence-service
    host: crop-intelligence-service
    port: 8095
    protocol: http
    routes:
      - name: crop-intelligence-service-route
        paths: ["/crop"]
        strip_path: true
        protocols: ["http", "https"]

  - name: virtual-sensors
    host: virtual-sensors
    port: 8119
    protocol: http
    routes:
      - name: virtual-sensors-route
        paths: ["/virtual-sensors"]
        strip_path: true
        protocols: ["http", "https"]

  - name: yield-prediction-service
    host: yield-prediction-service
    port: 8098
    protocol: http
    routes:
      - name: yield-prediction-service-route
        paths: ["/yield"]
        strip_path: true
        protocols: ["http", "https"]

  - name: field-chat
    host: field-chat
    port: 8099
    protocol: http
    routes:
      - name: field-chat-route
        paths: ["/field-chat"]
        strip_path: true
        protocols: ["http", "https"]

  - name: equipment-service
    host: equipment-service
    port: 8101
    protocol: http
    routes:
      - name: equipment-service-route
        paths: ["/equipment"]
        strip_path: true
        protocols: ["http", "https"]

  # gpu profile (only if enabled)
  - name: code-review-service
    host: code-review-service
    port: 8102
    protocol: http
    routes:
      - name: code-review-service-route
        paths: ["/code-review"]
        strip_path: true
        protocols: ["http", "https"]

  - name: task-service
    host: task-service
    port: 8103
    protocol: http
    routes:
      - name: task-service-route
        paths: ["/task"]
        strip_path: true
        protocols: ["http", "https"]

  - name: provider-config
    host: provider-config
    port: 8104
    protocol: http
    routes:
      - name: provider-config-route
        paths: ["/provider-config"]
        strip_path: true
        protocols: ["http", "https"]

  # DEPRECATED
  - name: agro-advisor
    host: agro-advisor
    port: 8105
    protocol: http
    routes:
      - name: agro-advisor-route
        paths: ["/agro-advisor-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  - name: iot-gateway
    host: iot-gateway
    port: 8106
    protocol: http
    routes:
      - name: iot-gateway-route
        paths: ["/iot-gateway"]
        strip_path: true
        protocols: ["http", "https"]

  # DEPRECATED
  - name: ndvi-engine
    host: ndvi-engine
    port: 8107
    protocol: http
    routes:
      - name: ndvi-engine-route
        paths: ["/ndvi-engine-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  # DEPRECATED
  - name: weather-core
    host: weather-core
    port: 8108
    protocol: http
    routes:
      - name: weather-core-route
        paths: ["/weather-core-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  - name: notification-service
    host: notification-service
    port: 8110
    protocol: http
    routes:
      - name: notification-service-route
        paths: ["/notification"]
        strip_path: true
        protocols: ["http", "https"]

  - name: astronomical-calendar
    host: astronomical-calendar
    port: 8111
    protocol: http
    routes:
      - name: astronomical-calendar-route
        paths: ["/astronomy"]
        strip_path: true
        protocols: ["http", "https"]

  - name: ai-advisor
    host: ai-advisor
    port: 8112
    protocol: http
    routes:
      - name: ai-advisor-route
        paths: ["/ai-advisor"]
        strip_path: true
        protocols: ["http", "https"]

  - name: alert-service
    host: alert-service
    port: 8113
    protocol: http
    routes:
      - name: alert-service-route
        paths: ["/alerts"]
        strip_path: true
        protocols: ["http", "https"]

  - name: field-service
    host: field-service
    port: 8115
    protocol: http
    routes:
      - name: field-service-route
        paths: ["/field-service-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  - name: inventory-service
    host: inventory-service
    port: 8116
    protocol: http
    routes:
      - name: inventory-service-route
        paths: ["/inventory"]
        strip_path: true
        protocols: ["http", "https"]

  - name: ndvi-processor
    host: ndvi-processor
    port: 8118
    protocol: http
    routes:
      - name: ndvi-processor-route
        paths: ["/ndvi-processor-legacy"]
        strip_path: true
        protocols: ["http", "https"]

  - name: field-intelligence
    host: field-intelligence
    port: 8120
    protocol: http
    routes:
      - name: field-intelligence-route
        paths: ["/field-intelligence"]
        strip_path: true
        protocols: ["http", "https"]

  - name: mcp-server
    host: mcp-server
    port: 8200
    protocol: http
    routes:
      - name: mcp-server-route
        paths: ["/mcp"]
        strip_path: true
        protocols: ["http", "https"]

# ------------------------------------------------------------------------------
# Intentionally NOT added to Kong (non-HTTP APIs / internal infra / workers)
# - postgres, pgbouncer, redis, nats, nats-prometheus-exporter, mqtt, qdrant
# - etcd, etcd-init, minio, milvus
# - agro-rules (worker, no HTTP)
# - demo-data (client, not an API)
# - ollama / ollama-model-loader (only if you want to expose)
# - crop-health (check if it has HTTP endpoints)
# ------------------------------------------------------------------------------
