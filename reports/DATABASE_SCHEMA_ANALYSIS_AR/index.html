
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Complete developer guide for the SAHOOL Agricultural Platform">
      
      
        <meta name="author" content="KAFAAT Team">
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù…Ø®Ø·Ø·Ø§Øª Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù‡Ø¬Ø±Ø§Øª - SAHOOL Developer Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="light-green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SAHOOL Developer Documentation" class="md-header__button md-logo" aria-label="SAHOOL Developer Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SAHOOL Developer Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù…Ø®Ø·Ø·Ø§Øª Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù‡Ø¬Ø±Ø§Øª
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.md" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/installation.md" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../services/overview.md" class="md-tabs__link">
          
  
  
  Services

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/authentication/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../development/setup.md" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contributing/guidelines.md" class="md-tabs__link">
          
  
  
  Contributing

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SAHOOL Developer Documentation" class="md-nav__button md-logo" aria-label="SAHOOL Developer Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    SAHOOL Developer Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/architecture.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/overview.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/starter.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Starter Package
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/professional.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Professional Package
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/enterprise.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Enterprise Package
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/field-ops.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/weather/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weather
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/satellite.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Satellite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/setup.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/testing.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/deployment.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Contributing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/guidelines.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guidelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/code-style.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Style
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="_1">ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù…Ø®Ø·Ø·Ø§Øª Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù‡Ø¬Ø±Ø§Øª<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="v15-idp">Ù…Ù†ØµØ© Ø³Ù‡ÙˆÙ„ Ø§Ù„Ù…ÙˆØ­Ø¯Ø© v15 IDP<a class="headerlink" href="#v15-idp" title="Permanent link">&para;</a></h2>
<p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> 2025-12-24
<strong>Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> Ø¬Ù…ÙŠØ¹ Ù…Ø®Ø·Ø·Ø§Øª Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§Ù„Ù‡Ø¬Ø±Ø§ØªØŒ ÙˆÙ†Ù…Ø§Ø°Ø¬ ORM</p>
<hr />
<h2 id="1">1. Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11-orm">1.1 ØªÙ‚Ù†ÙŠØ§Øª ORM Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©<a class="headerlink" href="#11-orm" title="Permanent link">&para;</a></h3>
<p>ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù†ØµØ© <strong>Ø£Ø±Ø¨Ø¹ ØªÙ‚Ù†ÙŠØ§Øª ORM Ù…Ø®ØªÙ„ÙØ©</strong> ÙÙŠ ÙˆÙ‚Øª ÙˆØ§Ø­Ø¯:</p>
<ol>
<li><strong>Prisma</strong> (TypeScript/Node.js)</li>
<li>Ø®Ø¯Ù…Ø© Field Core: <code>/apps/services/field-core/prisma/schema.prisma</code></li>
<li>Ø®Ø¯Ù…Ø© Research Core: <code>/apps/services/research-core/prisma/schema.prisma</code></li>
<li>
<p>Ø®Ø¯Ù…Ø© Marketplace: <code>/apps/services/marketplace-service/prisma/schema.prisma</code></p>
</li>
<li>
<p><strong>Tortoise ORM</strong> (Python)</p>
</li>
<li>
<p>Ø®Ø¯Ù…Ø© Field Chat: <code>/apps/services/field-chat/src/models.py</code></p>
</li>
<li>
<p><strong>SQLAlchemy</strong> (Python)</p>
</li>
<li>Ù…Ø­Ø±Ùƒ NDVI: <code>/apps/services/ndvi-engine/src/models.py</code></li>
<li>Field Suite: <code>/packages/field_suite/spatial/orm_models.py</code></li>
<li>Ù†Ø¸Ø§Ù… Outbox: <code>/shared/libs/outbox/models.py</code></li>
<li>
<p>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©: <code>/shared/libs/audit/models.py</code></p>
</li>
<li>
<p><strong>SQL Ø§Ù„Ø®Ø§Ù…</strong> (Raw SQL)</p>
</li>
<li>Ù‡Ø¬Ø±Ø§Øª PostgreSQL: <code>/infra/postgres/migrations/</code></li>
<li>Ù†ØµÙˆØµ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©: <code>/infra/postgres/init/</code></li>
</ol>
<h3 id="12">1.2 Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…ÙƒØªØ´ÙØ©<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<p>ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ <strong>70+ Ø¬Ø¯ÙˆÙ„</strong> Ø¹Ø¨Ø± Ø§Ù„Ù…Ù†ØµØ©:</p>
<h4 id="core-tables">Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Core Tables):<a class="headerlink" href="#core-tables" title="Permanent link">&para;</a></h4>
<ul>
<li><code>tenants</code> - Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†/Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª</li>
<li><code>users</code> - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</li>
<li><code>fields</code> - Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© âš ï¸ <strong>ØªØ¹Ø§Ø±Ø¶</strong></li>
<li><code>farms</code> - Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</li>
<li><code>crops</code> - Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„</li>
</ul>
<h4 id="research">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ (Research):<a class="headerlink" href="#research" title="Permanent link">&para;</a></h4>
<ul>
<li><code>experiments</code> - Ø§Ù„ØªØ¬Ø§Ø±Ø¨</li>
<li><code>research_protocols</code> - Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª</li>
<li><code>research_plots</code> - Ù‚Ø·Ø¹ Ø§Ù„ØªØ¬Ø§Ø±Ø¨</li>
<li><code>treatments</code> - Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</li>
<li><code>research_daily_logs</code> - Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</li>
<li><code>lab_samples</code> - Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±ÙŠØ©</li>
<li><code>digital_signatures</code> - Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</li>
</ul>
<h4 id="ndvi">Ø¬Ø¯Ø§ÙˆÙ„ NDVI ÙˆØ§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©:<a class="headerlink" href="#ndvi" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ndvi_observations</code> - Ù…Ø´Ø§Ù‡Ø¯Ø§Øª NDVI</li>
<li><code>ndvi_alerts</code> - ØªÙ†Ø¨ÙŠÙ‡Ø§Øª NDVI</li>
<li><code>ndvi_records</code> - Ø³Ø¬Ù„Ø§Øª NDVI âš ï¸ <strong>ØªØ¹Ø§Ø±Ø¶ Ù…Ø¹ ndvi_readings</strong></li>
<li><code>ndvi_readings</code> - Ù‚Ø±Ø§Ø¡Ø§Øª NDVI âš ï¸ <strong>ØªØ¹Ø§Ø±Ø¶</strong></li>
</ul>
<h4 id="marketplace">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø³ÙˆÙ‚ (Marketplace):<a class="headerlink" href="#marketplace" title="Permanent link">&para;</a></h4>
<ul>
<li><code>products</code> - Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</li>
<li><code>orders</code> - Ø§Ù„Ø·Ù„Ø¨Ø§Øª</li>
<li><code>order_items</code> - Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø·Ù„Ø¨</li>
<li><code>wallets</code> - Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ù…Ø§Ù„ÙŠØ©</li>
<li><code>transactions</code> - Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</li>
<li><code>loans</code> - Ø§Ù„Ù‚Ø±ÙˆØ¶</li>
</ul>
<h4 id="chat">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª (Chat):<a class="headerlink" href="#chat" title="Permanent link">&para;</a></h4>
<ul>
<li><code>chat_threads</code> - Ø®ÙŠÙˆØ· Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</li>
<li><code>chat_messages</code> - Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</li>
<li><code>chat_participants</code> - Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†</li>
<li><code>chat_attachments</code> - Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</li>
</ul>
<h4 id="iot">Ø¬Ø¯Ø§ÙˆÙ„ IoT:<a class="headerlink" href="#iot" title="Permanent link">&para;</a></h4>
<ul>
<li><code>iot_devices</code> - Ø£Ø¬Ù‡Ø²Ø© Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡</li>
<li><code>iot_readings</code> - Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±Ø§Øª</li>
</ul>
<h4 id="_2">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª:<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<ul>
<li><code>tasks</code> - Ø§Ù„Ù…Ù‡Ø§Ù… âš ï¸ <strong>ØªØ¹Ø§Ø±Ø¶</strong></li>
<li><code>alerts</code> - Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</li>
<li><code>notification_log</code> - Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</li>
</ul>
<h4 id="_3">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø·Ù‚Ø³:<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<ul>
<li><code>weather_records</code> - Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ù‚Ø³</li>
<li><code>weather_forecasts</code> - ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù‚Ø³</li>
</ul>
<h4 id="_4">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¡:<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<ul>
<li><code>anwa_events</code> - Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ù†ÙˆØ§Ø¡</li>
</ul>
<h4 id="_5">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚:<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<ul>
<li><code>sync_status</code> - Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© âš ï¸ <strong>ØªØ¹Ø§Ø±Ø¶</strong></li>
<li><code>audit_logs</code> - Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ âš ï¸ <strong>ØªØ¹Ø§Ø±Ø¶</strong></li>
<li><code>outbox_events</code> - Ø£Ø­Ø¯Ø§Ø« Outbox Pattern</li>
</ul>
<hr />
<h2 id="2-conflicts">2. Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ© (Conflicts)<a class="headerlink" href="#2-conflicts" title="Permanent link">&para;</a></h2>
<h3 id="21">âš ï¸ 2.1 ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<p>ØªÙ… Ø§ÙƒØªØ´Ø§Ù <strong>ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø®Ø·ÙŠØ±Ø©</strong> Ø¨ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©:</p>
<h4 id="fields">ğŸ”´ <strong>ØªØ¹Ø§Ø±Ø¶ Ø­Ø±Ø¬: Ø¬Ø¯ÙˆÙ„ <code>fields</code></strong><a class="headerlink" href="#fields" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/init/00-init-sahool.sql</code> (SQL Ø§Ù„Ø®Ø§Ù…)</li>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Field Core Prisma (<code>/apps/services/field-core/prisma/schema.prisma</code>)</li>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 3:</strong> Field Suite SQLAlchemy (<code>/packages/field_suite/spatial/orm_models.py</code>)</li>
</ul>
<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong>
- Ù†ÙØ³ Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ <code>fields</code> Ù…Ø¹Ø±Ù ÙÙŠ 3 Ø£Ù…Ø§ÙƒÙ† Ù…Ø®ØªÙ„ÙØ©
- Ø§Ø­ØªÙ…Ø§Ù„ ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„Ø¨Ù†ÙŠØ© (Schema Collision)
- Ù…Ø®Ø·Ø·Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ù„Ù„Ø£Ø¹Ù…Ø¯Ø© Ù‚Ø¯ ØªØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸ”¥ <strong>Ø­Ø±Ø¬ - ÙŠÙ…Ù†Ø¹ Ø¨Ø¯Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</strong></p>
<hr />
<h4 id="tasks">ğŸ”´ <strong>ØªØ¹Ø§Ø±Ø¶: Ø¬Ø¯ÙˆÙ„ <code>tasks</code></strong><a class="headerlink" href="#tasks" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/init/00-init-sahool.sql</code></li>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Field Core Prisma</li>
</ul>
<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong>
- ØªØ¹Ø±ÙŠÙ Ù…Ø²Ø¯ÙˆØ¬ Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…
- Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙˆØ§Ù„Ù‚ÙŠÙˆØ¯</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸ”¥ <strong>Ø­Ø±Ø¬</strong></p>
<hr />
<h4 id="ndvi_readings">ğŸŸ¡ <strong>ØªØ¹Ø§Ø±Ø¶: Ø¬Ø¯ÙˆÙ„ <code>ndvi_readings</code></strong><a class="headerlink" href="#ndvi_readings" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/init/00-init-sahool.sql</code></li>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Field Core Prisma</li>
</ul>
<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠÙˆØ¬Ø¯ Ø£ÙŠØ¶Ø§Ù‹ Ø¬Ø¯ÙˆÙ„ <code>ndvi_observations</code> ÙÙŠ Ù…Ø­Ø±Ùƒ NDVI - ØºÙŠØ± ÙˆØ§Ø¶Ø­ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù‚ØµÙˆØ¯Ø§Ù‹ Ø£Ù† ÙŠÙƒÙˆÙ†Ø§ Ø¬Ø¯ÙˆÙ„ÙŠÙ† Ù…Ù†ÙØµÙ„ÙŠÙ†</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø·</strong></p>
<hr />
<h4 id="sync_status">ğŸŸ¡ <strong>ØªØ¹Ø§Ø±Ø¶: Ø¬Ø¯ÙˆÙ„ <code>sync_status</code></strong><a class="headerlink" href="#sync_status" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/init/00-init-sahool.sql</code></li>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Field Core Prisma</li>
</ul>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø·</strong></p>
<hr />
<h4 id="field_boundary_history">ğŸŸ¡ <strong>ØªØ¹Ø§Ø±Ø¶: Ø¬Ø¯ÙˆÙ„ <code>field_boundary_history</code></strong><a class="headerlink" href="#field_boundary_history" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/init/00-init-sahool.sql</code></li>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Field Core Prisma</li>
</ul>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø·</strong></p>
<hr />
<h4 id="audit_logs">ğŸŸ¡ <strong>ØªØ¹Ø§Ø±Ø¶: Ø¬Ø¯ÙˆÙ„ <code>audit_logs</code></strong><a class="headerlink" href="#audit_logs" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/init/00-init-sahool.sql</code></li>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Audit SQLAlchemy (<code>/shared/libs/audit/models.py</code>)</li>
</ul>
<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong>
- Ø¨Ù†ÙŠØ© Ù…Ø®ØªÙ„ÙØ© Ù„Ù„Ø£Ø¹Ù…Ø¯Ø©
- Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ SQL Ø§Ù„Ø®Ø§Ù… Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ hash chain
- Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ SQLAlchemy ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ <code>prev_hash</code> Ùˆ <code>entry_hash</code> Ù„Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØªÙ„Ø§Ø¹Ø¨</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø· - Ù‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ÙÙ‚Ø¯Ø§Ù† Ù…ÙŠØ²Ø© Ø§Ù„Ø£Ù…Ø§Ù†</strong></p>
<hr />
<h4 id="farms">ğŸŸ¢ <strong>ØªØ¹Ø§Ø±Ø¶ Ù…Ø­ØªÙ…Ù„: Ø¬Ø¯ÙˆÙ„ <code>farms</code></strong><a class="headerlink" href="#farms" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/migrations/002_base_tables.sql</code> (ÙÙŠ schema <code>geo.farms</code>)</li>
<li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Field Suite SQLAlchemy (ÙÙŠ schema <code>public.farms</code>)</li>
</ul>
<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† ØªØ¹Ø§Ø±Ø¶Ø§Ù‹ Ø­Ù‚ÙŠÙ‚ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù†Ø§ ÙÙŠ schemas Ù…Ø®ØªÙ„ÙØ©</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¢ <strong>Ù…Ù†Ø®ÙØ¶ - Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù€schemas Ù…Ù†ÙØµÙ„Ø©</strong></p>
<hr />
<h4 id="_6">ğŸŸ¡ <strong>ØªÙƒØ±Ø§Ø± ÙƒØ§Ù…Ù„ Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø«ÙŠØ©</strong><a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ© <strong>Ù…Ø¹Ø±ÙØ© Ù…Ø±ØªÙŠÙ†</strong> ØªÙ…Ø§Ù…Ø§Ù‹:
- <code>experiments</code>
- <code>research_protocols</code>
- <code>research_plots</code>
- <code>treatments</code>
- <code>research_daily_logs</code>
- <code>lab_samples</code>
- <code>digital_signatures</code>
- <code>experiment_collaborators</code>
- <code>experiment_audit_log</code></p>
<p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/init/00-init-sahool.sql</code>
<strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Research Core Prisma</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø· - ØªÙƒØ±Ø§Ø± ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ</strong></p>
<hr />
<h4 id="_7">ğŸŸ¡ <strong>ØªÙƒØ±Ø§Ø± ÙƒØ§Ù…Ù„ Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø³ÙˆÙ‚</strong><a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<ul>
<li><code>products</code></li>
<li><code>orders</code></li>
<li><code>order_items</code></li>
<li><code>wallets</code></li>
<li><code>transactions</code></li>
<li><code>loans</code></li>
</ul>
<p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/init/00-init-sahool.sql</code>
<strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Marketplace Prisma</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø·</strong></p>
<hr />
<h4 id="_8">ğŸŸ¡ <strong>ØªÙƒØ±Ø§Ø± ÙƒØ§Ù…Ù„ Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</strong><a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<ul>
<li><code>chat_threads</code></li>
<li><code>chat_messages</code></li>
<li><code>chat_participants</code></li>
<li><code>chat_attachments</code></li>
</ul>
<p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 1:</strong> <code>/infra/postgres/init/00-init-sahool.sql</code>
<strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ 2:</strong> Field Chat Tortoise ORM</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø·</strong></p>
<hr />
<h2 id="3-anti-pattern">3. Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£Ø¬Ù†Ø¨ÙŠØ© Ø¹Ø¨Ø± Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø§Øª (Anti-Pattern)<a class="headerlink" href="#3-anti-pattern" title="Permanent link">&para;</a></h2>
<h3 id="31-microservices">ğŸ”´ 3.1 Ø§Ù†ØªÙ‡Ø§ÙƒØ§Øª Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ù€Microservices<a class="headerlink" href="#31-microservices" title="Permanent link">&para;</a></h3>
<p>ØªÙ… Ø§ÙƒØªØ´Ø§Ù <strong>Ù…Ø±Ø§Ø¬Ø¹ Ù…Ø¨Ø§Ø´Ø±Ø©</strong> Ø¨ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø§Øª ØªÙ†ØªÙ‡Ùƒ Ù…Ø¨Ø¯Ø£ Database-per-Service:</p>
<h4 id="field-core-users-service"><strong>Field Core â†’ Users Service</strong><a class="headerlink" href="#field-core-users-service" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// ÙÙŠ Field Core Prisma</span>
<span class="n">field_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">REFERENCES</span><span class="w"> </span><span class="n">fields</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="n">owner_id</span><span class="w"> </span><span class="n">UUID</span><span class="w">  </span><span class="c1">// ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ users Ù…Ù† Ø®Ø¯Ù…Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¯ÙˆÙ† foreign key</span>
</code></pre></div>

<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> ØºÙŠØ§Ø¨ FK ØµØ±ÙŠØ­ ÙˆÙ„ÙƒÙ† Ø§Ù„Ù…Ù†Ø·Ù‚ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø®Ø¯Ù…Ø© Ù…Ù†ÙØµÙ„Ø©</p>
<hr />
<h4 id="research-core-fieldsfarms"><strong>Research Core â†’ Fields/Farms</strong><a class="headerlink" href="#research-core-fieldsfarms" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// ÙÙŠ Research Core</span>
<span class="n">farmId</span><span class="w"> </span><span class="n">String</span>?<span class="w"> </span><span class="p">@</span><span class="n">map</span><span class="p">(</span><span class="s">&quot;farm_id&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// Ù„Ø§ ØªÙˆØ¬Ø¯ relation Ù…Ø¹Ø±ÙØ©</span>
</code></pre></div>

<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø®Ø¯Ù…Ø© FieldsØŒ Ù„ÙƒÙ† ÙŠØªÙ… Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† Ø®Ø¯Ù…Ø© Research</p>
<hr />
<h4 id="marketplace-users"><strong>Marketplace â†’ Users</strong><a class="headerlink" href="#marketplace-users" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// ÙÙŠ Marketplace</span>
<span class="n">sellerId</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="p">@</span><span class="n">map</span><span class="p">(</span><span class="s">&quot;seller_id&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ users</span>
<span class="n">buyerId</span><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="p">@</span><span class="n">map</span><span class="p">(</span><span class="s">&quot;buyer_id&quot;</span><span class="p">)</span><span class="w">   </span><span class="c1">// ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ users</span>
</code></pre></div>

<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ users Ù…Ù† Ø®Ø¯Ù…Ø© Ù…Ø®ØªÙ„ÙØ©</p>
<hr />
<h4 id="tasks-fields"><strong>Tasks â†’ Fields</strong><a class="headerlink" href="#tasks-fields" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- ÙÙŠ Ø¬Ø¯ÙˆÙ„ tasks</span>
<span class="n">field_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">fields</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">NULL</span>
</code></pre></div>

<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Tasks ÙÙŠ Ø®Ø¯Ù…Ø© Ù…Ù†ÙØµÙ„Ø© Ø¹Ù† FieldsØŒ Ù‡Ø°Ø§ ÙŠØ®Ø§Ù„Ù Ù…Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ø²Ù„</p>
<hr />
<h3 id="32-tenant-id">ğŸŸ¡ 3.2 Ø§Ø³ØªØ®Ø¯Ø§Ù… Tenant ID ÙƒÙ…ÙØªØ§Ø­ Ù…Ø´ØªØ±Ùƒ<a class="headerlink" href="#32-tenant-id" title="Permanent link">&para;</a></h3>
<p><strong>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Øª:</strong>
âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ <code>tenant_id</code> Ù„Ù„ØªÙ…ÙŠÙŠØ² Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†
âœ… ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø¹Ø²Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ (Logical Isolation)</p>
<p><strong>Ø§Ù„Ø³Ù„Ø¨ÙŠØ§Øª:</strong>
âš ï¸ <strong>Ø¹Ø¯Ù… Ø§ØªØ³Ø§Ù‚ ÙÙŠ Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong>
- Ø¨Ø¹Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„: <code>tenant_id UUID</code>
- Ø¨Ø¹Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„: <code>tenant_id VARCHAR(100)</code></p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ù€JOINs ÙˆÙ…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
<hr />
<h2 id="4-missing-indexes">4. Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© (Missing Indexes)<a class="headerlink" href="#4-missing-indexes" title="Permanent link">&para;</a></h2>
<h3 id="41">ğŸ”´ 4.1 ÙÙ‡Ø§Ø±Ø³ Ø­Ø±Ø¬Ø© Ù…ÙÙ‚ÙˆØ¯Ø©<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<h4 id="ndvi_observations"><strong>Ø¬Ø¯ÙˆÙ„ <code>ndvi_observations</code></strong><a class="headerlink" href="#ndvi_observations" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="err">âœ…</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">ix_ndvi_field_date</span><span class="w"> </span><span class="p">(</span><span class="n">field_id</span><span class="p">,</span><span class="w"> </span><span class="n">obs_date</span><span class="p">)</span>
<span class="err">âœ…</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">ix_ndvi_tenant_date</span><span class="w"> </span><span class="p">(</span><span class="n">tenant_id</span><span class="p">,</span><span class="w"> </span><span class="n">obs_date</span><span class="p">)</span>
<span class="err">âœ…</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">uq_ndvi_field_date_source</span>
</code></pre></div>

<p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âœ… Ø¬ÙŠØ¯Ø©</p>
<hr />
<h4 id="chat_messages"><strong>Ø¬Ø¯ÙˆÙ„ <code>chat_messages</code></strong><a class="headerlink" href="#chat_messages" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="err">âœ…</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_messages_thread</span><span class="w"> </span><span class="p">(</span><span class="n">thread_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">)</span>
<span class="err">âŒ</span><span class="w"> </span><span class="err">Ù…ÙÙ‚ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="err">Ø¹Ù„Ù‰</span><span class="w"> </span><span class="n">sender_id</span><span class="w"> </span><span class="err">Ù…Ù†ÙØ±Ø¯Ø§Ù‹</span><span class="w"> </span><span class="p">(</span><span class="err">Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</span><span class="w"> </span><span class="err">Ø¹Ù†</span><span class="w"> </span><span class="err">Ø±Ø³Ø§Ø¦Ù„</span><span class="w"> </span><span class="err">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span><span class="p">)</span>
</code></pre></div>

<p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_chat_messages_sender</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">chat_messages</span><span class="p">(</span><span class="n">sender_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">);</span>
</code></pre></div>

<hr />
<h4 id="transactions"><strong>Ø¬Ø¯ÙˆÙ„ <code>transactions</code></strong><a class="headerlink" href="#transactions" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="err">âœ…</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_transactions_wallet</span>
<span class="err">âŒ</span><span class="w"> </span><span class="err">Ù…ÙÙ‚ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="err">Ø¹Ù„Ù‰</span><span class="w"> </span><span class="p">(</span><span class="n">wallet_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">)</span><span class="w"> </span><span class="err">Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª</span><span class="w"> </span><span class="err">Ø§Ù„Ø²Ù…Ù†ÙŠØ©</span>
<span class="err">âŒ</span><span class="w"> </span><span class="err">Ù…ÙÙ‚ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="err">Ø¹Ù„Ù‰</span><span class="w"> </span><span class="n">reference_id</span><span class="w"> </span><span class="err">Ù„Ù„Ø¨Ø­Ø«</span><span class="w"> </span><span class="err">Ø§Ù„Ø³Ø±ÙŠØ¹</span>
</code></pre></div>

<p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_transactions_wallet_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">transactions</span><span class="p">(</span><span class="n">wallet_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_transactions_reference</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">transactions</span><span class="p">(</span><span class="n">reference_id</span><span class="p">);</span>
</code></pre></div>

<hr />
<h4 id="research_data_points"><strong>Ø¬Ø¯ÙˆÙ„ <code>research_data_points</code></strong><a class="headerlink" href="#research_data_points" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="err">âœ…</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_data_points_experiment</span>
<span class="err">âœ…</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_data_points_plot</span>
<span class="err">âœ…</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_data_points_date</span>
<span class="err">âŒ</span><span class="w"> </span><span class="err">Ù…ÙÙ‚ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="err">Ù…Ø±ÙƒØ¨</span><span class="w"> </span><span class="err">Ø¹Ù„Ù‰</span><span class="w"> </span><span class="p">(</span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="n">parameter_code</span><span class="p">,</span><span class="w"> </span><span class="n">measurement_date</span><span class="p">)</span><span class="w"> </span><span class="err">Ù„Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</span>
</code></pre></div>

<p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_data_points_analysis</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">research_data_points</span><span class="p">(</span>
<span class="w">    </span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="n">parameter_code</span><span class="p">,</span><span class="w"> </span><span class="n">measurement_date</span>
<span class="p">);</span>
</code></pre></div>

<hr />
<h4 id="iot_readings"><strong>Ø¬Ø¯ÙˆÙ„ <code>iot_readings</code></strong><a class="headerlink" href="#iot_readings" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="err">âœ…</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_iot_readings_device</span>
<span class="err">âŒ</span><span class="w"> </span><span class="err">Ù…ÙÙ‚ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="err">Ø¹Ù„Ù‰</span><span class="w"> </span><span class="p">(</span><span class="n">tenant_id</span><span class="p">,</span><span class="w"> </span><span class="n">recorded_at</span><span class="p">)</span><span class="w"> </span><span class="err">Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª</span><span class="w"> </span><span class="err">Ø¹Ù„Ù‰</span><span class="w"> </span><span class="err">Ù…Ø³ØªÙˆÙ‰</span><span class="w"> </span><span class="err">Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</span>
<span class="err">âŒ</span><span class="w"> </span><span class="err">Ù…ÙÙ‚ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="k">PARTIAL</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="err">Ù„Ù„Ù‚Ø±Ø§Ø¡Ø§Øª</span><span class="w"> </span><span class="err">Ø§Ù„Ø£Ø®ÙŠØ±Ø©</span><span class="w"> </span><span class="err">ÙÙ‚Ø·</span>
</code></pre></div>

<p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_iot_readings_tenant_time</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">iot_readings</span><span class="p">(</span><span class="n">tenant_id</span><span class="p">,</span><span class="w"> </span><span class="n">recorded_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>

<span class="c1">-- Partial index Ù„Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£ÙØ¶Ù„ (Ø¢Ø®Ø± 30 ÙŠÙˆÙ… ÙÙ‚Ø·)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_iot_readings_recent</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">iot_readings</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span><span class="w"> </span><span class="n">recorded_at</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">recorded_at</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;30 days&#39;</span><span class="p">;</span>
</code></pre></div>

<hr />
<h3 id="42-gist">ğŸŸ¡ 4.2 ÙÙ‡Ø§Ø±Ø³ GIST Ù…ÙÙ‚ÙˆØ¯Ø© Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©<a class="headerlink" href="#42-gist" title="Permanent link">&para;</a></h3>
<h4 id="research_plots"><strong>Ø¬Ø¯ÙˆÙ„ <code>research_plots</code></strong><a class="headerlink" href="#research_plots" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="err">âŒ</span><span class="w"> </span><span class="err">Ù…ÙÙ‚ÙˆØ¯</span><span class="p">:</span><span class="w"> </span><span class="n">GIST</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="err">Ø¹Ù„Ù‰</span><span class="w"> </span><span class="n">boundary</span><span class="w"> </span><span class="err">Ùˆ</span><span class="w"> </span><span class="n">centroid</span>
</code></pre></div>

<p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_research_plots_boundary</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">research_plots</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">GIST</span><span class="p">(</span><span class="n">boundary</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_research_plots_centroid</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">research_plots</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">GIST</span><span class="p">(</span><span class="n">centroid</span><span class="p">);</span>
</code></pre></div>

<hr />
<h2 id="5-data-integrity-issues">5. Ù…Ø´Ø§ÙƒÙ„ Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Data Integrity Issues)<a class="headerlink" href="#5-data-integrity-issues" title="Permanent link">&para;</a></h2>
<h3 id="51">ğŸ”´ 5.1 Ø¹Ø¯Ù… Ø§ØªØ³Ø§Ù‚ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<h4 id="tenant_id"><strong>Ù…Ø´ÙƒÙ„Ø©: tenant_id</strong><a class="headerlink" href="#tenant_id" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Ø§Ù„Ø¬Ø¯ÙˆÙ„</th>
<th>Ø§Ù„Ù†ÙˆØ¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>infra SQL</td>
<td><code>UUID</code></td>
</tr>
<tr>
<td>Field Core Prisma</td>
<td><code>VARCHAR(100)</code></td>
</tr>
<tr>
<td>Chat Tortoise</td>
<td><code>VARCHAR(64)</code></td>
</tr>
</tbody>
</table>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸ”¥ <strong>Ø­Ø±Ø¬ - Ù‚Ø¯ ÙŠÙ…Ù†Ø¹ JOINs ÙˆØ§Ù„Ù…Ù‚Ø§Ø±Ù†Ø§Øª</strong></p>
<hr />
<h4 id="geometry"><strong>Ù…Ø´ÙƒÙ„Ø©: Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù€Geometry</strong><a class="headerlink" href="#geometry" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Ø§Ù„Ø¬Ø¯ÙˆÙ„</th>
<th>Ø§Ù„Ù†ÙˆØ¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>fields (infra SQL)</td>
<td><code>GEOMETRY(POLYGON, 4326)</code></td>
</tr>
<tr>
<td>research_plots (infra SQL)</td>
<td><code>GEOGRAPHY(POLYGON, 4326)</code></td>
</tr>
<tr>
<td>Field Suite</td>
<td><code>geometry(Polygon, 4326)</code></td>
</tr>
</tbody>
</table>
<p><strong>Ø§Ù„ÙØ±Ù‚:</strong>
- <code>GEOMETRY</code>: ÙŠØ¹Ø§Ù…Ù„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙƒÙ€Cartesian (x, y)
- <code>GEOGRAPHY</code>: ÙŠØ¹Ø§Ù…Ù„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙƒÙ€Spherical (lat, lon) - Ø£Ø¯Ù‚ Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø· - Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø­Ø© ÙˆØ§Ù„Ù…Ø³Ø§ÙØ©</strong></p>
<hr />
<h4 id="ndvi-value-precision"><strong>Ù…Ø´ÙƒÙ„Ø©: NDVI value precision</strong><a class="headerlink" href="#ndvi-value-precision" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Ø§Ù„Ø¬Ø¯ÙˆÙ„</th>
<th>Ø§Ù„Ù†ÙˆØ¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ndvi_observations</td>
<td><code>DECIMAL(4,3)</code> - Ù†Ø·Ø§Ù‚: -1.000 Ø¥Ù„Ù‰ 1.000</td>
</tr>
<tr>
<td>ndvi_records</td>
<td><code>DECIMAL(6,4)</code> - Ù†Ø·Ø§Ù‚: -10.0000 Ø¥Ù„Ù‰ 10.0000</td>
</tr>
<tr>
<td>fields.ndvi_value (infra)</td>
<td><code>DECIMAL(5,4)</code></td>
</tr>
</tbody>
</table>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¢ <strong>Ù…Ù†Ø®ÙØ¶ - Ù„ÙƒÙ† ÙŠÙØ¶Ù„ Ø§Ù„ØªÙˆØ­ÙŠØ¯</strong></p>
<hr />
<h3 id="52-enums">ğŸŸ¡ 5.2 Ø¹Ø¯Ù… Ø§ØªØ³Ø§Ù‚ ÙÙŠ Ø§Ù„Ù€ENUMs<a class="headerlink" href="#52-enums" title="Permanent link">&para;</a></h3>
<h4 id="field_status"><strong>Ù…Ø«Ø§Ù„: field_status</strong><a class="headerlink" href="#field_status" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- ÙÙŠ infra SQL</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">field_status</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ENUM</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fallow&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;preparing&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;harvested&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;archived&#39;</span><span class="p">);</span>

<span class="c1">-- ÙÙŠ Field Core Prisma</span>
<span class="n">enum</span><span class="w"> </span><span class="n">FieldStatus</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="n">active</span>
<span class="w">  </span><span class="n">fallow</span>
<span class="w">  </span><span class="n">harvested</span>
<span class="w">  </span><span class="n">preparing</span>
<span class="w">  </span><span class="n">inactive</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="err">Ù…Ø®ØªÙ„Ù</span><span class="w"> </span><span class="err">Ø¹Ù†</span><span class="w"> </span><span class="s1">&#39;archived&#39;</span>
<span class="err">}</span>
</code></pre></div>

<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> <code>archived</code> ÙÙŠ SQL â‰  <code>inactive</code> ÙÙŠ Prisma</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø· - Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ Ø£Ø®Ø·Ø§Ø¡ runtime</strong></p>
<hr />
<h4 id="task_type"><strong>Ù…Ø«Ø§Ù„: task_type</strong><a class="headerlink" href="#task_type" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- ÙÙŠ infra SQL</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">task_type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ENUM</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;irrigation&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fertilization&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pesticide&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;harvest&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;planting&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;soil_prep&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pruning&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;inspection&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;maintenance&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;other&#39;</span><span class="p">);</span>

<span class="c1">-- ÙÙŠ Field Core Prisma</span>
<span class="n">enum</span><span class="w"> </span><span class="n">TaskType</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="n">irrigation</span>
<span class="w">  </span><span class="n">fertilization</span>
<span class="w">  </span><span class="n">spraying</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="err">Ù…Ø®ØªÙ„Ù</span><span class="w"> </span><span class="err">Ø¹Ù†</span><span class="w"> </span><span class="s1">&#39;pesticide&#39;</span>
<span class="w">  </span><span class="n">scouting</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="err">ØºÙŠØ±</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="w"> </span><span class="err">ÙÙŠ</span><span class="w"> </span><span class="k">SQL</span>
<span class="w">  </span><span class="n">maintenance</span>
<span class="w">  </span><span class="n">sampling</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="err">ØºÙŠØ±</span><span class="w"> </span><span class="err">Ù…ÙˆØ¬ÙˆØ¯</span><span class="w"> </span><span class="err">ÙÙŠ</span><span class="w"> </span><span class="k">SQL</span>
<span class="w">  </span><span class="n">harvest</span>
<span class="w">  </span><span class="n">planting</span>
<span class="w">  </span><span class="n">other</span>
<span class="err">}</span>
</code></pre></div>

<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸ”´ <strong>Ø­Ø±Ø¬ - Ø¹Ø¯Ù… ØªÙˆØ§ÙÙ‚ ÙƒØ§Ù…Ù„</strong></p>
<hr />
<h3 id="53-missing-constraints">ğŸ”´ 5.3 Ù‚ÙŠÙˆØ¯ Ù…ÙÙ‚ÙˆØ¯Ø© (Missing Constraints)<a class="headerlink" href="#53-missing-constraints" title="Permanent link">&para;</a></h3>
<h4 id="wallets"><strong>Ø¬Ø¯ÙˆÙ„ wallets</strong><a class="headerlink" href="#wallets" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙŠÙˆØ¯ CHECK Ø¹Ù„Ù‰:</span>
<span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c1">-- ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø±ØµÙŠØ¯ Ù…ÙˆØ¬Ø¨Ø§Ù‹</span>
<span class="n">current_loan</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">loan_limit</span><span class="w">  </span><span class="c1">-- Ø§Ù„Ù‚Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯</span>
<span class="n">credit_score</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">850</span><span class="w">  </span><span class="c1">-- Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†ÙŠ</span>
</code></pre></div>

<p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">wallets</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">chk_wallet_balance</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">wallets</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">chk_wallet_loan</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">current_loan</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">loan_limit</span><span class="p">);</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">wallets</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">chk_credit_score</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">credit_score</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">850</span><span class="p">);</span>
</code></pre></div>

<hr />
<h4 id="loans"><strong>Ø¬Ø¯ÙˆÙ„ loans</strong><a class="headerlink" href="#loans" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Ù‚ÙŠÙˆØ¯ Ù…ÙÙ‚ÙˆØ¯Ø©:</span>
<span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="n">total_due</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">amount</span>
<span class="n">paid_amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span>
<span class="n">paid_amount</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">total_due</span>
<span class="n">term_months</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div>

<p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">loans</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">chk_loan_amounts</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span>
<span class="w">    </span><span class="n">total_due</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">AND</span>
<span class="w">    </span><span class="n">paid_amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span>
<span class="w">    </span><span class="n">paid_amount</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">total_due</span><span class="w"> </span><span class="k">AND</span>
<span class="w">    </span><span class="n">term_months</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="p">);</span>
</code></pre></div>

<hr />
<h2 id="6-schema-versioning">6. Ù…Ø´Ø§ÙƒÙ„ Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª (Schema Versioning)<a class="headerlink" href="#6-schema-versioning" title="Permanent link">&para;</a></h2>
<h3 id="61">ğŸ”´ 6.1 Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¢Ù„ÙŠØ© Ù…ÙˆØ­Ø¯Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡Ø¬Ø±Ø§Øª<a class="headerlink" href="#61" title="Permanent link">&para;</a></h3>
<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong>
- <strong>Prisma</strong> ÙŠØ³ØªØ®Ø¯Ù… Ù…Ø¬Ù„Ø¯ <code>migrations/</code> Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡
- <strong>Alembic</strong> (SQLAlchemy) ÙŠØ³ØªØ®Ø¯Ù… <code>versions/</code> Ù…Ø¹ ØªØ³Ù…ÙŠØ© <code>s{sprint}_{number}</code>
- <strong>SQL Ø§Ù„Ø®Ø§Ù…</strong> ÙÙŠ <code>infra/postgres/</code> Ø¨Ø¯ÙˆÙ† Ø£ÙŠ tracking ØªÙ„Ù‚Ø§Ø¦ÙŠ
- <strong>Tortoise ORM</strong> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ù„ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… migrations</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸ”¥ <strong>Ø­Ø±Ø¬ - Ø§Ø­ØªÙ…Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø¬Ø±Ø§Øª Ù…ØªØ¶Ø§Ø±Ø¨Ø©</strong></p>
<hr />
<h3 id="62-_migrations">ğŸŸ¡ 6.2 Ø¬Ø¯ÙˆÙ„ <code>_migrations</code> ÙŠØ¯ÙˆÙŠ<a class="headerlink" href="#62-_migrations" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- ÙÙŠ 001_init_extensions.sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">_migrations</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">applied_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong>
- Ù„Ø§ ÙŠØªØªØ¨Ø¹ <strong>checksum</strong> Ù„Ù„Ù‡Ø¬Ø±Ø§Øª
- Ù„Ø§ ÙŠØªØªØ¨Ø¹ <strong>rollback</strong>
- Ù„Ø§ ÙŠØ¯Ø¹Ù… <strong>branching</strong></p>
<p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø¯Ø§Ø© Ù…ÙˆØ­Ø¯Ø© Ù…Ø«Ù„ Flyway Ø£Ùˆ Liquibase</p>
<hr />
<h3 id="63">ğŸŸ¡ 6.3 Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£Ø±Ù‚Ø§Ù… Ø¥ØµØ¯Ø§Ø±Ø§Øª Ù…Ù†Ø³Ù‚Ø©<a class="headerlink" href="#63" title="Permanent link">&para;</a></h3>
<p><strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong>
- Alembic: <code>s7_0001</code>, <code>s8_0001</code> (sprint-based)
- Prisma: timestamps
- SQL: <code>001_</code>, <code>002_</code> (sequential)</p>
<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ ØµØ¹ÙˆØ¨Ø© ÙÙŠ ØªØªØ¨Ø¹ ØªØ±ØªÙŠØ¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</p>
<hr />
<h2 id="7-migration-order-dependencies">7. ØªØ¨Ø¹ÙŠØ§Øª ØªØ±ØªÙŠØ¨ Ø§Ù„Ù‡Ø¬Ø±Ø§Øª (Migration Order Dependencies)<a class="headerlink" href="#7-migration-order-dependencies" title="Permanent link">&para;</a></h2>
<h3 id="71">ğŸ”´ 7.1 ØªØ¨Ø¹ÙŠØ§Øª ØºÙŠØ± Ù…ÙˆØ«Ù‚Ø©<a class="headerlink" href="#71" title="Permanent link">&para;</a></h3>
<h4 id="_9"><strong>Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</strong><a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">infra</span><span class="o">/</span><span class="nb">pos</span><span class="n">tgres</span><span class="o">/</span><span class="n">migrations</span><span class="o">/</span><span class="mf">001</span><span class="n">_init_extensions</span><span class="mf">.</span><span class="n">sql</span>
<span class="w">   </span><span class="err">â†“</span><span class="w"> </span><span class="p">(</span><span class="n">ÙŠ</span><span class="err">Ù</span><span class="n">Ù†Ø´Ø¦</span><span class="w"> </span><span class="nb">Pos</span><span class="n">tGIS</span><span class="w"> </span><span class="n">Ùˆ</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">extensions</span><span class="p">)</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">infra</span><span class="o">/</span><span class="nb">pos</span><span class="n">tgres</span><span class="o">/</span><span class="n">migrations</span><span class="o">/</span><span class="mf">002</span><span class="n">_base_tables</span><span class="mf">.</span><span class="n">sql</span>
<span class="w">   </span><span class="err">â†“</span><span class="w"> </span><span class="p">(</span><span class="n">ÙŠ</span><span class="err">Ù</span><span class="n">Ù†Ø´Ø¦</span><span class="w"> </span><span class="n">tenants</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">farms</span><span class="p">,</span><span class="w"> </span><span class="n">fields</span><span class="p">)</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">packages</span><span class="o">/</span><span class="n">field_suite</span><span class="o">/</span><span class="n">migrations</span><span class="o">/</span><span class="n">s7_0001_postgis_hierarchy</span><span class="mf">.</span><span class="n">py</span>
<span class="w">   </span><span class="err">â†“</span><span class="w"> </span><span class="p">(</span><span class="n">Ù‚Ø¯</span><span class="w"> </span><span class="n">ÙŠØªØ¹Ø§Ø±Ø¶</span><span class="w"> </span><span class="n">Ù…Ø¹</span><span class="w"> </span><span class="mf">002</span><span class="w"> </span><span class="n">Ù„Ø£Ù†Ù‡</span><span class="w"> </span><span class="n">ÙŠÙ†Ø´Ø¦</span><span class="w"> </span><span class="n">farms</span><span class="w"> </span><span class="n">Ùˆ</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">Ø£ÙŠØ¶Ø§</span><span class="err">Ù‹!</span><span class="p">)</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">apps</span><span class="o">/</span><span class="n">services</span><span class="o">/</span><span class="n">ndvi</span><span class="o">-</span><span class="n">engine</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">migrations</span><span class="o">/</span><span class="n">s8_0001_ndvi_timeseries</span><span class="mf">.</span><span class="n">py</span>
<span class="w">   </span><span class="err">â†“</span><span class="w"> </span><span class="p">(</span><span class="n">ÙŠØ­ØªØ§Ø¬</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">Ù„Ø¥Ù†Ø´Ø§Ø¡</span><span class="w"> </span><span class="n">FK</span><span class="p">)</span>

<span class="mf">5.</span><span class="w"> </span><span class="n">shared</span><span class="o">/</span><span class="n">libs</span><span class="o">/</span><span class="n">outbox</span><span class="o">/</span><span class="n">alembic</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="n">s4_0001_create_outbox_events</span><span class="mf">.</span><span class="n">py</span>
<span class="w">   </span><span class="err">â†“</span><span class="w"> </span><span class="p">(</span><span class="n">Ù…Ø³ØªÙ‚Ù„</span><span class="p">)</span>

<span class="mf">6.</span><span class="w"> </span><span class="n">Prisma</span><span class="w"> </span><span class="n">migrations</span><span class="w"> </span><span class="p">(</span><span class="n">ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</span><span class="err">ØŒ</span><span class="w"> </span><span class="n">Ù‚Ø¯</span><span class="w"> </span><span class="n">ØªØªØ¹Ø§Ø±Ø¶</span><span class="w"> </span><span class="n">Ù…Ø¹</span><span class="w"> </span><span class="n">Ø§Ù„ÙƒÙ„</span><span class="err">!</span><span class="p">)</span>
</code></pre></div>

<p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> ğŸ”¥ <strong>Ø­Ø±Ø¬ - Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¶Ù…Ø§Ù† Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‡Ø¬Ø±Ø§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­</strong></p>
<hr />
<h3 id="72-postgis-extension">ğŸ”´ 7.2 PostGIS extension ÙŠÙØ·Ù„Ø¨ ÙÙŠ Ø£Ù…Ø§ÙƒÙ† Ù…ØªØ¹Ø¯Ø¯Ø©<a class="headerlink" href="#72-postgis-extension" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- ÙÙŠ 001_init_extensions.sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">postgis</span><span class="p">;</span>

<span class="c1">-- ÙÙŠ 00-init-sahool.sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="ss">&quot;postgis&quot;</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="ss">&quot;postgis_topology&quot;</span><span class="p">;</span>

<span class="c1">-- ÙÙŠ Field Core Prisma migration</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">postgis</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">postgis_topology</span><span class="p">;</span>

<span class="c1">-- ÙÙŠ Field Suite Alembic</span>
<span class="n">op</span><span class="p">.</span><span class="k">execute</span><span class="p">(</span><span class="ss">&quot;CREATE EXTENSION IF NOT EXISTS postgis;&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… <code>IF NOT EXISTS</code> ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ØŒ Ù„ÙƒÙ† ÙŠÙˆØ¶Ø­ Ø§Ù„ØªÙƒØ±Ø§Ø±</p>
<hr />
<h3 id="73-functions-triggers">ğŸŸ¡ 7.3 Functions Ùˆ Triggers Ù…ØªÙƒØ±Ø±Ø©<a class="headerlink" href="#73-functions-triggers" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Function update_updated_at_column() Ù…Ø¹Ø±ÙØ© ÙÙŠ:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="n">Field</span><span class="w"> </span><span class="n">Core</span><span class="w"> </span><span class="n">Prisma</span><span class="w"> </span><span class="n">migration</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="n">infra</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">init</span><span class="o">/</span><span class="mi">00</span><span class="o">-</span><span class="n">init</span><span class="o">-</span><span class="n">sahool</span><span class="p">.</span><span class="k">sql</span>

<span class="c1">-- Function calculate_field_area() Ù…Ø¹Ø±ÙØ© ÙÙŠ:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="n">Field</span><span class="w"> </span><span class="n">Core</span><span class="w"> </span><span class="n">Prisma</span><span class="w"> </span><span class="n">migration</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="n">infra</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">init</span><span class="o">/</span><span class="mi">00</span><span class="o">-</span><span class="n">init</span><span class="o">-</span><span class="n">sahool</span><span class="p">.</span><span class="k">sql</span>

<span class="c1">-- Function sync_geometry_from_wkt() Ù…Ø¹Ø±ÙØ© ÙÙŠ:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="n">Field</span><span class="w"> </span><span class="n">Suite</span><span class="w"> </span><span class="n">Alembic</span><span class="w"> </span><span class="n">migration</span>
</code></pre></div>

<p><strong>Ø§Ù„ØªØ£Ø«ÙŠØ±:</strong> ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø· - Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ ØªØ­Ø°ÙŠØ±Ø§Øª Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©</strong></p>
<hr />
<h2 id="8-data-isolation">8. ØªÙˆØµÙŠØ§Øª Ù„Ø¹Ø²Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Data Isolation)<a class="headerlink" href="#8-data-isolation" title="Permanent link">&para;</a></h2>
<h3 id="81-quick-wins">âœ… 8.1 ØªÙˆØµÙŠØ§Øª Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰ (Quick Wins)<a class="headerlink" href="#81-quick-wins" title="Permanent link">&para;</a></h3>
<h4 id="1-schemas"><strong>1. Ø¥Ù†Ø´Ø§Ø¡ schemas Ù…Ù†ÙØµÙ„Ø© Ù„ÙƒÙ„ Ø®Ø¯Ù…Ø©</strong><a class="headerlink" href="#1-schemas" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù†:</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">fields</span><span class="w"> </span><span class="p">(...)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">experiments</span><span class="w"> </span><span class="p">(...)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">products</span><span class="w"> </span><span class="p">(...)</span>

<span class="c1">-- Ø§Ø³ØªØ®Ø¯Ù…:</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">field_service</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">field_service</span><span class="p">.</span><span class="n">fields</span><span class="w"> </span><span class="p">(...);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">research_service</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">research_service</span><span class="p">.</span><span class="n">experiments</span><span class="w"> </span><span class="p">(...);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">marketplace_service</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">marketplace_service</span><span class="p">.</span><span class="n">products</span><span class="w"> </span><span class="p">(...);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">chat_service</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">chat_service</span><span class="p">.</span><span class="n">threads</span><span class="w"> </span><span class="p">(...);</span>
</code></pre></div>

<p><strong>Ø§Ù„ÙÙˆØ§Ø¦Ø¯:</strong>
âœ… Ø­Ù„ ÙÙˆØ±ÙŠ Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
âœ… Ø¹Ø²Ù„ Ù…Ù†Ø·Ù‚ÙŠ ÙˆØ§Ø¶Ø­
âœ… Ø³Ù‡ÙˆÙ„Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
âœ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ù†Ù‚Ù„ Ø§Ù„Ù€schema Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†ÙØµÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</p>
<hr />
<h4 id="2-shared-reference-tables"><strong>2. Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø±Ø¬Ø¹ÙŠØ© Ù…Ø´ØªØ±ÙƒØ© (Shared Reference Tables)</strong><a class="headerlink" href="#2-shared-reference-tables" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">shared</span><span class="p">;</span>

<span class="c1">-- Ù†Ø³Ø®Ø© read-only Ù…Ù† users Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">shared</span><span class="p">.</span><span class="n">user_refs</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">tenant_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">full_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">last_synced_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="c1">-- Ù†Ø³Ø®Ø© read-only Ù…Ù† fields Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">shared</span><span class="p">.</span><span class="n">field_refs</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">field_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">tenant_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">last_synced_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</strong>
- Ø®Ø¯Ù…Ø© Research ØªØ´ÙŠØ± Ø¥Ù„Ù‰ <code>shared.field_refs</code> Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† <code>field_service.fields</code>
- ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø¹Ø¨Ø± <strong>CDC (Change Data Capture)</strong> Ø£Ùˆ <strong>Event Sourcing</strong></p>
<hr />
<h4 id="3-uuid-tenant_id"><strong>3. Ø§Ø³ØªØ®Ø¯Ø§Ù… UUID Ù…ÙˆØ­Ø¯ Ù„Ù€tenant_id</strong><a class="headerlink" href="#3-uuid-tenant_id" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- ØªØ­ÙˆÙŠÙ„ Ø¬Ù…ÙŠØ¹ tenant_id Ø¥Ù„Ù‰ UUID</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">chat_threads</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">tenant_id</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">tenant_id</span><span class="p">::</span><span class="n">UUID</span><span class="p">;</span>
<span class="c1">-- ÙƒØ±Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</span>
</code></pre></div>

<hr />
<h4 id="4-enums"><strong>4. ØªÙˆØ­ÙŠØ¯ ENUMs</strong><a class="headerlink" href="#4-enums" title="Permanent link">&para;</a></h4>
<p><strong>Ø®ÙŠØ§Ø± 1: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ø¯Ø§ÙˆÙ„ lookup</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">shared</span><span class="p">.</span><span class="n">field_statuses</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">code</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">name_en</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">name_ar</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">is_active</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">true</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">shared</span><span class="p">.</span><span class="n">field_statuses</span><span class="w"> </span><span class="k">VALUES</span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Active&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ù†Ø´Ø·&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39;fallow&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Fallow&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ø¨ÙˆØ±&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39;harvested&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Harvested&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ù…Ø­ØµÙˆØ¯&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39;preparing&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Preparing&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">),</span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39;inactive&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Inactive&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ØºÙŠØ± Ù†Ø´Ø·&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>

<span class="c1">-- ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„:</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_field_status</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">shared</span><span class="p">.</span><span class="n">field_statuses</span><span class="p">(</span><span class="n">code</span><span class="p">);</span>
</code></pre></div>

<p><strong>Ø§Ù„ÙÙˆØ§Ø¦Ø¯:</strong>
âœ… Ù…Ø±ÙˆÙ†Ø© ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙ… Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¯ÙˆÙ† ALTER TYPE
âœ… Ø¯Ø¹Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª
âœ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© soft delete Ù„Ù„Ù‚ÙŠÙ…</p>
<hr />
<h3 id="82">âœ… 8.2 ØªÙˆØµÙŠØ§Øª Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…Ø¯Ù‰<a class="headerlink" href="#82" title="Permanent link">&para;</a></h3>
<h4 id="1-database-per-service-pattern"><strong>1. ØªØ·Ø¨ÙŠÙ‚ Database-per-Service Pattern</strong><a class="headerlink" href="#1-database-per-service-pattern" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>sahool-field-db (PostgreSQL + PostGIS)
  â”œâ”€â”€ schema: field_service
  â”‚   â”œâ”€â”€ fields
  â”‚   â”œâ”€â”€ field_boundary_history
  â”‚   â”œâ”€â”€ sync_status
  â”‚   â””â”€â”€ tasks

sahool-research-db (PostgreSQL)
  â”œâ”€â”€ schema: research_service
  â”‚   â”œâ”€â”€ experiments
  â”‚   â”œâ”€â”€ research_protocols
  â”‚   â”œâ”€â”€ research_plots
  â”‚   â””â”€â”€ ...

sahool-marketplace-db (PostgreSQL)
  â”œâ”€â”€ schema: marketplace_service
  â”‚   â”œâ”€â”€ products
  â”‚   â”œâ”€â”€ orders
  â”‚   â”œâ”€â”€ wallets
  â”‚   â””â”€â”€ ...

sahool-core-db (PostgreSQL)
  â”œâ”€â”€ schema: tenants_service
  â”‚   â””â”€â”€ tenants
  â”œâ”€â”€ schema: users_service
  â”‚   â””â”€â”€ users
  â”œâ”€â”€ schema: shared
  â”‚   â”œâ”€â”€ user_refs (materialized view)
  â”‚   â””â”€â”€ field_refs (materialized view)
</code></pre></div>

<hr />
<h4 id="2-event-driven-architecture"><strong>2. Ø§Ø³ØªØ®Ø¯Ø§Ù… Event-Driven Architecture Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹</strong><a class="headerlink" href="#2-event-driven-architecture" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// Ù…Ø«Ø§Ù„: Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« field</span>
<span class="k">await</span><span class="w"> </span><span class="nx">publishEvent</span><span class="p">({</span>
<span class="w">  </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;field.updated&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">tenant_id</span><span class="o">:</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">tenant_id</span><span class="p">,</span>
<span class="w">  </span><span class="nx">field_id</span><span class="o">:</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
<span class="w">  </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
<span class="w">    </span><span class="nx">updated_at</span><span class="o">:</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">updated_at</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Ø®Ø¯Ù…Ø© Research ØªØ³ØªÙ…Ø¹ ÙˆØªØ­Ø¯Ø« shared.field_refs</span>
</code></pre></div>

<hr />
<h4 id="3-saga-pattern"><strong>3. ØªØ·Ø¨ÙŠÙ‚ SAGA Pattern Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ²Ø¹Ø©</strong><a class="headerlink" href="#3-saga-pattern" title="Permanent link">&para;</a></h4>
<p>Ù…Ø«Ø§Ù„: Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ÙÙŠ Marketplace ÙŠØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ« wallet:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Orchestrated SAGA</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">createOrderSaga</span><span class="p">(</span><span class="nx">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sagaId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uuid</span><span class="p">();</span>

<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Step 1: Reserve wallet balance</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">walletService</span><span class="p">.</span><span class="nx">reserveBalance</span><span class="p">(</span><span class="nx">sagaId</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Step 2: Create order</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">orderService</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">sagaId</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Step 3: Deduct balance</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">walletService</span><span class="p">.</span><span class="nx">deductBalance</span><span class="p">(</span><span class="nx">sagaId</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Commit</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">sagaService</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="nx">sagaId</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Compensate</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">walletService</span><span class="p">.</span><span class="nx">releaseReservation</span><span class="p">(</span><span class="nx">sagaId</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">orderService</span><span class="p">.</span><span class="nx">cancel</span><span class="p">(</span><span class="nx">sagaId</span><span class="p">);</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h3 id="83">âœ… 8.3 ØªÙˆØµÙŠØ§Øª Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ø¯Ù‰<a class="headerlink" href="#83" title="Permanent link">&para;</a></h3>
<h4 id="1-migrate-to-separate-databases"><strong>1. Migrate to Separate Databases</strong><a class="headerlink" href="#1-migrate-to-separate-databases" title="Permanent link">&para;</a></h4>
<p><strong>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong></p>
<div class="codehilite"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Gateway / BFF               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚          â”‚          â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚Field   â”‚  â”‚Researchâ”‚  â”‚Market  â”‚  â”‚Chat    â”‚
â”‚Service â”‚  â”‚Service â”‚  â”‚Service â”‚  â”‚Service â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚            â”‚         â”‚          â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚Field DBâ”‚  â”‚Res. DB â”‚  â”‚Market  â”‚  â”‚Chat DB â”‚
â”‚PostGIS â”‚  â”‚PG      â”‚  â”‚DB PG   â”‚  â”‚PG      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h4 id="2-read-replicas-shared-data"><strong>2. Ø§Ø³ØªØ®Ø¯Ø§Ù… Read Replicas Ù„Ù€Shared Data</strong><a class="headerlink" href="#2-read-replicas-shared-data" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>Master DB (Core)
  â”œâ”€â”€ tenants
  â””â”€â”€ users
       â”‚
       â†“ (Replication)
       â”‚
Read Replicas ÙÙŠ ÙƒÙ„ Ø®Ø¯Ù…Ø©
  â”œâ”€â”€ field-service-replica
  â”œâ”€â”€ research-service-replica
  â””â”€â”€ marketplace-service-replica
</code></pre></div>

<hr />
<h4 id="3-cqrs-command-query-responsibility-segregation"><strong>3. ØªØ·Ø¨ÙŠÙ‚ CQRS (Command Query Responsibility Segregation)</strong><a class="headerlink" href="#3-cqrs-command-query-responsibility-segregation" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>Write Model (Normalized)          Read Model (Denormalized)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fields          â”‚â”€â”€Eventsâ”€â”€â”€â”€â”€â”€â–¶â”‚ field_summaries     â”‚
â”‚  - id           â”‚              â”‚  - id                â”‚
â”‚  - name         â”‚              â”‚  - name              â”‚
â”‚  - status       â”‚              â”‚  - owner_name âœ“     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  - crop_name âœ“      â”‚
                                 â”‚  - latest_ndvi âœ“    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  - task_count âœ“     â”‚
â”‚ ndvi_readings   â”‚â”€â”€Eventsâ”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="9">9. Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©<a class="headerlink" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="-">ğŸ”´ <strong>Ø­Ø±Ø¬ - ÙŠØ¬Ø¨ Ø§Ù„Ø­Ù„ ÙÙˆØ±Ø§Ù‹:</strong><a class="headerlink" href="#-" title="Permanent link">&para;</a></h3>
<ol>
<li>âœ‹ <strong>ØªØ¹Ø§Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ <code>fields</code></strong> (3 ØªØ¹Ø±ÙŠÙØ§Øª Ù…Ø®ØªÙ„ÙØ©)</li>
<li>âœ‹ <strong>ØªØ¹Ø§Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ <code>tasks</code></strong> (ØªØ¹Ø±ÙŠÙÙŠÙ†)</li>
<li>âœ‹ <strong>Ø¹Ø¯Ù… Ø§ØªØ³Ø§Ù‚ ENUMs</strong> (field_status, task_type)</li>
<li>âœ‹ <strong>Ø¹Ø¯Ù… Ø§ØªØ³Ø§Ù‚ tenant_id type</strong> (UUID vs VARCHAR)</li>
<li>âœ‹ <strong>Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¢Ù„ÙŠØ© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ù‡Ø¬Ø±Ø§Øª</strong></li>
</ol>
<hr />
<h3 id="-_1">ğŸŸ¡ <strong>Ù…ØªÙˆØ³Ø· - ÙŠØ¬Ø¨ Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù„Ø­Ù„:</strong><a class="headerlink" href="#-_1" title="Permanent link">&para;</a></h3>
<ol>
<li>âš ï¸ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø«ÙŠØ© (9 Ø¬Ø¯Ø§ÙˆÙ„)</li>
<li>âš ï¸ ØªÙƒØ±Ø§Ø± Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø³ÙˆÙ‚ (6 Ø¬Ø¯Ø§ÙˆÙ„)</li>
<li>âš ï¸ ØªÙƒØ±Ø§Ø± Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª (4 Ø¬Ø¯Ø§ÙˆÙ„)</li>
<li>âš ï¸ Ù…Ø±Ø§Ø¬Ø¹ FK Ø¹Ø¨Ø± Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</li>
<li>âš ï¸ ÙÙ‡Ø§Ø±Ø³ Ù…ÙÙ‚ÙˆØ¯Ø© Ø¹Ù„Ù‰ Ø¬Ø¯Ø§ÙˆÙ„ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</li>
<li>âš ï¸ Ù‚ÙŠÙˆØ¯ CHECK Ù…ÙÙ‚ÙˆØ¯Ø© (wallets, loans)</li>
<li>âš ï¸ Ø¹Ø¯Ù… Ø§ØªØ³Ø§Ù‚ GEOMETRY vs GEOGRAPHY</li>
</ol>
<hr />
<h3 id="-_2">ğŸŸ¢ <strong>ØªØ­Ø³ÙŠÙ†Ø§Øª - ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ù„ Ù„Ø§Ø­Ù‚Ø§Ù‹:</strong><a class="headerlink" href="#-_2" title="Permanent link">&para;</a></h3>
<ol>
<li>â„¹ï¸ Functions Ùˆ Triggers Ù…ØªÙƒØ±Ø±Ø©</li>
<li>â„¹ï¸ Ø¹Ø¯Ù… Ø§ØªØ³Ø§Ù‚ Ø¯Ù‚Ø© NDVI values</li>
<li>â„¹ï¸ Ø¬Ø¯ÙˆÙ„ _migrations ÙŠØ¯ÙˆÙŠ ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†</li>
</ol>
<hr />
<h2 id="10">10. Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©<a class="headerlink" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="1-1-2">ğŸ“‹ <strong>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„ØªÙˆØ­ÙŠØ¯ Ø§Ù„ÙÙˆØ±ÙŠ (Ø£Ø³Ø¨ÙˆØ¹ 1-2)</strong><a class="headerlink" href="#1-1-2" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- 1. Ø¥Ù†Ø´Ø§Ø¡ schemas Ù…Ù†ÙØµÙ„Ø©</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">field_service</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">research_service</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">marketplace_service</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">chat_service</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">shared</span><span class="p">;</span>

<span class="c1">-- 2. Ù†Ù‚Ù„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªØ¹Ø§Ø±Ø¶Ø©</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">field_service</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">field_service</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">experiments</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">research_service</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">marketplace_service</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">chat_threads</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">chat_service</span><span class="p">;</span>

<span class="c1">-- 3. ØªÙˆØ­ÙŠØ¯ tenant_id</span>
<span class="c1">-- (ÙŠØªØ·Ù„Ø¨ migration script Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)</span>

<span class="c1">-- 4. ØªÙˆØ­ÙŠØ¯ ENUMs</span>
<span class="c1">-- (Ø¥Ù†Ø´Ø§Ø¡ lookup tables ÙƒÙ…Ø§ Ù‡Ùˆ Ù…ÙˆØ¶Ø­ Ø£Ø¹Ù„Ø§Ù‡)</span>
</code></pre></div>

<hr />
<h3 id="2-3">ğŸ“‹ <strong>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙ‡Ø§Ø±Ø³ (Ø£Ø³Ø¨ÙˆØ¹ 3)</strong><a class="headerlink" href="#2-3" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- ØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© ÙÙŠ Ø§Ù„Ù‚Ø³Ù… 4</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_chat_messages_sender</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">chat_service</span><span class="p">.</span><span class="n">chat_messages</span><span class="p">(</span><span class="n">sender_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_transactions_wallet_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">marketplace_service</span><span class="p">.</span><span class="n">transactions</span><span class="p">(</span><span class="n">wallet_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">);</span>
<span class="c1">-- ... Ø¥Ù„Ø®</span>
</code></pre></div>

<hr />
<h3 id="3-4">ğŸ“‹ <strong>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚ÙŠÙˆØ¯ (Ø£Ø³Ø¨ÙˆØ¹ 4)</strong><a class="headerlink" href="#3-4" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Ø¥Ø¶Ø§ÙØ© CHECK constraints</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">marketplace_service</span><span class="p">.</span><span class="n">wallets</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">chk_wallet_balance</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="c1">-- ... Ø¥Ù„Ø®</span>
</code></pre></div>

<hr />
<h3 id="4-5-6">ğŸ“‹ <strong>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù‡Ø¬Ø±Ø§Øª (Ø£Ø³Ø¨ÙˆØ¹ 5-6)</strong><a class="headerlink" href="#4-5-6" title="Permanent link">&para;</a></h3>
<ul>
<li>Ø§Ø®ØªÙŠØ§Ø± Ø£Ø¯Ø§Ø© ÙˆØ§Ø­Ø¯Ø© (Ù…Ù‚ØªØ±Ø­: <strong>Liquibase</strong> Ù„Ø¯Ø¹Ù… multi-language)</li>
<li>ØªØ­ÙˆÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‡Ø¬Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¥Ù„Ù‰ changelog Ù…ÙˆØ­Ø¯</li>
<li>Ø¥Ø¹Ø¯Ø§Ø¯ CI/CD Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡Ø¬Ø±Ø§Øª</li>
</ul>
<hr />
<h3 id="5-event-driven-refs-7-10">ğŸ“‹ <strong>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Event-Driven Refs (Ø£Ø³Ø¨ÙˆØ¹ 7-10)</strong><a class="headerlink" href="#5-event-driven-refs-7-10" title="Permanent link">&para;</a></h3>
<ul>
<li>ØªØ·Ø¨ÙŠÙ‚ Event Bus (Kafka/RabbitMQ)</li>
<li>Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯Ø§ÙˆÙ„ shared refs</li>
<li>Ø¥Ø¹Ø¯Ø§Ø¯ CDC Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</li>
</ul>
<hr />
<h3 id="6-3-6">ğŸ“‹ <strong>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: ÙØµÙ„ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø´Ù‡Ø± 3-6)</strong><a class="headerlink" href="#6-3-6" title="Permanent link">&para;</a></h3>
<ul>
<li>Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†ÙØµÙ„Ø© Ù„ÙƒÙ„ Ø®Ø¯Ù…Ø©</li>
<li>ØªØ·Ø¨ÙŠÙ‚ data migration</li>
<li>ØªØ­Ø¯ÙŠØ« connection strings</li>
<li>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„</li>
</ul>
<hr />
<h2 id="11-success-metrics">11. Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­ (Success Metrics)<a class="headerlink" href="#11-success-metrics" title="Permanent link">&para;</a></h2>
<h3 id="_10">âœ… <strong>Ù…Ø¹Ø§ÙŠÙŠØ± ÙÙ†ÙŠØ©:</strong><a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<ul>
<li>âœ“ ØµÙØ± ØªØ¹Ø§Ø±Ø¶Ø§Øª ÙÙŠ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</li>
<li>âœ“ 100% Ø§ØªØ³Ø§Ù‚ ÙÙŠ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
<li>âœ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ø­Ø±Ø¬Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©</li>
<li>âœ“ ØµÙØ± FK Ù…Ø¨Ø§Ø´Ø± Ø¨ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø§Øª</li>
<li>âœ“ Ø¢Ù„ÙŠØ© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ù‡Ø¬Ø±Ø§Øª</li>
</ul>
<h3 id="_11">âœ… <strong>Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡:</strong><a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<ul>
<li>âœ“ Ø²Ù…Ù† Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª &lt; 100ms (P95)</li>
<li>âœ“ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ scale Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ‚Ù„</li>
<li>âœ“ ØµÙØ± deadlocks Ø¨ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø§Øª</li>
</ul>
<h3 id="_12">âœ… <strong>Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØµÙŠØ§Ù†Ø©:</strong><a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<ul>
<li>âœ“ ÙˆØ«Ø§Ø¦Ù‚ ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù…Ø®Ø·Ø·Ø§Øª</li>
<li>âœ“ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª integration ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</li>
<li>âœ“ CI/CD pipeline Ù„Ù„Ù‡Ø¬Ø±Ø§Øª</li>
</ul>
<hr />
<h2 id="12_1">12. Ø§Ù„Ø®Ù„Ø§ØµØ©<a class="headerlink" href="#12_1" title="Permanent link">&para;</a></h2>
<h3 id="_13">ğŸ“Š <strong>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong><a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Ø§Ù„Ù…Ø¹ÙŠØ§Ø±</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
</tr>
</thead>
<tbody>
<tr>
<td>ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª</td>
<td>âŒ</td>
<td>ØªØ¹Ø§Ø±Ø¶Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©</td>
</tr>
<tr>
<td>Ø¹Ø²Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td>
<td>âš ï¸</td>
<td>schemas Ù…Ø´ØªØ±ÙƒØ©</td>
</tr>
<tr>
<td>Ø§Ù„ÙÙ‡Ø§Ø±Ø³</td>
<td>ğŸŸ¡</td>
<td>Ø¬ÙŠØ¯Ø© Ø¬Ø²Ø¦ÙŠØ§Ù‹</td>
</tr>
<tr>
<td>Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td>
<td>âš ï¸</td>
<td>Ù‚ÙŠÙˆØ¯ Ù…ÙÙ‚ÙˆØ¯Ø©</td>
</tr>
<tr>
<td>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡Ø¬Ø±Ø§Øª</td>
<td>âŒ</td>
<td>ØºÙŠØ± Ù…ÙˆØ­Ø¯Ø©</td>
</tr>
<tr>
<td>Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø§Øª</td>
<td>âŒ</td>
<td>FK Ù…Ø¨Ø§Ø´Ø±Ø©</td>
</tr>
<tr>
<td>Ø§Ù„Ø£Ø¯Ø§Ø¡</td>
<td>ğŸŸ¡</td>
<td>Ø¬ÙŠØ¯ Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø©</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="_14">ğŸ¯ <strong>Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©:</strong><a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Monolithic Database)
         â†“
   [Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1-2: ØªÙˆØ­ÙŠØ¯ ÙÙˆØ±ÙŠ]
         â†“
Shared Database with Isolated Schemas
         â†“
   [Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3-5: Event-Driven]
         â†“
Database-per-Service with Event Bus
         â†“
   [Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: ÙØµÙ„ ÙƒØ§Ù…Ù„]
         â†“
  Truly Distributed Microservices
</code></pre></div>

<hr />
<h3 id="_15">âš¡ <strong>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰:</strong><a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p><strong>ÙŠØ¬Ø¨ Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ù‚Ø¨Ù„ Production:</strong></p>
<ol>
<li>ğŸ”´ ØªØ¹Ø§Ø±Ø¶ <code>fields</code> table</li>
<li>ğŸ”´ ØªÙˆØ­ÙŠØ¯ <code>tenant_id</code> type</li>
<li>ğŸ”´ ØªÙˆØ­ÙŠØ¯ ENUMs</li>
<li>ğŸ”´ Ø¥Ù†Ø´Ø§Ø¡ schemas Ù…Ù†ÙØµÙ„Ø©</li>
<li>ğŸ”´ Ø¥Ø¶Ø§ÙØ© Ø¢Ù„ÙŠØ© tracking Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ù‡Ø¬Ø±Ø§Øª</li>
</ol>
<p><strong>Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø²Ù…Ù†ÙŠ:</strong> 2-3 Ø£Ø³Ø§Ø¨ÙŠØ¹ Ù„Ù„Ø­Ù„ Ø§Ù„Ø­Ø±Ø¬</p>
<hr />
<h2 id="13">13. Ù…Ø±Ø§Ø¬Ø¹ Ø¥Ø¶Ø§ÙÙŠØ©<a class="headerlink" href="#13" title="Permanent link">&para;</a></h2>
<h3 id="_16">ğŸ“š <strong>ÙˆØ«Ø§Ø¦Ù‚ Ø°Ø§Øª ØµÙ„Ø©:</strong><a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="./docs/DATABASE.md">Database Schemas Documentation</a></li>
<li><a href="./docs/MIGRATIONS.md">Migration Guide</a></li>
<li><a href="./docs/infrastructure/POSTGIS_OPTIMIZATION.md">PostGIS Optimization</a></li>
<li><a href="../COMPREHENSIVE_REVIEW_REPORT_AR/">Comprehensive Review Report (Arabic)</a></li>
</ul>
<h3 id="_17">ğŸ”§ <strong>Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª:</strong><a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<ul>
<li>Field Core: <code>/apps/services/field-core/prisma/schema.prisma</code></li>
<li>Research Core: <code>/apps/services/research-core/prisma/schema.prisma</code></li>
<li>Marketplace: <code>/apps/services/marketplace-service/prisma/schema.prisma</code></li>
<li>NDVI Engine: <code>/apps/services/ndvi-engine/src/models.py</code></li>
<li>Field Suite: <code>/packages/field_suite/spatial/orm_models.py</code></li>
</ul>
<h3 id="_18">ğŸ› ï¸ <strong>Ù…Ù„ÙØ§Øª Ø§Ù„Ù‡Ø¬Ø±Ø§Øª:</strong><a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<ul>
<li>Infra Migrations: <code>/infra/postgres/migrations/</code></li>
<li>Infra Init: <code>/infra/postgres/init/</code></li>
<li>Alembic Migrations: <code>*/migrations/versions/</code></li>
<li>Prisma Migrations: <code>*/prisma/migrations/</code></li>
</ul>
<hr />
<p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> 2025-12-24
<strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> 1.0
<strong>Ø§Ù„Ù…Ø­Ù„Ù„:</strong> Claude Code Assistant
<strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ğŸ”´ ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙÙˆØ±ÙŠØ©</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>