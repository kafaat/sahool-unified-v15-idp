{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sahool.app/schemas/field.created.v1.json",
  "title": "Field Created Event",
  "description": "Event emitted when a new field is registered in the system",
  "allOf": [
    { "$ref": "base-event.v1.json" }
  ],
  "properties": {
    "event_type": {
      "const": "field.created"
    },
    "event_version": {
      "const": "1.0.0"
    },
    "payload": {
      "type": "object",
      "required": [
        "field_id",
        "tenant_id",
        "name",
        "geometry",
        "area_hectares"
      ],
      "properties": {
        "field_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for the field"
        },
        "tenant_id": {
          "type": "string",
          "format": "uuid",
          "description": "Tenant/organization that owns the field"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 255,
          "description": "Human-readable name for the field"
        },
        "geometry": {
          "type": "object",
          "description": "GeoJSON geometry of the field boundary (RFC 7946 compliant)",
          "required": ["type", "coordinates"],
          "oneOf": [
            {
              "title": "Polygon",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "Polygon"
                },
                "coordinates": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "array",
                    "minItems": 4,
                    "description": "Linear ring with at least 4 positions (first and last must be identical)",
                    "items": {
                      "type": "array",
                      "minItems": 2,
                      "maxItems": 3,
                      "description": "Position [longitude, latitude] or [longitude, latitude, altitude]",
                      "items": {
                        "type": "number"
                      }
                    }
                  }
                }
              },
              "required": ["type", "coordinates"]
            },
            {
              "title": "MultiPolygon",
              "properties": {
                "type": {
                  "type": "string",
                  "const": "MultiPolygon"
                },
                "coordinates": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "array",
                    "minItems": 1,
                    "description": "Array of polygon coordinate arrays",
                    "items": {
                      "type": "array",
                      "minItems": 4,
                      "items": {
                        "type": "array",
                        "minItems": 2,
                        "maxItems": 3,
                        "items": {
                          "type": "number"
                        }
                      }
                    }
                  }
                }
              },
              "required": ["type", "coordinates"]
            }
          ]
        },
        "area_hectares": {
          "type": "number",
          "minimum": 0,
          "description": "Area of the field in hectares"
        },
        "soil_type": {
          "type": "string",
          "enum": ["clay", "sandy", "loam", "silt", "peat", "chalk", "mixed"],
          "description": "Primary soil type of the field"
        },
        "irrigation_type": {
          "type": "string",
          "enum": ["drip", "sprinkler", "flood", "center_pivot", "none"],
          "description": "Irrigation system type"
        },
        "owner_id": {
          "type": "string",
          "format": "uuid",
          "description": "User ID of the field owner"
        },
        "location": {
          "type": "object",
          "properties": {
            "country": { "type": "string" },
            "region": { "type": "string" },
            "governorate": { "type": "string" },
            "district": { "type": "string" }
          }
        }
      },
      "additionalProperties": false
    }
  }
}
