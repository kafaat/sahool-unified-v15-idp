# ==============================================================================
# SAHOOL Dead Letter Queue (DLQ) Configuration
# ==============================================================================
# Add these environment variables to your service configuration
# to enable and configure Dead Letter Queue for failed message handling
# ==============================================================================

# ──────────────────────────────────────────────────────────────────────────────
# DLQ Enable/Disable
# ──────────────────────────────────────────────────────────────────────────────

# Enable Dead Letter Queue for failed messages
# Set to false to use legacy retry logic (not recommended)
DLQ_ENABLED=true

# ──────────────────────────────────────────────────────────────────────────────
# Retry Configuration
# ──────────────────────────────────────────────────────────────────────────────

# Maximum number of retry attempts before moving to DLQ
# Recommended: 3-5 retries
# Min: 1, Max: 10
DLQ_MAX_RETRIES=3

# Initial retry delay in seconds
# First retry waits this long
DLQ_INITIAL_DELAY=1.0

# Maximum retry delay in seconds
# Caps exponential backoff
DLQ_MAX_DELAY=60.0

# Exponential backoff multiplier
# Delay = initial_delay * (multiplier ^ attempt)
# Example: 1.0, 2.0, 4.0, 8.0, 16.0 seconds (multiplier=2.0)
DLQ_BACKOFF_MULTIPLIER=2.0

# ──────────────────────────────────────────────────────────────────────────────
# DLQ Stream Configuration
# ──────────────────────────────────────────────────────────────────────────────

# Name of the JetStream stream for DLQ
# All services should use the same stream name
DLQ_STREAM_NAME=SAHOOL_DLQ

# Subject prefix for DLQ messages
# DLQ subjects: sahool.dlq.field.created, sahool.dlq.weather.alert, etc.
DLQ_SUBJECT_PREFIX=sahool.dlq

# ──────────────────────────────────────────────────────────────────────────────
# DLQ Retention Policy
# ──────────────────────────────────────────────────────────────────────────────

# Maximum age of messages in DLQ (days)
# Messages older than this are automatically deleted
# Recommended: 7-30 days
DLQ_MAX_AGE_DAYS=30

# Maximum number of messages in DLQ stream
# When exceeded, oldest messages are deleted
# Recommended: 50000-100000
DLQ_MAX_MESSAGES=100000

# Maximum bytes in DLQ stream (10 GB default)
# 1 GB  = 1073741824
# 10 GB = 10737418240
DLQ_MAX_BYTES=10737418240

# ──────────────────────────────────────────────────────────────────────────────
# DLQ Monitoring and Alerting
# ──────────────────────────────────────────────────────────────────────────────

# Enable alerting for DLQ accumulation
DLQ_ALERT_ENABLED=true

# Alert when DLQ message count exceeds this threshold
# Triggers monitoring alerts to investigate failures
# Recommended: 50-200
DLQ_ALERT_THRESHOLD=100

# Interval to check DLQ size for alerts (seconds)
# 300 = 5 minutes
# 600 = 10 minutes
DLQ_ALERT_CHECK_INTERVAL=300

# ──────────────────────────────────────────────────────────────────────────────
# Example Configurations for Different Environments
# ──────────────────────────────────────────────────────────────────────────────

# ─── Development Environment ───
# DLQ_MAX_RETRIES=2
# DLQ_INITIAL_DELAY=0.5
# DLQ_MAX_AGE_DAYS=7
# DLQ_MAX_MESSAGES=10000
# DLQ_ALERT_THRESHOLD=50

# ─── Staging Environment ───
# DLQ_MAX_RETRIES=3
# DLQ_INITIAL_DELAY=1.0
# DLQ_MAX_AGE_DAYS=14
# DLQ_MAX_MESSAGES=50000
# DLQ_ALERT_THRESHOLD=100

# ─── Production Environment ───
# DLQ_MAX_RETRIES=5
# DLQ_INITIAL_DELAY=2.0
# DLQ_MAX_DELAY=120.0
# DLQ_MAX_AGE_DAYS=30
# DLQ_MAX_MESSAGES=200000
# DLQ_ALERT_THRESHOLD=200

# ──────────────────────────────────────────────────────────────────────────────
# Service-Specific Overrides
# ──────────────────────────────────────────────────────────────────────────────

# Different services may need different retry policies:

# ─── Critical Services (e.g., billing, payments) ───
# More retries, longer delays
# DLQ_MAX_RETRIES=5
# DLQ_MAX_DELAY=300.0

# ─── High-Volume Services (e.g., iot-gateway) ───
# Fewer retries, shorter delays
# DLQ_MAX_RETRIES=2
# DLQ_MAX_DELAY=30.0

# ─── Notification Service ───
# Moderate retries for delivery attempts
# DLQ_MAX_RETRIES=3
# DLQ_INITIAL_DELAY=5.0
# DLQ_MAX_DELAY=60.0
