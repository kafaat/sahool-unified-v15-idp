# ═══════════════════════════════════════════════════════════════════════════════
# SAHOOL Platform - InfluxDB 2.x Configuration
# إعدادات قاعدة بيانات InfluxDB 2.x
# ═══════════════════════════════════════════════════════════════════════════════
#
# This configuration file provides security-hardened settings for InfluxDB 2.x
# For production use, adjust resource limits based on workload requirements
#
# ═══════════════════════════════════════════════════════════════════════════════

# HTTP Bind Address and Port
bind-address = ":8086"

# TLS Configuration
# Uncomment to enable HTTPS (requires mounted certificates)
# tls-cert = "/etc/ssl/influxdb-cert.pem"
# tls-key = "/etc/ssl/influxdb-key.pem"

# Storage Engine Configuration
[storage-engine]
  # Cache settings - adjust based on available memory
  cache-max-memory-size = 1073741824  # 1GB
  cache-snapshot-memory-size = 26214400  # 25MB
  cache-snapshot-write-cold-duration = "10m"
  compact-full-write-cold-duration = "4h"

# Query Configuration
[query]
  # Maximum number of concurrent queries
  max-concurrent-queries = 100

  # Query timeout (0 = no timeout)
  query-timeout = "120s"

  # Maximum points per query
  max-points-per-query = 0  # unlimited (adjust in production)

  # Max memory bytes a query can use
  max-memory-bytes = 0  # unlimited (adjust in production)

# HTTP Configuration
[http]
  # Enable HTTP service
  enabled = true

  # Bind address
  bind-address = ":8086"

  # Request logging
  access-log-enabled = true

  # Enable Gzip compression
  compression-enabled = true

  # Max row limit (0 = unlimited)
  max-row-limit = 10000

  # Read timeout
  read-timeout = "30s"

  # Write timeout
  write-timeout = "30s"

  # Idle timeout
  idle-timeout = "120s"

# Security Configuration
[security]
  # Session timeout (in minutes)
  session-length = 60

  # Session renewal (renew session before expiration)
  session-renew-disabled = false

# Logging Configuration
[logging]
  # Log level: debug, info, warn, error
  level = "info"

  # Log format: json, logfmt
  format = "logfmt"

# Metrics Configuration
[metrics]
  # Expose Prometheus metrics endpoint at /metrics
  enabled = true

# Data Retention Enforcement
[data]
  # Enforce retention policies (true recommended for production)
  retention-check-enabled = true

  # Retention check interval
  retention-check-interval = "30m"

  # Maximum number of series per database
  max-series-per-database = 10000000

  # Maximum number of values per tag
  max-values-per-tag = 100000

# Rate Limiting (optional - uncomment for production)
# [rate-limit]
#   # Enable rate limiting
#   enabled = true
#
#   # Maximum requests per second
#   max-requests-per-second = 1000
#
#   # Maximum concurrent requests
#   max-concurrent-requests = 500

# Continuous Query Configuration
[continuous-queries]
  # Enable continuous queries
  enabled = true

  # Run interval
  run-interval = "1m"

# Coordinator Configuration
[coordinator]
  # Write timeout
  write-timeout = "30s"

  # Maximum concurrent writes
  max-concurrent-writes = 100

# Performance Tuning
[performance]
  # Maximum number of concurrent series creates
  max-concurrent-series-creates = 100

  # Maximum index log file size
  max-index-log-file-size = "1m"

# ═══════════════════════════════════════════════════════════════════════════════
# NOTES:
# ═══════════════════════════════════════════════════════════════════════════════
#
# 1. TLS Configuration:
#    - Uncomment tls-cert and tls-key lines when certificates are available
#    - Mount certificates via Docker volumes
#
# 2. Memory Limits:
#    - Adjust cache-max-memory-size based on available RAM
#    - Monitor memory usage via /metrics endpoint
#
# 3. Query Limits:
#    - Set max-points-per-query to prevent resource exhaustion
#    - Adjust query-timeout based on typical query patterns
#
# 4. Rate Limiting:
#    - Enable in production to prevent abuse
#    - Adjust limits based on expected load
#
# 5. Monitoring:
#    - Metrics endpoint enabled by default
#    - Integrate with Prometheus for monitoring
#
# ═══════════════════════════════════════════════════════════════════════════════
